(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"+x/n":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){if(!r)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(i)};var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),i=new Uint8Array(16);e.exports=t.default},"4TD3":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;for(var r=[],i=0;i<256;++i)r[i]=(i+256).toString(16).substr(1);var a=function(e,t){var n=t||0,i=r;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")};t.default=a,e.exports=t.default},GmzI:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("aHma")),i=a(n("u4r5"));function a(e){return e&&e.__esModule?e:{default:e}}var o=(0,r.default)("v5",80,i.default);t.default=o,e.exports=t.default},RaMe:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i,a=s(n("+x/n")),o=s(n("4TD3"));function s(e){return e&&e.__esModule?e:{default:e}}var c=0,u=0;var l=function(e,t,n){var s=t&&n||0,l=t||[],h=(e=e||{}).node||r,d=void 0!==e.clockseq?e.clockseq:i;if(null==h||null==d){var f=e.random||(e.rng||a.default)();null==h&&(h=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==d&&(d=i=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:u+1,m=p-c+(v-u)/1e4;if(m<0&&void 0===e.clockseq&&(d=d+1&16383),(m<0||p>c)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");c=p,u=v,i=d;var g=(1e4*(268435455&(p+=122192928e5))+v)%4294967296;l[s++]=g>>>24&255,l[s++]=g>>>16&255,l[s++]=g>>>8&255,l[s++]=255&g;var y=p/4294967296*1e4&268435455;l[s++]=y>>>8&255,l[s++]=255&y,l[s++]=y>>>24&15|16,l[s++]=y>>>16&255,l[s++]=d>>>8|128,l[s++]=255&d;for(var b=0;b<6;++b)l[s+b]=h[b];return t||(0,o.default)(l)};t.default=l,e.exports=t.default},aHma:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n){var r=function(e,r,a,o){var s=a&&o||0;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(e)),"string"==typeof r&&(r=function(e){var t=[];return e.replace(/[a-fA-F0-9]{2}/g,(function(e){t.push(parseInt(e,16))})),t}(r)),!Array.isArray(e))throw TypeError("value must be an array of bytes");if(!Array.isArray(r)||16!==r.length)throw TypeError("namespace must be uuid string or an Array of 16 byte values");var c=n(r.concat(e));if(c[6]=15&c[6]|t,c[8]=63&c[8]|128,a)for(var u=0;u<16;++u)a[s+u]=c[u];return a||(0,i.default)(c)};try{r.name=e}catch(e){}return r.DNS=a,r.URL=o,r},t.URL=t.DNS=void 0;var r,i=(r=n("4TD3"))&&r.__esModule?r:{default:r};var a="6ba7b810-9dad-11d1-80b4-00c04fd430c8";t.DNS=a;var o="6ba7b811-9dad-11d1-80b4-00c04fd430c8";t.URL=o},cIdt:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("+x/n")),i=a(n("4TD3"));function a(e){return e&&e.__esModule?e:{default:e}}var o=function(e,t,n){var a=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r.default)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[a+s]=o[s];return t||(0,i.default)(o)};t.default=o,e.exports=t.default},lOZ2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"v1",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"v3",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"v4",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"v5",{enumerable:!0,get:function(){return o.default}});var r=s(n("RaMe")),i=s(n("zLF4")),a=s(n("cIdt")),o=s(n("GmzI"));function s(e){return e&&e.__esModule?e:{default:e}}},pMVe:function(e,t,n){"use strict";function r(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function i(e,t,n,i,a,o){return r((s=r(r(t,e),r(i,o)))<<(c=a)|s>>>32-c,n);var s,c}function a(e,t,n,r,a,o,s){return i(t&n|~t&r,e,t,a,o,s)}function o(e,t,n,r,a,o,s){return i(t&r|n&~r,e,t,a,o,s)}function s(e,t,n,r,a,o,s){return i(t^n^r,e,t,a,o,s)}function c(e,t,n,r,a,o,s){return i(n^(t|~r),e,t,a,o,s)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var u=function(e){if("string"==typeof e){var t=unescape(encodeURIComponent(e));e=new Array(t.length);for(var n=0;n<t.length;n++)e[n]=t.charCodeAt(n)}return function(e){var t,n,r,i=[],a=32*e.length;for(t=0;t<a;t+=8)n=e[t>>5]>>>t%32&255,r=parseInt("0123456789abcdef".charAt(n>>>4&15)+"0123456789abcdef".charAt(15&n),16),i.push(r);return i}(function(e,t){var n,i,u,l,h;e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;var d=1732584193,f=-271733879,p=-1732584194,v=271733878;for(n=0;n<e.length;n+=16)i=d,u=f,l=p,h=v,d=a(d,f,p,v,e[n],7,-680876936),v=a(v,d,f,p,e[n+1],12,-389564586),p=a(p,v,d,f,e[n+2],17,606105819),f=a(f,p,v,d,e[n+3],22,-1044525330),d=a(d,f,p,v,e[n+4],7,-176418897),v=a(v,d,f,p,e[n+5],12,1200080426),p=a(p,v,d,f,e[n+6],17,-1473231341),f=a(f,p,v,d,e[n+7],22,-45705983),d=a(d,f,p,v,e[n+8],7,1770035416),v=a(v,d,f,p,e[n+9],12,-1958414417),p=a(p,v,d,f,e[n+10],17,-42063),f=a(f,p,v,d,e[n+11],22,-1990404162),d=a(d,f,p,v,e[n+12],7,1804603682),v=a(v,d,f,p,e[n+13],12,-40341101),p=a(p,v,d,f,e[n+14],17,-1502002290),f=a(f,p,v,d,e[n+15],22,1236535329),d=o(d,f,p,v,e[n+1],5,-165796510),v=o(v,d,f,p,e[n+6],9,-1069501632),p=o(p,v,d,f,e[n+11],14,643717713),f=o(f,p,v,d,e[n],20,-373897302),d=o(d,f,p,v,e[n+5],5,-701558691),v=o(v,d,f,p,e[n+10],9,38016083),p=o(p,v,d,f,e[n+15],14,-660478335),f=o(f,p,v,d,e[n+4],20,-405537848),d=o(d,f,p,v,e[n+9],5,568446438),v=o(v,d,f,p,e[n+14],9,-1019803690),p=o(p,v,d,f,e[n+3],14,-187363961),f=o(f,p,v,d,e[n+8],20,1163531501),d=o(d,f,p,v,e[n+13],5,-1444681467),v=o(v,d,f,p,e[n+2],9,-51403784),p=o(p,v,d,f,e[n+7],14,1735328473),f=o(f,p,v,d,e[n+12],20,-1926607734),d=s(d,f,p,v,e[n+5],4,-378558),v=s(v,d,f,p,e[n+8],11,-2022574463),p=s(p,v,d,f,e[n+11],16,1839030562),f=s(f,p,v,d,e[n+14],23,-35309556),d=s(d,f,p,v,e[n+1],4,-1530992060),v=s(v,d,f,p,e[n+4],11,1272893353),p=s(p,v,d,f,e[n+7],16,-155497632),f=s(f,p,v,d,e[n+10],23,-1094730640),d=s(d,f,p,v,e[n+13],4,681279174),v=s(v,d,f,p,e[n],11,-358537222),p=s(p,v,d,f,e[n+3],16,-722521979),f=s(f,p,v,d,e[n+6],23,76029189),d=s(d,f,p,v,e[n+9],4,-640364487),v=s(v,d,f,p,e[n+12],11,-421815835),p=s(p,v,d,f,e[n+15],16,530742520),f=s(f,p,v,d,e[n+2],23,-995338651),d=c(d,f,p,v,e[n],6,-198630844),v=c(v,d,f,p,e[n+7],10,1126891415),p=c(p,v,d,f,e[n+14],15,-1416354905),f=c(f,p,v,d,e[n+5],21,-57434055),d=c(d,f,p,v,e[n+12],6,1700485571),v=c(v,d,f,p,e[n+3],10,-1894986606),p=c(p,v,d,f,e[n+10],15,-1051523),f=c(f,p,v,d,e[n+1],21,-2054922799),d=c(d,f,p,v,e[n+8],6,1873313359),v=c(v,d,f,p,e[n+15],10,-30611744),p=c(p,v,d,f,e[n+6],15,-1560198380),f=c(f,p,v,d,e[n+13],21,1309151649),d=c(d,f,p,v,e[n+4],6,-145523070),v=c(v,d,f,p,e[n+11],10,-1120210379),p=c(p,v,d,f,e[n+2],15,718787259),f=c(f,p,v,d,e[n+9],21,-343485551),d=r(d,i),f=r(f,u),p=r(p,l),v=r(v,h);return[d,f,p,v]}(function(e){var t,n=[];for(n[(e.length>>2)-1]=void 0,t=0;t<n.length;t+=1)n[t]=0;var r=8*e.length;for(t=0;t<r;t+=8)n[t>>5]|=(255&e[t/8])<<t%32;return n}(e),8*e.length))};t.default=u,e.exports=t.default},u4r5:function(e,t,n){"use strict";function r(e,t,n,r){switch(e){case 0:return t&n^~t&r;case 1:return t^n^r;case 2:return t&n^t&r^n&r;case 3:return t^n^r}}function i(e,t){return e<<t|e>>>32-t}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function(e){var t=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){var a=unescape(encodeURIComponent(e));e=new Array(a.length);for(var o=0;o<a.length;o++)e[o]=a.charCodeAt(o)}e.push(128);var s=e.length/4+2,c=Math.ceil(s/16),u=new Array(c);for(o=0;o<c;o++){u[o]=new Array(16);for(var l=0;l<16;l++)u[o][l]=e[64*o+4*l]<<24|e[64*o+4*l+1]<<16|e[64*o+4*l+2]<<8|e[64*o+4*l+3]}for(u[c-1][14]=8*(e.length-1)/Math.pow(2,32),u[c-1][14]=Math.floor(u[c-1][14]),u[c-1][15]=8*(e.length-1)&4294967295,o=0;o<c;o++){for(var h=new Array(80),d=0;d<16;d++)h[d]=u[o][d];for(d=16;d<80;d++)h[d]=i(h[d-3]^h[d-8]^h[d-14]^h[d-16],1);var f=n[0],p=n[1],v=n[2],m=n[3],g=n[4];for(d=0;d<80;d++){var y=Math.floor(d/20),b=i(f,5)+r(y,p,v,m)+g+t[y]+h[d]>>>0;g=m,m=v,v=i(p,30)>>>0,p=f,f=b}n[0]=n[0]+f>>>0,n[1]=n[1]+p>>>0,n[2]=n[2]+v>>>0,n[3]=n[3]+m>>>0,n[4]=n[4]+g>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]};t.default=a,e.exports=t.default},w318:function(e,t,n){"use strict";(function(e,r,i){var a;function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){return f(e)||v(e)||E(e)||d()}function c(e,t,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function u(e,t,n,r,i,a,o){try{var s=e[a](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(r,i)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){u(a,r,i,o,s,"next",e)}function s(e){u(a,r,i,o,s,"throw",e)}o(void 0)}))}}function h(e,t){return f(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}(e,t)||E(e,t)||d()}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e){if(Array.isArray(e))return e}function p(e){return function(e){if(Array.isArray(e))return O(e)}(e)||v(e)||E(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function m(e){var t="function"==typeof Map?new Map:void 0;return(m=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return g(e,arguments,C(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),b(n,e)})(e)}function g(e,t,n){return(g=x()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&b(i,n.prototype),i}).apply(null,arguments)}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function k(e){var t=x();return function(){var n,r=C(e);if(t){var i=C(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w(this,n)}}function w(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?S(e):t}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function x(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function M(e,t,n){return t&&P(e.prototype,t),n&&P(e,n),e}function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=E(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function E(e,t){if(e){if("string"==typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n("pNMO"),n("4Brf"),n("0oug"),n("ma9I"),n("piMb"),n("yyme"),n("TeQF"),n("fbCW"),n("x0AG"),n("QWBl"),n("pjDv"),n("yq1k"),n("yXV3"),n("4mDm"),n("uqXc"),n("2B1R"),n("E9XD"),n("9N29"),n("Junv"),n("+2oP"),n("Rfxz"),n("ToJy"),n("pDQq"),n("wZ/5"),n("rOQg"),n("9LPj"),n("Tskq"),n("qePV"),n("i6QF"),n("WDsR"),n("r/Vq"),n("5uH8"),n("w1rZ"),n("JevA"),n("zKZe"),n("3KgV"),n("5DmW"),n("27RR"),n("cDke"),n("NBAS"),n("tkto"),n("r5Og"),n("ExoC"),n("07d7"),n("rNhl"),n("4l63"),n("5s+n"),n("SuFq"),n("XUE8"),n("TWNs"),n("rB9j"),n("JfAA"),n("YGK4"),n("9bJ7"),n("inlA"),n("9tb/"),n("JTJg"),n("PKPk"),n("Rm1S"),n("TZCg"),n("OM9Z"),n("UxlC"),n("hByQ"),n("EnZy"),n("LKBx"),n("SYor"),n("XMab"),n("moxL"),n("qXVe"),n("c162"),n("waxf"),n("0TkE"),n("Onu3"),n("1dYe"),n("gvgV"),n("6R/c"),n("YL0P"),n("X5Zq"),n("MoCz"),n("P8wP"),n("ypFw"),n("JaFt"),n("zSZm"),n("KVSy"),n("ZJ55"),n("IZzc"),n("s5qe"),n("cvf0"),n("ENF9"),n("H+LF"),n("FZtP"),n("3bBZ"),n("Kz25"),n("vxnP"),n("ls82");var R=Object.create,N=Object.defineProperty,L=Object.defineProperties,j=Object.getOwnPropertyDescriptor,D=Object.getOwnPropertyDescriptors,F=Object.getOwnPropertyNames,z=Object.getOwnPropertySymbols,B=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable,W=function(e,t,n){return t in e?N(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},H=function(e,t){for(var n in t||(t={}))U.call(t,n)&&W(e,n,t[n]);if(z){var r,i=A(z(t));try{for(i.s();!(r=i.n()).done;){n=r.value;V.call(t,n)&&W(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},_=function(e,t){return L(e,D(t))},G=function(e){return N(e,"__esModule",{value:!0})},Y=function(e,t){for(var n in G(e),t)N(e,n,{get:t[n],enumerable:!0})},X=function(e){return function(e,t,n){if(t&&"object"==T(t)||"function"==typeof t){var r,i=A(F(t));try{var a=function(){var i=r.value;!U.call(e,i)&&"default"!==i&&N(e,i,{get:function(){return t[i]},enumerable:!(n=j(t,i))||n.enumerable})};for(i.s();!(r=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}}return e}(G(N(null!=e?R(B(e)):{},"default",e&&e.__esModule&&"default"in e?{get:function(){return e.default},enumerable:!0}:{value:e,enumerable:!0})),e)},q=function(e,t,n,r){for(var i,a=r>1?void 0:r?j(t,n):t,o=e.length-1;o>=0;o--)(i=e[o])&&(a=(r?i(t,n,a):i(a))||a);return r&&a&&N(t,n,a),a};Y(t,{AdminObserverId:function(){return hn},AkkoVersion:function(){return We},AnimationMode:function(){return bd},ApplianceNames:function(){return SS},AsyncModuleLoadMode:function(){return Dk},CNode:function(){return El},CursorNames:function(){return Xx},DefaultHotKeys:function(){return cw},DeviceType:function(){return ld},DisplayerConsumer:function(){return NS},EventPhase:function(){return dr},EventScope:function(){return Ln},InvisiblePlugin:function(){return BS},KeyboardKind:function(){return Jk},LoggerReportMode:function(){return HC},ObserverMode:function(){return lC},PPTKind:function(){return ww},PPTTaskStatus:function(){return Sw},PPTTaskStep:function(){return xw},PlayerConsumer:function(){return jS},PlayerPhase:function(){return cC},RenderEngine:function(){return WS},RoomConsumer:function(){return LS},RoomErrorLevel:function(){return mx},RoomPhase:function(){return vx},ScenePathType:function(){return CS},ScreenType:function(){return KC},ShapeType:function(){return wS},UpdateEventKind:function(){return ci},ViewMode:function(){return HS},ViewVisionMode:function(){return ix},WhiteVersion:function(){return eI},WhiteWebSdk:function(){return ZC},autorun:function(){return Yk.autorun},contentModeAspectFill:function(){return vS},contentModeAspectFillScale:function(){return mS},contentModeAspectFit:function(){return gS},contentModeAspectFitScale:function(){return bS},contentModeAspectFitSpace:function(){return yS},contentModeScale:function(){return pS},createPPTTask:function(){return Rw},createPlugins:function(){return DS},injectCustomStyle:function(){return eC},isPlayer:function(){return $C},isRoom:function(){return JC},listenDisposed:function(){return po},listenUpdated:function(){return ho},previewPPT:function(){return yk},reaction:function(){return Yk.reaction},setAsyncModuleLoadMode:function(){return Wk},toJS:function(){return is},unlistenDisposed:function(){return vo},unlistenUpdated:function(){return fo}});var Q={sdkVersion:"2.15.13",defaultRegion:"cn-hz",modules:{identifier:"link.netless/white-model-render",origin:"https://sdk.netless.link"},shuntApiHosts:["api.netless.link"],hosts:{pptApi:"api.netless.link"},log:{argusOptions:{reportResourceURL:"https://rest-argus-ad.agoralab.co/v3/report",vid:3}}};(0,X(n("0yMQ")).configure)({useProxies:window.__netlessMobXUseProxies,isolateGlobalState:!0});X(n("HrR1"));var K={};Y(K,{ActionFrameType:function(){return Nn},AdminObserverId:function(){return hn},AkkoApp:function(){return Oc},AkkoFetcher:function(){return Je},AkkoVersion:function(){return We},Environment:function(){return Ar},EventPhase:function(){return dr},EventScope:function(){return Ln},FramePicker:function(){return Jn},ImagePhase:function(){return Vi},KickReason:function(){return si},Library:function(){return $r},MagixPhase:function(){return pc},ReconstructorFactory:function(){return Ec},ReconstructorPhase:function(){return Cc},ReconstructorSeekingResult:function(){return Ic},SocketErrorCode:function(){return Ai},UpdateEventKind:function(){return ci},__context:function(){return li},copy:function(){return is},createBuffer:function(){return ye},createElement:function(){return ga},event:function(){return kr},findClass:function(){return rs},findClassId:function(){return ns},findIdentifierWith:function(){return Co},getAuthorId:function(){return mi},getClassReflection:function(){return fi},getCurrentTimestamp:function(){return vi},getEnvironment:function(){return pi},getLibrary:function(){return hi},getResource:function(){return Rr},getSnapshot:function(){return wi},getUser:function(){return bi},getUserIds:function(){return ki},getUsersCount:function(){return yi},hasUser:function(){return gi},isAkkoObject:function(){return di},isAkkoWrappedObject:function(){return eo},isAkkoWrappedObjectAccessible:function(){return es},isBuffer:function(){return ke},isInstanceOf:function(){return ts},listenDisposed:function(){return po},listenUpdated:function(){return ho},noEffects:function(){return pr},resolve:function(){return Ce},socketFactory:function(){return Ei},transient:function(){return fr},translateToAckFrame:function(){return Zn},unlistenDisposed:function(){return vo},unlistenUpdated:function(){return fo},wrapBuffer:function(){return be}});var Z=Object.defineProperty,J=Object.defineProperties,$=Object.getOwnPropertyDescriptors,ee=Object.getOwnPropertySymbols,te=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable,re=function(e,t,n){return t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},ie=function(e,t){for(var n in t||(t={}))te.call(t,n)&&re(e,n,t[n]);if(ee){var r,i=A(ee(t));try{for(i.s();!(r=i.n()).done;){n=r.value;ne.call(t,n)&&re(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},ae=function(e,t){return J(e,$(t))},oe=function(){function e(){I(this,e)}return M(e,[{key:"id",get:function(){return void 0===this._id&&(this._id="".concat(e.nextBufferId),e.nextBufferId+=1),this._id}}]),e}();oe.nextBufferId=0;var se=function(){for(var e={},t=0;t<256;++t){var n=t.toString(16);1===n.length&&(e["0"+n]=t),e[n]=t}return Object.freeze(e)}(),ce=function(){for(var e=[],t=0;t<256;++t){var n=t.toString(16);1===n.length?e[t]="0"+n:e[t]=n}return Object.freeze(e)}();function ue(e,t,n){for(var r=new String(new Number(n).toString(16)),i=16-r.length,a=0;a<8;++a){var o=2*a-i;if(o<-1)e.setUint8(t+a,0);else if(-1===o){var s=r.substr(0,1),c=se[s];e.setUint8(t+a,c)}else{var u=r.substr(o,2),l=se[u];e.setUint8(t+a,l)}}}function le(e,t){for(var n="",r=0;r<8;++r){var i=e.getUint8(t+r);n+=ce[i]}return parseInt(n,16)}var he,de,fe=function(e){y(n,e);var t=k(n);function n(e,r){var i;return I(this,n),(i=t.call(this)).buffer=e,i.create=r,i}return M(n,[{key:"readonly",get:function(){return!0}},{key:"byteLength",get:function(){return this.buffer.byteLength}},{key:"primitiveBuffer",get:function(){return this.buffer}},{key:"isEqualsTo",value:function(e){if(this.byteLength!==e.byteLength)return!1;for(var t=0;t<this.byteLength;++t)if(this.getUint8(t)!==e.getUint8(t))return!1;return!0}},{key:"slice",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.buffer.length-e,n=this.create(t),r=n.buffer,i=0;i<t;++i)r.writeUInt8(this.buffer.readUInt8(e+i),i);return n}},{key:"getFloat64",value:function(e){return this.buffer.readDoubleLE(e)}},{key:"getUint16",value:function(e){return this.buffer.readUInt16LE(e)}},{key:"getInt32",value:function(e){return this.buffer.readInt32LE(e)}},{key:"getUint32",value:function(e){return this.buffer.readUInt32LE(e)}},{key:"getUint8",value:function(e){return this.buffer.readUInt8(e)}},{key:"getUint64",value:function(e){return le(this,e)}}]),n}(oe),pe=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"readonly",get:function(){return!1}},{key:"freeze",value:function(){return Object.setPrototypeOf(this,fe.prototype),this}},{key:"fill",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.byteLength-n,i=e.primitiveBuffer;if(i instanceof ArrayBuffer){for(var a=new DataView(i),o=this.buffer.byteLength-t,s=Math.min(r,o),c=0;c<s;++c)this.buffer.writeUInt8(a.getUint8(c+n),c+t);return s}return i.copy(this.buffer,t,n,n+r)}},{key:"setFloat64",value:function(e,t){this.buffer.writeDoubleLE(t,e)}},{key:"setUint16",value:function(e,t){this.buffer.writeUInt16LE(t,e)}},{key:"setInt32",value:function(e,t){this.buffer.writeInt32LE(t,e)}},{key:"setUint32",value:function(e,t){this.buffer.writeUInt32LE(t,e)}},{key:"setUint8",value:function(e,t){this.buffer.writeUInt8(t,e)}},{key:"setUint64",value:function(e,t){ue(this,e,t)}}]),n}(fe),ve=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this)).arrayBuffer=e,r.dataView=new DataView(e),r}return M(n,[{key:"readonly",get:function(){return!0}},{key:"byteLength",get:function(){return this.arrayBuffer.byteLength}},{key:"primitiveBuffer",get:function(){return this.arrayBuffer}},{key:"isEqualsTo",value:function(e){if(this.byteLength!==e.byteLength)return!1;for(var t=0;t<this.byteLength;++t)if(this.getUint8(t)!==e.getUint8(t))return!1;return!0}},{key:"slice",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.dataView.byteLength-e,n=new ArrayBuffer(t),r=new DataView(n),i=0;i<t;++i)r.setUint8(i,this.dataView.getUint8(e+i));return new me(n)}},{key:"getFloat64",value:function(e){return this.dataView.getFloat64(e,!0)}},{key:"getUint16",value:function(e){return this.dataView.getUint16(e,!0)}},{key:"getInt32",value:function(e){return this.dataView.getInt32(e,!0)}},{key:"getUint32",value:function(e){return this.dataView.getUint32(e,!0)}},{key:"getUint8",value:function(e){return this.dataView.getUint8(e)}},{key:"getUint64",value:function(e){return le(this,e)}}]),n}(oe),me=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"readonly",get:function(){return!1}},{key:"freeze",value:function(){return Object.setPrototypeOf(this,ve.prototype),this}},{key:"fill",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.MAX_SAFE_INTEGER,i=e.primitiveBuffer,a=this.dataView.byteLength-t,o=Math.min(r,a);if(i instanceof ArrayBuffer)for(var s=new DataView(i),c=0;c<o;++c)this.dataView.setUint8(c+t,s.getUint8(c+n));else for(var u=0;u<o;++u)this.dataView.setUint8(u+t,i.readUInt8(u+n));return o}},{key:"setFloat64",value:function(e,t){this.dataView.setFloat64(e,t,!0)}},{key:"setUint16",value:function(e,t){this.dataView.setUint16(e,t,!0)}},{key:"setInt32",value:function(e,t){this.dataView.setInt32(e,t,!0)}},{key:"setUint32",value:function(e,t){this.dataView.setUint32(e,t,!0)}},{key:"setUint8",value:function(e,t){this.dataView.setUint8(e,t)}},{key:"setUint64",value:function(e,t){ue(this,e,t)}}]),n}(ve),ge=new function t(){var n=this;I(this,t),this.create=function(e){return n.nodeBuffer?new pe(n.nodeBuffer.alloc(e),n.create):new me(new ArrayBuffer(e))},this.wrap=function(e){return n.nodeBuffer&&e instanceof n.nodeBuffer?new pe(e,n.create):new me(e)},this.nodeBuffer="function"==typeof e?r.Buffer:null},ye=ge.create,be=ge.wrap;function ke(e){return e instanceof fe||e instanceof ve}(de=he||(he={})).Any="any",de.Never="never",de.Undefined="undefined",de.Null="null",de.String="string",de.Number="number",de.Boolean="boolean",de.Function="function",de.Object="object",de.And="and",de.Or="or",de.Generic="generic",de.Generator="generator",de.Reference="reference",de.GlobalReference="globalReference";var we=new(function(){function e(){I(this,e),this.singletonMap=e.createSingletonMap()}return M(e,[{key:"getSingletonType",value:function(e){return this.singletonMap[e]}},{key:"getFunctionType",value:function(){return{typeEnum:he.Function}}},{key:"getObjectType",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.key,n=e.index,r=e.properties;return{typeEnum:he.Object,key:t||this.getSingletonType(he.Undefined),index:n||this.getSingletonType(he.Undefined),properties:r||{}}}},{key:"getCompoundType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{typeEnum:e,children:t}}},{key:"getGenericType",value:function(e){return{index:e,typeEnum:he.Generic}}},{key:"getGeneratorType",value:function(e){var t=e.template,n=e.params;return{typeEnum:he.Generator,template:t,params:n||[]}}},{key:"getReferenceType",value:function(e){return{typeEnum:he.Reference,name:e}}},{key:"getGlobalReferenceType",value:function(e,t){return{typeEnum:he.GlobalReference,path:e,name:t}}}],[{key:"createSingletonMap",value:function(){for(var e={},t=0,n=[he.Any,he.Never,he.Undefined,he.Null,he.String,he.Number,he.Boolean];t<n.length;t++){var r=n[t];e[r]={typeEnum:r}}return Object.freeze(e)}}]),e}()),Se=(we.getSingletonType.bind(we),we.getFunctionType.bind(we),we.getObjectType.bind(we),we.getCompoundType.bind(we),we.getGenericType.bind(we),we.getGeneratorType.bind(we),we.getReferenceType.bind(we),we.getGlobalReferenceType.bind(we),function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).name="RuntimeError",r}return n}(m(Error))),xe=function(){function e(t,n,r,i){I(this,e),this.akkoVersion=t,this.akkoObjectBaseClass=n,this.libraryFactory=r,this.onCreatedLibrary=i,this.classHandlers={}}return M(e,[{key:"baseClass",value:function(){return this.akkoObjectBaseClass}},{key:"wrapSuperClass",value:function(e){if(e===Object)return this.akkoObjectBaseClass;if("function"!=typeof e)return e;for(var t=e;t!==this.akkoObjectBaseClass;){var n=Object.getPrototypeOf(t.prototype);if(!n)throw new Se("class ".concat(e.name," can't be extended, it's out of library"));t=n.constructor}return e}},{key:"declareClass",value:function(e){var t=e.classId,n=e.clazz,r=e.superClass,i=e.memberDecorators;if(this.classHandlers[t])throw new Se("class id ".concat(t," was declared"));this.classHandlers[t]={classId:t,clazz:n,superClass:r,memberDecorators:i||{}}}},{key:"createLibrary",value:function(e,t){var n={};for(var r in t.classes){var i,a=t.classes[r],o=this.classHandlers[r],s=[],c=A(a.members);try{for(c.s();!(i=c.n()).done;){var u=i.value,l=o.memberDecorators[u.name];s.push(ae(ie({},u),{decorators:l||Object.freeze([])}))}}catch(e){c.e(e)}finally{c.f()}n[r]={classId:o.classId,clazz:o.clazz,superClass:o.superClass,objectFormatId:a.objectFormatId,members:s}}var h=this.libraryFactory({appIdentifier:t.identifier,appVersion:t.version,akkoVersion:t.akko,formatBase64:t.formatBase64,formatHash:t.formatHash,rootConstructor:e,classDeclarations:n});return Object.defineProperty(e,"__library",{enumerable:!1,configurable:!1,writable:!1,value:h}),this.onCreatedLibrary(h),e}}]),e}();function Ce(){for(var e=[],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.map((function(e){return Ie(e)})).forEach((function(t){e=0!==e.length&&Pe(t)?Me(e,t):t})),e.join("/")}function Ie(e){var t=e.split("/");return t.length>0&&("."===t[0]&&t.shift(),""===t[t.length-1]&&t.pop()),t}function Pe(e){return e.length>0&&""!==e[0]}function Me(e,t){var n=Te(e),r=Te(t);if(n.pureCells.length>r.doubleDotsCount){for(var i=0;i<r.doubleDotsCount;++i)n.pureCells.pop();return[].concat(p(Ae(n.doubleDotsCount)),p(n.pureCells),p(r.pureCells))}var a=r.doubleDotsCount-n.pureCells.length;return[].concat(p(Ae(n.doubleDotsCount+a)),p(r.pureCells))}function Te(e){var t,n=[],r=0,i=A(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;".."===a?r+=1:n.push(a)}}catch(e){i.e(e)}finally{i.f()}return{doubleDotsCount:r,pureCells:n}}function Ae(e){for(var t=[],n=0;n<e;++n)t.push("..");return t}var Ee,Oe,Re=function e(t){var n=this;I(this,e),this.contextsStack=[],this.context=function(e){switch(e){case"index":var t=function(e){var t=new xe(e.akkoVersion,e.akkoObjectBaseClass,e.libraryFactory,e.onCreatedLibrary);return Object.freeze({baseClass:t.baseClass.bind(t),wrapSuperClass:t.wrapSuperClass.bind(t),declareClass:t.declareClass.bind(t),createLibrary:t.createLibrary.bind(t),creator:e.coreFunctions.creator,updater:e.coreFunctions.updater,wrapper:e.coreFunctions.wrapper,unwrapper:e.coreFunctions.unwrapper,jsxUnwrapper:e.coreFunctions.jsxUnwrapper,getter:e.coreFunctions.getter,setter:e.coreFunctions.setter,caller:e.coreFunctions.caller,remover:e.coreFunctions.remover,prefix:e.coreFunctions.prefix,postfix:e.coreFunctions.postfix})}({akkoVersion:n.akkoVersion,akkoObjectBaseClass:n.akkoObjectBaseClass,libraryFactory:n.libraryFactory,coreFunctions:n.coreFunctions,onCreatedLibrary:function(){return n.contextsStack.pop()}});return n.contextsStack.push(t),t;case"module":var r=n.contextsStack[n.contextsStack.length-1];if(!r)throw new Se("can't import index out of library");return r;default:throw new Se("unexpect mode ".concat(JSON.stringify(e)))}},this.isAkkoObject=function(e){return e instanceof n.akkoObjectBaseClass},this.getLibrary=function(e){if("function"==typeof e){var t=e.__library;if("object"==T(t))return t}else if(n.isAkkoObject(e))return n.getLibrary(e.constructor)},this.akkoVersion=t.akkoVersion,this.akkoObjectBaseClass=t.akkoObjectBaseClass,this.libraryFactory=t.libraryFactory,this.coreFunctions=Object.freeze(ie({},t.coreFunctions))};function Ne(e){return e.type===Ee.Property}function Le(e){return e.type===Ee.Method}!function(e){e.Method="method",e.Property="property"}(Ee||(Ee={})),function(e){e.Value="value",e.Readonly="readonly",e.Writeonly="writeonly",e.Accessible="accessible"}(Oe||(Oe={}));var je=function(){function e(t){var n=this;I(this,e),this.invoker=t,this.timer=null,this.fireAt=-1,this.invokeWhenTimeout=function(){var e=Date.now();if(e>=n.fireAt)n.timer=null,n.fireAt=-1,n.invoker();else{var t=n.fireAt-e;n.timer=setTimeout(n.invokeWhenTimeout,t)}}}return M(e,[{key:"isRunning",get:function(){return null!==this.timer}},{key:"refreshAndInvokeAfterInterval",value:function(e){var t=Date.now();if(null===this.timer)this.timer=setTimeout(this.invokeWhenTimeout,e),this.fireAt=t+e;else{var n=t+e;n<=this.fireAt&&(clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)),this.fireAt=n}}},{key:"cancel",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}}]),e}();function De(e){return"object"==("undefined"==typeof window?"undefined":T(window))&&"requestIdleCallback"in window?new ze(e):new Fe}var Fe=function(){function e(){I(this,e)}return M(e,[{key:"invokeOnIdle",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new Promise((function(t,r){try{t(e.apply(void 0,n))}catch(e){r(e)}}))}},{key:"invoke",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.apply(void 0,n)}}]),e}(),ze=function(){function e(t){var n=this;I(this,e),this.queue=[],this.isWaitingIdle=!1,this.onFire=function(){try{if(n.queue.length>0){var e,t=n.config,r=t.checkingTimeMod,i=t.maxInvokingDuration,a=t.maxPaddingDuration,o=Date.now();for(e=0;e<n.queue.length;++e){var s=n.queue[e];if(n.handle(s),o<s.beginAt+a&&0!==e&&e%r==0&&Date.now()-o>i)break}n.queue.splice(0,e+1),n.isWaitingIdle=!1,n.queue.length>0&&n.requestNextFire()}}catch(r){console.error("[Error] IdleQueue is crash (akko-core)"),console.error(r)}},this.handle=function(e){var t=e.invoker,n=e.params,r=e.resolve,i=e.reject;try{r(t.apply(void 0,p(n)))}catch(e){i(e)}},this.config=Object.freeze(ie({},t))}return M(e,[{key:"invoke",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return this.queue.length>0&&this.queue.splice(0).forEach(this.handle),e.apply(void 0,n)}},{key:"invokeOnIdle",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return new Promise((function(n,i){var a=Date.now();t.queue.push({invoker:e,params:r,beginAt:a,resolve:n,reject:i}),!t.isWaitingIdle&&1===t.queue.length&&(t.isWaitingIdle=!0,t.requestNextFire())}))}},{key:"requestNextFire",value:function(){window.requestIdleCallback(this.onFire,{timeout:this.config.timeout})}}]),e}(),Be=function(){function e(t,n){I(this,e),this.isFreezed=!1,this.shouldInvokeAfterFreeze=!1,this.latestInvokeTimestamp=0,this.timer=-1,this._limitDuration=t,this.invoker=n,this.invokeWhenTimeout=this.invokeWhenTimeout.bind(this)}return M(e,[{key:"limitDuration",get:function(){return this._limitDuration},set:function(e){if(this._limitDuration!==e){if(this._limitDuration=e,-1!==this.timer){clearTimeout(this.timer);var t=this.nextInvokeTimeDuration();this.timer=setTimeout(this.invokeWhenTimeout,t)}this.invoke()}}},{key:"isWaitingToInvoke",get:function(){return this.shouldInvokeAfterFreeze||-1!==this.timer}},{key:"invoke",value:function(){if(this.isFreezed)this.shouldInvokeAfterFreeze=!0;else if(-1===this.timer){var e=this.nextInvokeTimeDuration();this.timer=setTimeout(this.invokeWhenTimeout,e)}}},{key:"nextInvokeTimeDuration",value:function(){var e=Date.now(),t=this.latestInvokeTimestamp+this.limitDuration-e;return Math.max(0,t)}},{key:"invokeWhenTimeout",value:function(){this.timer=-1,this.latestInvokeTimestamp=Date.now(),this.invoker()}},{key:"cancel",value:function(){this.isFreezed?this.shouldInvokeAfterFreeze=!1:-1!==this.timer&&(clearTimeout(this.timer),this.timer=-1)}},{key:"freeze",value:function(){this.isFreezed||(-1!==this.timer&&(clearTimeout(this.timer),this.timer=-1,this.shouldInvokeAfterFreeze=!0),this.isFreezed=!0)}},{key:"unfreeze",value:function(){!this.isFreezed||(this.isFreezed=!1,this.shouldInvokeAfterFreeze&&(this.shouldInvokeAfterFreeze=!1,this.invoke()))}}]),e}(),Ue=Object.freeze(["alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigma","tau","upsilon","phi","chi","psi","omega"]),Ve=function(){function e(t,n,r,i){I(this,e),this.x=t,this.y=n,this.z=r,this.suffix=i,Object.freeze(this)}return M(e,[{key:"withoutSuffix",value:function(){return new e(this.x,this.y,this.z)}},{key:"toString",value:function(){var e="".concat(this.x,".").concat(this.y,".").concat(this.z);return this.suffix&&(e+="-".concat(this.suffix.greekLetter,".").concat(this.suffix.number)),e}}],[{key:"parse",value:function(t){if(!/^\d+\.\d+\.\d+(-\w+\.\d+)?$/i.test(t))throw new Error("invalid version format ".concat(JSON.stringify(t)));var n,r=t.match(/-\w+\.\d+$/),i=t;r&&(n=e.parseSuffix(t,r[0].replace(/^-/i,"")),i=t.substring(0,t.length-r[0].length));var a=h(e.parseVersionArray(t,i),3);return new e(a[0],a[1],a[2],n)}},{key:"parseSuffix",value:function(e,t){var n=t.split("."),r=n[0];if(-1===Ue.indexOf(r))throw new Error("invalid Greek letter ".concat(JSON.stringify(r)," of ").concat(JSON.stringify(e)));var i=parseInt(n[1],10);if(!Number.isSafeInteger(i))throw new Error("invalid version number ".concat(JSON.stringify(i)," of ").concat(JSON.stringify(e)));return Object.freeze({greekLetter:r,number:i})}},{key:"parseVersionArray",value:function(e,t){var n,r=[],i=A(t.split("."));try{for(i.s();!(n=i.n()).done;){var a=n.value,o=parseInt(a,10);if(!Number.isSafeInteger(o))throw new Error("invalid version number ".concat(JSON.stringify(a)," of ").concat(JSON.stringify(e)));r.push(o)}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"compare",value:function(e,t){var n=e.x-t.x;if(0!==n||0!==(n=e.y-t.y)||0!==(n=e.z-t.z))return n;if(!e.suffix&&t.suffix)return 1;if(e.suffix&&!t.suffix)return-1;if(!e.suffix&&!t.suffix)return 0;var r=e.suffix.greekLetter,i=t.suffix.greekLetter;return 0!==(n=Ue.indexOf(r)-Ue.indexOf(i))?n:e.suffix.number-t.suffix.number}}]),e}(),We="1.4.4",He=Object.defineProperty,_e=Object.getOwnPropertySymbols,Ge=Object.prototype.hasOwnProperty,Ye=Object.prototype.propertyIsEnumerable,Xe=function(e,t,n){return t in e?He(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n};function qe(e,t){return void 0===e?t:e}var Qe=function(){function e(t){I(this,e);var n={},r=[];for(var i in t){var a=t[i],o=qe(a.enablePing,!0),s=qe(a.useSSL,!0),c=[],u={};for(var l in a.hosts)"*"===l?c.push.apply(c,p(this.readStringArray(a.hosts[l]))):u[l]=this.readStringArray(a.hosts[l]);r.push(i),n[i]=Object.freeze({enablePing:o,useSSL:s,hosts:Object.freeze({default:Object.freeze(c),regions:Object.freeze(u)})})}this.keys=Object.freeze(r.sort()),this.hosts=Object.freeze(function(e,t){for(var n in t||(t={}))Ge.call(t,n)&&Xe(e,n,t[n]);if(_e){var r,i=A(_e(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Ye.call(t,n)&&Xe(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e}({},n))}return M(e,[{key:"readStringArray",value:function(e){return"string"==typeof e?Object.freeze([e]):Object.freeze(p(e))}},{key:"host",value:function(e){var t=this.hosts[e];if(!t)throw new Error("cannot find host ".concat(JSON.stringify(e)));return t}}]),e}(),Ke=function(){function e(t,n){var r;if(I(this,e),this.nextIndex=0,this.enablePing=t.enablePing,this.useSSL=t.useSSL,0===(r=void 0===n?t.hosts.default:t.hosts.regions[n]||t.hosts.default).length)throw void 0===n?new Error("expect region: unexpect undefined"):new Error("invalid region ".concat(JSON.stringify(n),": cannot find any hosts of region"));this.hosts=r}return M(e,[{key:"hostsCount",get:function(){return this.hosts.length}},{key:"host",value:function(){return this.hosts[this.nextIndex]}},{key:"markSuccess",value:function(e){}},{key:"markFail",value:function(e){var t=this.nextIndex+1;t>=this.hosts.length&&(t=0),this.nextIndex=t}}]),e}(),Ze=function(){function e(t){I(this,e),this.fetcher=t}return M(e,[{key:"fetch",value:function(e,t,n){var r=this;return new Promise((function(i,a){var o=setTimeout((function(){o=null,a(new Error("timeout"))}),n);r.fetcher(e,t).then((function(e){null!==o&&(clearTimeout(o),i(e))})).catch((function(e){null!==o&&(clearTimeout(o),a(e))}))}))}}]),e}(),Je=function(){function e(t){I(this,e);var n=new Qe(t.configmap),r={};this.fetcher=new Ze(t.fetcher),this.keys=n.keys,this.onIngoreFetchError=t.onIngoreFetchError,this.retryCount=t.retryCount,this.retryLoopsCount=t.retryLoopsCount,this.timeout=e.parseTimeoutFromParams(t.timeout),this.bussySleepDuration=qe(t.bussySleepDuration,3e3);var i,a=A(this.keys);try{for(a.s();!(i=a.n()).done;){var o=i.value;r[o]=new Ke(n.host(o),t.region)}}catch(e){a.e(e)}finally{a.f()}this.loops=Object.freeze(r)}var t;return M(e,[{key:"fetch",value:function(e){var t=this,n=this.parseFetchingContext(e),r=n.key,i=this.loop(r);return function(e,r){return t.fetchWithKey(n,i,e,r)}}},{key:"origin",value:function(e,t){var n=this.loop(t),r=n.host(),i=e;return/:$/im.test(i)||(i+=":"),this.replaceProtocol(i,n.useSSL)+"//"+r}},{key:"reportSuccess",value:function(e,t){this.loop(e).markSuccess(t)}},{key:"reportFail",value:function(e,t){this.loop(e).markFail(t)}},{key:"fetchWithKey",value:(t=l(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,c,u,l,h,d,f,p,v,m;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=(i&&i.method||"get").toLowerCase(),void 0===(o=t.enableRetry)&&(o=this.checkIsIdempotent(a)),s=o?this.getFetchingCount(t,n):1,c=null,u=0;case 4:if(!(u<s)){e.next=28;break}return l=Date.now(),e.prev=6,h=n.host(),d=this.replaceURL(r,h,n.useSSL),f=t.timeout.length,p=u<f?t.timeout[u]:t.timeout[f-1],e.next=13,this.fetcher.fetch(d,i,p);case 13:if(v=e.sent,this.isServerBussyCode(v.status)){e.next=16;break}return e.abrupt("return",(n.markSuccess(Date.now()-l),v));case 16:if(e.t0=u<s-1,!e.t0){e.next=20;break}return e.next=20,new Promise((function(e){return setTimeout(e,t.bussySleepDuration)}));case 20:e.next=25;break;case 22:e.prev=22,e.t1=e.catch(6),c=e.t1,n.markFail(Date.now()-l);case 25:++u,e.next=4;break;case 28:throw this.onIngoreFetchError&&c&&this.onIngoreFetchError(c),m="fail to ".concat(a," ").concat(r),s>1&&(m+=" after ".concat(s," times retries")),c=c?new Error("".concat(m," and the last Error is: ").concat(c.message)):new Error(m);case 31:case"end":return e.stop()}}),e,this,[[6,22]])}))),function(e,n,r,i){return t.apply(this,arguments)})},{key:"getFetchingCount",value:function(e,t){var n,r;return"number"==typeof e.retryCount&&(n=e.retryCount+1),"number"==typeof e.retryLoopsCount&&(r=(e.retryLoopsCount+1)*t.hostsCount),void 0!==n&&void 0!==r?Math.max(n,r):void 0!==n?n:void 0!==r?r:t.hostsCount}},{key:"replaceURL",value:function(e,t,n){var r=new URL(e),i=r.protocol,a=r.port,o=r.pathname,s=r.search,c=this.replaceProtocol(i,n),u=t;return a&&(u+=":"+a),"".concat(c,"//").concat(u).concat(o).concat(s)}},{key:"parseFetchingContext",value:function(t){var n=t;return"string"==typeof n&&(n={key:n}),Object.freeze({key:n.key,enableRetry:n.enableRetry,timeout:e.parseTimeoutFromParams(n.timeout,this.timeout),retryCount:qe(n.retryCount,this.retryCount),retryLoopsCount:qe(n.retryLoopsCount,this.retryLoopsCount),bussySleepDuration:qe(n.bussySleepDuration,this.bussySleepDuration)})}},{key:"checkIsIdempotent",value:function(e){switch(e){case"put":case"options":case"head":case"patch":case"delete":case"get":return!0;default:return!1}}},{key:"isServerBussyCode",value:function(e){switch(e){case 503:case 504:return!0;default:return!1}}},{key:"replaceProtocol",value:function(e,t){switch(e){case"http:":case"https:":return t?"https:":"http:";case"ws:":case"wss:":return t?"wss:":"ws:";default:return e}}},{key:"loop",value:function(e){var t=this.loops[e];if(!t)throw new Error("undefined key ".concat(JSON.stringify(e)));return t}}],[{key:"parseTimeoutFromParams",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.defaultTimeout;if("number"==typeof t)return Object.freeze([t]);if(Array.isArray(t)){if(0===t.length)throw new Error("timeout cannot be []");return Object.freeze(p(t))}return n}}]),e}();Je.defaultTimeout=Object.freeze([5e3,1e4,25e3]);var $e=X(n("aaBP")),et=X(n("aaBP")),tt=Object.defineProperty,nt=Object.defineProperties,rt=Object.getOwnPropertyDescriptors,it=Object.getOwnPropertySymbols,at=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,st=function(e,t,n){return t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},ct=function(e,t){for(var n in t||(t={}))at.call(t,n)&&st(e,n,t[n]);if(it){var r,i=A(it(t));try{for(i.s();!(r=i.n()).done;){n=r.value;ot.call(t,n)&&st(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e};var ut,lt,ht,dt=Math.pow(2,32),ft=(Math.pow(2,16),dt-1),pt=function(){function e(){I(this,e),this._length=0,this.bufferChunks=[],this.appendNewChunk()}return M(e,[{key:"length",get:function(){return this._length}},{key:"toBuffer",value:function(){var e,t=ye(this.length),n=0,r=A(this.bufferChunks);try{for(r.s();!(e=r.n()).done;){var i=e.value;t.fill(i.buffer,n,0,i.length),n+=i.length}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"generateHash",value:function(e,t){for(var n=0,r=e;;){if(n>=this.bufferChunks.length)return"";var i=this.bufferChunks[n].length;if(r<i)break;r-=i,n+=1}for(var a=t,o=new $e.default,s=[0];n<this.bufferChunks.length;++n){for(var c=this.bufferChunks[n],u=c.buffer,l=c.length,h=r;h<l;++h)if(s[0]=u.getUint8(h),o.appendBinary(String.fromCharCode.apply(String,s)),(a-=1)<=0)return o.end(!0);r=0}return o.end(!0)}},{key:"pushBuffer",value:function(e,t,n){var r=Math.min(n,this.currentChunk.buffer.byteLength-this.currentChunk.length);r>0&&(this.currentChunk.buffer.fill(e,this.currentChunk.length,t,r),this.currentChunk.length+=r,this._length+=r);var i=n-r;i>0&&(this.currentChunk={buffer:e.slice(t+r,i),length:i},this.bufferChunks.push(this.currentChunk),this._length+=i)}},{key:"pushUint8",value:function(e){this.currentChunk.length+1>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint8(this.currentChunk.length,e),this.currentChunk.length+=1,this._length+=1}},{key:"pushUint8Holder",value:function(){this.currentChunk.length+1>this.currentChunk.buffer.byteLength&&this.appendNewChunk();var e=this.currentChunk.length,t=this.currentChunk.buffer;return this.currentChunk.length+=1,this._length+=1,function(n){return t.setUint8(e,n)}}},{key:"pushUint16",value:function(e){this.currentChunk.length+2>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint16(this.currentChunk.length,e),this.currentChunk.length+=2,this._length+=2}},{key:"pushInt32",value:function(e){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setInt32(this.currentChunk.length,e),this.currentChunk.length+=4,this._length+=4}},{key:"pushUint32",value:function(e){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setUint32(this.currentChunk.length,e),this.currentChunk.length+=4,this._length+=4}},{key:"pushUint32Holder",value:function(){this.currentChunk.length+4>this.currentChunk.buffer.byteLength&&this.appendNewChunk();var e=this.currentChunk.length,t=this.currentChunk.buffer;return this.currentChunk.length+=4,this._length+=4,function(n){return t.setUint32(e,n)}}},{key:"pushFloat64",value:function(e){this.currentChunk.length+8>this.currentChunk.buffer.byteLength&&this.appendNewChunk(),this.currentChunk.buffer.setFloat64(this.currentChunk.length,e),this.currentChunk.length+=8,this._length+=8}},{key:"appendNewChunk",value:function(){var e=ye(256);this.currentChunk={buffer:e,length:0},this.bufferChunks.push(this.currentChunk)}}]),e}();!function(e){e[e.Never=0]="Never",e[e.Undefined=1]="Undefined",e[e.Null=2]="Null",e[e.String=3]="String",e[e.Integer32=4]="Integer32",e[e.Integer53=5]="Integer53",e[e.Float=6]="Float",e[e.Function=7]="Function",e[e.Object=8]="Object",e[e.Array=9]="Array",e[e.True=10]="True",e[e.False=11]="False",e[e.Buffer=12]="Buffer",e[e.HangUpObject=13]="HangUpObject"}(ut||(ut={})),function(e){e[e.Array=0]="Array",e[e.DeducedObject=1]="DeducedObject",e[e.AssertedObject=2]="AssertedObject",e[e.HangUpObject=3]="HangUpObject"}(lt||(lt={})),function(e){e[e.Array=0]="Array",e[e.Object=1]="Object",e[e.HangUpObject=2]="HangUpObject"}(ht||(ht={}));var vt="__identifier",mt="__hangUpMetadata",gt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};I(this,e),this.decorateObjectEnums=Object.freeze([1]),this.decorateObject=t}return M(e,[{key:"createObject",value:function(e,t){var n=0===t?[]:{};return Object.defineProperty(n,vt,{enumerable:!1,configurable:!0,value:e}),n}},{key:"findIdentifier",value:function(e){return e[vt]}},{key:"findHangUpMetadata",value:function(e){return e[mt]}},{key:"checkObjectEnum",value:function(e){return e.constructor===Array?0:mt in e?2:1}},{key:"length",value:function(e){return e.length}},{key:"keys",value:function(e){return Object.keys(e)}},{key:"hasKey",value:function(e,t){return t in e}},{key:"getValue",value:function(e,t){return e[t]}},{key:"setValue",value:function(e,t,n){e[t]=n}},{key:"completeHangUpObject",value:function(e,t){Object.defineProperty(e,mt,{enumerable:!1,configurable:!0,value:Object.freeze(ct({},t))})}}]),e}();function yt(){var e={id:-1};return e.key=e,e.index=e,e.properties=Object.freeze({}),Object.freeze(e)}var bt="0".charCodeAt(0),kt="9".charCodeAt(0)+1,wt="a".charCodeAt(0),St="f".charCodeAt(0)+1,xt=new(function(){function e(){I(this,e);for(var t=[],n=[],r=0;r<16;++r){var i=r.toString(16).charCodeAt(0);t[r]=i,n[i]=r}this.integerToCode=Object.freeze(t),this.codeToInteger=Object.freeze(n)}return M(e,[{key:"cleanUnmeaningZero",value:function(e,t){for(;e.length>t&&0===this.codeToInteger[e[e.length-1]];)e.pop()}},{key:"pushInt53",value:function(e,t){var n=0|t,r=(t-n)/dt;this.pushUint32(e,n),this.pushUint32(e,r)}},{key:"readInt53",value:function(e,t){var n=this.readInt32(e,t);return this.readInt32(e,t+8)*dt+n}},{key:"pushUint32",value:function(e,t){var n=e.length;e[n]=this.integerToCode[15&t],e[n+1]=this.integerToCode[t>>4&15],e[n+2]=this.integerToCode[t>>8&15],e[n+3]=this.integerToCode[t>>12&15],e[n+4]=this.integerToCode[t>>16&15],e[n+5]=this.integerToCode[t>>20&15],e[n+6]=this.integerToCode[t>>24&15],e[n+7]=this.integerToCode[t>>28&15]}},{key:"readUint32",value:function(e,t){var n=this.readInt32(e,t);return n<0&&(n+=dt),n}},{key:"readInt32",value:function(e,t){for(var n=0,r=0;r<8;++r){var i=this.codeToInteger[e.charCodeAt(t+r)];if(void 0===i)return NaN;n|=i<<4*r}return n}},{key:"parseCode",value:function(e){return this.codeToInteger[e]}},{key:"toCode",value:function(e){return this.integerToCode[e]}},{key:"increment",value:function(e,t){for(var n=t;;){if(e.length<=n){e[n]=bt+1;break}var r=!0;switch(e[n]+=1,e[n]){case kt:e[n]=wt;break;case St:e[n]=bt,n+=1,r=!1}if(r)break}}},{key:"parseString",value:function(e){for(var t=new String(e),n=[],r=0;r<t.length;++r)n.push(t.charCodeAt(r));return n}},{key:"stringify",value:function(e){return String.fromCharCode.apply(String,e)}}]),e}());function Ct(e,t){var n=[];return xt.pushInt53(n,e),"number"==typeof t&&(xt.pushInt53(n,t),xt.cleanUnmeaningZero(n,16)),new It(e,n)}var It=function(){function e(t,n){I(this,e),this.scopeId=t,this.codes=n}return M(e,[{key:"generate",value:function(){var e=xt.stringify(this.codes);return xt.increment(this.codes,16),e}},{key:"createdCount",get:function(){for(var e=16,t=0,n=0,r=0;r<8;++r){var i=this.codes[e+r];t|=(i=void 0===i?0:xt.parseCode(i))<<4*r}e+=8;for(var a=0;a<8;++a){var o=this.codes[e+a];n|=(o=void 0===o?0:xt.parseCode(o))<<4*a}return n*dt+t}},{key:"clone",value:function(){return new e(this.scopeId,p(this.codes))}}]),e}(),Pt=function(){function e(t,n){I(this,e),this.observerId=t,this.codes=n,this._createdCount=0}return M(e,[{key:"scopeId",get:function(){return 0}},{key:"createdCount",get:function(){return this._createdCount}},{key:"generate",value:function(){return this._createdCount+=1,xt.increment(this.codes,8),xt.stringify(this.codes)}},{key:"clone",value:function(){return new e(this.observerId,p(this.codes))}},{key:"makeSureNextGenerationIdAfter",value:function(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);if(void 0===xt.parseCode(r))throw new Error("invalid generationId");t[n]=r}for(var i=0;i<t.length;++i)this.codes[i+8]=t[i]}}]),e}(),Mt=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).name="SerializerError",r}return n}(m(Error)),Tt=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).name="DeserializerError",r}return n}(m(Error)),At=Math.pow(2,31)-1,Et=-Math.pow(2,31),Ot=function(){function e(t,n,r,i){I(this,e),this.writer=t,this.objectFormats=n,this.objectAdapter=r,this.assertObjectFormat=i,this.anyObjectFormat=yt(),this.serializeTasksQueue=[],this.serializeBufferQueue=[],this.didObjectInQueueSet={},this.bufferIndexMap={}}return M(e,[{key:"serialize",value:function(e,t){var n=this.writer.putUint32Holder(),r=this.writer.didWriteBytes,i=1;1!==this.objectFormats.length&&(this.writer.writeUint32(e.length),i=e.length);for(var a=0;a<i;++a){var o=this.objectFormats[a]||this.anyObjectFormat,s=e[a];this.serializeValue(o,s)}for(;this.serializeTasksQueue.length>0;)this.handleSerializeTask(this.serializeTasksQueue.shift());this.writer.writeBigInt(""),this.writer.writeUint32(this.serializeBufferQueue.length);var c,u=A(this.serializeBufferQueue);try{for(u.s();!(c=u.n()).done;){var l=c.value;this.writer.writeUint8(l.readonly?255:0),this.writer.writeBuffer(l)}}catch(e){u.e(e)}finally{u.f()}var h=this.writer.didWriteBytes-r,d=t?this.writer.generateHash(r,h):$t;this.serializeHash(d),n(h+Jt)}},{key:"serializeValue",value:function(e,t){"object"!=T(t)?this.serializeNotObjectValue(t):null===t?this.writer.writeUint8(ut.Null):ke(t)?this.serializeBufferValue(t):this.serializeObjectValue(e,t)}},{key:"handleSerializeTask",value:function(e){var t=e.identifier,n=e.object,r=e.objectEnum,i=e.deducedFormat;switch(this.writer.writeBigInt(t),r){case ht.Array:this.writer.writeUint8(lt.Array),this.handleArraySerializeTask(n,i);break;case ht.Object:var a=this.assertObjectFormat(n),o=a?lt.AssertedObject:lt.DeducedObject,s=a||i,c=!a;this.writer.writeUint8(o),this.handleObjectSerializeTask(n,s,c);break;case ht.HangUpObject:var u=this.objectAdapter.findHangUpMetadata(n),l=Ve.parse(u.version),h=l.x,d=l.y,f=l.z;this.writer.writeUint8(lt.HangUpObject),this.writer.writeUint32(u.objectFormatId),this.writer.writeUint16(h),this.writer.writeUint16(d),this.writer.writeUint16(f),this.writer.writeUint8(ut.Never),this.handleHangUpObjectSerializeTask(n)}}},{key:"serializeNotObjectValue",value:function(e){switch(T(e)){case"undefined":this.writer.writeUint8(ut.Undefined);break;case"string":this.writer.writeUint8(ut.String),this.writer.writeString(e);break;case"number":Number.isSafeInteger(e)?Et<=e&&e<=At?(this.writer.writeUint8(ut.Integer32),this.writer.writeInt32(e)):(this.writer.writeUint8(ut.Integer53),this.writer.writeInt53(e)):(this.writer.writeUint8(ut.Float),this.writer.writeFloat64(e));break;case"boolean":e?this.writer.writeUint8(ut.True):this.writer.writeUint8(ut.False);break;default:throw new Mt("not support ".concat(T(e)," now"))}}},{key:"serializeBufferValue",value:function(e){var t=this.bufferIndexMap[e.id];void 0===t&&(t=this.serializeBufferQueue.length,this.bufferIndexMap[e.id]=t,this.serializeBufferQueue[t]=e),this.writer.writeUint8(ut.Buffer),this.writer.writeUint32(t)}},{key:"serializeObjectValue",value:function(e,t){var n,r=this.objectAdapter.findIdentifier(t),i=this.objectAdapter.checkObjectEnum(t);switch(i){case ht.Array:n=ut.Array;break;case ht.Object:n=ut.Object;break;case ht.HangUpObject:n=ut.HangUpObject;break;default:throw new Error("unrecognized object enum ".concat(i))}this.writer.writeUint8(n),this.writer.writeUint8(0),this.writer.writeBigInt(r),this.pushToSerializeTaskQueueIfFirstCall({identifier:r,object:t,deducedFormat:e,objectEnum:i})}},{key:"pushToSerializeTaskQueueIfFirstCall",value:function(e){this.didObjectInQueueSet[e.identifier]||(this.didObjectInQueueSet[e.identifier]=!0,this.serializeTasksQueue.push(e))}},{key:"handleArraySerializeTask",value:function(e,t){var n=this.objectAdapter.length(e),r=t.index;this.writer.writeUint32(n);for(var i=0;i<n;++i)this.serializeValue(r,this.objectAdapter.getValue(e,i))}},{key:"handleObjectSerializeTask",value:function(e,t,n){for(var r in this.writer.writeUint32(t.id),t.properties){var i=t.properties[r];this.objectAdapter.hasKey(e,r)?this.serializeValue(i,this.objectAdapter.getValue(e,r)):this.writer.writeUint8(ut.Never)}if(n){var a,o=this.writer.putUint32Holder(),s=0,c=A(this.objectAdapter.keys(e));try{for(c.s();!(a=c.n()).done;){var u=a.value;u in t.properties||(this.writer.writeString(u),this.serializeValue(t.key,this.objectAdapter.getValue(e,u)),s+=1)}}catch(e){c.e(e)}finally{c.f()}o(s)}else this.writer.writeUint32(0)}},{key:"handleHangUpObjectSerializeTask",value:function(e){var t,n=this.writer.putUint32Holder(),r=0,i=A(this.objectAdapter.keys(e));try{for(i.s();!(t=i.n()).done;){var a=t.value;this.writer.writeString(a),this.serializeValue(this.anyObjectFormat,this.objectAdapter.getValue(e,a)),r+=1}}catch(e){i.e(e)}finally{i.f()}n(r)}},{key:"serializeHash",value:function(e){for(var t=0;t<Jt;++t)t<e.length?this.writer.writeUint8(e.charCodeAt(t)):this.writer.writeUint8(0)}}]),e}(),Rt=function(){function e(t,n,r,i){I(this,e),this.reader=t,this.format=n,this.objectAdapter=r,this.valuesLength=i,this.objectStateMap={},this.holdersMap={},this.deserializeBufferSetterQueue=[],this.cacheMap=Object.freeze([{},{},{}])}return M(e,[{key:"deserialize",value:function(t){for(var n=e.simpleObjectAdapter,r=this.reader.readUint32(),i=this.reader.didReadBytes,a=this.deserializeRootValuesLength(),o=[],s=0;s<a;++s)this.deserializeValue(n,o,s);for(;;){var c=this.reader.readBigInt();if(""===c)break;this.deserializeArrayOrObjectBody(c)}this.handleAllDeserializeBuffers(),this.invokeObjectDecorator();var u=this.reader.didReadBytes-i;if(r!==u+Jt)throw new Tt("expect bytes ".concat(r,", instead of ").concat(u));var l=this.deserializeHash();if(!t&&l!==$t&&l!==this.reader.generateHash(i,u))throw new Tt("hash isn't matched");return o}},{key:"deserializeRootValuesLength",value:function(){return 1!==this.valuesLength?this.reader.readUint32():1}},{key:"invokeObjectDecorator",value:function(){var e,t=Object.freeze([]),n=A(this.objectAdapter.decorateObjectEnums);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.cacheMap[r];for(var a in i){var o=i[a],s=this.objectStateMap[a];if(s){var c=this.holdersMap[a]||t,u=s.type,l=s.objectFormat;this.objectAdapter.decorateObject(o,u,c,l)}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"deserializeValue",value:function(e,t,n){var r,i=this.reader.readUint8();switch(i){case ut.Undefined:e.setValue(t,n,void 0);break;case ut.Null:e.setValue(t,n,null);break;case ut.String:e.setValue(t,n,this.reader.readString());break;case ut.Integer32:e.setValue(t,n,this.reader.readInt32());break;case ut.Integer53:e.setValue(t,n,this.reader.readInt53());break;case ut.Float:e.setValue(t,n,this.reader.readFloat64());break;case ut.True:e.setValue(t,n,!0);break;case ut.False:e.setValue(t,n,!1);break;case ut.Array:this.reader.readUint8(),r=this.reader.readBigInt();var a=this.readAndPushToDeserializeTaskQueueIfNeed(r,ht.Array);e.setValue(t,n,a);break;case ut.Object:this.reader.readUint8(),r=this.reader.readBigInt();var o=this.readAndPushToDeserializeTaskQueueIfNeed(r,ht.Object);e.setValue(t,n,o);break;case ut.HangUpObject:this.reader.readUint8(),r=this.reader.readBigInt();var s=this.readAndPushToDeserializeTaskQueueIfNeed(r,ht.HangUpObject);e.setValue(t,n,s);break;case ut.Buffer:var c=this.reader.readUint32(),u=this.deserializeBufferSetterQueue[c];u||(u=this.deserializeBufferSetterQueue[c]=[]),u.push((function(r){return e.setValue(t,n,r)}));break;case ut.Never:break;default:throw new Mt("unrecognized primitiveType ".concat(JSON.stringify(i)))}return r}},{key:"readAndPushToDeserializeTaskQueueIfNeed",value:function(e,t){var n=this.cacheMap[t],r=n[e];return r||(n[e]=r=this.objectAdapter.createObject(e,t)),r}},{key:"deserializeArrayOrObjectBody",value:function(e){var t=this.reader.readUint8();switch(t){case lt.Array:this.objectStateMap[e]={type:t},this.handleArrayDeserializerTask(this.cacheMap[ht.Array][e]);break;case lt.DeducedObject:case lt.AssertedObject:var n=this.cacheMap[ht.Object][e],r=this.reader.readUint32(),i=this.format.findObjectFormat(r);this.objectStateMap[e]={type:t,objectFormat:i},this.handleObjectDeserializerTask(n,i);break;case lt.HangUpObject:var a=this.cacheMap[ht.HangUpObject][e],o=this.reader.readUint32(),s=this.reader.readUint16(),c=this.reader.readUint16(),u=this.reader.readUint16();this.objectStateMap[e]={type:t},this.reader.readUint8(),this.handleHangUpObjectDeserializerTask(a,{objectFormatId:o,version:"".concat(s,".").concat(c,".").concat(u)})}}},{key:"handleAllDeserializeBuffers",value:function(){for(var e=this.reader.readUint32(),t=0;t<e;++t){var n=this.reader.readUint8(),r=this.reader.readBuffer();n&&r.freeze();var i,a=A(this.deserializeBufferSetterQueue[t]);try{for(a.s();!(i=a.n()).done;){(0,i.value)(r)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"handleArrayDeserializerTask",value:function(e){for(var t=this.reader.readUint32(),n=0;n<t;++n)this.deserializeValueAndRecordHolders(e,n)}},{key:"handleObjectDeserializerTask",value:function(e,t){for(var n in t.properties)this.deserializeValueAndRecordHolders(e,n);for(var r=this.reader.readUint32(),i=0;i<r;++i){var a=this.reader.readString();this.deserializeValueAndRecordHolders(e,a)}}},{key:"handleHangUpObjectDeserializerTask",value:function(e,t){for(var n=this.reader.readUint32(),r=0;r<n;++r){var i=this.reader.readString();this.deserializeValueAndRecordHolders(e,i)}this.objectAdapter.completeHangUpObject(e,t)}},{key:"deserializeValueAndRecordHolders",value:function(e,t){var n=this.deserializeValue(this.objectAdapter,e,t);if(void 0!==n){var r=this.holdersMap[n];r||(this.holdersMap[n]=r=[]),r.push({object:e,key:t})}}},{key:"deserializeHash",value:function(){for(var e=new Array(Jt),t=0;t<Jt;++t)e[t]=this.reader.readUint8();return String.fromCharCode.apply(String,e)}}]),e}();Rt.simpleObjectAdapter=new gt;var Nt,Lt=function(){function e(t,n,r,i){I(this,e),this.reader=t,this.format=n,this.objectFormats=r,this.objectAdapter=i,this.arrayCacheMap={},this.objectCacheMap={},this.objectStateMap={},this.holdersMap={},this.deserializeTasksQueue=[],this.deserializeBufferSetterQueue=[]}return M(e,[{key:"deserialize",value:function(t){for(var n=e.simpleObjectAdapter,r=this.reader.readUint32(),i=this.reader.didReadBytes,a=this.deserializeRootValuesLength(),o=[],s=0;s<a;++s){var c=this.objectFormats[s]||e.neverObjectFormat;this.deserializeValue(c,n,o,s)}for(;;){var u=this.reader.readBigInt();if(""===u)break;var l=this.takeNextDeserializerTask(u);this.handleDeserializerTask(l)}this.handleAllDeserializeBuffers(),this.invokeObjectDecorator();var h=this.reader.didReadBytes-i;if(r!==h+Jt)throw new Tt("expect bytes ".concat(r,", instead of ").concat(h));var d=this.deserializeHash();if(!t&&d!==$t&&d!==this.reader.generateHash(i,h))throw new Tt("hash isn't matched");return o}},{key:"deserializeRootValuesLength",value:function(){return 1!==this.objectFormats.length?this.reader.readUint32():1}},{key:"invokeObjectDecorator",value:function(){var e=Object.freeze([]);for(var t in this.objectCacheMap){var n=this.objectCacheMap[t],r=this.holdersMap[t]||e,i=this.objectStateMap[t],a=i.objectFormat,o=i.type;this.objectAdapter.decorateObject(n,o,r,a)}}},{key:"deserializeValueAndRecordHolders",value:function(e,t,n){var r=this.deserializeValue(e,this.objectAdapter,t,n);if(void 0!==r){var i=this.holdersMap[r];i||(this.holdersMap[r]=i=[]),i.push({object:t,key:n})}}},{key:"deserializeValue",value:function(e,t,n,r){var i;switch(this.reader.readUint8()){case ut.Undefined:t.setValue(n,r,void 0);break;case ut.Null:t.setValue(n,r,null);break;case ut.String:t.setValue(n,r,this.reader.readString());break;case ut.Integer32:t.setValue(n,r,this.reader.readInt32());break;case ut.Integer53:t.setValue(n,r,this.reader.readInt53());break;case ut.Float:t.setValue(n,r,this.reader.readFloat64());break;case ut.True:t.setValue(n,r,!0);break;case ut.False:t.setValue(n,r,!1);break;case ut.Object:i=this.reader.readBigInt();var a=this.readAndPushToDeserializeTaskQueueIfNeed(i,e,!1);t.setValue(n,r,a);break;case ut.Array:i=this.reader.readBigInt();var o=this.readAndPushToDeserializeTaskQueueIfNeed(i,e,!0);t.setValue(n,r,o);break;case ut.Buffer:var s=this.reader.readUint32(),c=this.deserializeBufferSetterQueue[s];c||(c=this.deserializeBufferSetterQueue[s]=[]),c.push((function(e){return t.setValue(n,r,e)}))}return i}},{key:"readAndPushToDeserializeTaskQueueIfNeed",value:function(e,t,n){var r=n?this.arrayCacheMap:this.objectCacheMap,i=r[e];return i||(r[e]=i=this.objectAdapter.createObject(e,n?ht.Array:ht.Object),this.deserializeTasksQueue.push({isArray:n,identifier:e,deducedFormat:t,object:i})),i}},{key:"takeNextDeserializerTask",value:function(e){for(var t=0;t<this.deserializeTasksQueue.length;++t){var n=this.deserializeTasksQueue[t];if(e===n.identifier)return this.deserializeTasksQueue.splice(t,1),n}throw new Tt("can't find identifier ".concat(e," in task queue"))}},{key:"handleDeserializerTask",value:function(e){var t=this.reader.readUint8(),n=e.identifier;switch(t){case lt.Array:if(!e.isArray)throw new Tt("expect array");this.objectStateMap[n]={type:t,objectFormat:e.deducedFormat},this.handleArrayDeserializerTask(e.object,e.deducedFormat);break;case lt.DeducedObject:if(e.isArray)throw new Tt("expect object");this.objectStateMap[n]={type:t,objectFormat:e.deducedFormat},this.handleObjectDeserializerTask(e.object,e.deducedFormat);break;case lt.AssertedObject:if(e.isArray)throw new Tt("expect object");var r=this.reader.readUint32(),i=this.format.findObjectFormat(r);this.objectStateMap[n]={type:t,objectFormat:i},this.handleObjectDeserializerTask(e.object,i)}}},{key:"handleAllDeserializeBuffers",value:function(){for(var e=this.reader.readUint32(),t=0;t<e;++t){var n=this.reader.readUint8(),r=this.reader.readBuffer();n&&r.freeze();var i,a=A(this.deserializeBufferSetterQueue[t]);try{for(a.s();!(i=a.n()).done;){(0,i.value)(r)}}catch(e){a.e(e)}finally{a.f()}}}},{key:"handleArrayDeserializerTask",value:function(e,t){for(var n=t.index,r=this.reader.readUint32(),i=0;i<r;++i)this.deserializeValueAndRecordHolders(n,e,i)}},{key:"handleObjectDeserializerTask",value:function(e,t){for(var n in t.properties)this.deserializeValueAndRecordHolders(t.properties[n],e,n);for(var r=this.reader.readUint32(),i=0;i<r;++i){var a=this.reader.readString();this.deserializeValueAndRecordHolders(t.key,e,a)}}},{key:"deserializeHash",value:function(){for(var e=new Array(Jt),t=0;t<Jt;++t)e[t]=this.reader.readUint8();return String.fromCharCode.apply(String,e)}}]),e}();Lt.neverObjectFormat=yt(),Lt.simpleObjectAdapter=new gt,function(e){e[e.V0=0]="V0",e[e.V1=1]="V1"}(Nt||(Nt={}));var jt=Ve.parse("1.4.2");function Dt(e){var t=e;return"string"==typeof t&&(t=Ve.parse(t)),Ve.compare(t,jt)<0?0:1}var Ft=function(){function e(t){I(this,e),this.format=t.format,this.objectAdapter=t.objectAdapter,this.assertObjectFormat=t.assertObjectFormat||function(){}}return M(e,[{key:"serialize",value:function(e){var t=e.writer,n=e.values,r=e.objectFormats,i=e.includesHash;new Ot(t,r,this.objectAdapter,this.assertObjectFormat).serialize(n,i)}},{key:"deserialize",value:function(e){var t=e.reader,n=e.objectFormats,r=e.ignoreHashChecking;switch(e.version){case Nt.V0:return new Lt(t,this.format,n,this.objectAdapter).deserialize(r);case Nt.V1:return new Rt(t,this.format,this.objectAdapter,n.length).deserialize(r);default:return[]}}}]),e}(),zt="0".charCodeAt(0),Bt=function(){function e(){I(this,e),this.buffer=new pt}return M(e,[{key:"generateHash",value:function(e,t){return this.buffer.generateHash(e,t)}},{key:"didWriteBytes",get:function(){return this.buffer.length}},{key:"writeBuffer",value:function(e){this.buffer.pushUint32(e.byteLength),e.byteLength>0&&this.buffer.pushBuffer(e,0,e.byteLength)}},{key:"writeUint8",value:function(e){this.buffer.pushUint8(e)}},{key:"putUint8Holder",value:function(){return this.buffer.pushUint8Holder()}},{key:"writeUint16",value:function(e){this.buffer.pushUint16(e)}},{key:"writeInt32",value:function(e){this.buffer.pushInt32(e)}},{key:"writeUint32",value:function(e){this.buffer.pushUint32(e)}},{key:"putUint32Holder",value:function(){return this.buffer.pushUint32Holder()}},{key:"writeInt53",value:function(e){var t=0|e,n=(e-t)/dt;this.buffer.pushInt32(t),this.buffer.pushInt32(n)}},{key:"writeFloat64",value:function(e){this.buffer.pushFloat64(e)}},{key:"writeString",value:function(e){var t=function(e){for(var t=new String(e),n=0,r=0,i=0;i<t.length;++i)(r=t.charCodeAt(i))<128?n+=1:r<2048?n+=2:55296==(64512&r)&&56320==(64512&t.charCodeAt(i+1))?(++i,n+=4):n+=3;return n}(e);this.writeInt32(t),function(e,t){for(var n,r,i=new String(e),a=0;a<i.length;++a)(n=i.charCodeAt(a))<128?t.pushUint8(n):n<2048?(t.pushUint8(n>>6|192),t.pushUint8(63&n|128)):55296==(64512&n)&&56320==(64512&(r=i.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&r),++a,t.pushUint8(n>>18|240),t.pushUint8(n>>12&63|128),t.pushUint8(n>>6&63|128),t.pushUint8(63&n|128)):(t.pushUint8(n>>12|224),t.pushUint8(n>>6&63|128),t.pushUint8(63&n|128))}(e,this.buffer)}},{key:"writeBigInt",value:function(e){var t=new String(e);if(t.length>255)throw new Mt("length of identifier ".concat(t.length," is greater than 255"));this.buffer.pushUint8(t.length);for(var n=Math.ceil(t.length/2),r=0;r<n;++r){var i=t.charCodeAt(2*r),a=t.charCodeAt(2*r+1);Number.isNaN(a)&&(a=zt);var o=xt.parseCode(i),s=xt.parseCode(a);if(void 0===o||void 0===s)throw new Mt("invalid big integer ".concat(JSON.stringify(e)));this.buffer.pushUint8(o|s<<4)}}},{key:"writeReadSlice",value:function(e){var t,n=A(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.offset,a=r.byteLength,o=r.buffer;this.buffer.pushBuffer(o,i,a)}}catch(e){n.e(e)}finally{n.f()}}},{key:"toBuffer",value:function(){return this.buffer.toBuffer()}}]),e}(),Ut=[],Vt=[0],Wt=[0,0],Ht=[0,0,0],_t=[0,0,0,0],Gt=[0,0,0,0,0],Yt=[0,0,0,0,0,0],Xt=[0,0,0,0,0,0,0],qt=[0,0,0,0,0,0,0,0];var Qt,Kt,Zt=function(){function e(t){I(this,e),this._offset=0,this.buffer=t}return M(e,[{key:"offset",get:function(){return this._offset}},{key:"generateHash",value:function(e,t){for(var n=Math.min(e+t-1,this.buffer.byteLength-1),r=new et.default,i=[0],a=e;a<=n;++a)i[0]=this.buffer.getUint8(a),r.appendBinary(String.fromCharCode.apply(String,i));return r.end(!0)}},{key:"didReadBytes",get:function(){return this._offset}},{key:"readBuffer",value:function(){var e=this.buffer.getUint32(this._offset);this._offset+=4;var t=this.buffer.slice(this._offset,e);return this._offset+=e,t}},{key:"readUint8",value:function(){var e=this.buffer.getUint8(this._offset);return this._offset+=1,e}},{key:"readUint16",value:function(){var e=this.buffer.getUint16(this._offset);return this._offset+=2,e}},{key:"readInt32",value:function(){var e=this.buffer.getInt32(this._offset);return this._offset+=4,e}},{key:"readUint32",value:function(){var e=this.buffer.getUint32(this._offset);return this._offset+=4,e}},{key:"readInt53",value:function(){var e=this.buffer.getInt32(this._offset);this._offset+=4;var t=this.buffer.getInt32(this._offset);return this._offset+=4,t*dt+e}},{key:"readFloat64",value:function(){var e=this.buffer.getFloat64(this._offset);return this._offset+=8,e}},{key:"readString",value:function(){var e=this.readInt32(),t=function(e,t,n){var r=t;if(n<1)return"";for(var i,a=r+n,o=[],s=null,c=0;r<a;)(i=e.getUint8(r++))<128?o[c++]=i:i>191&&i<224?o[c++]=(31&i)<<6|63&e.getUint8(r++):i>239&&i<365?(i=((7&i)<<18|(63&e.getUint8(r++))<<12|(63&e.getUint8(r++))<<6|63&e.getUint8(r++))-65536,o[c++]=55296+(i>>10),o[c++]=56320+(1023&i)):o[c++]=(15&i)<<12|(63&e.getUint8(r++))<<6|63&e.getUint8(r++),c>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),c=0);return s?(c&&s.push(String.fromCharCode.apply(String,o.slice(0,c))),s.join("")):String.fromCharCode.apply(String,o.slice(0,c))}(this.buffer,this._offset,e);return this._offset+=e,t}},{key:"readBigInt",value:function(){for(var e=this.readUint8(),t=Math.ceil(e/2),n=function(e){switch(e){case 0:return Ut;case 1:return Vt;case 2:return Wt;case 3:return Ht;case 4:return _t;case 5:return Gt;case 6:return Yt;case 7:return Xt;case 8:return qt;default:return[]}}(e),r=0;r<t;++r){var i=this.readUint8(),a=15&i,o=i>>4&15;n[2*r]=xt.toCode(a),2*r+1<e&&(n[2*r+1]=xt.toCode(o))}return String.fromCharCode.apply(String,n)}},{key:"skipBytes",value:function(e){return this._offset+=e,e}},{key:"sliceLatestBytes",value:function(e){return[{offset:this._offset-e,buffer:this.buffer,byteLength:e}]}}]),e}(),Jt=16,$t=function(){for(var e=[],t=0;t<Jt;++t)e[t]=0;return String.fromCharCode.apply(String,e)}(),en=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).name="FormatError",r}return n}(m(Error));!function(e){e[e.Indeterminate=0]="Indeterminate",e[e.Circular=1]="Circular",e[e.Noncircular=2]="Noncircular"}(Qt||(Qt={})),function(e){e[e.Border=0]="Border",e[e.Compound=1]="Compound",e[e.Object=2]="Object",e[e.Handle=3]="Handle"}(Kt||(Kt={}));var tn=function(){function e(t,n,r){I(this,e),this.templateEnvironment=t,this.templateType=n,this.params=r,this.expandedParamNodes=[],this.convertTypeToGeneratorParam=this.convertTypeToGeneratorParam.bind(this);for(var i=0;i<r.length;++i)this.expandedParamNodes[i]=void 0}return M(e,[{key:"getExpandedExpression",value:function(){return this.expandNode(this.templateType)}},{key:"expandNode",value:function(e){switch(e.typeEnum){case he.Any:case he.Never:case he.Undefined:case he.Null:case he.String:case he.Number:case he.Boolean:case he.Function:return{type:e,clazz:0};case he.Object:var t=e,n={};for(var r in t.properties){var i=t.properties[r];n[r]=this.expandNode(i)}return{type:t,clazz:2,key:this.expandNode(t.key),index:this.expandNode(t.index),properties:n};case he.And:case he.Or:var a,o=e,s=[],c=A(o.children);try{for(c.s();!(a=c.n()).done;){var u=a.value;s.push(this.expandNode(u))}}catch(e){c.e(e)}finally{c.f()}return{type:o,clazz:1,children:s};case he.Generator:return this.expandGeneratorType(e);case he.Generic:return this.expandGenericType(e);case he.Reference:case he.GlobalReference:return this.expandReferenceType(e)}throw new en("unrecognized enum type "+e.typeEnum)}},{key:"expandGeneratorType",value:function(e){var t=e.params.map(this.convertTypeToGeneratorParam);return{clazz:3,handle:this.templateEnvironment.getTemplate(e.template).getHandle(t)}}},{key:"convertTypeToGeneratorParam",value:function(e){var t=this.expandNode(e);return 3===t.clazz?t.handle:t.type}},{key:"expandGenericType",value:function(e){var t=e.index,n=this.expandedParamNodes[t];if(!n){var r=this.params[t];if(!r)throw new en("generic index ".concat(t," is out of range: 0 ~ ").concat(this.params.length-1));n=this.covertParamTypeToExpandedNode(r),this.expandedParamNodes[t]=n}return n}},{key:"expandReferenceType",value:function(e){var t,n=this.templateEnvironment.replaceReferenceType(e);return t=n.typeEnum===he.Generator?n:{typeEnum:he.Generator,template:n,params:[]},this.expandGeneratorType(t)}},{key:"covertParamTypeToExpandedNode",value:function(e){return"id"in e?this.expandNode(e):{clazz:3,handle:e}}}]),e}(),nn=function(){function e(t){I(this,e),this.rootExpandedNode=t}return M(e,[{key:"getCollapsedExpression",value:function(){return this.collapseNode(this.rootExpandedNode)}},{key:"collapseNode",value:function(t){switch(t.clazz){case Kt.Border:return{id:e.generateId(),hasCircular:!1,types:[t.type.typeEnum]};case Kt.Object:return this.collapseObjectExpandedNode(t);case Kt.Handle:return this.collapseHandleExpandedNode(t);case Kt.Compound:return this.collapseCompoundExpandedNode(t,t.type.typeEnum);default:throw new Error("invalid class ".concat(t.clazz))}}},{key:"collapseObjectExpandedNode",value:function(t){var n=t.key,r=t.index,i=t.properties,a=this.collapseNode(n),o=this.collapseNode(r),s=a.hasCircular||o.hasCircular,c={};for(var u in i){var l=i[u],h=this.collapseNode(l);c[u]=h,s=s||h.hasCircular}var d={key:a,index:o,properties:c};return this.isCollapsedObjectHasNeverPropertyTypes(d)?e.neverCollapsedNode:{id:e.generateId(),hasCircular:s,types:[he.Object],object:d}}},{key:"collapseHandleExpandedNode",value:function(t){var n=t.handle;switch(n.state){case Qt.Noncircular:return n.collapsedNode;case Qt.Indeterminate:case Qt.Circular:return{id:e.generateId(),hasCircular:!0,types:[he.Object],handle:n};default:throw new Error("invalid state ".concat(n.state))}}},{key:"collapseCompoundExpandedNode",value:function(t,n){var r,i=[],a=A(t.children);try{for(a.s();!(r=a.n()).done;){var o=r.value;i.push(this.collapseNode(o))}}catch(e){a.e(e)}finally{a.f()}if(0===i.length)return e.neverCollapsedNode;if(1===i.length)return i[0];for(var s=0,c=i;s<c.length;s++){var u=c[s];if(u.handle&&u.handle.state===Qt.Indeterminate){var l=n===he.And?"&":"|";throw new en('can not operate an indeterminate expression with "'.concat(l,'" sign'))}}return n===he.And?this.pruneAndMergeNodes(i):this.flattenNodes(i)}},{key:"pruneAndMergeNodes",value:function(t){var n=this.collectCrossTypeEnumsWith(t);if(0===n.length||n.find((function(e){return e===he.Never})))return e.neverCollapsedNode;var r=this.collectAllObjectCollapsedNodesIn(t);return this.handleObjectCollapsedNodesWithTypeEnums(r,n,he.And)}},{key:"flattenNodes",value:function(t){var n=this.collectUnionTypeEnumsWith(t);if(0===(n=n.filter((function(e){return e!==he.Never}))).length)return e.neverCollapsedNode;if(n.find((function(e){return e===he.Any})))return{id:e.generateId(),hasCircular:!1,types:[he.Any]};var r=this.collectAllObjectCollapsedNodesIn(t);return this.handleObjectCollapsedNodesWithTypeEnums(r,n,he.Or)}},{key:"collectCrossTypeEnumsWith",value:function(e){var t,n={},r=A(e);try{for(r.s();!(t=r.n()).done;){var i,a=A(t.value.types);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=n[o];void 0===s&&(s=0),n[o]=s+1}}catch(e){a.e(e)}finally{a.f()}}}catch(e){r.e(e)}finally{r.f()}var c=[];for(var u in n)n[u]===e.length&&c.push(u);return c}},{key:"collectUnionTypeEnumsWith",value:function(e){var t,n={},r=A(e);try{for(r.s();!(t=r.n()).done;){var i,a=A(t.value.types);try{for(a.s();!(i=a.n()).done;){n[i.value]=!0}}catch(e){a.e(e)}finally{a.f()}}}catch(e){r.e(e)}finally{r.f()}var o=[];for(var s in n)n[s]&&o.push(s);return o}},{key:"collectAllObjectCollapsedNodesIn",value:function(e){var t,n=[],r=A(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;(i.object||i.handle)&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"handleObjectCollapsedNodesWithTypeEnums",value:function(t,n,r){var i,a=t;if(0===a.length)return{id:e.generateId(),hasCircular:!1,types:n};if(1===a.length)return function(e,t){return nt(e,rt(t))}(ct({},a[0]),{id:e.generateId(),types:n});var o=[];if(a=a.filter((function(e){return!e.handle||(o.push(e),!1)})),o.length>=2){var s=r===he.And?"&":"|";throw new en("can not ".concat(o.length,' circular expression with "').concat(s,'" sign'))}(i=a).push.apply(i,o);for(var c=a[0].object,u=1;u<a.length;++u){if(r===he.And&&this.isCollapsedObjectHasNeverPropertyTypes(c))return e.neverCollapsedNode;var l=a[u],h=this.getObjectFromObjectCollapsedNode(l);c=r===he.And?this.factorizeWithAndOperation(c,h):this.factorizeWithOrOperation(c,h)}return this.isCollapsedObjectHasNeverPropertyTypes(c)?e.neverCollapsedNode:{id:e.generateId(),types:n,hasCircular:this.hasCircularIn(a),object:c}}},{key:"getObjectFromObjectCollapsedNode",value:function(e){for(var t=e;;){if(t.object)return t.object;t=t.handle.collapsedNode}}},{key:"hasCircularIn",value:function(e){var t,n=A(e);try{for(n.s();!(t=n.n()).done;){if(t.value.hasCircular)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"factorizeWithAndOperation",value:function(e,t){var n=[],r=[],i=[];for(var a in e.properties)a in t.properties?n.push(a):r.push(a);for(var o in t.properties)o in e.properties||i.push(o);for(var s={},c=0,u=n;c<u.length;c++){var l=u[c],h=e.properties[l],d=t.properties[l];s[l]=this.pruneAndMergeNodes([h,d])}for(var f=0,p=r;f<p.length;f++){var v=p[f];s[v]=e.properties[v]}for(var m=0,g=i;m<g.length;m++){var y=g[m];s[y]=t.properties[y]}return{key:this.pruneAndMergeKeyOrIndexNodes(e.key,t.key),index:this.pruneAndMergeKeyOrIndexNodes(e.index,t.index),properties:s}}},{key:"factorizeWithOrOperation",value:function(e,t){var n=[];for(var r in e.properties)r in t.properties&&n.push(r);for(var i={},a=0,o=n;a<o.length;a++){var s=o[a],c=e.properties[s],u=t.properties[s];i[s]=this.flattenNodes([c,u])}return{key:this.flattenNodesKeyOrIndexNodes(e.key,t.key),index:this.flattenNodesKeyOrIndexNodes(e.index,t.index),properties:i}}},{key:"pruneAndMergeKeyOrIndexNodes",value:function(e,t){return this.isCollapsedNodeTypeEqual(e,he.Undefined)?t:this.isCollapsedNodeTypeEqual(t,he.Undefined)?e:this.pruneAndMergeNodes([e,t])}},{key:"flattenNodesKeyOrIndexNodes",value:function(e,t){return this.isCollapsedNodeTypeEqual(e,he.Undefined)?t:this.isCollapsedNodeTypeEqual(t,he.Undefined)?e:this.flattenNodes([e,t])}},{key:"isCollapsedObjectHasNeverPropertyTypes",value:function(e){if(this.isCollapsedNodeTypeEqual(e.key,he.Never)||this.isCollapsedNodeTypeEqual(e.index,he.Never))return!0;for(var t in e.properties)if(this.isCollapsedNodeTypeEqual(e.properties[t],he.Never))return!0;return!1}},{key:"isCollapsedNodeTypeEqual",value:function(e,t){return 1===e.types.length&&e.types[0]===t}}],[{key:"generateId",value:function(){var e=this.nextId;return this.nextId+=1,"".concat(e)}}]),e}(),rn=nn;rn.nextId=0,rn.neverCollapsedNode={id:nn.generateId(),hasCircular:!1,types:[he.Never]};var an,on=function(){function e(t){I(this,e),this.replaceReferenceType=t,this.templatesTable={}}return M(e,[{key:"getTemplate",value:function(e){if(void 0===e.id)throw new en("templateType don't have id");var t=this.templatesTable[e.id];return t||(t=new sn(this,e),this.templatesTable[e.id]=t),t}}]),e}(),sn=function(){function e(t,n){I(this,e),this.templateEnvironment=t,this.templateType=n,this.handlesCache=[]}return M(e,[{key:"getHandle",value:function(e){var t=this.getHandleByParams(e);if(!t){t={state:Qt.Indeterminate},this.setHandleWithParams(t,p(e));var n=this.createCollapsedNode(e);t.collapsedNode=n,t.state=n.hasCircular?Qt.Circular:Qt.Noncircular}return t}},{key:"createCollapsedNode",value:function(e){var t=new tn(this.templateEnvironment,this.templateType,e).getExpandedExpression();return new rn(t).getCollapsedExpression()}},{key:"getHandleByParams",value:function(t){var n,r=A(this.handlesCache);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(e.isParamsEquals(i.params,t))return i.handle}}catch(e){r.e(e)}finally{r.f()}}},{key:"setHandleWithParams",value:function(e,t){if(this.handlesCache.length>=2500)throw new en("the template's definition is divergence");this.handlesCache.push({handle:e,params:t})}}],[{key:"isParamsEquals",value:function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n){var r=e[n],i=t[n];if(!(r===i||"id"in r&&"id"in i&&r.id===i.id))return!1}return!0}}]),e}(),cn=function(){function e(t){I(this,e),this.collapsedNodeToRecordMap={},this.recordMap={},this.nextRecordId=0,this.templateEnvironment=new on(t);var n=this.nextRecordId;this.nextRecordId+=1,this.recordMap[n]=this.anyObjectFormatRecord={id:n,key:n,index:n,properties:{}}}return M(e,[{key:"covert",value:function(e){var t=this.templateEnvironment.getTemplate(e).getHandle([]).collapsedNode,n=this.findRecordId(t);return this.recordMap[n]}},{key:"getObjectFormatRecords",value:function(){var e=[];for(var t in this.recordMap)e.push(this.recordMap[t]);return e}},{key:"findRecordId",value:function(e){if(e.types.some((function(e){return e===he.Object}))){var t=this.collapsedNodeToRecordMap[e.id];if(!t){var n={id:this.nextRecordId};this.nextRecordId+=1,this.collapsedNodeToRecordMap[e.id]=n,this.recordMap[n.id]=n,this.convertCollapsedNodeAndFillObjectFormatRecord(e,n),t=n}return t.id}return this.anyObjectFormatRecord.id}},{key:"convertCollapsedNodeAndFillObjectFormatRecord",value:function(e,t){for(var n=e;n.handle;)n=n.handle.collapsedNode;var r=n.object,i={};for(var a in r.properties)i[a]=this.findRecordId(r.properties[a]);t.key=this.findRecordId(r.key),t.index=this.findRecordId(r.index),t.properties=i}}]),e}(),un=function(){function e(){I(this,e),this.replaceReferenceType=function(){throw new en("not define referenceTypeReplacer")}}return M(e,[{key:"createWithRecords",value:function(e,t){var n,r=new cn(t||this.replaceReferenceType),i=[],a={},o=A(e);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s.type,u=s.interrupter,l=r.covert(c);u&&(a[l.id]=u),i.push(l.id)}}catch(e){o.e(e)}finally{o.f()}for(var h=r.getObjectFormatRecords().map((function(e){var t=a[e.id];return t?t(e):e})),d=new ln(h),f=[],p=0,v=i;p<v.length;p++){var m=v[p];f.push(d.findObjectFormat(m))}return{format:d,objectFormats:f}}},{key:"createWithBuffer",value:function(e){return new ln(ln.deserialize(e))}}]),e}(),ln=function(){function e(t){I(this,e),this.records={},this.formats={};var n,r=null,i=A(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o={};this.records[a.id]=a,this.formats[a.id]=o,this.isAnyObjectFormatRecord(a)&&(r=o)}}catch(e){i.e(e)}finally{i.f()}var s,c=A(t);try{for(c.s();!(s=c.n()).done;){var u=s.value;this.completeObjectFormat(this.formats[u.id],u)}}catch(e){c.e(e)}finally{c.f()}if(!r)throw new Error("can't find any object format");this.anyObjectFormat=r,this.objectFormatIds=Object.freeze(t.map((function(e){return e.id})).sort())}return M(e,[{key:"isAnyObjectFormatRecord",value:function(e){for(var t in e.properties)return!1;return e.index===e.id&&e.key===e.id}},{key:"completeObjectFormat",value:function(e,t){for(var n in e.id=t.id,e.key=this.formats[t.key],e.index=this.formats[t.index],e.properties={},t.properties)e.properties[n]=this.formats[t.properties[n]];Object.freeze(e.properties),Object.freeze(e)}},{key:"findObjectFormat",value:function(e){var t=this.formats[e];if(!t)throw new Error("can't find ObjectFormat with id ".concat(e));return t}},{key:"serialize",value:function(){var e=[],t=new Bt;for(var n in this.records)e.push(this.records[n]);e.sort((function(e,t){return e.id-t.id})),t.writeUint32(e.length);for(var r=0,i=e;r<i.length;r++){var a=i[r];this.serializeRecord(a,t)}return t.toBuffer()}},{key:"serializeRecord",value:function(e,t){if(e.id>ft)throw new en("ObjectFormat's number can't greater than ".concat(ft));var n=Object.keys(e.properties).sort();if(n.length>ft)throw new en("ObjectFormat's properties number can't greater than ".concat(ft));t.writeUint32(e.id),t.writeUint32(e.key),t.writeUint32(e.index),t.writeUint32(n.length);var r,i=A(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;t.writeString(a),t.writeUint32(e.properties[a])}}catch(e){i.e(e)}finally{i.f()}}}],[{key:"deserialize",value:function(e){for(var t=[],n=new Zt(e),r=n.readUint32(),i=0;i<r;++i){for(var a=n.readUint32(),o=n.readUint32(),s=n.readUint32(),c=n.readUint32(),u={},l=0;l<c;++l){var h=n.readString(),d=n.readUint32();u[h]=d}t.push({id:a,key:o,index:s,properties:u})}return t}}]),e}(),hn=Math.pow(2,32)-1,dn=X(n("d+02")),fn=Object.defineProperty,pn=Object.getOwnPropertySymbols,vn=Object.prototype.hasOwnProperty,mn=Object.prototype.propertyIsEnumerable,gn=function(e,t,n){return t in e?fn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},yn=function(e,t){for(var n in t||(t={}))vn.call(t,n)&&gn(e,n,t[n]);if(pn){var r,i=A(pn(t));try{for(i.s();!(r=i.n()).done;){n=r.value;mn.call(t,n)&&gn(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},bn=function(){function e(t){I(this,e),this.sockets=[],this.logger=t}return M(e,[{key:"socketsCount",get:function(){return this.sockets.length}},{key:"addSocket",value:function(e){-1===this.sockets.indexOf(e)&&this.sockets.push(e)}},{key:"removeSocket",value:function(e){var t=this.sockets.indexOf(e);-1!==t&&this.sockets.splice(t,1)}},{key:"forEachSockets",value:function(e){this.sockets.forEach(e)}},{key:"emit",value:function(e,t){var n,r=A(this.sockets);try{for(r.s();!(n=r.n()).done;){var i=n.value;try{i.emit(e,t)}catch(e){this.logger.error(e)}}}catch(e){r.e(e)}finally{r.f()}}}]),e}(),kn=function(){function e(t){I(this,e),this.typesMap={},this.typeToIndexMap={},this.typesMap=Object.freeze(this.createTypesMap(t)),this.typeToIndexMap=Object.freeze(this.createTypeToIndexMap(this.typesMap))}return M(e,[{key:"createTypesMap",value:function(e){for(var t={},n=0;n<e.length;++n)t[n]=e[n];return t}},{key:"createTypeToIndexMap",value:function(e){var t={};for(var n in e){var r=parseInt(n,10),i=e[r];if(i in t)throw new Error('find duplicated type "'.concat(i,' in parameters of new TypesMap(...)"'));t[i]=r}return t}},{key:"hasType",value:function(e){return e in this.typeToIndexMap}},{key:"findTypeId",value:function(e){var t=this.typeToIndexMap[e];if(void 0===t)throw new Error("can't find id with type ".concat(e));return t}},{key:"findTypeById",value:function(e){var t=this.typesMap[e];if(!t)throw new Error("can't find type with id ".concat(e));return t}},{key:"extendsTypesMap",value:function(t){var n=[];for(var r in this.typesMap)n.push(this.typesMap[r]);for(var i in t.typesMap)n.push(t.typesMap[i]);return new e(n)}}],[{key:"create",value:function(t){return new e(t)}}]),e}();!function(e){e[e.CONNECTING=0]="CONNECTING",e[e.OPEN=1]="OPEN",e[e.CLOSING=2]="CLOSING",e[e.CLOSED=3]="CLOSED"}(an||(an={}));var wn,Sn=function(){function e(){I(this,e),this.eventListeners={}}return M(e,[{key:"on",value:function(e,t){var n=this.eventListeners[e];n||(n=[],this.eventListeners[e]=n),-1===n.indexOf(t)&&n.push(t)}},{key:"off",value:function(e,t){var n=this.eventListeners[e];if(n){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.eventListeners[e])}}},{key:"once",value:function(e,t){var n=this;this.on(e,(function r(i){try{t(i)}finally{n.off(e,r)}}))}},{key:"dispatchToListeners",value:function(e,t){var n=this.eventListeners[e];if(n){var r,i=A(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;try{a(t)}catch(e){console.error(e)}}}catch(e){i.e(e)}finally{i.f()}}}}]),e}(),xn=Math.pow(2,32);function Cn(e,t,n){var r=n%xn,i=(n-r)/xn;e.setInt32(t,r),e.setInt32(t+4,i)}function In(e,t){var n=e.getInt32(t);return e.getInt32(t+4)*xn+n}!function(e){e[e.Buffer=0]="Buffer",e[e.String=1]="String",e[e.Integer=2]="Integer"}(wn||(wn={}));var Pn=function(){function e(t,n,r){var i=this;I(this,e),this.typesMap=t,this.socket=n,this.receiver=r,this.latestThreePackageBytes=[0,0,0],this.nextSelfPackageId=0,this._latestReceivedRemoteId=-1,this.onMessage=function(e){try{if(i.receivedPackageHeadBuffer){var t=i.receivedPackageHeadBuffer,n=be(e.data),r=i.parsePackage(t,n);i._latestReceivedRemoteId=Math.max(r.id,i._latestReceivedRemoteId),i.receivedPackageHeadBuffer=void 0,i.receiver(null,r)}else i.receivedPackageHeadBuffer=be(e.data)}catch(t){i.receiver(t,null)}},n.binaryType="arraybuffer",n.addEventListener("message",this.onMessage)}return M(e,[{key:"bufferedAmount",get:function(){return this.socket.bufferedAmount}},{key:"maxPackageBytesInLatestThree",get:function(){return Math.max.apply(Math,[0].concat(p(this.latestThreePackageBytes)))}},{key:"latestReceivedRemoteId",get:function(){return this._latestReceivedRemoteId}},{key:"sendPackage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Object.freeze({id:this.nextSelfPackageId,receivedId:this._latestReceivedRemoteId,type:e,data:t});this.nextSelfPackageId+=1;var r=this.createPackageHead(n),i=this.wrapPackageData(n.data),a=r.byteLength+i.byteLength;return this.socket.send(r.primitiveBuffer),this.socket.send(i.primitiveBuffer),this.latestThreePackageBytes[0]=this.latestThreePackageBytes[1],this.latestThreePackageBytes[1]=this.latestThreePackageBytes[2],this.latestThreePackageBytes[2]=a,n.id}},{key:"createPackageHead",value:function(e){var t=ye(18);return Cn(t,0,e.id),Cn(t,8,e.receivedId),t.setUint8(16,this.typesMap.findTypeId(e.type)),t.setUint8(17,function(e){switch(T(e)){case"number":return 2;case"string":return 1;default:return 0}}(e.data)),t}},{key:"wrapPackageData",value:function(e){if("string"==typeof e){for(var t=new String(e),n=ye(2*t.length),r=0;r<t.length;++r)n.setUint16(2*r,65535&t.charCodeAt(r));return n}if("number"==typeof e){var i=ye(8);return Cn(i,0,e),i}return e}},{key:"parsePackage",value:function(e,t){var n,r=In(e,0),i=In(e,8),a=e.getUint8(16),o=e.getUint8(17);switch(o){case wn.String:for(var s=t.byteLength/2,c=[],u=0;u<s;++u)c[u]=t.getUint16(2*u);n=String.fromCharCode.apply(String,c);break;case wn.Integer:n=In(t,0);break;case wn.Buffer:n=t;break;default:throw new Error("unrecognized data type ".concat(o))}return Object.freeze({id:r,receivedId:i,type:this.typesMap.findTypeById(a),data:n})}}]),e}(),Mn=function(){function e(t,n,r,i,a){var o=this;I(this,e),this.receivedWhenNotWorkingBuffer=[],this.remoteHeartbeatTimeout=void 0,this.crashByChannelError=!1,this.isWorking=!1,this.isLimit=!1,this.becameLimitTimestamp=0,this.sendHeartbeat=function(){o.isWorking&&(o.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(o.akkoSocket.params.heartbeatInterval),o.chanel.sendPackage("heartbeat"))},this.handleRemoteHeartbeatTimeout=function(){o.crashByChannelError||(o.crashByChannelError=!0,o.callbacks.onRemoteHeartbeatTimeout())},this.onReceivedPackage=function(e,t){if(!o.crashByChannelError)if(!e&&t)if(o.isWorking)try{o.handleReceivedPackage(t)}finally{o.delayRemoteHeartbeatTimeoutChecking()}else o.receivedWhenNotWorkingBuffer.push(t);else e&&!t&&o.callbacks.onParseMessageFailed(e)},this.akkoSocket=t,this.logger=r,this.chanel=new Pn(i,n,this.onReceivedPackage),this.callbacks=Object.freeze(yn({},a)),this.sendHeartbeatDelayer=new je(this.sendHeartbeat),this.remoteHeartbeatTimeoutDelayer=new je(this.handleRemoteHeartbeatTimeout)}return M(e,[{key:"send",value:function(e,t){if(this.isWorking)if(t instanceof Array){var n,r=A(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.sendPackage(e,i)}}catch(e){r.e(e)}finally{r.f()}}else this.sendPackage(e,t)}},{key:"sendPackage",value:function(e,t){if(this.checkBufferedAmountOverflow())throw this.crashByChannelError||(this.crashByChannelError=!0,this.callbacks.onSendingBufferOverflow()),new Error("sending buffer overflow");this.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatInterval),this.chanel.sendPackage(e,t)}},{key:"checkBufferedAmountOverflow",value:function(){var e=!1,t=this.akkoSocket.params,n=t.sendingBufferCrash,r=t.sendingBufferLimit,i=t.sendingBufferLimitDuration,a=this.chanel,o=a.bufferedAmount,s=a.maxPackageBytesInLatestThree;if(o>n+s)e=!0;else if(o>r+s){var c=Date.now();this.isLimit?c-this.becameLimitTimestamp>i&&(this.isLimit=!1,e=!0):(this.isLimit=!0,this.becameLimitTimestamp=c)}else this.isLimit=!1;return e}},{key:"dispatchClose",value:function(e){var t=JSON.stringify(e);this.chanel.sendPackage("close",t)}},{key:"start",value:function(){this.isWorking||(this.isWorking=!0,this.delayRemoteHeartbeatTimeoutChecking(),this.sendHeartbeatDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatInterval),this.chanel.sendPackage("setHeartbeatTimeout",this.akkoSocket.params.heartbeatTimeout),this.cleanReceivedWhenNotWorkingBuffer())}},{key:"cleanReceivedWhenNotWorkingBuffer",value:function(){var e=this.receivedWhenNotWorkingBuffer.splice(0,this.receivedWhenNotWorkingBuffer.length);if(e.length>0)try{var t,n=A(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.handleReceivedPackage(r)}}catch(e){n.e(e)}finally{n.f()}}finally{this.delayRemoteHeartbeatTimeoutChecking()}}},{key:"stop",value:function(){this.isWorking&&(this.isWorking=!1,this.sendHeartbeatDelayer.cancel(),this.remoteHeartbeatTimeoutDelayer.cancel(),this.remoteHeartbeatTimeout=void 0)}},{key:"handleReceivedPackage",value:function(t){if(e.sessionEventTypesMap.hasType(t.type)){if("setHeartbeatTimeout"===t.type)"number"==typeof t.data&&t.data>0?this.remoteHeartbeatTimeout=t.data:this.logger.warn("illegal remote heartbeat timeout: ".concat(t.data));else if("close"===t.type){var n;if("string"==typeof t.data)try{n=JSON.parse(t.data)}catch(e){this.logger.warn("parse close payload as JSON failed: ".concat(e.message))}this.callbacks.onCloseByRemote(n)}}else this.callbacks.onEvent(t.type,t.data)}},{key:"delayRemoteHeartbeatTimeoutChecking",value:function(){void 0===this.remoteHeartbeatTimeout?this.remoteHeartbeatTimeoutDelayer.refreshAndInvokeAfterInterval(this.akkoSocket.params.heartbeatTimeout):this.remoteHeartbeatTimeoutDelayer.refreshAndInvokeAfterInterval(this.remoteHeartbeatTimeout)}}]),e}();Mn.sessionEventTypesMap=kn.create(["heartbeat","setHeartbeatTimeout","close"]);var Tn,An,En=function(){function e(t,n){var r=this;I(this,e),this.socket=t,this.logger=n,this.paddingExecutors=[],this.createdAt=Date.now(),this.isConnecting=!0,this.onOpen=function(){if(r.isConnecting){r.finishConnecting();var e,t=Date.now()-r.createdAt,n=A(r.paddingExecutors.splice(0));try{for(n.s();!(e=n.n()).done;){e.value.resolve({duration:t})}}catch(e){n.e(e)}finally{n.f()}}},this.onError=function(e){if(r.isConnecting){r.finishConnecting();var t,n=new Error(e.message||"connect failed"),i=A(r.paddingExecutors.splice(0));try{for(i.s();!(t=i.n()).done;){t.value.reject(n)}}catch(e){i.e(e)}finally{i.f()}}},this.onTimeout=function(){if(r.isConnecting){r.finishConnecting();var e,t=new Error("timeout"),n=A(r.paddingExecutors.splice(0));try{for(n.s();!(e=n.n()).done;){e.value.reject(t)}}catch(e){n.e(e)}finally{n.f()}try{var i=1e3;r.socket.close(1e3)}catch(i){r.logger.error(i)}}},t.addEventListener("open",this.onOpen),t.addEventListener("error",this.onError),this.timeoutTimer=setTimeout(this.onTimeout,25e3)}return M(e,[{key:"waitToConnected",value:function(){var e=this;return new Promise((function(t,n){e.paddingExecutors.push({resolve:t,reject:n})}))}},{key:"finishConnecting",value:function(){this.timeoutTimer&&clearTimeout(this.timeoutTimer),this.socket.removeEventListener("open",this.onOpen),this.socket.removeEventListener("error",this.onError),this.isConnecting=!1,this.timeoutTimer=null}}]),e}(),On=function(e){y(i,e);var t,n,r=k(i);function i(e,t,n,a){var o;return I(this,i),(o=r.call(this)).connectingManager=null,o.connectFailError=void 0,o.onError=function(){o.logger.warn("websocket received error")},o.onCloseByRemote=function(e){if(o._phase===Tn.Connected){o.sessionChannel.stop(),o.closeSocket(1e3),o.updatePhase(Tn.Disconnected);var t=e&&e.error,n=e&&e.reason;t?o.params.onDisconnect({reason:An.RemoteError,message:t,remoteCode:e.errorCode}):o.params.onDisconnect({reason:An.Normal,message:n||"ok"})}},o.onClose=function(e){var t=e.code,n=void 0===t?1e3:t,r=e.reason;if(o._phase===Tn.Connected){var i=o.errorMessageWithCode(n)||"disconnected with code ".concat(n,' "').concat(r,'"');o.sessionChannel.stop(),o.updatePhase(Tn.Disconnected),o.params.onDisconnect({reason:An.WebSocketError,message:i,webSocketCode:n})}},o.socket=e,o.socket.binaryType="arraybuffer",o.logger=t,o.params=Object.freeze(yn({},a)),o.sessionChannel=new Mn(S(o),e,t,n,{onCloseByRemote:o.onCloseByRemote,onEvent:function(e,t){return o.dispatchToListeners(e,t)},onRemoteHeartbeatTimeout:function(){return o.onCommunicationErrorMessage("remote heartbeat timeout")},onSendingBufferOverflow:function(){return o.onCommunicationErrorMessage("sending buffer overflow")},onParseMessageFailed:function(e){return o.onCommunicationErrorMessage("parse message failed: "+e.message)}}),o.initializePhaseWithSocketReadyState(),o}return M(i,[{key:"initializePhaseWithSocketReadyState",value:function(){switch(this.socket.readyState){case an.CONNECTING:this._phase=Tn.Connecting,this.connect();break;case an.OPEN:this._phase=Tn.Connected,this.addSessionListeners(),this.sessionChannel.start();break;default:var e=an[this.socket.readyState];throw e||(e="".concat(this.socket.readyState)),new Error("invalid readyState of WebSocket: ".concat(e))}}},{key:"phase",get:function(){return this._phase}},{key:"updatePhase",value:function(e){if(this._phase!==e)try{this.params.onPhaseChanged(e)}finally{this._phase=e}}},{key:"emit",value:function(e,t){if(this._phase!==Tn.Connected)throw new Error("AkkoSocket can't emit when phase is ".concat(this.phase));try{this.sessionChannel.send(e,t)}catch(e){throw this.disconnectForceWithCode(1e3),this.params.onDisconnect({reason:An.WebSocketError,message:e.message}),e}}},{key:"connect",value:(n=l(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,this.connectingManager=new En(this.socket,this.logger),e.next=4,this.connectingManager.waitToConnected();case 4:this.addSessionListeners(),this.sessionChannel.start(),this.updatePhase(Tn.Connected),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),this.updatePhase(Tn.Disconnected),this.connectFailError=e.t0;case 12:return e.prev=12,this.connectingManager=null,e.finish(12);case 15:case"end":return e.stop()}}),e,this,[[0,9,12,15]])}))),function(){return n.apply(this,arguments)})},{key:"addSessionListeners",value:function(){this.socket.addEventListener("close",this.onClose),this.socket.addEventListener("error",this.onError)}},{key:"waitToConnected",value:function(){if(this.connectFailError)throw this.connectFailError;if(this._phase===Tn.Connected)return Promise.resolve({duration:0});if(this._phase===Tn.Connecting)return this.connectingManager.waitToConnected();throw new Error("AkkoSocket's phase had became ".concat(this._phase))}},{key:"disconnect",value:function(e){return e?this.disconnectWithCodeAndReason({reason:e}):this.disconnectWithCodeAndReason()}},{key:"disconnectWithErrorDescription",value:function(e){var t=e.message,n=e.code;return this.disconnectWithCodeAndReason({error:t,errorCode:n})}},{key:"disconnectForce",value:function(){if(this._phase===Tn.Connected){this.disconnectForceWithCode(1e3)}}},{key:"disconnectForceWithCode",value:function(e){this.sessionChannel.stop(),this.closeSocket(e),this.updatePhase(Tn.Disconnected)}},{key:"disconnectWithCodeAndReason",value:(t=l(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.didCallDisconnect){e.next=2;break}throw new Error("AkkoSocket did call disconnect");case 2:this.didCallDisconnect=!0,n=!0,e.t0=this._phase,e.next=e.t0===Tn.Disconnecting||e.t0===Tn.Disconnected?7:e.t0===Tn.Connecting?8:17;break;case 7:throw new Error("AkkoSocket can't disconnect when phase is ".concat(this.phase));case 8:return e.prev=8,e.next=11,this.waitToConnected();case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(8),n=!1;case 16:return e.abrupt("break",17);case 17:if(!n){e.next=26;break}return this.updatePhase(Tn.Disconnecting),this.sessionChannel.dispatchClose(t),e.next=22,this.waitUtilCloseAndCheckTimeout();case 22:if(!e.sent){e.next=25;break}this.closeSocket(1e3);case 25:this.sessionChannel.stop(),this.updatePhase(Tn.Disconnected);case 26:case"end":return e.stop()}}),e,this,[[8,13]])}))),function(e){return t.apply(this,arguments)})},{key:"waitUtilCloseAndCheckTimeout",value:function(){var e=this,t=null,n=new Promise((function(e){t=setTimeout((function(){t=null,e(!0)}),3e3)})),r=new Promise((function(t){e.socket.readyState===an.CLOSED?t(!1):e.socket.addEventListener("close",(function(){return t(!1)}))}));return Promise.race([n,r]).then((function(e){return null!==t&&clearTimeout(t),e}))}},{key:"onCommunicationErrorMessage",value:function(e){this._phase===Tn.Connected&&(this.disconnectForce(),this.params.onDisconnect({reason:An.CommunicationError,message:e}))}},{key:"closeSocket",value:function(e){try{this.socket.close(e)}catch(e){this.logger.error(e)}}},{key:"errorMessageWithCode",value:function(e){switch(e){case 1e3:return"CLOSE_NORMAL";case 1001:return"CLOSE_GOING_AWAY";case 1002:return"CLOSE_PROTOCOL_ERROR";case 1003:return"CLOSE_UNSUPPORTED";case 1005:return"CLOSE_NO_STATUS";case 1006:return"CLOSE_ABNORMAL";case 1007:return"Unsupported Data";case 1008:return"Policy Violation";case 1009:return"CLOSE_TOO_LARGE";case 1010:return"Missing Extension";case 1011:return"Internal Error";case 1012:return"Service Restart";case 1013:return"Try Again Later";case 1015:return"TLS Handshake";default:return}}}]),i}(Sn),Rn=function(){function e(t){I(this,e),this.eventTypesMap=Mn.sessionEventTypesMap.extendsTypesMap(kn.create(t))}return M(e,[{key:"createSocket",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new On(t,n,this.eventTypesMap,yn(yn({},e.defaultSocketParams),r))}},{key:"createCombinedSockets",value:function(e){return new bn(e)}}]),e}();Rn.defaultSocketParams=Object.freeze({heartbeatInterval:4e4,heartbeatTimeout:5e4,sendingBufferLimit:5242880,sendingBufferLimitDuration:3e4,sendingBufferCrash:104857600,onDisconnect:function(){},onPhaseChanged:function(){}}),function(e){e.Connecting="connecting",e.Connected="connected",e.Disconnecting="disconnecting",e.Disconnected="disconnected"}(Tn||(Tn={})),function(e){e.Normal="normal",e.WebSocketError="webSocketError",e.CommunicationError="communicationError",e.RemoteError="remoteError"}(An||(An={}));var Nn,Ln,jn=Object.defineProperty,Dn=Object.defineProperties,Fn=Object.getOwnPropertyDescriptors,zn=Object.getOwnPropertySymbols,Bn=Object.prototype.hasOwnProperty,Un=Object.prototype.propertyIsEnumerable,Vn=function(e,t,n){return t in e?jn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Wn=function(e,t){for(var n in t||(t={}))Bn.call(t,n)&&Vn(e,n,t[n]);if(zn){var r,i=A(zn(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Un.call(t,n)&&Vn(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Hn=function(e,t){return Dn(e,Fn(t))};function _n(e){return 0===e.type}function Gn(e){return 1===e.type}function Yn(e){return 3===e.type}function Xn(e){return 4===e.type}!function(e){e[e.Invoker=0]="Invoker",e[e.Event=1]="Event",e[e.Ack=2]="Ack",e[e.Enter=3]="Enter",e[e.Leave=4]="Leave"}(Nn||(Nn={})),function(e){e[e.System=0]="System",e[e.App=1]="App",e[e.Custom=2]="Custom",e[e.Magix=3]="Magix"}(Ln||(Ln={}));var qn=function(){function e(t,n){I(this,e);var r=t.format.anyObjectFormat;this.serialization=t,this.rootClassReflection=n,this.rootObjectFormats=Object.freeze([this.rootClassReflection.objectFormat]),this.oneAnyObjectFormats=Object.freeze([r]),this.twoAnyObjectFormats=Object.freeze([r,r])}return M(e,[{key:"serializeSnapshotFrame",value:function(e){var t=new Bt;return this.serializeFrameHeader(t,e),this.serializeUsers(t,e.users),this.serialization.serialize({writer:t,values:[e.rootObject],objectFormats:this.rootObjectFormats,includesHash:!0}),t.toBuffer()}},{key:"serializeUsers",value:function(e,t){var n=[this.serialization.format.anyObjectFormat];e.writeUint32(t.length);var r,i=A(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;e.writeUint32(a.userId),e.writeUint32(a.nextFrameId),e.writeString(a.session),this.serialization.serialize({writer:e,values:[a.payload],objectFormats:n,includesHash:!0})}}catch(e){i.e(e)}finally{i.f()}}},{key:"deserializeSnapshotFrame",value:function(e,t,n){var r,i=new Zt(e),a=this.deserializeFrameHeader(i);r=t!==Nt.V0?this.deserializeUsers(i,t,n):function(e){var t=e.readInt32();e.readInt32();for(var n=[],r=0;r<t;++r){var i=e.readUint32();n.push({userId:i,nextFrameId:0,session:"",payload:void 0})}return n}(i);var o=h(this.serialization.deserialize({reader:i,objectFormats:this.rootObjectFormats,ignoreHashChecking:n,version:t}),1)[0];return Hn(Wn({},a),{users:r,rootObject:o})}},{key:"deserializeUsers",value:function(e,t,n){for(var r=e.readUint32(),i=[],a=[this.serialization.format.anyObjectFormat],o=0;o<r;++o){var s=e.readUint32(),c=e.readUint32(),u=e.readString(),l=h(this.serialization.deserialize({reader:e,objectFormats:a,ignoreHashChecking:n,version:t}),1)[0];i.push({userId:s,nextFrameId:c,session:u,payload:l})}return Object.freeze(i)}},{key:"serializeActionFrame",value:function(e,t){var n=new Bt;if(this.serializeFrameHeader(n,e),n.writeUint8(e.type),n.writeInt53(e.scopeId),n.writeInt53(e.beginObjectId),_n(e)){n.writeUint32(e.methodId);var r=this.rootClassReflection.methodNames[e.methodId],i=this.rootClassReflection.methods[r].parameterFormatObjects;this.serialization.serialize({writer:n,values:e.parameters,objectFormats:i,includesHash:t})}else Gn(e)?(n.writeUint8(e.scope),n.writeString(e.event),this.serialization.serialize({writer:n,values:[e.payload],objectFormats:this.oneAnyObjectFormats,includesHash:t})):Yn(e)?(n.writeString(e.session),this.serialization.serialize({writer:n,values:[e.userPayload,e.connectedPayload],objectFormats:this.twoAnyObjectFormats,includesHash:t})):Xn(e)&&this.serialization.serialize({writer:n,values:[e.payload],objectFormats:this.oneAnyObjectFormats,includesHash:t});return n.toBuffer()}},{key:"deserializeActionFrame",value:function(e,t,n){var r,i=new Zt(e),a=this.deserializeFrameHeader(i),o=i.readUint8(),s=0,c=0;switch(t!==Nt.V0&&(s=i.readInt53(),c=i.readInt53()),o){case Nn.Invoker:var u=i.readUint32(),l=this.rootClassReflection.methodNames[u],d=this.rootClassReflection.methods[l].parameterFormatObjects,f=this.serialization.deserialize({reader:i,objectFormats:d,ignoreHashChecking:n,version:t});return t===Nt.V0&&(r=i.readBigInt()),Hn(Wn({},a),{type:o,scopeId:s,beginObjectId:c,beginGenerationId:r,methodId:u,parameters:f});case Nn.Event:var p=i.readUint8(),v=i.readString(),m=h(this.serialization.deserialize({reader:i,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:n,version:t}),1)[0];return t===Nt.V0&&(r=i.readBigInt()),Hn(Wn({},a),{type:o,scopeId:s,beginObjectId:c,beginGenerationId:r,scope:p,event:v,payload:m});case Nn.Ack:return Hn(Wn({},a),{type:o,scopeId:s,beginObjectId:c});case Nn.Enter:var g=i.readString(),y=h(this.serialization.deserialize({reader:i,objectFormats:this.twoAnyObjectFormats,ignoreHashChecking:n,version:t}),2),b=y[0],k=y[1];return Hn(Wn({},a),{type:o,scopeId:s,beginObjectId:c,session:g,userPayload:b,connectedPayload:k});case Nn.Leave:var w=h(this.serialization.deserialize({reader:i,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:n,version:t}),1)[0];return Hn(Wn({},a),{type:o,scopeId:s,beginObjectId:c,payload:w});default:throw new Error("invalid type ".concat(o))}}},{key:"serializeFrameHeader",value:function(e,t){e.writeUint32(t.frameId),e.writeUint32(t.originalFrameId),e.writeInt53(t.timestamp),e.writeUint32(t.authorId)}},{key:"deserializeFrameHeader",value:function(e){return{frameId:e.readUint32(),originalFrameId:e.readUint32(),timestamp:e.readInt53(),authorId:e.readUint32()}}}]),e}(),Qn=Math.pow(2,32);Math.pow(2,16);function Kn(e,t){var n=e.getInt32(t);return e.getInt32(t+4)*Qn+n}function Zn(e){for(var t=new Zt(e),n=new Bt,r=0;r<20;++r)n.writeUint8(t.readUint8());return n.writeUint8(Nn.Ack),n.toBuffer()}var Jn=function(){function e(t){if(I(this,e),t.byteLength<20)throw new Error("Buffer is to short");this.frameBuffer=t}return M(e,[{key:"frameId",get:function(){return this.frameBuffer.getUint32(0)},set:function(e){this.frameBuffer.setUint32(0,e)}},{key:"originalFrameId",get:function(){return this.frameBuffer.getUint32(4)},set:function(e){this.frameBuffer.setUint32(4,e)}},{key:"timestamp",get:function(){return Kn(this.frameBuffer,8)},set:function(e){var t=0|e,n=(e-t)/Qn;this.frameBuffer.setInt32(8,t),this.frameBuffer.setInt32(12,n)}},{key:"authorId",get:function(){return this.frameBuffer.getUint32(16)},set:function(e){this.frameBuffer.setUint32(16,e)}},{key:"type",get:function(){return this.frameBuffer.getUint8(20)}},{key:"scopeId",get:function(){return Kn(this.frameBuffer,21)}},{key:"beginObjectId",get:function(){return Kn(this.frameBuffer,29)}},{key:"scope",get:function(){return this.frameBuffer.getUint8(37)}},{key:"fetchEventContent",value:function(){var e=new Zt(this.frameBuffer);if(e.skipBytes(37),this.type===Nn.Event){var t=e.readUint8();return{event:e.readString(),scope:t}}}}]),e}(),$n=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.call(this)}return M(n,[{key:"createObject",value:function(e,t){var r=c(C(n.prototype),"createObject",this).call(this,e,t);return n.objectsCollection&&n.objectsCollection.push(r),r}}],[{key:"startCollection",value:function(){this.objectsCollection=[]}},{key:"completeCollection",value:function(){try{if(!this.objectsCollection)return[];var e,t=A(this.objectsCollection);try{for(t.s();!(e=t.n()).done;){delete e.value.__identifier}}catch(e){t.e(e)}finally{t.f()}return this.objectsCollection}finally{this.objectsCollection=void 0}}}]),n}(gt);function er(e,t){return new qn(e,t)}$n.objectsCollection=void 0;var tr,nr=function(){function e(){I(this,e),this.listeners=[]}return M(e,[{key:"currentNode",get:function(){return this._currentNode}},{key:"addListener",value:function(e){this.listeners.push(e)}},{key:"runWith",value:function(e,t){var n=this._currentNode;this._currentNode=e,this.dispatch(e,!0);try{return t()}finally{this._currentNode=n,this.dispatch(e,!1),n&&this.dispatch(n,!0)}}},{key:"dispatch",value:function(e,t){var n,r=A(this.listeners);try{for(r.s();!(n=r.n()).done;){var i=n.value;try{i(e,t)}catch(e){console.error(e)}}}catch(e){r.e(e)}finally{r.f()}}}]),e}();!function(e){e[e.SingleForward=0]="SingleForward",e[e.DoubleForward=1]="DoubleForward"}(tr||(tr={}));var rr,ir,ar,or=new nr;!function(e){e[e.FlatObject=0]="FlatObject",e[e.AkkoObject=1]="AkkoObject",e[e.Array=2]="Array",e[e.Displayer=3]="Displayer"}(rr||(rr={})),function(e){e[e.Uncommitted=0]="Uncommitted",e[e.Committed=1]="Committed",e[e.Rejected=2]="Rejected"}(ir||(ir={})),function(e){e[e.Illusion=0]="Illusion",e[e.IllusionRebuild=1]="IllusionRebuild",e[e.Real=2]="Real",e[e.RealAck=3]="RealAck",e[e.Outside=4]="Outside"}(ar||(ar={}));var sr=function(){function e(t){I(this,e),this.operator=t,this.floatObjects={}}return M(e,[{key:"collectValue",value:function(e){var t=this;if("object"==T(e)&&null!==e){var n=this.operator.identifier(e);return n in this.floatObjects||(this.floatObjects[n]=e,this.operator.forEach(e,(function(e){t.collectValue(e)}))),n}}}]),e}(),cr=function e(){I(this,e)};function ur(e){return e instanceof cr}function lr(e){var t=function(e,t,n){return n};return Object.setPrototypeOf(t,cr.prototype),Object.defineProperty(t,"payload",{enumerable:!0,configurable:!1,writable:!1,value:e}),t}var hr,dr,fr=lr(null),pr=lr(null),vr=function e(t){var n=this;I(this,e),this.filters=[],this.filter=function(e,t,r){var i,a=A(n.filters);try{for(a.s();!(i=a.n()).done;){if((0,i.value)(e,t,r))return!0}}catch(e){a.e(e)}finally{a.f()}return!1};var r,i=[],a=A(t);try{var o=function(){var e=r.value,t=void 0;if("function"==typeof e)t=e;else if("string"==typeof e)t=function(t){return t===e};else{if(!(e instanceof RegExp))throw new Error("unrecognized condition "+e);t=function(t){return e.test(t)}}i.push(t)};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}this.filters=Object.freeze(i)};function mr(e,t){return{event:e.event,payload:e.payload,authorId:e.authorId,scope:gr(e.scope),phase:t}}function gr(e){switch(e){case Ln.System:return hr.System;case Ln.App:return hr.App;case Ln.Custom:return hr.Custom;default:return hr.Magix}}!function(e){e.System="system",e.App="app",e.Custom="custom",e.Magix="magix"}(hr||(hr={})),function(e){e.Dispatched="dispatched",e.Updated="updated",e.Canceled="canceled"}(dr||(dr={}));var yr=function e(t){I(this,e),this.eventFilter=new vr(t).filter};function br(e){return"object"==T(e)&&null!==e&&e instanceof yr}function kr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return lr(new yr(t))}var wr="__reflection",Sr=function(){function e(t,n,r,i){I(this,e),this.isRootClass=n,this.id=r.classId,this.name=r.clazz.name,this.clazz=r.clazz,this.superClass=r.superClass,this.objectFormat=t.findObjectFormat(r.objectFormatId);for(var a={},o={},s=[r].concat(p(i)),c=s.length-1;c>=0;--c){var u,l=s[c],h=l.clazz,d=A(l.members);try{for(d.s();!(u=d.n()).done;){var f=u.value;Ne(f)?a[f.name]=this.createProperty(f,h,this.objectFormat):Le(f)&&(o[f.name]=this.createMethod(f,h,t))}}catch(e){d.e(e)}finally{d.f()}}this.properties=Object.freeze(a),this.methods=Object.freeze(o),this.methodNames=Object.freeze(Object.keys(this.methods))}return M(e,[{key:"createProperty",value:function(e,t,n){var r=e.decorators.some((function(e){return e===fr}));return Object.freeze({name:e.name,mode:e.mode,belongsClass:t,isTransient:r,isPublic:e.isPublic,objectFormat:n.properties[e.name],decorators:e.decorators})}},{key:"createMethod",value:function(e,t,n){var r,i=e.name,a=e.parameters,o=e.decorators,s=[],c=A(a);try{for(c.s();!(r=c.n()).done;){var u=r.value;s.push(n.findObjectFormat(u))}}catch(e){c.e(e)}finally{c.f()}return Object.freeze({name:i,belongsClass:t,isPublic:e.isPublic,parameterFormatObjects:Object.freeze(s),decorators:Object.freeze(p(o))})}}]),e}(),xr=function(e){y(n,e);var t=k(n);function n(e,r,i,a,o){var s;return I(this,n),(s=t.call(this,(function(e,t,n,r){return s.handleDecorateObject(e,t,n,r)}))).decorateObjectEnums=Object.freeze([ht.Object,ht.Array]),s.proxyRuntime=e,s.idGenerator=i,s.covertIdToClass=r,s.toOverrideObjects=a,s.overrideNodeCatcher=o,s}return M(n,[{key:"createObject",value:function(e,t){if(t===ht.HangUpObject)throw new Tt("not support hang up object: ".concat(e));return c(C(n.prototype),"createObject",this).call(this,e,t)}},{key:"handleDecorateObject",value:function(e,t,n,r){var i=e.__identifier,a=this.proxyRuntime.objectOperator,o=this.getClassReflection(t,r),s=this.toOverrideObjects[i];if(!s||!this.isTypeMatch(s,t))switch(t){case lt.Array:s=a.createObject(this.idGenerator.generate(),[]);break;case lt.DeducedObject:s=a.createObject(this.idGenerator.generate(),{});break;case lt.AssertedObject:Object.setPrototypeOf(e,o.clazz.prototype),s=a.createObject(this.idGenerator.generate(),e);break;default:throw new Tt("invalid ObjectType ".concat(t))}var c,u=A(n);try{for(u.s();!(c=u.n()).done;){var l=c.value;l.object[l.key]=s}}catch(e){u.e(e)}finally{u.f()}this.overrideNodeCatcher(s,e,o)}},{key:"isTypeMatch",value:function(e,t){switch(this.proxyRuntime.objectOperator.kind(e)){case rr.Array:return t===lt.Array;case rr.FlatObject:return t===lt.DeducedObject;case rr.AkkoObject:return t===lt.AssertedObject;default:return!1}}},{key:"getClassReflection",value:function(e,t){if(e===lt.AssertedObject){if(!t)throw new Tt("expect object format");var n=this.covertIdToClass(t.id);if(!n)throw new Tt("can't find class by object format id ".concat(t.id));return n[wr]}return null}}]),n}(gt),Cr=function(){function e(t){var n=this;I(this,e),this.assertObjectFormat=function(e){var t=n.proxyRuntime.objectOperator.getClassReflection(e);if(t)return t.objectFormat};var r=new sr(t.proxyRuntime.objectOperator);this.format=t.format,this.snapshotObjectFormats=t.snapshotObjectFormats,this.idGenerator=t.idGenerator,this.proxyRuntime=t.proxyRuntime,this.covertIdToClass=t.covertIdToClass,r.collectValue(t.rootObject),this.floatObjects=r.floatObjects}return M(e,[{key:"recoverFrom",value:function(t,n){for(var r,i=[],a=new xr(this.proxyRuntime,this.covertIdToClass,this.idGenerator,this.floatObjects,(function(e,t,n){return i.push({object:e,tempObject:t,classReflection:n})})),o=!n,s=h(new Ft({format:this.format,objectAdapter:a,assertObjectFormat:this.assertObjectFormat}).deserialize({reader:t,objectFormats:this.snapshotObjectFormats,ignoreHashChecking:o,version:e.akkoSerVersion}),1)[0],c=0,u=i;c<u.length;c++){var l=u[c],d=l.object,f=l.tempObject,p=l.classReflection;this.proxyRuntime.objectOperator.override(d,f,p),f===s&&(r=d)}return r}}]),e}();Cr.akkoSerVersion=Dt(We);var Ir,Pr=null,Mr=null;or.addListener((function(e,t){t&&e.tools?(Ir=e.coreFunctions,Mr=e.tools.idGenerator,Pr=e.proxyRuntime):(Ir=null,Mr=null,Pr=null)}));var Tr,Ar,Er=function(){function e(t,n){I(this,e),this.format=n.format,this.covertIdToClass=n.covertObjectFormatIdToClass,this.description=Object.freeze({roomUUID:t,appIdentifier:n.appIdentifier,appVersion:n.appVersion,appHash:n.appHash,akkoVersion:n.akkoVersion})}return M(e,[{key:"createSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!or.currentNode)throw new Error("can't call createSnapshot out of Magix");var n=Ir.wrapper(e),r=new Bt,i=this.readObjectFormatWith(n),a=t;return r.writeUint8(t?255:0),t&&(r.writeString(this.description.roomUUID),r.writeString(this.description.appIdentifier),r.writeString(this.description.appVersion),r.writeString(this.description.appHash),r.writeString(this.description.akkoVersion)),r.writeUint32(i.id),Pr.frameHandler.createSerialization(this.format).serialize({writer:r,values:[n],objectFormats:[i],includesHash:a}),r.toBuffer().freeze()}},{key:"recoverWithSnapshot",value:function(e,t){if(!or.currentNode)throw new Error("can't call recoverWithSnapshot out of Magix");var n=Ir.wrapper(t),r=new Zt(e),i=this.readDescription(r),a=r.readUint32();if(n&&this.readObjectFormatWith(n).id!==a)throw new Error("target's class isn't matching");var o=this.format.findObjectFormat(a),s=this.shouldOverrideTarget(i)?n:void 0;return new Cr({rootObject:s,format:this.format,snapshotObjectFormats:[o],idGenerator:Mr,proxyRuntime:Pr,covertIdToClass:this.covertIdToClass}).recoverFrom(r,void 0!==i)}},{key:"readObjectFormatWith",value:function(e){var t=Pr.objectOperator;if(t.kind(e)!==rr.AkkoObject)throw new Error("can't only create snapshot of AkkoObject");return t.getClassReflection(e).objectFormat}},{key:"readDescription",value:function(e){if(e.readUint8()){var t=e.readString(),n=e.readString(),r=e.readString(),i=e.readString(),a=e.readString();if(n!==this.description.appIdentifier)throw new Error("invalid snapshot: appIdentifier not matches");if(r!==this.description.appVersion)throw new Error("invalid snapshot: appVersion not matches");if(i!==this.description.appHash)throw new Error("invalid snapshot: appHash not matches");if(a!==this.description.akkoVersion)throw new Error("invalid snapshot: akkoVersion not matches");return{roomUUID:t,appIdentifier:n,appVersion:r,appHash:i,akkoVersion:a}}}},{key:"shouldOverrideTarget",value:function(e){return!e||e.roomUUID===this.description.roomUUID}}]),e}();function Or(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return new Er(t,e)}function Rr(){if(!Tr)throw new Error("you can not call this function out of Magix");return Tr.resource}or.addListener((function(e,t){Tr=t&&e.tools?e.tools.extra:void 0})),function(e){e.Real="real",e.Illusion="illusion",e.NoEffects="noEffects"}(Ar||(Ar={}));var Nr=function(){function e(t){I(this,e),this.atob=t}return M(e,[{key:"parse",value:function(e){for(var t=new String(this.atob(e)),n=ye(t.length),r=0;r<t.length;++r)n.setUint8(r,t.charCodeAt(r));return n}}]),e}();function Lr(e){var t={},n=function(n){var r=e[n];t[n]="function"==typeof r?function(){var e;try{for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];e=r.apply(t,i)}catch(e){console.error(e)}return e}:r};for(var r in e)n(r);return Object.freeze(t)}var jr="__identifier";function Dr(e,t){Object.defineProperty(e,jr,{enumerable:!1,configurable:!0,value:t})}var Fr,zr,Br,Ur,Vr,Wr,Hr,_r,Gr,Yr,Xr,qr=function(){function e(t,n){I(this,e),this.foundObjects=[],this.idGenerator=t,this.operator=n}return M(e,[{key:"complete",value:function(){var e,t=A(this.foundObjects);try{for(t.s();!(e=t.n()).done;){delete e.value[jr]}}catch(e){t.e(e)}finally{t.f()}}},{key:"bind",value:function(e){if("object"!=T(e)||null===e||ke(e))return e;var t=e;if(this.operator.isDisplayerObject(t)&&(t=this.operator.copyDisplayer(t)),t.constructor===Array)return this.bindArray(t);if(t.constructor===Object)return this.bindObject(t);throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"bindArray",value:function(e){var t=e[jr];void 0===t&&(Dr(e,t=this.idGenerator.generate()),this.foundObjects.push(e));for(var n=0;n<e.length;++n)this.bind(e[n])}},{key:"bindObject",value:function(e){var t=e[jr];for(var n in void 0===t&&(Dr(e,t=this.idGenerator.generate()),this.foundObjects.push(e)),e)this.bind(e[n])}}]),e}(),Qr=function(){function e(t,n,r){I(this,e),this.nodes={},this.idGenerator=t,this.operator=n,this.adapter=r}return M(e,[{key:"bind",value:function(e,t){var n=null,r=this.bindValue(e,t),i=this.findIdentifier(r);if(void 0!==i){var a=this.nodes[i];n={wrapped:a.wrapped,copied:a.copied}}return{value:r,binder:n}}},{key:"completeBinding",value:function(){for(var e in this.nodes){delete this.nodes[e].binded[jr]}}},{key:"bindValue",value:function(e,t){if("object"!=T(e)||null===e)return e;if(ke(e))return e.readonly?e:e.slice();var n=e;if(this.operator.isDisplayerObject(n)&&(n=this.operator.copyDisplayer(n)),n.constructor===Array)return this.bindArray(n,t);if(n.constructor===Object)return this.bindObject(n,t);throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"bindArray",value:function(e,t){var n=e[jr];if(void 0===n){n=this.idGenerator.generate();var r=this.adapter.createObject(n,ht.Array),i=[];Dr(e,n),Dr(i,n),this.nodes[n]={identifier:n,binded:e,copied:i,wrapped:r};for(var a=0;a<e.length;++a){var o=this.bindValue(e[a],t.index),s=this.findIdentifier(o);if(void 0===s)this.adapter.setValue(r,a,o),i[a]=o;else{var c=this.nodes[s],u=c.copied,l=c.wrapped;this.adapter.setValue(r,a,l),i[a]=u}}}return e}},{key:"bindObject",value:function(e,t){var n=e[jr];if(void 0===n){n=this.idGenerator.generate();var r={},i=this.adapter.createObject(n,ht.Object),a=[],o=[];for(var s in Dr(e,n),Dr(r,n),this.nodes[n]={identifier:n,binded:e,copied:r,wrapped:i},t.properties)s in e&&(a.push(s),o.push(t.properties[s]));for(var c in e)c!==jr&&!(c in t.properties)&&(a.push(c),o.push(t.key));for(var u=0;u<a.length;++u){var l=a[u],h=o[u],d=this.bindValue(e[l],h),f=this.findIdentifier(d);if(void 0===f)this.adapter.setValue(i,l,d),r[l]=d;else{var p=this.nodes[f],v=p.copied,m=p.wrapped;this.adapter.setValue(i,l,m),r[l]=v}}}return e}},{key:"findIdentifier",value:function(e){if("object"==T(e)&&null!==e)return e[jr]}}]),e}(),Kr=function(){function e(t){I(this,e),this._phase=t.phase||t.getCurrentPhase(),this.getCurrentPhase=t.getCurrentPhase,this.onPhaseChanged=t.onPhaseChanged}return M(e,[{key:"phase",get:function(){return this._phase}},{key:"touch",value:function(){var e=this.getCurrentPhase(),t=this._phase;t!==e&&(this._phase=e,this.onPhaseChanged&&this.onPhaseChanged(e,t))}}]),e}(),Zr=function(){function e(t,n){I(this,e),this.paddingInvokers=null,this.logger=t,this.callbacks=Wn({},n)}return M(e,[{key:"hasKey",value:function(e){return e in this.callbacks}},{key:"callback",value:function(e,t){var n=this.callbacks[e];if(n)if(this.paddingInvokers)this.paddingInvokers.push({key:e,payload:t});else try{n(t)}catch(e){this.logger.error(e)}}},{key:"isPadding",get:function(){return!!this.paddingInvokers},set:function(e){if(this.isPadding!==e)if(e)this.paddingInvokers=[];else{var t,n=A(this.paddingInvokers);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.key,a=r.payload;try{this.callbacks[i](a)}catch(e){this.logger.error(e)}}}catch(e){n.e(e)}finally{n.f()}this.paddingInvokers=null}}}]),e}(),Jr=function(){function e(t){I(this,e),this.base64Parser=new Nr(t)}return M(e,[{key:"create",value:function(e){if(!this.isSupportedAkkoVersion(e.akkoVersion))throw new Se("can not support library (built by akko ".concat(e.akkoVersion,")"));var t=this.createFormat(e.formatBase64),n=this.createClassReflections(t,e.rootConstructor,e.classDeclarations),r=this.createObjectFormatToClassMap(n);return new $r(e.appIdentifier,e.appVersion,e.formatHash,e.akkoVersion,e.rootConstructor,(function(e){return r[e]}),t,n)}},{key:"isSupportedAkkoVersion",value:function(e){var t=We.split("."),n=e.split(".");return!(n.length<2||t[0]!==n[0]||t[1]!==n[1])&&(!(t.length>=3)||t[2]>=n[2])}},{key:"createFormat",value:function(e){var t=new un,n=this.base64Parser.parse(e);return t.createWithBuffer(n)}},{key:"createClassReflections",value:function(e,t,n){var r={};for(var i in n){var a=n[i],o=a.clazz,c=o===t,u=s(this.searchThisAndSuperClassDeclarations(a,n)),l=u[0],h=u.slice(1),d=new Sr(e,c,l,h);if(void 0!==Object.getOwnPropertyDescriptor(o,wr))throw new Se("class ".concat(o.name,' has defined  reserved word static property "').concat(wr));Object.defineProperty(o,wr,{value:d,writable:!1,configurable:!1}),r[i]=d}return Object.freeze(r)}},{key:"createObjectFormatToClassMap",value:function(e){var t={};for(var n in e){var r=e[n];t[r.objectFormat.id]=r.clazz}return Object.freeze(t)}},{key:"searchThisAndSuperClassDeclarations",value:function(e,t){for(var n=[],r=e;n.push(r),r.superClass&&r.superClass!==Object;)r=this.findClassDeclarationsWithConstructor(r.superClass,t);return n}},{key:"findClassDeclarationsWithConstructor",value:function(e,t){for(var n in t){var r=t[n];if(r.clazz===e)return r}throw new Se("can not find superClass")}}]),e}(),$r=function(){function e(t,n,r,i,a,o,s,c){I(this,e),this.appIdentifier=t,this.appVersion=n,this.appHash=r,this.akkoVersion=i,this.rootClass=a,this.covertObjectFormatIdToClass=o,this.format=s,this.classReflections=c}return M(e,[{key:"classReflection",value:function(e){var t=this.classReflections[e];if(!t)throw new Error("can't find class with id ".concat(e));return t}}]),e}();function ei(e){Fr=e.creator,zr=e.updater,Br=e.wrapper,Ur=e.unwrapper,Vr=e.jsxUnwrapper,Wr=e.getter,Hr=e.setter,_r=e.caller,Gr=e.remover,Yr=e.prefix,Xr=e.postfix}var ti,ni,ri=Object.freeze({creator:function(e){return e},updater:function(e){return e},wrapper:function(e){return e},unwrapper:function(e){return e},jsxUnwrapper:function(e){return e},getter:function(e,t){return e[t]},setter:function(e,t,n){return e[t]=n},caller:function(e,t,n,r){return(r||e)[t].apply(e,n)},remover:function(e,t){return delete e[t]},prefix:function(e,t,n){return e[t]+=n},postfix:function(e,t,n){var r=e[t];return e[t]+=n,r}});function ii(){if(!ti){var e=this.constructor&&this.constructor.name;throw e?new Error("can't construct ".concat(e," out of Magix, it's an AkkoObject")):new Error("can't construct an AkkoObject out of Magix")}ti(this)}ei(ri),or.addListener((function(e,t){ei(t?e.coreFunctions:ri)})),or.addListener((function(e,t){ti=t?e.coreFunctions.creator:void 0})),Object.setPrototypeOf(ii.prototype,Object.prototype),or.addListener((function(e,t){ni=t?e.proxyRuntime.objectOperator:void 0}));var ai=function(){var e=new Jr(dn.default.bind(null));return new Re({akkoVersion:We,akkoObjectBaseClass:ii,libraryFactory:e.create.bind(e),coreFunctions:{creator:function(e){return Fr(e)},updater:function(e){return zr(e)},wrapper:function(e){return Br(e)},unwrapper:function(e){return Ur(e)},jsxUnwrapper:function(e){return Vr(e)},getter:function(e,t){return Wr(e,t)},setter:function(e,t,n){return Hr(e,t,n)},caller:function(e,t,n,r){return _r(e,t,n,r)},remover:function(e,t){return Gr(e,t)},prefix:function(e,t,n){return Yr(e,t,n)},postfix:function(e,t,n){return Xr(e,t,n)}}})}();var oi,si,ci,ui,li=ai.context,hi=ai.getLibrary;function di(e){if(!ni)throw new Error("can't call isAkkoObject out of Magix");return ni.isValidObject(e)||ai.isAkkoObject(e)}function fi(e){if("function"==typeof e){var t=e[wr];if("object"==T(t)&&null!==t)return t}else if(ai.isAkkoObject(e))return fi(e.constructor)}function pi(){if(!oi)throw Si();return oi.environment}function vi(){if(!oi)throw Si();return oi.timestamp}function mi(){if(!oi)throw Si();return oi.functions.getAuthorId()}function gi(e){if(!oi)throw Si();return oi.functions.hasUser(e)}function yi(){if(!oi)throw Si();return oi.functions.getUsersCount()}function bi(e){if(!oi)throw Si();return oi.functions.getUser(e)}function ki(){if(!oi)throw Si();return oi.functions.getUserIds()}function wi(){if(!oi)throw Si();return oi.snapshot}function Si(){return new Error("you can not call this function out of Magix")}function xi(e){for(var t=new Zt(e),n=t.readUint32(),r=[],i=t.readUint32(),a=0;a<i;++a){var o=t.readInt53(),s=t.readUint32();r.push(Object.freeze({beginScopeId:o,count:s}))}return Object.freeze({userId:n,initializeSlices:Object.freeze(r)})}or.addListener((function(e,t){oi=t&&e.tools?e.tools:void 0})),function(e){e.RoomDelete="roomDelete",e.RoomZombie="roomZombie",e.RoomBan="roomBan",e.GatewayAdjust="GatewayAdjust",e.KickByAdmin="kickByAdmin",e.ReplaceByOther="replaceByOther",e.Crash="crash"}(si||(si={})),function(e){e[e.Inserted=0]="Inserted",e[e.Updated=1]="Updated",e[e.Removed=2]="Removed"}(ci||(ci={})),function(e){e[e.Readonly=0]="Readonly",e[e.Writable=1]="Writable"}(ui||(ui={}));var Ci=function(){function e(t,n){I(this,e);var r=n.format.anyObjectFormat;this.serialization=new Ft({format:n.format,objectAdapter:new $n}),this.objectOperator=t,this.oneAnyObjectFormats=Object.freeze([r]),this.twoAnyObjectFormats=Object.freeze([r,r])}return M(e,[{key:"serialize",value:function(e){var t=new Bt,n=Ct(-1),r=new qr(n,this.objectOperator);t.writeUint8(e.kind);try{switch(e.kind){case ui.Writable:var i=e.userPayload,a=e.connectedPayload;r.bind(i),r.bind(a),this.serialization.serialize({writer:t,values:[i,a],objectFormats:this.twoAnyObjectFormats,includesHash:!1});break;case ui.Readonly:var o=e.payload;r.bind(o),this.serialization.serialize({writer:t,values:[o],objectFormats:this.oneAnyObjectFormats,includesHash:!1})}return t.toBuffer()}finally{r.complete()}}},{key:"deserialize",value:function(t){try{$n.startCollection();var n=new Zt(t),r=n.readUint8();switch(r){case ui.Writable:var i=h(this.serialization.deserialize({reader:n,objectFormats:this.twoAnyObjectFormats,ignoreHashChecking:!0,version:e.akkoSerVersion}),2);return{kind:r,userPayload:i[0],connectedPayload:i[1]};case ui.Readonly:return{kind:r,payload:h(this.serialization.deserialize({reader:n,objectFormats:this.oneAnyObjectFormats,ignoreHashChecking:!0,version:e.akkoSerVersion}),1)[0]};default:throw new Error("invalid kind ".concat(r))}}finally{$n.completeCollection()}}}]),e}();Ci.akkoSerVersion=Dt(We);var Ii=function(){function e(){I(this,e)}return M(e,[{key:"serialize",value:function(e){var t=new Bt;return t.writeString(e.libIdentifier),t.writeString(e.appIdentifier),t.writeString(e.appVersion),t.writeString(e.appHash),t.toBuffer()}},{key:"deserialize",value:function(e){var t=new Zt(e);return{libIdentifier:t.readString(),appIdentifier:t.readString(),appVersion:t.readString(),appHash:t.readString()}}}]),e}();function Pi(e){return function(e){var t=new Bt;return t.writeUint32(e.id),t.writeInt53(e.timestamp),t.toBuffer()}(e)}function Mi(e){return function(e){var t=new Zt(e),n=t.readUint32(),r=t.readInt53();return Object.freeze({id:n,timestamp:r})}(e)}var Ti=function(){function e(t){if(I(this,e),this.storageSlices=[],this.usingSlice=void 0,this.nextScopeId=0,t){var n,r=A(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.appendScopeSlice(i)}}catch(e){r.e(e)}finally{r.f()}}}return M(e,[{key:"allocScopeId",value:function(){if(this.usingSlice){var e=this.nextScopeId;return e===this.usingSlice.beginScopeId+this.usingSlice.count-1?(this.usingSlice=this.storageSlices.shift(),this.usingSlice&&(this.nextScopeId=this.usingSlice.beginScopeId)):this.nextScopeId+=1,e}}},{key:"appendScopeSlice",value:function(e){this.usingSlice?this.storageSlices.push(e):(this.usingSlice=e,this.nextScopeId=e.beginScopeId)}}]),e}();var Ai,Ei=new Rn(["error","snapshot","action","chunk","session-build","update-online","allocate-user","release-user","allocate-scope","update-access","ban-access","hang-up","library-description","ping","pong"]);!function(e){e[e.Undefined=0]="Undefined",e[e.NoUserToRelease=1]="NoUserToRelease",e[e.WritableAccessForbidden=2]="WritableAccessForbidden",e[e.StuffedOfWritableUsers=3]="StuffedOfWritableUsers",e[e.WrongWritablePhase=4]="WrongWritablePhase"}(Ai||(Ai={}));var Oi=function(){function e(t,n,r){I(this,e),this.nextFrameId=0,this.userId=t,this.scopeStorage=n,this.nextFrameId=r}return M(e,[{key:"createFrameId",value:function(){var e=this.nextFrameId;return this.nextFrameId+=1,e}},{key:"appendScopeSlices",value:function(e){var t,n=A(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.scopeStorage.appendScopeSlice(r)}}catch(e){n.e(e)}finally{n.f()}}},{key:"allocateIdentifierGenerator",value:function(){var e=this.scopeStorage.allocScopeId();if(void 0===e)throw new Se("run out of scope ID");return Ct(e)}}]),e}(),Ri=function(){function e(t,n){if(I(this,e),this.users={},this._usersCount=0,this.paddingImageCreatingTask=null,this.proxyRuntime=t,n){var r,i=A(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.users[a.userId]={userId:a.userId,nextFrameId:a.nextFrameId,session:a.session,payload:a.payload},this._usersCount+=1}}catch(e){i.e(e)}finally{i.f()}}else this.users[hn]={userId:hn,nextFrameId:0,session:"",payload:void 0},this._usersCount+=1}return M(e,[{key:"hasUser",value:function(e){return e in this.users}},{key:"userIds",get:function(){var e=[];for(var t in this.users)e.push(parseInt(t,10));return e.sort()}},{key:"usersCount",get:function(){return this._usersCount}},{key:"user",value:function(e,t){var n=this.users[e];if(n){var r=n.payload;return t||(r=this.proxyRuntime.objectOperator.wrapDisplayer(this.proxyRuntime,r)),{userId:e,session:n.session,payload:r}}}},{key:"snapshotUsers",value:function(){var e,t=[],n=A(this.userIds);try{for(n.s();!(e=n.n()).done;){var r=e.value,i=this.users[r];t.push({userId:r,nextFrameId:i.nextFrameId,session:i.session,payload:i.payload})}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"createImageAuthor",value:function(e,t){var n=this,r=e.userId,i=this.users[r];if(i){var a=new Ti(e.initializeSlices),o=new Oi(e.userId,a,i.nextFrameId);try{t(o)}catch(e){console.error(e)}return Promise.resolve()}return new Promise((function(r){n.paddingImageCreatingTask={allocatedUser:e,complete:function(e){r(),e&&t(e)}}}))}},{key:"cancelImageAuthorCreating",value:function(){this.paddingImageCreatingTask&&(this.paddingImageCreatingTask.complete(null),this.paddingImageCreatingTask=null)}},{key:"updateUserNextFrameId",value:function(e,t){var n=this.users[e];n&&(n.nextFrameId=t)}},{key:"userEnter",value:function(e,t,n,r){var i=this;e in this.users||(this._usersCount+=1),this.users[e]={userId:e,nextFrameId:t,session:n,payload:r},this.proxyRuntime.observeUpdate((function(){if(i.paddingImageCreatingTask){var n=i.paddingImageCreatingTask.allocatedUser,r=n.userId,a=n.initializeSlices;if(r===e){var o=new Ti(a),s=new Oi(e,o,t);i.paddingImageCreatingTask.complete(s),i.paddingImageCreatingTask=null}}i.proxyRuntime.reportUsersChanged(i._usersCount)}))}},{key:"userLeave",value:function(e){e in this.users&&(this._usersCount-=1,delete this.users[e]),this.proxyRuntime.reportUsersChanged(this._usersCount)}}]),e}(),Ni=function(){function e(t){I(this,e),this.didCompleteInit=!1,this.proxyRuntime=t.proxyRuntime,this.imageUsers=t.imageUsers,this.onEventFire=t.onEventFire,this.onEventFireACK=t.onEventFireACK,this.onCatchErrorWhenAppendFrame=t.onCatchErrorWhenAppendFrame;var n=fi(t.library.rootClass),r=[],i={},a={};for(var o in n.methods){var s=n.methods[o],c=e.findEventPayloadWithDecorators(s.decorators);c&&r.push(Object.freeze({filter:c.eventFilter,method:o})),a[o]=e.findNoEffectsWithDecorators(s.decorators)}for(var u=0;u<n.methodNames.length;++u)i[n.methodNames[u]]=u;this.methodNames=n.methodNames,this.methodNameToIdMap=Object.freeze(i),this.eventHandlers=Object.freeze(r),this.noEffectsMethods=Object.freeze(a)}return M(e,[{key:"completeInit",value:function(){this.didCompleteInit=!0}},{key:"methodNameToId",value:function(e){return this.methodNameToIdMap[e]}},{key:"isNoEffectMethod",value:function(e){return this.noEffectsMethods[e]}},{key:"dispatch",value:function(e,t){var n,r=this.proxyRuntime.rootObject.target,i=Ln.Custom,a=A(this.eventHandlers);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.filter,c=o.method;s(e,t,i)&&this.proxyRuntime.rootObject.getRootMethod(c).apply(r,[e,t,i])}}catch(e){a.e(e)}finally{a.f()}}},{key:"invoke",value:function(e,t){var n=this.proxyRuntime.rootObject.target;return this.proxyRuntime.rootObject.getRootMethod(e).apply(n,t)}},{key:"appendAction",value:function(e,t){var n=this;(t.mode===ar.Real||t.mode===ar.RealAck)&&this.imageUsers.updateUserNextFrameId(e.authorId,e.originalFrameId+1);var r=!this.isForcesOnIllusionLine(t.mode);try{var i;return this.proxyRuntime.block.runWithMagix(t,(function(){_n(e)?i=n.invokeActionFrame(e):Gn(e)?n.handleEventActionFrame(e):Yn(e)?n.handleEnterActionFrame(e):Xn(e)&&n.handleLeaveActionFrame(e)})),i}catch(i){return void(this.onCatchErrorWhenAppendFrame&&this.onCatchErrorWhenAppendFrame(e.authorId,i))}finally{r&&(this.frameId=e.frameId,this.timestamp=e.timestamp)}}},{key:"callbackEventIfNeed",value:function(e){if(this.didCompleteInit)if(Gn(e)){var t=this.proxyRuntime.rootObject.observerId;e.authorId===t?this.onEventFireACK({event:e.event,payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:e.scope,authorId:e.authorId}):this.onEventFire({event:e.event,payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:e.scope,authorId:e.authorId})}else Yn(e)?this.onEventFire({event:"Enter",payload:this.proxyRuntime.objectOperator.copyDisplayer(e.connectedPayload),scope:Ln.System,authorId:e.authorId}):Xn(e)&&this.onEventFire({event:"Leave",payload:this.proxyRuntime.objectOperator.copyDisplayer(e.payload),scope:Ln.System,authorId:e.authorId})}},{key:"invokeActionFrame",value:function(e){var t=e.methodId,n=e.parameters,r=this.proxyRuntime.rootObject.target,i=this.methodNames[t];return this.proxyRuntime.rootObject.getRootMethod(i).apply(r,n)}},{key:"handleEventActionFrame",value:function(e){if(void 0!==e.beginGenerationId&&e.scope===Ln.System)switch(e.event){case"Enter":var t=e.authorId,n=e.originalFrameId+1;this.imageUsers.userEnter(t,n,"",void 0);break;case"Leave":this.imageUsers.userLeave(e.authorId)}this.invokeEventCallbacks(e.event,e.payload,e.scope)}},{key:"handleEnterActionFrame",value:function(e){var t=e.authorId,n=e.originalFrameId+1,r=e.session,i=e.userPayload;this.imageUsers.userEnter(t,n,r,i),this.invokeEventCallbacks("Enter",e.connectedPayload,Ln.System)}},{key:"handleLeaveActionFrame",value:function(e){var t=e.authorId,n=e.payload;this.imageUsers.userLeave(t),this.invokeEventCallbacks("Leave",n,Ln.System)}},{key:"invokeEventCallbacks",value:function(e,t,n){var r,i=this.proxyRuntime.rootObject.target,a=A(this.eventHandlers);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.filter,c=o.method;s(e,t,n)&&this.proxyRuntime.rootObject.getRootMethod(c).apply(i,[e,t,n])}}catch(e){a.e(e)}finally{a.f()}}},{key:"isForcesOnIllusionLine",value:function(e){switch(e){case ar.Real:case ar.RealAck:return!1;case ar.Illusion:case ar.IllusionRebuild:return!0;case ar.Outside:return this.proxyRuntime.hasDoubleLines&&this.proxyRuntime.hasBranch;default:throw new Error("invalid mode ".concat(e))}}}],[{key:"findEventPayloadWithDecorators",value:function(e){var t,n=A(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(ur(r)&&br(r.payload))return r.payload}}catch(e){n.e(e)}finally{n.f()}}},{key:"findNoEffectsWithDecorators",value:function(e){var t,n=A(e);try{for(n.s();!(t=n.n()).done;){if(t.value===pr)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}}]),e}(),Li=function(){function e(t,n,r){I(this,e),this.observerId=t,this.logger=n,this.onLengthChanged=r,this.queue=[]}return M(e,[{key:"length",get:function(){return this.queue.length}},{key:"pushIllusionActionFrameGetter",value:function(e){this.queue.push(e),this.onLengthChanged(this.queue.length)}},{key:"forFrames",value:function(e){var t,n=A(this.queue);try{for(n.s();!(t=n.n()).done;){e(t.value)}}catch(e){n.e(e)}finally{n.f()}}},{key:"replaceActionFrame",value:function(e){var t,n,r,i=this.isAckFrame(e);if(i){var a=this.takeIllusionFrame(e.frameId,e.originalFrameId),o=new Jn(a.get());t=Date.now()-a.timestamp,o.frameId=e.frameId,o.originalFrameId=e.originalFrameId,o.timestamp=e.timestamp,n=o.frameBuffer,r=a.section}else{if(e.type===Nn.Ack)throw new Error("received others' ACK frame");n=e.frameBuffer}return{replacedBuffer:n,isAck:i,rttTimeInterval:t,section:r}}},{key:"takeIllusionFrame",value:function(e,t){var n=this.queue.findIndex((function(e){return e.frameId===t}));if(n>0&&this.logger.warn("received frame can't touch first illusion frame"),-1===n)throw new Error("not found frameId ".concat(t," match to ACK frameId"));var r=this.queue.splice(n,1)[0];return this.onLengthChanged(this.queue.length),r}},{key:"isAckFrame",value:function(e){switch(e.type){case Nn.Ack:case Nn.Invoker:return e.authorId===this.observerId;case Nn.Event:if(e.scope===Ln.Custom)return e.authorId===this.observerId}return!1}}]),e}();function ji(e){return void 0===e.beginGenerationId?Ct(e.scopeId,e.beginObjectId):function(e,t){if(e>ft)throw new Error("observerId ".concat(e," is out of range 0 ~ ").concat(ft));var n=[],r=new Pt(e,n);return xt.pushUint32(n,e),r.makeSureNextGenerationIdAfter(t),r}(e.authorId,e.beginGenerationId)}var Di=function(){function e(t,n,r,i,a,o,s){I(this,e),this.logger=t,this.strategy=n,this.proxyRuntime=r,this.triggerInvoker=i,this.assertAppendFrameId=a,this.onReceivedRttReport=o,this.onIllusionQueueLengthChanged=s,this.observerId=null,this._illusionQueue=null}return M(e,[{key:"illusionQueue",get:function(){return this._illusionQueue}},{key:"waitUtilIllusionQueueEmpty",value:function(){var e=this;return 0===this._illusionQueue.length?Promise.resolve():new Promise((function(t){e.onIllusionQueueEmpty=t}))}},{key:"setObserverId",value:function(e){if(this._illusionQueue)throw new Error("did set observer ID");this.observerId=e,this._illusionQueue=new Li(e,this.logger,this.onIllusionQueueLengthChanged)}},{key:"cleanObserverId",value:function(){var e=this._illusionQueue;this.observerId=null,this._illusionQueue=null,this.onIllusionQueueLengthChanged(e.length)}},{key:"appendActionFramesWithDoubleMode",value:function(e){var t,n,r=A(e);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.proxyRuntime.frameHandler.deserializeActionFrame(i,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking,{mode:ar.Real}),o=ji(a);this.assertAppendFrameId(a),t=this.triggerInvoker.appendAction(a,{authorId:a.authorId,mode:ar.Real,timestamp:a.timestamp,identifierGenerator:o}),this.triggerInvoker.callbackEventIfNeed(a)}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"appendActionFrames",value:function(e){var t,n,r=this,i=[],a=[],o=!1,s=!1,c=A(e);try{for(c.s();!(t=c.n()).done;){var u=t.value,l=new Jn(u),h=this._illusionQueue.replaceActionFrame(l);h.isAck||(o=!0),!s&&l.type===Nn.Leave&&l.authorId===this.observerId&&(s=!0);var d={frameBuffer:h.replacedBuffer,frameSection:h.section};o?a.push(d):i.push(d),void 0!==h.rttTimeInterval&&this.onReceivedRttReport(h.rttTimeInterval)}}catch(e){c.e(e)}finally{c.f()}if(this.proxyRuntime.block.runWithDisableObserve((function(){var e,t=A(i);try{for(t.s();!(e=t.n()).done;){var n=e.value,a=n.frameBuffer,o=n.frameSection,s=r.proxyRuntime.frameHandler.deserializeActionFrame(a,r.strategy.deserializerVersion,r.strategy.ignoreHashChecking,{mode:ar.RealAck,frameSection:o}),c=ji(s);r.assertAppendFrameId(s),r.triggerInvoker.appendAction(s,{authorId:s.authorId,mode:ar.RealAck,timestamp:s.timestamp,frameSection:o,identifierGenerator:c}),r.triggerInvoker.callbackEventIfNeed(s),o.completeACK()}}catch(e){t.e(e)}finally{t.f()}})),a.length>0){this.proxyRuntime.mergeBranch();var f,p=A(a);try{for(p.s();!(f=p.n()).done;){var v=f.value,m=v.frameBuffer,g=v.frameSection,y=this.proxyRuntime.frameHandler.deserializeActionFrame(m,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking,{mode:ar.Real,frameSection:g}),b=ji(y);this.assertAppendFrameId(y),n=this.triggerInvoker.appendAction(y,{authorId:y.authorId,mode:ar.Real,timestamp:y.timestamp,frameSection:g,identifierGenerator:b}),this.triggerInvoker.callbackEventIfNeed(y)}}catch(e){p.e(e)}finally{p.f()}this._illusionQueue.length>0&&(s?this._illusionQueue=new Li(this.observerId,this.logger,this.onIllusionQueueLengthChanged):this.rebuildIllusionBranch())}return this.proxyRuntime.hasBranch&&this.proxyRuntime.hasDoubleLines&&0===this._illusionQueue.length&&this.proxyRuntime.mergeBranch(),this.onIllusionQueueEmpty&&0===this._illusionQueue.length&&(this.onIllusionQueueEmpty(),this.onIllusionQueueEmpty=void 0),n}},{key:"rebuildIllusionBranch",value:function(){var e=this;this.proxyRuntime.forkBranchRuntime();var t=this._illusionQueue;this._illusionQueue=new Li(this.observerId,this.logger,this.onIllusionQueueLengthChanged),t.forFrames((function(t){var n=new Jn(t.get()),r=e.proxyRuntime.createFrameSection(t.section),i={frameId:t.frameId,timestamp:t.timestamp,section:r,get:function(){return n.frameBuffer}};e._illusionQueue.pushIllusionActionFrameGetter(i);var a=e.proxyRuntime.frameHandler.deserializeActionFrame(n.frameBuffer,e.strategy.deserializerVersion,e.strategy.ignoreHashChecking,{mode:ar.IllusionRebuild,frameSection:r}),o=ji(a);e.triggerInvoker.appendAction(a,{authorId:a.authorId,mode:ar.IllusionRebuild,timestamp:a.timestamp,frameSection:r,identifierGenerator:o}),r.completeRebuild()})),t.length>0&&this.onIllusionQueueLengthChanged(this._illusionQueue.length)}}]),e}(),Fi=function(){function e(t,n){I(this,e),this.objectOperator=n,this.rootClassReflection=fi(t.rootClass);var r=new Ft({format:t.format,objectAdapter:new $n});this.flatFrameSerialization=er(r,this.rootClassReflection)}return M(e,[{key:"serialize",value:function(e,t,n){var r=new qr(e,this.objectOperator);try{this.replaceWithBindsActionFrame(r,t);var i=Hn(Wn({},t),{beginObjectId:e.createdCount});return this.flatFrameSerialization.serializeActionFrame(i,n)}finally{r.complete()}}},{key:"replaceWithBindsActionFrame",value:function(e,t){if(Gn(t))e.bind(t.payload);else if(_n(t)){var n,r=A(t.parameters);try{for(r.s();!(n=r.n()).done;){var i=n.value;e.bind(i)}}catch(e){r.e(e)}finally{r.f()}}else Yn(t)?(e.bind(t.userPayload),e.bind(t.connectedPayload)):Xn(t)&&e.bind(t.payload)}}]),e}(),zi=function(){function e(t){I(this,e),this.author=t.author,this.objectOperator=t.objectOperator,this.rootClassReflection=t.rootClassReflection,this.objectAdapter=t.objectAdapter,this.flatFrameSerialization=t.flatFrameSerialization,this.includesFrameHash=t.includesFrameHash}return M(e,[{key:"appendScopeSlices",value:function(e){this.author.appendScopeSlices(e)}},{key:"handleInvokerArgs",value:function(e,t,n){var r=this.objectOperator,i=this.objectAdapter,a=this.rootClassReflection,o=new Qr(n,r,i);try{for(var s=a.methods[e].parameterFormatObjects,c=[],u=[],l=0;l<t.length;++l){var h=o.bind(t[l],s[l]),d=h.value,f=h.binder;f?(c[l]=f.copied,u[l]=f.wrapped):(c[l]=d,u[l]=d)}return{copied:c,wrapped:u}}finally{o.completeBinding()}}},{key:"handlePayload",value:function(e,t){var n=this.objectOperator,r=this.objectAdapter,i=this.flatFrameSerialization.serialization.format.anyObjectFormat,a=new Qr(t,n,r);try{var o=a.bind(e,i),s=o.value,c=o.binder,u=s,l=s;return c&&(u=c.copied,l=c.wrapped),{copied:u,wrapped:l}}finally{a.completeBinding()}}},{key:"serializeEventFrameGetter",value:function(e,t,n,r){var i=this,a=this.author.createFrameId(),o={frameId:a,originalFrameId:a,timestamp:n,authorId:this.author.userId,type:Nn.Event,scopeId:r.scopeId,beginObjectId:r.createdCount,event:e,payload:t,scope:Ln.Custom};return{frameId:a,getter:function(){return i.flatFrameSerialization.serializeActionFrame(o,i.includesFrameHash)}}}},{key:"serializeInvokerFrameGetter",value:function(e,t,n,r){var i=this,a=this.author.createFrameId(),o={frameId:a,originalFrameId:a,timestamp:n,authorId:this.author.userId,type:Nn.Invoker,scopeId:r.scopeId,beginObjectId:r.createdCount,methodId:e,parameters:t};return{frameId:a,getter:function(){return i.flatFrameSerialization.serializeActionFrame(o,i.includesFrameHash)}}}}]),e}(),Bi=function(){function e(t,n){I(this,e),this.onGeneratedFrameBuffer=t,this.onGenreateFrameFailed=n,this.pendding={},this._count=0}return M(e,[{key:"count",get:function(){return this._count}},{key:"createEventFrameGetter",value:function(e,t,n,r,i,a){var o=this,s=r.serializeEventFrameGetter(e,t,n,a),c=s.frameId,u=s.getter,l=new Ui(c,n,i,(function(){try{var e=new Jn(u());return o.fireGenerate(l,e),e.frameBuffer}catch(e){throw o.onGenreateFrameFailed(e),e}}));return this.fireCreate(l),l}},{key:"createInvokerFrameGetter",value:function(e,t,n,r,i,a){var o=this,s=r.serializeInvokerFrameGetter(e,t,n,a),c=s.frameId,u=s.getter,l=new Ui(c,n,i,(function(){try{var e=new Jn(u());return o.fireGenerate(l,e),e.frameBuffer}catch(e){throw o.onGenreateFrameFailed(e),e}}));return this.fireCreate(l),l}},{key:"fireCreate",value:function(e){this.pendding[e.id]||(this.pendding[e.id]=e,this._count+=1)}},{key:"fireGenerate",value:function(e,t){e.id in this.pendding&&(delete this.pendding[e.id],this._count-=1),this.onGeneratedFrameBuffer(t.frameBuffer)}}]),e}();Bi.callGetMaxDuration=1200;var Ui=function(){function e(t,n,r,i){I(this,e),this.frameId=t,this.timestamp=n,this.section=r,this.getter=i,this.buffer=null,this.id="".concat(e.nextId),e.nextId+=1}return M(e,[{key:"get",value:function(){return this.buffer||(this.buffer=this.getter()),this.buffer}}]),e}();Ui.nextId=0;var Vi,Wi=function(){function e(t){var n=this;if(I(this,e),this.modifiable=!0,this.generator=null,this.didDestroy=!1,this.assertAppendFrameId=function(e){var t=e.frameId,r=n.triggerInvoker.frameId+1;if(r!==t)throw new Error("find unexpected frame id ".concat(t,", wanna ").concat(r))},this.invokeMethod=function(e,t){n.assertEnableSendActionFrames();var r,i=Date.now(),a=n.generator;if(!a)throw new Error("cannot invoke ".concat(e,", frameGenerator is not prepare"));var o=a.author.allocateIdentifierGenerator(),s=n.proxyRuntime.block.runWithContinuousUpdated((function(){var s=n.proxyRuntime.createFrameSection(),c={authorId:a.author.userId,mode:ar.Illusion,frameSection:s,timestamp:i,identifierGenerator:o};r=n.proxyRuntime.block.runWithMagix(c,(function(){var r=n.triggerInvoker.methodNameToId(e),c=a.handleInvokerArgs(e,t,o),u=o.clone();try{return n.triggerInvoker.invoke(e,c.wrapped)}finally{var l=n.pending.createInvokerFrameGetter(r,c.copied,i,a,s,u);n.branchImageHelper.illusionQueue.pushIllusionActionFrameGetter(l),n.callbacks.onGeneratedActionFrame?(n.phaseNode.touch(),n.callbacks.onGeneratedActionFrame(l)):l.get()}}))}));return n.callbacks.onModified&&s.didUpdated&&n.callbacks.onModified(),r},this.currentPhase=function(){var e=n.branchImageHelper.illusionQueue;return e&&0===e.length&&0===n.pending.count?Vi.Real:Vi.Illusion},this.clientCrashWithError=function(e){n.callbacks.onClientCrashWithError&&Promise.resolve().then((function(){return n.callbacks.onClientCrashWithError(e)})).catch((function(e){return console.error(e)}))},this.library=t.library,this.logger=t.logger,this.proxyRuntime=t.proxyRuntime,this.serializer=new Fi(t.library,t.proxyRuntime.objectOperator),this.imageUsers=t.imageUsers,this.strategy=t.strategy,this.callbacks=Lr(t.callbacks||{}),this.eventFireNode=new Zr(t.logger,{fire:this.callbacks.onEventFire,ack:this.callbacks.onEventFireACK}),this.eventFireNode.isPadding=!0,this.triggerInvoker=new Ni({library:this.library,imageUsers:this.imageUsers,proxyRuntime:t.proxyRuntime,onEventFire:function(e){return n.eventFireNode.callback("fire",e)},onEventFireACK:function(e){return n.eventFireNode.callback("ack",e)},onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame}),this.triggerInvoker.frameId=t.frameId,this.triggerInvoker.timestamp=t.timestamp,this.proxyRuntime.rootObject.onInvokedTriggerMethod=this.invokeMethod,t.actionFrames){var r,i=A(t.actionFrames);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=this.proxyRuntime.frameHandler.deserializeActionFrame(a,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking),s=ji(o);this.triggerInvoker.appendAction(o,{authorId:o.authorId,timestamp:o.timestamp,mode:ar.Real,identifierGenerator:s})}}catch(e){i.e(e)}finally{i.f()}}this.phaseNode=new Kr({phase:Vi.Real,getCurrentPhase:this.currentPhase,onPhaseChanged:this.callbacks.onPhaseChanged}),this.branchImageHelper=new Di(this.logger,this.strategy,this.proxyRuntime,this.triggerInvoker,this.assertAppendFrameId,this.callbacks.onReceivedRttReport||function(){},this.callbacks.onIllusionQueueLengthChanged||function(){}),this.pending=new Bi((function(){return n.phaseNode.touch()}),this.clientCrashWithError),this.triggerInvoker.completeInit(),this.eventFireNode.hasKey("fire")&&Promise.resolve().then((function(){return n.eventFireNode.isPadding=!1})).catch((function(e){return console.error(e)}))}var t;return M(e,[{key:"hasDoubleLines",get:function(){return this.proxyRuntime.hasDoubleLines}},{key:"trigger",get:function(){return this.proxyRuntime.rootObject.displayer}},{key:"phase",get:function(){return this.phaseNode.phase}},{key:"userIds",get:function(){return this.imageUsers.userIds}},{key:"usersCount",get:function(){return this.imageUsers.usersCount}},{key:"pendingReportChanged",get:function(){return this.proxyRuntime.pendingReportChanged},set:function(e){this.proxyRuntime.pendingReportChanged=e}},{key:"hasUser",value:function(e){return this.imageUsers.hasUser(e)}},{key:"user",value:function(e){return this.imageUsers.user(e,!1)}},{key:"verifiedFrameId",get:function(){return this.triggerInvoker.frameId}},{key:"frameId",get:function(){var e=this.triggerInvoker.frameId,t=this.branchImageHelper.illusionQueue;return t&&(e+=t.length),e},set:function(e){var t=this.branchImageHelper.illusionQueue,n=e;t&&(n-=t.length),this.triggerInvoker.frameId=n}},{key:"timestamp",get:function(){return this.triggerInvoker.timestamp}},{key:"appendActionFrames",value:function(e){this.appendActionFramesToRuntime(e)}},{key:"appendActionFramesToRuntime",value:function(e){var t,n,r=this;this.eventFireNode.isPadding=!0;try{t=this.proxyRuntime.block.runWithContinuousUpdated((function(){n=r.proxyRuntime.hasDoubleLines?r.proxyRuntime.hasBranch?r.branchImageHelper.appendActionFrames(e):r.branchImageHelper.appendActionFramesWithDoubleMode(e):r.appendActionFramesWithSingleMode(e)})),this.phaseNode.touch()}finally{this.eventFireNode.isPadding=!1}return this.callbacks.onModified&&t.didUpdated&&this.callbacks.onModified(),n}},{key:"appendScopeSlices",value:function(e){this.generator&&this.generator.appendScopeSlices(e)}},{key:"appendActionFramesWithSingleMode",value:function(e){var t,n,r=A(e);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.proxyRuntime.frameHandler.deserializeActionFrame(i,this.strategy.deserializerVersion,this.strategy.ignoreHashChecking),o=ji(a);this.assertAppendFrameId(a),t=this.triggerInvoker.appendAction(a,{authorId:a.authorId,mode:ar.Real,timestamp:a.timestamp,identifierGenerator:o}),this.triggerInvoker.callbackEventIfNeed(a)}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"dispatch",value:function(e,t){var n=this;this.assertEnableSendActionFrames();var r=Date.now(),i=this.generator;if(!i)throw new Error("cannot dispatch event ".concat(e,", generator is not prepare"));var a=i.author.allocateIdentifierGenerator(),o=this.proxyRuntime.block.runWithContinuousUpdated((function(){var o=n.proxyRuntime.createFrameSection(),s={authorId:i.author.userId,mode:ar.Illusion,timestamp:r,frameSection:o,identifierGenerator:a};n.proxyRuntime.block.runWithMagix(s,(function(){var s=i.handlePayload(t,a),c=a.clone();try{return n.triggerInvoker.dispatch(e,s.wrapped)}finally{var u=n.pending.createEventFrameGetter(e,s.copied,r,i,o,c);n.branchImageHelper.illusionQueue.pushIllusionActionFrameGetter(u),n.callbacks.onGeneratedActionFrame?(n.phaseNode.touch(),n.callbacks.onGeneratedActionFrame(u)):u.get()}}))}));this.eventFireNode.callback("fire",{event:e,payload:t,scope:Ln.Custom,authorId:i.author.userId}),this.callbacks.onModified&&o.didUpdated&&this.callbacks.onModified()}},{key:"snapshot",value:function(){var e=this,t=this.generator?this.generator.author.userId:hn,n={frameId:this.frameId,originalFrameId:this.frameId,timestamp:this.timestamp,authorId:t,rootObject:this.proxyRuntime.rootObject.snapshotRootObject(),users:this.imageUsers.snapshotUsers()},r={authorId:t,mode:ar.Outside,timestamp:n.timestamp,identifierGenerator:Ct(-1)};return this.proxyRuntime.block.runWithMagix(r,(function(){return e.proxyRuntime.frameHandler.serializeSnapshotFrame(n)}))}},{key:"setAllocatedUser",value:function(e){var t=this;return this.imageUsers.createImageAuthor(e,(function(n){var r=t.serializer,i=r.objectOperator,a=r.rootClassReflection,o=r.flatFrameSerialization,s=t.proxyRuntime.frameHandler.objectAdapter,c=t.strategy.includesFrameHash;t.generator=new zi({author:n,objectOperator:i,rootClassReflection:a,flatFrameSerialization:o,objectAdapter:s,includesFrameHash:c}),t.proxyRuntime.reportObserverIdChanged(e.userId),t.branchImageHelper.setObserverId(n.userId)}))}},{key:"removeAllocatedUser",value:(t=l(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.imageUsers.cancelImageAuthorCreating(),this.generator=null,this.proxyRuntime.reportObserverIdChanged(hn),e.next=5,this.branchImageHelper.waitUtilIllusionQueueEmpty();case 5:this.branchImageHelper.cleanObserverId();case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.didDestroy||(this.imageUsers.cancelImageAuthorCreating(),this.generator=null,this.didDestroy=!0,this.proxyRuntime.dispose(),this.phaseNode.touch())}},{key:"createInvokerFrameBuffer",value:function(e){var t=this.triggerInvoker.methodNameToId(e.method);if(void 0===t)throw new Error("can't find method ".concat(JSON.stringify(e.method)));if(this.triggerInvoker.isNoEffectMethod(e.method))throw new Error("can't create frame for no effects method ".concat(JSON.stringify(e.method)));var n=Hn(Wn({},this.createFrameHeader(e)),{type:Nn.Invoker,scopeId:e.identifierGenerator.scopeId,methodId:t,parameters:e.parameters});return this.serializeActionFrame(e.identifierGenerator,n)}},{key:"createEventFrameBuffer",value:function(e){var t=Hn(Wn({},this.createFrameHeader(e)),{type:Nn.Event,scopeId:e.identifierGenerator.scopeId,scope:e.scope,event:e.event,payload:e.payload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createEnterFrameBuffer",value:function(e){var t=Hn(Wn({},this.createFrameHeader(e)),{type:Nn.Enter,scopeId:e.identifierGenerator.scopeId,session:e.session,userPayload:e.userPayload,connectedPayload:e.connectedPayload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createLeaveFrameBuffer",value:function(e){var t=Hn(Wn({},this.createFrameHeader(e)),{type:Nn.Leave,scopeId:e.identifierGenerator.scopeId,payload:e.payload});return this.serializeActionFrame(e.identifierGenerator,t)}},{key:"createFrameHeader",value:function(e){var t=e.frameId,n=e.originalFrameId,r=e.authorId;return{frameId:t,originalFrameId:void 0===n?t:n,timestamp:Date.now(),authorId:r,beginObjectId:0}}},{key:"serializeActionFrame",value:function(e,t){var n=this,r={authorId:this.generator?this.generator.author.userId:hn,mode:ar.Outside,timestamp:t.timestamp,identifierGenerator:e};return this.proxyRuntime.block.runWithMagix(r,(function(){return n.serializer.serialize(e,t,n.strategy.includesFrameHash)}))}},{key:"assertEnableSendActionFrames",value:function(){if(this.didDestroy)throw new Error("image was desctroy");var e=this.branchImageHelper.illusionQueue;if((e?e.length:0)>=700)throw this.clientCrashWithError(new Error("illusion queue is overflow")),new Error("can't modify. illusion queue is overflow")}}]),e}();!function(e){e.Real="real",e.Illusion="illusion"}(Vi||(Vi={}));var Hi=function(){function e(t){I(this,e),this.proxyManager=t}return M(e,[{key:"createAccessUpdaterSerialization",value:function(e){return new Ci(this.proxyManager.objectOperator,e)}},{key:"createWithParameters",value:function(t){var n=this.findOriginProxyRuntime(t),r=this.proxyManager.createProxyRuntime(t.library,n),i=new Ri(r),a=Date.now();r.setupWithParameters(t.constructorScopeId,t.args,a,{logger:t.logger,observerId:t.observerId,imageUsers:i,pendingReportChanged:t.pendingReportChanged,snapshotManager:Or(t.library,t.roomUUID),toolsExtra:t.toolsExtra});var o=new Wi({frameId:0,timestamp:a,library:t.library,logger:t.logger,proxyRuntime:r,actionFrames:[],imageUsers:i,strategy:e.wrapStrategy(t),callbacks:t.callbacks});return n?r.rootObject.initializeWithOriginRootObject(n.rootObject):r.rootObject.initialize(),o}},{key:"parseSnapshotFrame",value:function(e,t){var n=this.proxyManager.createProxyRuntime(e),r=Nt.V1;return n.frameHandler.deserializeSnapshotFrame(t,r,!1)}},{key:"createWithSnapshot",value:function(t){var n=this.findOriginProxyRuntime(t),r=this.proxyManager.createProxyRuntime(t.library,n),i=t.snapshotDeserializerVersion;void 0===i&&(i=Dt(We));var a=r.frameHandler.deserializeSnapshotFrame(t.snapshotFrame,i,t.ignoreHashChecking),o=a.rootObject,s=new Ri(r,a.users);r.setupWithRootObject(o,{logger:t.logger,observerId:t.observerId,imageUsers:s,pendingReportChanged:t.pendingReportChanged,snapshotManager:Or(t.library,t.roomUUID),toolsExtra:t.toolsExtra});var c=new Wi({frameId:a.frameId,timestamp:a.timestamp,library:t.library,logger:t.logger,actionFrames:t.actionFrames,proxyRuntime:r,imageUsers:s,strategy:e.wrapStrategy(t),callbacks:t.callbacks});return n?r.rootObject.initializeWithOriginRootObject(n.rootObject):r.rootObject.initialize(),c}},{key:"findOriginProxyRuntime",value:function(e){var t=e.originalImage;if(t)return t.proxyRuntime}}],[{key:"wrapStrategy",value:function(e){var t=e.actionDeserializerVersion;return void 0===t&&(t=Dt(We)),Object.freeze({roomUUID:e.roomUUID,ignoreHashChecking:e.ignoreHashChecking,includesFrameHash:e.includesFrameHash,deserializerVersion:t})}}]),e}(),_i=Object.freeze([{methodName:"toString",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"toLocaleString",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"join",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"indexOf",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"lastIndexOf",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"every",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"some",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"forEach",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"reduce",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"reduceRight",returnArray:!1,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"concat",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"reverse",returnArray:!0,lengthChanged:!1,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"slice",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"splice",returnArray:!0,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function(e,t){var n,r=t[0];if(r>=0&&r<e.length)if(t.length>1){var i=t[1];void 0===i&&(i=0);var a=t.length-2;a<0&&(a=0),a===i?a>0&&(n={beginIndex:r,length:a}):n={beginIndex:r,length:e.length-r}}else n={beginIndex:r,length:e.length-r};return n}},{methodName:"map",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"filter",returnArray:!0,lengthChanged:!1,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"sort",returnArray:!0,lengthChanged:!1,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}},{methodName:"push",returnArray:!1,lengthChanged:!0,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:e.length-1,length:1}}},{methodName:"pop",returnArray:!1,lengthChanged:!0,elementChanged:!1,cleanEqualsCount:!1,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:e.length,length:1}}},{methodName:"shift",returnArray:!1,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length+1}}},{methodName:"unshift",returnArray:!1,lengthChanged:!0,elementChanged:!0,cleanEqualsCount:!0,touchLength:!0,pickTouchedSegment:function(e){return{beginIndex:0,length:e.length}}}]);var Gi=function(){function e(t){I(this,e),this.nodes={};var n,r={},i=A(t);try{var a=function(){var e=n.value,t=e.clazz,i=e.banList,a=e.proxyList,o={},s=t.name;r[s]=Object.freeze({clazz:t,methods:o});var c,u=A(i);try{var l=function(){var e=c.value;o[e]=function(){throw new Error("".concat(s,".").concat(e," is ban in Magix"))}};for(u.s();!(c=u.n()).done;)l()}catch(e){u.e(e)}finally{u.f()}var h,d=A(a);try{var f=function(){var e=h.value;o[e]=function(){throw new Error("".concat(s,".").concat(e," is not defined"))}};for(d.s();!(h=d.n()).done;)f()}catch(e){d.e(e)}finally{d.f()}Object.seal(o)};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}this.nodes=r}return M(e,[{key:"findMethod",value:function(e,t){var n=this.findNode(e);if(n)return n.methods[t]}},{key:"proxyMethod",value:function(e,t,n){var r=this.findNode(e);if(!r)throw new Error("invalid class");if(!(t in r.methods))throw new Error("invalid method ".concat(JSON.stringify(t)));r.methods[t]=n}},{key:"findNode",value:function(e){var t=e.name,n=this.nodes[t];if(n&&n.clazz===e)return n}}]),e}();var Yi=Object.defineProperty,Xi=Object.getOwnPropertySymbols,qi=Object.prototype.hasOwnProperty,Qi=Object.prototype.propertyIsEnumerable,Ki=function(e,t,n){return t in e?Yi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Zi=function(e,t){for(var n in t||(t={}))qi.call(t,n)&&Ki(e,n,t[n]);if(Xi){var r,i=A(Xi(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Qi.call(t,n)&&Ki(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Ji=function(){function e(t){I(this,e),this.usersCache={},this.observerId=t.observerId,this.environment=t.environment,this.authorId=t.authorId,this.core=t.coreFunctions,this.roomObserver=t.roomObserver,this.imageUsers=t.imageUsers}return M(e,[{key:"getAuthorId",value:function(){var e;return this.environment===Ar.NoEffects&&this.observerId===this.authorId&&(null==(e=this.roomObserver)||e.reportObservedObserverId()),this.authorId}},{key:"hasUser",value:function(e){var t;return this.environment===Ar.NoEffects&&(null==(t=this.roomObserver)||t.reportObservedUsers()),this.imageUsers.hasUser(e)}},{key:"getUsersCount",value:function(){var e;return this.environment===Ar.NoEffects&&(null==(e=this.roomObserver)||e.reportObservedUsers()),this.imageUsers.usersCount}},{key:"getUser",value:function(e){var t,n;return this.imageUsers.hasUser(e)&&((n=this.usersCache[e])||(n=this.usersCache[e]=this.core.creator(this.imageUsers.user(e,!0)))),this.environment===Ar.NoEffects&&(null==(t=this.roomObserver)||t.reportObservedUsers()),n}},{key:"getUserIds",value:function(){var e;return this.userIdsCache||(this.userIdsCache=this.core.creator(this.imageUsers.userIds)),this.environment===Ar.NoEffects&&(null==(e=this.roomObserver)||e.reportObservedUsers()),this.userIdsCache}}]),e}(),$i=function(){function e(t){I(this,e),this._hasDoubleLines=!1,this._branchRuntime=null,this.logger=t.logger,this.observerId=t.observerId,this.proxyRuntime=t.proxyRuntime,this.imageUsers=t.imageUsers,this.toolsExtra=t.toolsExtra,this.snapshotManager=t.snapshotManager}return M(e,[{key:"hasDoubleLines",get:function(){return this._hasDoubleLines}},{key:"branchRuntime",get:function(){return this._branchRuntime}},{key:"changeToDoubleLines",value:function(){this._hasDoubleLines=!0}},{key:"forkBranchRuntime",value:function(){return this._branchRuntime=function(e){return new Ja(e)}(this.logger),this._branchRuntime}},{key:"releaseBranchRuntime",value:function(){this._branchRuntime&&(this._branchRuntime=null)}},{key:"getForwardMode",value:function(){return!this._hasDoubleLines||this._branchRuntime?tr.SingleForward:tr.DoubleForward}},{key:"runWithMagix",value:function(t,n){var r=t.authorId,i=this.getEnvironment(t.mode),a=this.getForwardMode(),o=e.coreFunctionsSwitcher.switchCoreFunctions(t.mode),s=Object.freeze({idGenerator:t.identifierGenerator,environment:i,timestamp:t.timestamp,snapshot:this.snapshotManager,extra:this.toolsExtra,functions:new Ji({observerId:this.observerId,environment:i,authorId:r,coreFunctions:o,roomObserver:this.proxyRuntime.roomObserver,imageUsers:this.imageUsers})}),c={mode:t.mode,coreFunctions:o,frameSection:t.frameSection,proxyRuntime:this.proxyRuntime,forwardMode:a,tools:s};return or.runWith(c,n)}},{key:"runWithSerialization",value:function(t,n){var r=this.getForwardMode(),i=e.coreFunctionsSwitcher.switchCoreFunctions(t.mode),a={mode:t.mode,coreFunctions:i,frameSection:t.frameSection,proxyRuntime:this.proxyRuntime,forwardMode:r};return or.runWith(a,n)}},{key:"isForcesOnIllusionLine",value:function(e){switch(e){case Ga.Real:case Ga.RealAck:return!1;case Ga.Illusion:case Ga.IllusionRebuild:return!0;case Ga.Outside:return this._hasDoubleLines&&!!this._branchRuntime;default:throw new Error("invalid mode ".concat(e))}}},{key:"getEnvironment",value:function(e){switch(e){case Ga.Illusion:case Ga.IllusionRebuild:return Ar.Illusion;case Ga.Real:case Ga.RealAck:return Ar.Real;case Ga.Outside:return Ar.NoEffects;default:throw new Error("invalid mode ".concat(e))}}}],[{key:"coreFunctionsSwitcher",get:function(){return this._coreFunctionsSwitcher||(this._coreFunctionsSwitcher=new Xa),this._coreFunctionsSwitcher}}]),e}();function ea(e,t,n){return t.constructor===Object?Xo(e,n,t):Qo(e,n,t)}var ta,na="__identifier";function ra(e,t){Object.defineProperty(e,na,{enumerable:!1,configurable:!0,value:t})}or.addListener((function(e,t){ta=t?e.coreFunctions.creator:void 0}));var ia=function(){function e(t,n,r){I(this,e),this.proxyRuntime=t,this.identifierGenerator=n,this.banFunction=r,this.proxyNodes={},this.modifyObjects=[]}return M(e,[{key:"complete",value:function(){var e,t=A(this.modifyObjects);try{for(t.s();!(e=t.n()).done;){delete e.value[na]}}catch(e){t.e(e)}finally{t.f()}}},{key:"wrap",value:function(e){if(this.banFunction&&"function"==typeof e)throw new Error("can't wrap function");if("object"!=T(e)||null===e||ke(e))return e;if(eo(e))throw new Error("can't let displayer node pass Magix border");if(e.constructor===Array)return this.wrapArray(e);if(e.constructor===Object)return this.wrapObject(e);throw new Error("can't let object of ".concat(e.constructor.name," pass Magix border"))}},{key:"wrapArray",value:function(e){var t,n=e[na];if(void 0===n){ra(e,n=this.identifierGenerator.generate());for(var r=(t=this.createProxyNode([],n)).target(),i=0;i<e.length;++i)r[i]=this.wrap(e[i]);this.proxyNodes[n]=t,this.modifyObjects.push(e)}else t=this.proxyNodes[n];return t}},{key:"wrapObject",value:function(e){var t,n=e[na];if(void 0===n){ra(e,n=this.identifierGenerator.generate());var r,i=(t=this.createProxyNode({},n)).target(),a=A(Object.keys(e).sort());try{for(a.s();!(r=a.n()).done;){var o=r.value;i[o]=this.wrap(e[o])}}catch(e){a.e(e)}finally{a.f()}this.proxyNodes[n]=t,this.modifyObjects.push(e)}else t=this.proxyNodes[n];return t}},{key:"createProxyNode",value:function(e,t){return ta?ta(e,t):ea(this.proxyRuntime,e,t)}}]),e}(),aa=function(){function e(t){I(this,e),this.pendingBuffer={},this.observer=t.create("","room observer")}return M(e,[{key:"pendingReportChanged",get:function(){return!!this.pendingBuffer},set:function(e){!!this.pendingBuffer!==e&&(e?this.pendingBuffer={}:(this.firePendingReportChanges(this.pendingBuffer),this.pendingBuffer=null))}},{key:"reportObserverIdChanged",value:function(t){this.report(e.selfUserId,t,ci.Updated)}},{key:"reportUsersChanged",value:function(t){this.report(e.users,t,ci.Updated)}},{key:"reportObservedObserverId",value:function(){this.observer.reportObservedKey(e.selfUserId)}},{key:"reportObservedUsers",value:function(){this.observer.reportObservedKey(e.users)}},{key:"firePendingReportChanges",value:function(t){for(var n in t){var r=t[n],i=r.value,a=r.kind;this.observer.reportChanged(e.users,i,a)}}},{key:"report",value:function(e,t,n){if(this.pendingBuffer){var r=this.pendingBuffer[e];r?(r.value=t,r.kind=n):this.pendingBuffer[e]={value:t,kind:n}}else this.observer.reportChanged(e,t,n)}}]),e}();function oa(e,t){Object.defineProperty(e,xo,{enumerable:!1,writable:!1,configurable:!0,value:t})}aa.selfUserId="userId",aa.users="users";var sa=function(){function e(){I(this,e),this.didTouchedSet={}}return M(e,[{key:"copyProxyNode",value:function(e){var t=e.identifier;this.didTouchedSet[t]||(this.didTouchedSet[t]=!0,Io(e)?this.copyAkkoObjectProxyNode(e):To(e)?this.copyFlatObjectProxyNode(e):Ro(e)&&this.copyArrayProxyNode(e))}},{key:"copyAkkoObjectProxyNode",value:function(e){var t=e.realTarget;if(t){var n={};for(var r in t){var i=Object.getOwnPropertyDescriptor(t,r);if(i&&!i.get&&!i.set){var a=t[r];bo(a)&&this.copyProxyNode(a),n[r]=a}}oa(n,e),Object.setPrototypeOf(n,e.struct.classReflection.clazz.prototype),e.illuTarget=n}}},{key:"copyFlatObjectProxyNode",value:function(e){var t=e.realTarget;if(t){var n={};for(var r in t){var i=t[r];bo(i)&&this.copyProxyNode(i),n[r]=i}oa(n,e),e.illuTarget=n}}},{key:"copyArrayProxyNode",value:function(e){var t=e.realTarget;if(t){for(var n=[],r=0;r<t.length;++r)if(r in t){var i=t[r];bo(i)&&this.copyProxyNode(i),n[r]=i}oa(n,e),e.illuTarget=n}}}]),e}(),ca=new(function(){function e(){I(this,e)}return M(e,[{key:"addProperty",value:function(e,t,n){}},{key:"removeProperty",value:function(e,t){}},{key:"setProperty",value:function(e,t,n){}},{key:"unbindDelegate",value:function(e){}},{key:"callbackDelegates",value:function(){return{didUpdated:!1}}}]),e}());function ua(){return ca}function la(e,t){var n=ca;try{return ca=e,t(),{didUpdated:e.didUpdated}}finally{ca=n}}var ha=function(){function e(){I(this,e),this.disable=!1,this.delegates={},this.unbindsDelegated={},this.updatedObjects={},this._didUpdated=!1}return M(e,[{key:"didUpdated",get:function(){return this._didUpdated}},{key:"callbackDelegates",value:function(){for(var e in this.delegates)if(e in this.unbindsDelegated)delete this.delegates[e];else{var t=this.delegates[e],n=this.updatedObjects[e];t.updateDisplayer(n)}for(var r in this.delegates){var i=this.delegates[r],a=this.updatedObjects[r];i.reportChanged(a)}}},{key:"unbindDelegate",value:function(e){this.disable||(this.unbindsDelegated[e.identifier]=!0)}},{key:"addProperty",value:function(e,t,n){if(!this.disable&&(this._didUpdated=!0,!e.didDispose)){var r=this.getBufferObject(e),i=r[t];if(i)switch(i.value=n,i.kind){case ci.Removed:i.kind=ci.Updated;break;case ci.Inserted:i.kind=ci.Inserted;break;case ci.Updated:i.kind=ci.Updated}else r[t]={kind:ci.Inserted,value:n,isIndex:"number"==typeof t}}}},{key:"setProperty",value:function(e,t,n){if(!this.disable&&(this._didUpdated=!0,!e.didDispose)){var r=this.getBufferObject(e),i=r[t];if(i)switch(i.value=n,i.kind){case ci.Removed:i.kind=ci.Updated;break;case ci.Inserted:i.kind=ci.Inserted;break;case ci.Updated:i.kind=ci.Updated}else r[t]={kind:ci.Updated,value:n,isIndex:"number"==typeof t}}}},{key:"removeProperty",value:function(e,t){if(!this.disable&&(this._didUpdated=!0,!e.didDispose)){var n=this.getBufferObject(e),r=n[t];if(r)switch(r.kind){case ci.Removed:break;case ci.Inserted:delete n[t];break;case ci.Updated:r.kind=ci.Removed,r.value=void 0}else n[t]={kind:ci.Removed,value:void 0,isIndex:"number"==typeof t}}}},{key:"getBufferObject",value:function(e){var t=e.identifier,n=this.updatedObjects[t];return n||(this.delegates[t]=e,this.updatedObjects[t]=n={}),n}}]),e}(),da=function(){function e(t,n,r){I(this,e),this.runtime=t,this.observerAdapter=n,this.pendingUpdatedSection=r?new ha:null}return M(e,[{key:"pendingReportChanged",get:function(){return!!this.pendingUpdatedSection},set:function(e){!!this.pendingUpdatedSection!==e&&(e?this.pendingUpdatedSection=new ha:(this.pendingUpdatedSection.callbackDelegates(),this.pendingUpdatedSection=null))}},{key:"runWithMagix",value:function(e,t){return this.runtime.runWithMagix(e,t)}},{key:"runWithDisableObserve",value:function(e){var t=ua();try{return t.disable=!0,e()}finally{t.disable=!1}}},{key:"runWithContinuousUpdated",value:function(e){var t,n,r;return this.pendingUpdatedSection?(n=this.pendingUpdatedSection,r=!1):(n=new ha,r=!0),this.observerAdapter?this.observerAdapter.observeUpdate((function(){t=la(n,e),r&&n.callbackDelegates()})):(t=la(n,e),r&&n.callbackDelegates()),t}}]),e}();var fa=function(){function e(t){var n=this;I(this,e),this.cache={},this.clean=function(){var e=n.adapter.createObserverCollection();for(var t in n.cache){var r=n.cache[t];for(var i in r){var a=r[i].hub;a&&e.addObserverHub(a)}delete n.cache[t]}e.clean()},this.adapter=t,this.delayer=new je(this.clean)}return M(e,[{key:"valueWithArgs",value:function(e,t,n,r,i){var a,o=this;if(this.isComplicate(r))return i.call(e,n,r);var s,c=n+JSON.stringify(r),u=this.cache[t];if(u||(u=this.cache[t]={}),c in u)null==(a=(s=u[c]).hub)||a.replay();else{var l,h;try{l=this.adapter.collectObservations((function(){return i.call(e,n,r)}),(function(e){return h=e})),s={hub:h,result:l}}catch(e){s={hub:h,error:e}}h&&(h.onChanged=function(){return o.onExpire(t,c)}),u[c]=s}return this.touchCache(),this.returnNode(s)}},{key:"isComplicate",value:function(e){if(e.length>=5)return!0;var t,n=A(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("string"!=typeof r&&"number"!=typeof r)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"valueWithKey",value:function(e,t,n,r){var i,a,o=this,s=this.cache[t];if(s||(s=this.cache[t]={}),n in s)null==(i=(a=s[n]).hub)||i.replay();else{var c,u;try{c=this.adapter.collectObservations((function(){return r.call(e,n)}),(function(e){return u=e})),a={hub:u,result:c}}catch(e){a={hub:u,error:e}}u&&(u.onChanged=function(){return o.onExpire(t,n)}),s[n]=a}return this.touchCache(),this.returnNode(a)}},{key:"onExpire",value:function(e,t){var n=this.cache[e];t in n&&(delete n[t],function(e){for(var t in e)return!0;return!1}(n)||delete this.cache[e])}},{key:"returnNode",value:function(e){if(e.error)throw e.error;return e.hub&&e.hub.replay(),e.result}},{key:"touchCache",value:function(){if(!this.delayer.isRunning){var t=e.cacheDuration,n=e.cacheRate,r=t+Math.random()*n;this.delayer.refreshAndInvokeAfterInterval(r)}}}]),e}();fa.cacheDuration=6e4,fa.cacheRate=.3;var pa,va=function(){function e(t,n,r,i){var a=i.observerAdapter,o=i.escapeObjectFilter,s=i.jsxFactory;I(this,e),this.objectOperator=t,this.library=n,this.disposedListeners=[],this.observerAdapter=a,this.escapeObjectFilter=o||function(){return!1},this.jsxFactory=s,this.roomObserver=a&&new aa(a),this.noEffectsIdGenerator=Ct(-1),this.frameHandler=new Zo(this,this.library),this.cache=this.observerAdapter&&new fa(this.observerAdapter),r&&r.library===this.library?this.structMap=Zi({},r.structMap):this.structMap={}}return M(e,[{key:"runtime",get:function(){return this._runtime}},{key:"block",get:function(){return this.proxyBlock}},{key:"rootObject",get:function(){return this._rootObject}},{key:"hasDoubleLines",get:function(){return this._runtime.hasDoubleLines}},{key:"hasBranch",get:function(){return!!this._runtime.branchRuntime}},{key:"pendingReportChanged",get:function(){var e,t;return!(!(null==(e=this.roomObserver)?void 0:e.pendingReportChanged)&&!(null==(t=this.proxyBlock)?void 0:t.pendingReportChanged))},set:function(e){this.roomObserver&&(this.roomObserver.pendingReportChanged=e),this.proxyBlock&&(this.proxyBlock.pendingReportChanged=e),this._rootObject.pendingUpdatedRootObject=e}},{key:"forkBranchRuntime",value:function(){this._runtime.forkBranchRuntime()}},{key:"mergeBranch",value:function(){var e=this._runtime;e.branchRuntime.syncTwoBranches(),e.releaseBranchRuntime()}},{key:"observeUpdate",value:function(e){this.observerAdapter?this.observerAdapter.observeUpdate(e):e()}},{key:"reportUsersChanged",value:function(e){var t;null==(t=this.roomObserver)||t.reportUsersChanged(e)}},{key:"reportObserverIdChanged",value:function(e){var t;this._runtime.observerId=e,null==(t=this.roomObserver)||t.reportObserverIdChanged(e)}},{key:"createFrameSection",value:function(e){var t=this._runtime;t.hasDoubleLines||((new sa).copyProxyNode(this._rootObject.snapshotRootObject()),t.changeToDoubleLines());var n,r=t.branchRuntime;return r||(r=t.forkBranchRuntime()),e&&(n=e.takeCreatedProxyNodes()),r.createFrameSection(n)}},{key:"setupWithParameters",value:function(e,t,n,r){var i=this;this.setupRuntime(r);var a=hn,o=Ct(e),s=this.pushValues(o,t,!0),c={authorId:a,mode:ar.Real,timestamp:n,identifierGenerator:o},u=this.runtime.runWithMagix(c,(function(){return g(i.library.rootClass,p(s))})).__proxy;this._rootObject=new Jo(this._runtime,u,this.observerAdapter),this._rootObject.pendingUpdatedRootObject=r.pendingReportChanged}},{key:"setupWithRootObject",value:function(e,t){if(this.setupRuntime(t),!Io(e))throw new Error("rootObject should be AkkoObjectProxyNode");this._rootObject=new Jo(this._runtime,e,this.observerAdapter),this._rootObject.pendingUpdatedRootObject=t.pendingReportChanged}},{key:"setupRuntime",value:function(e){if(this._runtime)throw new Error("did bind runtime params");this._runtime=new $i({logger:e.logger,observerId:e.observerId,imageUsers:e.imageUsers,snapshotManager:e.snapshotManager,proxyRuntime:this,toolsExtra:e.toolsExtra}),this.roomObserver&&(this.roomObserver.pendingReportChanged=e.pendingReportChanged),this.proxyBlock=new da(this._runtime,this.observerAdapter,e.pendingReportChanged)}},{key:"pullValue",value:function(e){return"object"!=T(e)||null===e?e:bo(e)?e.displayer:ke(e)?e.readonly?e:e.slice():this.escapeObjectFilter(e)?e:void 0}},{key:"pushValues",value:function(e,t,n){var r=[],i=new ia(this,e,n);try{for(var a=0;a<t.length;++a)r[a]=i.wrap(t[a]);return r}finally{i.complete()}}},{key:"getAkkoObjectStruct",value:function(e){var t=this.structMap[e.id];return t||(t=this.structMap[e.id]=new so(e)),t}},{key:"listenDisposed",value:function(e){-1===this.disposedListeners.indexOf(e)&&this.disposedListeners.push(e)}},{key:"unlistenDisposed",value:function(e){var t=this.disposedListeners.indexOf(e);-1!==t&&this.disposedListeners.splice(t,1)}},{key:"dispose",value:function(){var e,t=A(this.disposedListeners.splice(0));try{for(t.s();!(e=t.n()).done;){var n=e.value;try{n()}catch(e){console.error(e)}}}catch(e){t.e(e)}finally{t.f()}}}]),e}(),ma=new Gi([{clazz:Object,proxyList:["assign"],banList:["getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","create","defineProperty","defineProperties"]},{clazz:Array,proxyList:[],banList:["from"]},{clazz:String,proxyList:["fromCodePoint","fromCharCode"],banList:[]},{clazz:Number,proxyList:["isFinite","isInteger","isNaN","isSafeInteger","parseFloat","parseInt"],banList:[]}]);function ga(){if(!pa)throw or.currentNode?new Error("can't create JSX. you didn't set jsxFactory"):new Error("can't create JSX. maybe you called it out of Magix");for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return pa.apply(void 0,t)}ma.proxyMethod(Object,"assign",(function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(n.length>0){var i=n[0];i&&bo(i)&&(e=i)}for(var a=0;a<n.length;++a)n[a]=ko(n[a]);var o=Object.assign.apply(this,n),s=o[xo];return e&&e!==s&&(s=e,co(e,o)),s})),ma.proxyMethod(String,"fromCodePoint",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)t[r]=ko(t[r]);return String.fromCodePoint.apply(this,t)})),ma.proxyMethod(String,"fromCharCode",(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)t[r]=ko(t[r]);return String.fromCharCode.apply(this,t)})),ma.proxyMethod(Number,"isFinite",Number.isFinite),ma.proxyMethod(Number,"isInteger",Number.isInteger),ma.proxyMethod(Number,"isNaN",Number.isNaN),ma.proxyMethod(Number,"isSafeInteger",Number.isSafeInteger),ma.proxyMethod(Number,"parseFloat",Number.parseFloat),ma.proxyMethod(Number,"parseInt",Number.parseInt),or.addListener((function(e,t){pa=t?e.proxyRuntime.jsxFactory:void 0}));var ya=function(){function e(){I(this,e),this.unwrappedMap={}}return M(e,[{key:"unwrap",value:function(e){return bo(e)?this.unwrapProxyNode(e):ke(e)?e.readonly?e:e.slice():e}},{key:"unwrapProxyNode",value:function(e){if(Io(e))return e.displayer;var t=e.identifier,n=this.unwrappedMap[t];if(!n){var r=e.target();if(To(e))for(var i in this.unwrappedMap[t]=n={},r)n[i]=this.unwrap(r[i]);else if(Ro(e)){this.unwrappedMap[t]=n=[];for(var a=0;a<r.length;++a)n[a]=this.unwrap(r[a])}}return n}}]),e}();function ba(e){if("object"==T(e)&&null!==e){if(bo(e))return e;var t=e[xo];return bo(t)?t:void 0}}function ka(e){return e instanceof ii?e.__proxy:e}var wa,Sa,xa,Ca,Ia,Pa,Ma,Ta,Aa,Ea,Oa,Ra,Na,La,ja=function(){function e(){I(this,e)}return M(e,[{key:"updater",value:function(e){return e}},{key:"getter",value:function(e,t){var n=ba(e);return n?n.getValue(t):e[t]}},{key:"caller",value:function(e,t,n,r){if("function"==typeof e){if(wr in e)return e[t].apply(e,n);var i=ma.findMethod(e,t);if(i)return i.apply(e,n);if("function"==typeof Function.prototype[t])return e[t].apply(e,p(n));throw new Error("can't call ".concat(e.name,".").concat(t,", it's not supported"))}var a,o;return r&&(a=r[t]),bo(e)?(o=e.target(),a||(a=e.getMethod(t))):(o=e,a||(a=e[t])),a.apply(o,n)}},{key:"setter",value:function(e,t,n){var r=ba(e),i=n;return i=ka(i),r?r.setValue(t,i):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=ba(e);return r?r.prefix(t,n):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=ba(e);if(r)return r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=ba(e);return n?n.removeKey(t):delete e[t]}},{key:"wrapper",value:function(e){return"object"!=T(e)||null===e?e:e[xo]||e}},{key:"unwrapper",value:function(e){return bo(e)?e.target():e}},{key:"jsxUnwrapper",value:function(e){return(new ya).unwrap(e)}}]),e}(),Da=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"onContextUpdate",value:function(e,t){t?(wa=e.tools&&e.tools.idGenerator,Sa=e.frameSection,xa=e.proxyRuntime):(wa=void 0,Sa=void 0,xa=void 0)}},{key:"creator",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:wa.generate();if(e.constructor===Array)t=Qo(xa,n,e);else if(e.constructor===Object)t=Xo(xa,n,e);else{var r=e.constructor[wr];if("object"!=T(r)||null===r)throw new Error("can't find __reflection");var i=xa.getAkkoObjectStruct(r);t=qo(xa,n,e,i)}return Sa.addCreatedObject(t),t}},{key:"updater",value:function(e){return bo(e)&&Sa.illusionUpdateProxyNode(e),e}},{key:"setter",value:function(e,t,n){var r=ba(e),i=n;return i=ka(i),r?(Sa.illusionUpdateProxyNode(r),r.setValue(t,i)):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=ba(e);return r?(Sa.illusionUpdateProxyNode(r),r.prefix(t,n)):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=ba(e);if(r)return Sa.illusionUpdateProxyNode(r),r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=ba(e);return n?(Sa.illusionUpdateProxyNode(n),n.removeKey(t)):delete e[t]}}]),n}(ja),Fa=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"onContextUpdate",value:function(e,t){t?(Ca=e.tools&&e.tools.idGenerator,Ia=e.frameSection,Pa=e.proxyRuntime):(Ca=void 0,Ia=void 0,Pa=void 0)}},{key:"creator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ca.generate(),n=Ia.illusionTakeCreatedObject(t,e);if(n)n.replaceIlluTarget(e);else if(e.constructor===Array)n=Qo(Pa,t,e);else if(e.constructor===Object)n=Xo(Pa,t,e);else{var r=e.constructor[wr];if("object"!=T(r)||null===r)throw new Error("can't find __reflection");var i=Pa.getAkkoObjectStruct(r);n=qo(Pa,t,e,i)}return Ia.addCreatedObject(n),n}},{key:"updater",value:function(e){return bo(e)&&Ia.illusionUpdateProxyNode(e),e}},{key:"setter",value:function(e,t,n){var r=ba(e),i=n;return i=ka(i),r?(Ia.illusionUpdateProxyNode(r),r.setValue(t,i)):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=ba(e);return r?(Ia.illusionUpdateProxyNode(r),r.prefix(t,n)):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=ba(e);if(r)return Ia.illusionUpdateProxyNode(r),r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=ba(e);return n?(Ia.illusionUpdateProxyNode(n),n.removeKey(t)):delete e[t]}}]),n}(ja),za=tr.SingleForward,Ba=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"onContextUpdate",value:function(e,t){t?(Ma=e.tools&&e.tools.idGenerator,Ta=e.frameSection,Aa=e.proxyRuntime,za=e.forwardMode):(Ma=void 0,Ta=void 0,Aa=void 0,za=tr.SingleForward)}},{key:"creator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ma.generate(),n=null==Ta?void 0:Ta.realTakeCreatedObject(t,e);if(n)n.realTarget=co(n,e);else if(e.constructor===Array)n=Qo(Aa,t,e);else if(e.constructor===Object)n=Xo(Aa,t,e);else{var r=e.constructor[wr];if("object"!=T(r)||null===r)throw new Error("can't find __reflection");var i=Aa.getAkkoObjectStruct(r);n=qo(Aa,t,e,i)}return za===tr.DoubleForward&&n.converge(),n}},{key:"wrapper",value:function(e){if("object"!=T(e)||null===e)return e;var t=e[xo];return t?(za===tr.DoubleForward&&t.converge(),t):e}}]),n}(ja),Ua=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"onContextUpdate",value:function(e,t){t?(Ea=e.tools&&e.tools.idGenerator,Oa=e.frameSection,Ra=e.proxyRuntime):(Ea=void 0,Oa=void 0,Ra=void 0)}},{key:"creator",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ea.generate(),n=Oa.realTakeCreatedObject(t,e);if(n)n.realTarget=co(n,e);else if(e.constructor===Array)(n=Qo(Ra,t,e)).converge(),Oa.realUpdateProxyNode(n);else if(e.constructor===Object)(n=Xo(Ra,t,e)).converge(),Oa.realUpdateProxyNode(n);else{var r=e.constructor[wr];if("object"!=T(r)||null===r)throw new Error("can't find __reflection");var i=Ra.getAkkoObjectStruct(r);(n=qo(Ra,t,e,i)).converge(),Oa.realUpdateProxyNode(n)}return n}},{key:"wrapper",value:function(e){if("object"!=T(e)||null===e)return e;var t=e[xo];return t?(t.illuTarget||(t.converge(),Oa.realUpdateProxyNode(t)),t):e}},{key:"updater",value:function(e){return bo(e)&&Oa.realUpdateProxyNode(e),e}},{key:"setter",value:function(e,t,n){var r=ba(e),i=n;return i=ka(i),r?(Oa.realUpdateProxyNode(r),r.setValue(t,i)):e[t]=i}},{key:"prefix",value:function(e,t,n){var r=ba(e);return r?(Oa.realUpdateProxyNode(r),r.prefix(t,n)):e[t]+=n}},{key:"postfix",value:function(e,t,n){var r=ba(e);if(r)return Oa.realUpdateProxyNode(r),r.postfix(t,n);var i=e[t];return e[t]+=n,i}},{key:"remover",value:function(e,t){var n=ba(e);return n?(Oa.realUpdateProxyNode(n),n.removeKey(t)):delete e[t]}}]),n}(ja),Va=Ha;function Wa(e){return-1===function(e){return xt.readInt53(e,0)}(e.identifier)}function Ha(){return!0}function _a(e,t){if(Va(e))return!0;var n=fi(e.target());if(n){var r=n.properties[t];if(r&&r.isTransient)return!0}return!1}or.addListener((function(e,t){Va=t&&e.tools&&e.mode===Ga.Outside?Wa:Ha}));var Ga,Ya=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"onContextUpdate",value:function(e,t){t?(Na=e.tools&&e.tools.idGenerator,La=e.proxyRuntime):(Na=void 0,La=void 0)}},{key:"creator",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Na.generate();if(e.constructor===Array)t=Qo(La,n,e);else if(e.constructor===Object)t=Xo(La,n,e);else{var r=e.constructor[wr];if("object"!=T(r)||null===r)throw new Error("can't find __reflection");var i=La.getAkkoObjectStruct(r);t=qo(La,n,e,i)}return t}},{key:"getter",value:function(e,t){var n=ba(e);if(n){var r=n.getValue(t);return n.touchKey(t),r}return e[t]}},{key:"unwrapper",value:function(e){return bo(e)?(e.touchKey(),e.target()):e}},{key:"setter",value:function(e,t,n){var r=ba(e),i=n;if(r&&_a(r,t))return i=ka(i),r?r.setValue(t,i):e[t]=i;throw new Error("Magix is frozen, you can't modify anything")}},{key:"prefix",value:function(e,t,n){var r=ba(e);if(r&&_a(r,t)){var i=r.prefix(t,n);return r.touchKey(t),i}throw new Error("Magix is frozen, you can't modify anything")}},{key:"postfix",value:function(e,t,n){var r=ba(e);if(r&&_a(r,t)){var i=r.postfix(t,n);return r.touchKey(t),i}throw new Error("Magix is frozen, you can't modify anything")}},{key:"remover",value:function(e,t){var n=ba(e);if(n&&_a(n,t))return n.removeKey(t);throw new Error("Magix is frozen, you can't modify anything")}}]),n}(ja);!function(e){e[e.Illusion=0]="Illusion",e[e.IllusionRebuild=1]="IllusionRebuild",e[e.Real=2]="Real",e[e.RealAck=3]="RealAck",e[e.Outside=4]="Outside"}(Ga||(Ga={}));var Xa=function(){function e(){var t=this;I(this,e),this.illusion=e.bind(new Da),this.illusionRebuild=e.bind(new Fa),this.real=e.bind(new Ba),this.realAck=e.bind(new Ua),this.outside=e.bind(new Ya),this.currentCoreFunctions=this.illusion,or.addListener((function(e,n){return t.currentCoreFunctions.onContextUpdate(e,n)}))}return M(e,[{key:"switchCoreFunctions",value:function(e){switch(e){case 0:this.currentCoreFunctions=this.illusion;break;case 1:this.currentCoreFunctions=this.illusionRebuild;break;case 2:this.currentCoreFunctions=this.real;break;case 3:this.currentCoreFunctions=this.realAck;break;case 4:this.currentCoreFunctions=this.outside}return this.currentCoreFunctions}}],[{key:"bind",value:function(e){return Object.freeze({creator:e.creator.bind(e),updater:e.updater.bind(e),wrapper:e.wrapper.bind(e),unwrapper:e.unwrapper.bind(e),jsxUnwrapper:e.jsxUnwrapper.bind(e),getter:e.getter.bind(e),setter:e.setter.bind(e),caller:e.caller.bind(e),remover:e.remover.bind(e),prefix:e.prefix.bind(e),postfix:e.postfix.bind(e),onContextUpdate:e.onContextUpdate.bind(e)})}}]),e}();var qa=function(){function e(){I(this,e),this.counterSet={},this.elementSet={}}return M(e,[{key:"hasElement",value:function(e){var t=this.elementSet[e.identifier];return!!t&&t===e}},{key:"createSubSet",value:function(){return new Qa(this)}},{key:"release",value:function(e){for(var t in this.elementSet){var n=this.elementSet[t];e&&e(n),delete this.counterSet[t],delete this.elementSet[t]}}},{key:"add",value:function(e){var t=e.identifier;return t in this.counterSet?this.counterSet[t]+=1:(this.elementSet[t]=e,this.counterSet[t]=1)}},{key:"remove",value:function(e){var t=this.counterSet[e];return void 0===t?t=0:0===(t-=1)&&(delete this.counterSet[e],delete this.elementSet[e]),t}}]),e}(),Qa=function(){function e(t){I(this,e),this.uniteSet=t,this.elementSet={}}return M(e,[{key:"add",value:function(e){var t=e.identifier;t in this.elementSet||(this.elementSet[t]=e,this.uniteSet.add(e))}},{key:"release",value:function(e){for(var t in this.elementSet){var n=this.elementSet[t],r=this.uniteSet.remove(t);e&&0===r&&e(n),delete this.elementSet[t]}}}]),e}();function Ka(e){var t=e.realTarget,n=e.illuTarget;if(!t||!n)return!1;switch(e.kind){case wo.Array:var r=e,i=t,a=n;if(i.length!==a.length)return!1;for(var o=r.equalsCount;o<i.length;++o)if(Za(i[o],a[o]))return r.equalsCount=o,!1;return r.equalsCount=i.length,!0;case wo.FlatObject:case wo.HangUpObject:for(var s in t)if(!(s in n)||Za(n[s],t[s]))return!1;for(var c in n)if(!(c in t))return!1;return!0;case wo.AkkoObject:var u,l=A(e.struct.serializableValueProperties);try{for(l.s();!(u=l.n()).done;){var h=u.value;if(h in t!=h in n||Za(t[h],n[h]))return!1}}catch(e){l.e(e)}finally{l.f()}return!0;default:return!1}}function Za(e,t){return e!==t&&(Number.isNaN(e)?!Number.isNaN(t):!ke(e)||!ke(t)||!e.isEqualsTo(t))}var Ja=function(){function e(t){I(this,e),this.logger=t,this.updatedProxyNodes=new qa,this.noConvergentRealNodes={},this.noConvergentIllusionNodes={}}return M(e,[{key:"createFrameSection",value:function(e){return new $a(this,this.updatedProxyNodes.createSubSet(),e)}},{key:"syncTwoBranches",value:function(){for(var e in this.updatedProxyNodes.release((function(e){Ka(e)||e.converge()})),this.noConvergentIllusionNodes){var t=this.noConvergentIllusionNodes[e];t!==this.noConvergentRealNodes[e]&&t.converge(),delete this.noConvergentIllusionNodes[e]}for(var n in this.noConvergentRealNodes)this.noConvergentRealNodes[n].converge(),delete this.noConvergentRealNodes[n]}},{key:"isUpdatedProxyNode",value:function(e){return this.updatedProxyNodes.hasElement(e)}},{key:"isNoConvergentIllusionProxyNode",value:function(e){return e in this.noConvergentIllusionNodes}},{key:"isNoConvergentRealProxyNode",value:function(e){return e in this.noConvergentRealNodes}},{key:"addNoConvergentIllusionProxyNode",value:function(e){this.logger.warn("found no convergent illusion object: ".concat(e.identifier)),this.noConvergentIllusionNodes[e.identifier]=e}},{key:"addNoConvergentRealProxyNode",value:function(e){this.logger.warn("found no convergent real object: ".concat(e.identifier)),this.noConvergentRealNodes[e.identifier]=e}}]),e}(),$a=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};I(this,e),this.createdProxyNodes={},this.branch=t,this.illuUpdatedProxyNodes=n,this.realUpdatedProxyNodes={},this.legacyCreatedProxyNodes=r}return M(e,[{key:"takeCreatedProxyNodes",value:function(){try{return this.createdProxyNodes}finally{this.createdProxyNodes={}}}},{key:"illusionUpdateProxyNode",value:function(e){this.branch.isNoConvergentIllusionProxyNode(e.identifier)||this.illuUpdatedProxyNodes.add(e)}},{key:"realUpdateProxyNode",value:function(e){!this.branch.isNoConvergentRealProxyNode(e.identifier)&&!this.branch.isUpdatedProxyNode(e)&&(this.realUpdatedProxyNodes[e.identifier]=e)}},{key:"addCreatedObject",value:function(e){e.identifier in this.createdProxyNodes||(this.createdProxyNodes[e.identifier]=e),this.illuUpdatedProxyNodes.add(e)}},{key:"illusionTakeCreatedObject",value:function(e,t){return this.takeCreatedObject(e,t,this.legacyCreatedProxyNodes)}},{key:"realTakeCreatedObject",value:function(e,t){var n=this.takeCreatedObject(e,t,this.createdProxyNodes);return n&&!this.branch.isUpdatedProxyNode(n)&&(this.realUpdatedProxyNodes[e]=n),n}},{key:"takeCreatedObject",value:function(e,t,n){var r=n[e];return r&&(delete n[e],(Ro(r)&&t.constructor!==Array||To(r)&&t.constructor!==Object||Io(r)&&t.constructor!==r.struct.classReflection.clazz)&&(r.dispose(),r=void 0)),r}},{key:"completeRebuild",value:function(){for(var e in this.legacyCreatedProxyNodes)this.legacyCreatedProxyNodes[e].dispose(),delete this.legacyCreatedProxyNodes[e]}},{key:"completeACK",value:function(){var e=this;for(var t in this.realUpdatedProxyNodes){var n=this.realUpdatedProxyNodes[t];Ka(n)||this.branch.addNoConvergentRealProxyNode(n),delete this.realUpdatedProxyNodes[t]}for(var r in this.illuUpdatedProxyNodes.release((function(t){t.realTarget&&!Ka(t)&&e.branch.addNoConvergentIllusionProxyNode(t)})),this.createdProxyNodes)this.createdProxyNodes[r].dispose(),delete this.createdProxyNodes[r]}}]),e}();function eo(e){return e instanceof io}function to(e){var t=e.__proxy;return t.didDispose?ir.Rejected:t.realTarget?ir.Committed:ir.Uncommitted}var no,ro,io=function(){function e(t){I(this,e),Object.defineProperty(this,"__proxy",{value:t,writable:!1,enumerable:!1,configurable:!0})}return M(e,[{key:"toJSON",value:function(){return this.__proxy.toJSON()}}]),e}();function ao(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Object.defineProperty(e,t,{enumerable:n,configurable:!0,get:function(){var e=this.__proxy,n=e.proxyRuntime.pullValue(e.displayerTarget()[t]);return e.assertAccessible(),e.touchKey(t),n}})}function oo(e,t){delete e[t]}!function(e){e[e.ReadValue=0]="ReadValue",e[e.ReadByGetter=1]="ReadByGetter",e[e.CanNotReadGetter=2]="CanNotReadGetter",e[e.CanNotReadPrivateValue=3]="CanNotReadPrivateValue",e[e.CanNotReadPrivateGetter=4]="CanNotReadPrivateGetter"}(no||(no={})),function(e){e[e.NoEffects=0]="NoEffects",e[e.Modifiable=1]="Modifiable",e[e.Private=2]="Private",e[e.EventReceiver=3]="EventReceiver"}(ro||(ro={}));var so=function(){function e(t){I(this,e),this.valuePropertiesSet={},this.classReflection=t;var n=[],r=[],i=[],a={};for(var o in t.properties){var s=t.properties[o],c=s.mode===Oe.Value,u=s.decorators.some((function(e){return e===pr})),l=s.decorators.some((function(e){return e===fr}));c&&(a[o]=!0,l?n.push(o):r.push(o)),s.isPublic&&(c||u)&&i.push(o)}this.transientValueProperties=Object.freeze(n),this.serializableValueProperties=Object.freeze(r),this.copyableProperties=Object.freeze(i),this.displayerNodeClass=this.createAkkoDisplayerNodeClass(t),this.valuePropertiesSet=Object.freeze(a),this.propertyKinds=this.createPropertyReadableKinds(t),this.methodKinds=this.createMethodCallableKinds(t)}return M(e,[{key:"isValueProperty",value:function(e){return e in this.valuePropertiesSet}},{key:"getPropertyReadableKind",value:function(e){return this.propertyKinds[e]}},{key:"getMethodCallableKind",value:function(e){return this.methodKinds[e]}},{key:"getValueOutsideFromProxyNode",value:function(e,t){switch(this.propertyKinds[t]){case 0:case 1:return e.proxyRuntime.pullValue(this.getValueFromProxyNode(e,t));case 2:throw new Error("can't read property ".concat(JSON.stringify(t)," unless it has @noEffects"));case 3:case 4:throw new Error("can't read private property ".concat(JSON.stringify(t)));default:return}}},{key:"getValueFromProxyNode",value:function(e,t){switch(e.assertAccessible(),this.propertyKinds[t]){case 0:case 3:var n=e.displayerTarget()[t];return e.touchKey(t),n;case 1:var r=e.proxyRuntime.runtime,i=r.observerId,a=e.proxyRuntime.noEffectsIdGenerator,o={authorId:i,mode:Ga.Outside,timestamp:Date.now(),identifierGenerator:a};return r.runWithMagix(o,(function(){return e.target()[t]}));default:return}}},{key:"createAkkoDisplayerNodeClass",value:function(e){var t=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return n}(io),n=function(e){Object.defineProperty(t.prototype,e,{enumerable:!1,configurable:!1,get:function(){var t=this.__proxy,n=t.struct;return t.assertAccessible(),n.getValueOutsideFromProxyNode(t,e)}})};for(var r in e.properties)n(r);var i=function(e){t.prototype[e]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return this.__proxy.callOutside(e,n)}};for(var a in e.methods)i(a);return t}},{key:"createPropertyReadableKinds",value:function(e){var t={};for(var n in e.properties){var r=e.properties[n];r.isPublic?r.mode===Oe.Value?t[n]=0:r.decorators.some((function(e){return e===pr}))?t[n]=1:t[n]=2:r.mode===Oe.Value?t[n]=3:t[n]=4}return Object.freeze(t)}},{key:"createMethodCallableKinds",value:function(e){var t={};for(var n in e.methods){var r=e.methods[n];r.isPublic?r.decorators.some((function(e){return ur(e)&&br(e.payload)}))?t[n]=3:r.decorators.some((function(e){return e===pr}))?t[n]=0:t[n]=1:t[n]=2}return Object.freeze(t)}}]),e}();function co(e,t){return Object.defineProperty(t,xo,{enumerable:!1,writable:!1,configurable:!0,value:e}),t}var uo=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,null,[{key:"createClass",value:function(e){var t=e.classReflection,r=e.getter,i=e.invoker,a=function(e){y(n,e);var t=k(n);function n(e,r){var i;return I(this,n),i=t.call(this,r),Object.defineProperty(S(i),"__Holder",{value:e,writable:!1,enumerable:!1,configurable:!0}),i}return n}(n),o=function(e){Object.defineProperty(a.prototype,e,{enumerable:!1,configurable:!1,get:function(){return r(e)},set:function(){throw new Error("cannot set property ".concat(e," which has only a getter"))}})};for(var s in t.properties)o(s);var c=function(e){a.prototype[e]=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i(e,n)}};for(var u in t.methods)c(u);return a}},{key:"updateProxy",value:function(e,t){Object.defineProperty(e,xo,{value:t,writable:!1,enumerable:!1,configurable:!0})}},{key:"getHolder",value:function(e){return e.__Holder}}]),n}(io),lo=function(){function e(t,n){var r=this;I(this,e),this.updatedListeners=[],this.disposedListeners=[],this.dispatchDisposed=function(){var e,t=A(r.disposedListeners);try{for(t.s();!(e=t.n()).done;){var n=e.value;try{n()}catch(e){console.error(e)}}}catch(e){t.e(e)}finally{t.f()}},this.runtime=t,this.onClean=n}return M(e,[{key:"listenUpdated",value:function(e){this.updatedListeners.some((function(t){return t.id===e.id}))||this.updatedListeners.push(Object.freeze(Zi({},e)))}},{key:"unlistenUpdated",value:function(e){var t=this.updatedListeners.findIndex((function(t){return t.id===e}));-1!==t&&(this.updatedListeners.splice(t,1),this.fireRemoveListener())}},{key:"listenDisposed",value:function(e){-1===this.disposedListeners.indexOf(e)&&(this.disposedListeners.push(e),1===this.disposedListeners.length&&this.runtime.listenDisposed(this.dispatchDisposed))}},{key:"unlistenDisposed",value:function(e){var t=this.disposedListeners.indexOf(e);-1!==t&&(this.disposedListeners.splice(t,1),this.fireRemoveListener(),0===this.disposedListeners.length&&this.runtime.unlistenDisposed(this.dispatchDisposed))}},{key:"dispatchUpdated",value:function(e){var t,n=A(this.updatedListeners);try{for(n.s();!(t=n.n()).done;){var r=t.value.listener;try{r(e)}catch(e){console.error(e)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"fireRemoveListener",value:function(){0===this.updatedListeners.length&&0===this.disposedListeners.length&&(this.runtime.unlistenDisposed(this.dispatchDisposed),this.onClean())}}]),e}();function ho(e,t){var n=mo(e),r=e.__proxy;null==n||n.listenUpdated({id:t,listener:function(e){return function(e,t,n){var r=[];for(var i in t){var a=t[i],o=a.isIndex?parseInt(i,10):i,s=a.kind,c=void 0;switch(s){case ci.Inserted:case ci.Updated:c=e.proxyRuntime.pullValue(a.value);break;case ci.Removed:}r.push({key:o,value:c,kind:s})}n(r)}(r,e,t)}})}function fo(e,t){var n;null==(n=mo(e))||n.unlistenUpdated(t)}function po(e,t){var n;null==(n=mo(e))||n.listenDisposed(t)}function vo(e,t){var n;null==(n=mo(e))||n.unlistenDisposed(t)}function mo(e){if(!eo(e))throw new Error("it isn't akko wrapped object");return e instanceof uo?uo.getHolder(e).getListeners():e.__proxy.getListeners()}var go=!1,yo=tr.SingleForward;function bo(e){return e instanceof So}function ko(e){return"object"!=T(e)||null===e?e:e instanceof So?e.target():e}or.addListener((function(e,t){if(t){var n=e.proxyRuntime.runtime;go=n.isForcesOnIllusionLine(e.mode),yo=e.forwardMode}else go=!1,yo=tr.SingleForward}));var wo,So=function(){function e(t,n,r){I(this,e),this._didDispose=!1,this.listeners=null,this.proxyRuntime=t,this.identifier=n,go?this.illuTarget=co(this,r):this.realTarget=co(this,r)}return M(e,[{key:"didDispose",get:function(){return this._didDispose}},{key:"assertAccessible",value:function(){if(this._didDispose)throw new Error("akko wrapped object isn't accessible")}},{key:"reportChanged",value:function(e){var t;null==(t=this.listeners)||t.dispatchUpdated(e)}},{key:"getValue",value:function(e){return this.target()[e]}},{key:"touchKey",value:function(e){var t=this.proxyRuntime.observerAdapter;t&&(this.observer||(this.observer=t.create(this.identifier,this.getDebugName())),void 0===e?this.observer.reportObservedIteration():this.observer.reportObservedKey(e))}},{key:"getListeners",value:function(){var e=this;return!this.listeners&&!this._didDispose&&(this.listeners=new lo(this.proxyRuntime,(function(){e.listeners=null}))),this.listeners}},{key:"cleanListeners",value:function(){this.listeners=null}},{key:"dispose",value:function(){this._didDispose=!0,ua().unbindDelegate(this),this._displayer&&(this.releaseDisplayer(this._displayer),delete this._displayer,delete this.observer),this.listeners&&(this.listeners=null)}},{key:"target",value:function(){return go?this.illuTarget:this.realTarget}},{key:"displayerTarget",value:function(){return this.illuTarget||this.realTarget}},{key:"displayer",get:function(){return this._displayer||(this._displayer=this.createDisplayer()),this._displayer}},{key:"toString",value:function(){return this.target().toString()}},{key:"toLocaleString",value:function(){return this.target().toLocaleString()}},{key:"sideTarget",value:function(){if(yo===tr.DoubleForward&&!go)return this.illuTarget}}]),e}(),xo="__proxy";function Co(e){if(or.currentNode){if(bo(e))return e.identifier;var t=e[xo];if(!bo(t))throw new Error("identifier not found");return t.identifier}if(eo(e))return e.__proxy.identifier;throw"object"!=T(e)?new Error("can not find identifier of ".concat(T(e))):null===e?new Error("can not find identifier of null"):new Error("identifier not found")}function Io(e){return e instanceof Po}!function(e){e[e.FlatObject=0]="FlatObject",e[e.AkkoObject=1]="AkkoObject",e[e.Array=2]="Array",e[e.HangUpObject=3]="HangUpObject"}(wo||(wo={}));var Po=function(e){y(n,e);var t=k(n);function n(e,r,i,a){var o;return I(this,n),(o=t.call(this,e,r,i)).struct=a,o}return M(n,[{key:"getDebugName",value:function(){return this.struct.classReflection.name}},{key:"createDisplayer",value:function(){return new(0,this.struct.displayerNodeClass)(this)}},{key:"kind",get:function(){return wo.AkkoObject}},{key:"clazz",get:function(){return this.struct.classReflection.clazz}},{key:"updateDisplayer",value:function(e){}},{key:"reportChanged",value:function(e){c(C(n.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t)for(var r in e){var i=e[r],a=i.kind,o=i.value;t.reportChanged(r,o,a)}}},{key:"converge",value:function(){var e=this.realTarget;if(e){var t,n={},r=A(this.struct.serializableValueProperties);try{for(r.s();!(t=r.n()).done;){var i=t.value;i in e&&(n[i]=e[i])}}catch(e){r.e(e)}finally{r.f()}Object.setPrototypeOf(n,this.struct.classReflection.clazz.prototype),this.replaceIlluTarget(n)}}},{key:"replaceIlluTarget",value:function(e){var t=this.illuTarget||this.realTarget,n=co(this,e);this.illuTarget=n;var r,i=ua(),a=A(this.struct.serializableValueProperties);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o in t,c=o in n;c&&!s?i.addProperty(this,o,n[o]):!c&&s?i.removeProperty(this,o):c&&s&&n[o]!==t[o]&&i.setProperty(this,o,n[o])}}catch(e){a.e(e)}finally{a.f()}}},{key:"getMethod",value:function(e){return this.target()[e]}},{key:"touchKey",value:function(e){switch(this.struct.getPropertyReadableKind(e)){case no.ReadValue:case no.CanNotReadPrivateValue:c(C(n.prototype),"touchKey",this).call(this,e)}}},{key:"callOutside",value:function(e,t){var n;switch(this.assertAccessible(),this.struct.getMethodCallableKind(e)){case ro.NoEffects:var r=this.proxyRuntime.cache;n=r?r.valueWithArgs(this,this.identifier,e,t,this.callNoEffectsMethod):this.callNoEffectsMethod(e,t);break;case ro.Modifiable:if(!this.struct.classReflection.isRootClass)throw new Error("can only call modifiable methods of trigger object");n=this.proxyRuntime.rootObject.onInvokedTriggerMethod(e,t);break;case ro.EventReceiver:throw new Error("can't invoke event receiver. you should call dispatch()");case ro.Private:throw new Error("can't invoke private method");default:var i;(i=void 0)[e].apply(i,p(t))}return this.proxyRuntime.pullValue(n)}},{key:"callNoEffectsMethod",value:function(e,t){var n=this,r=this.proxyRuntime.runtime,i=r.observerId,a=this.proxyRuntime.noEffectsIdGenerator,o={authorId:i,mode:Ga.Outside,timestamp:Date.now(),identifierGenerator:a};return r.runWithMagix(o,(function(){var r=n.target(),i=r[e],o=n.proxyRuntime.pushValues(a,t,!1);return i.apply(r,o)}))}},{key:"setValue",value:function(e,t){var n=this.target();if(this.struct.isValueProperty(e)){var r=n[e],i=e in n;n[e]=t,i?r!==t&&ua().setProperty(this,e,t):ua().addProperty(this,e,t);var a=this.sideTarget();return a&&(a[e]=t),t}return n[e]=t}},{key:"postfix",value:function(e,t){var n=this.target();if(this.struct.isValueProperty(e)){var r=n[e],i=e in n,a=n[e]+=t;i?r!==a&&ua().setProperty(this,e,a):ua().addProperty(this,e,a);var o=this.sideTarget();return o&&(o[e]=a),a}return n[e]+=t}},{key:"prefix",value:function(e,t){var n=this.target(),r=n[e];if(this.struct.isValueProperty(e)){var i=e in n,a=n[e]+=t;i?r!==a&&ua().setProperty(this,e,a):ua().addProperty(this,e,a);var o=this.sideTarget();o&&(o[e]=a)}else n[e]+=t;return r}},{key:"removeKey",value:function(e){if(this.struct.isValueProperty(e)){var t=this.target(),n=e in t;if(n){delete t[e],ua().removeProperty(this,e);var r=this.sideTarget();r&&delete r[e]}return n}return!1}},{key:"toJSON",value:function(){var e,t={},n=A(this.struct.copyableProperties);try{for(n.s();!(e=n.n()).done;){var r=e.value;t[r]=this[r]}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"releaseDisplayer",value:function(e){}}]),n}(So),Mo=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"getDebugName",value:function(){return"Object"}},{key:"createDisplayer",value:function(){var e=new io(this);for(var t in this.displayerTarget())ao(e,t);return e}},{key:"updateDisplayer",value:function(e){var t=this._displayer;if(t)for(var n in e)switch(e[n].kind){case ci.Inserted:ao(t,n);break;case ci.Removed:oo(t,n)}}},{key:"reportChanged",value:function(e){c(C(n.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t)for(var r in e){var i=e[r],a=i.kind,o=i.value;t.reportChanged(r,o,a)}}},{key:"clazz",get:function(){return Object}},{key:"converge",value:function(){this.realTarget&&this.replaceIlluTarget(Zi({},this.realTarget))}},{key:"replaceIlluTarget",value:function(e){var t=this.illuTarget||this.realTarget,n=co(this,e);this.illuTarget=n;var r=ua();for(var i in n){var a=n[i];i in t?t[i]!==a&&r.setProperty(this,i,a):r.addProperty(this,i,a)}for(var o in t)o in n||r.removeProperty(this,o)}},{key:"getMethod",value:function(e){return this.target()[e]}},{key:"setValue",value:function(e,t){var n=this.target(),r=this.sideTarget(),i=n[e],a=e in n;return n[e]=t,a?i!==t&&ua().setProperty(this,e,t):ua().addProperty(this,e,t),r&&(r[e]=t),t}},{key:"prefix",value:function(e,t){var n=this.target(),r=this.sideTarget(),i=n[e],a=e in n,o=n[e]+=t;return a?i!==o&&ua().setProperty(this,e,o):ua().addProperty(this,e,o),r&&(r[e]=o),o}},{key:"postfix",value:function(e,t){var n=this.target(),r=this.sideTarget(),i=n[e],a=e in n,o=n[e]+=t;return a?i!==o&&ua().setProperty(this,e,o):ua().addProperty(this,e,o),r&&(r[e]=o),i}},{key:"removeKey",value:function(e){var t=this.target(),n=e in t;if(n){delete t[e];var r=this.sideTarget();ua().removeProperty(this,e),r&&delete r[e]}return n}},{key:"toJSON",value:function(){var e=this.displayerTarget(),t={};for(var n in e)t[n]=e[n];return t}},{key:"releaseDisplayer",value:function(e){}}]),n}(So);function To(e){return e instanceof Ao}var Ao=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"kind",get:function(){return wo.FlatObject}},{key:"covertToAkkoObjectProxyNode",value:function(e){var t=this,n=this.realTarget,r=this.illuTarget;return t.struct=this.proxyRuntime.getAkkoObjectStruct(e),t._displayer=void 0,Object.setPrototypeOf(t,Po.prototype),Object.setPrototypeOf(n,e.clazz.prototype),r&&Object.setPrototypeOf(r,e.clazz.prototype),t}}]),n}(Mo),Eo=function(){function e(t){I(this,e),this.index=0,this.proxy=t,this.length=t.proxyRuntime.pullValue(t.displayerTarget().length),t.assertAccessible(),t.touchKey("length")}return M(e,[{key:Symbol.iterator,value:function(){return new e(this.proxy)}},{key:"next",value:function(){if(this.index>=this.length)return{value:void 0,done:!0};var e=this.proxy.displayerTarget()[this.index],t=this.proxy.proxyRuntime.pullValue(e);return this.proxy.assertAccessible(),this.proxy.touchKey(this.index),this.index+=1,{value:t,done:!1}}}]),e}(),Oo=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n),r=t.call(this,e);for(var i=e.displayerTarget(),a=0;a<i.length;++a)ao(S(r),a);return r}return M(n,[{key:"concat",value:function(){for(var e=n.unwrapToPureArray(this),t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0;a<r.length;++a)r[a]=n.unwrapToPureArray(r[a]);return Array.prototype.concat(e,r)}},{key:"every",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.every.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"filter",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.filter.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"find",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime,i=Array.prototype.find.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}));return r.pullValue(i)}},{key:"findIndex",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.findIndex.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"forEach",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;Array.prototype.forEach.call(this.__proxy.displayerTarget(),(function(i,a){e.call(t,r.pullValue(i),a,n)}))}},{key:"indexOf",value:function(e,t){var n=e;return eo(n)&&(n=n.__proxy),Array.prototype.indexOf.call(this.__proxy.displayerTarget(),n,t)}},{key:"lastIndexOf",value:function(e,t){var n=e;return eo(n)&&(n=n.__proxy),Array.prototype.lastIndexOf.call(this.__proxy.displayerTarget(),n,t)}},{key:"join",value:function(e){return Array.prototype.join.call(this.__proxy.displayerTarget(),e)}},{key:"map",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.map.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"reduce",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime,i=t;return Array.prototype.reduce.call(this.__proxy.displayerTarget(),(function(t,a,o){var s=t;return i!==s&&(s=r.pullValue(s)),i=e(s,r.pullValue(a),o,n)}),t)}},{key:"reduceRight",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime,i=t;return Array.prototype.reduceRight.call(this.__proxy.displayerTarget(),(function(t,a,o){var s=t;return i!==s&&(s=r.pullValue(s)),i=e(s,r.pullValue(a),o,n)}),t)}},{key:"slice",value:function(e,t){for(var n=this.__proxy.proxyRuntime,r=Array.prototype.slice.call(this.__proxy.displayerTarget(),e,t),i=0;i<r.length;++i)r[i]=n.pullValue(r[i]);return r}},{key:"some",value:function(e,t){var n=this,r=this.__proxy.proxyRuntime;return Array.prototype.some.call(this.__proxy.displayerTarget(),(function(i,a){return e.call(t,r.pullValue(i),a,n)}))}},{key:"toString",value:function(){return Array.prototype.toString.apply(this.__proxy.displayerTarget())}},{key:"copyWithin",value:function(){n.throwImmutableError()}},{key:"fill",value:function(){n.throwImmutableError()}},{key:"pop",value:function(){n.throwImmutableError()}},{key:"push",value:function(){n.throwImmutableError()}},{key:"reverse",value:function(){n.throwImmutableError()}},{key:"shift",value:function(){n.throwImmutableError()}},{key:"splice",value:function(){n.throwImmutableError()}},{key:"unshift",value:function(){n.throwImmutableError()}},{key:"sort",value:function(){n.throwImmutableError()}},{key:"entries",value:function(){n.throwBanMethodError()}},{key:"keys",value:function(){n.throwBanMethodError()}},{key:"values",value:function(){n.throwBanMethodError()}}],[{key:"refreshLength",value:function(e,t){for(var n=t;n in e;)oo(e,n),n+=1;if(n===t)for(n=t-1;n>=0&&!(n in e);)ao(e,n),n-=1}},{key:"unwrapToPureArray",value:function(e){if(e instanceof n){for(var t=e.__proxy.displayerTarget().length,r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}return e}},{key:"throwImmutableError",value:function(){throw new Error("it is immutable")}},{key:"throwBanMethodError",value:function(){throw new Error("ban method")}}]),n}(io);function Ro(e){return e instanceof Lo}Object.defineProperty(Oo.prototype,"length",{enumerable:!1,configurable:!0,get:function(){var e=this.__proxy,t=e.proxyRuntime.pullValue(e.displayerTarget().length);return e.touchKey("length"),t}}),"undefined"!=typeof Symbol&&void 0!==Symbol.iterator&&Object.defineProperty(Oo.prototype,Symbol.iterator,{enumerable:!1,configurable:!0,writable:!1,value:function(){return new Eo(this.__proxy)}});var No=function(e){y(n,e);var t=k(n);function n(){var e;return I(this,n),(e=t.apply(this,arguments)).equalsCount=0,e}return M(n,[{key:"getDebugName",value:function(){return"Array"}},{key:"createDisplayer",value:function(){return new Oo(this)}},{key:"kind",get:function(){return wo.Array}},{key:"clazz",get:function(){return Array}},{key:"updateDisplayer",value:function(e){var t=this._displayer,n=e.length;t&&n&&Oo.refreshLength(t,n.value)}},{key:"reportChanged",value:function(e){c(C(n.prototype),"reportChanged",this).call(this,e);var t=this.observer;if(t){var r=e.length;for(var i in r&&t.reportChanged("length",r.value,r.kind),e){var a=e[i],o=a.kind,s=a.value;a.isIndex&&t.reportChanged(parseInt(i,10),s,o)}}}},{key:"converge",value:function(){this.realTarget&&(this.replaceIlluTarget(p(this.realTarget)),this.equalsCount=this.realTarget.length)}},{key:"replaceIlluTarget",value:function(e){var t=this.illuTarget||this.realTarget,n=co(this,e);this.illuTarget=n;for(var r=Math.min(t.length,n.length),i=ua(),a=0;a<r;++a)t[a]!==n[a]&&i.setProperty(this,a,n[a]);this.refreshLength(t.length,n),this.equalsCount=0}},{key:"getMethod",value:function(e){return n.arrayValidMethods[e]}},{key:"getValue",value:function(e){return"number"==typeof e?this.target()[e]:"length"===e?this.target().length:void 0}},{key:"setValue",value:function(e,t){var n=this.target(),r=n.length;if("number"==typeof e){if(e>=0){var i=e in n&&n[e]!==t,a=n[e]=t;i&&ua().setProperty(this,e,t);var o=this.sideTarget();return this.refreshLength(r,n),o&&(o[e]=t),e<this.equalsCount&&(this.equalsCount=e),a}return t}return n[e]}},{key:"removeKey",value:function(e){return!1}},{key:"prefix",value:function(e,t){if("number"==typeof e){var n=this.target(),r=this.sideTarget(),i=e in n,a=n.length,o=n[e],s=n[e]+=t;return i&&s!==o&&ua().setProperty(this,e,s),this.refreshLength(a,n),r&&(r[e]=s),e<this.equalsCount&&(this.equalsCount=e),s}}},{key:"postfix",value:function(e,t){if("number"==typeof e){var n=this.target(),r=this.sideTarget(),i=e in n,a=n.length,o=n[e],s=n[e]+=t;return i&&s!==o&&ua().setProperty(this,e,s),this.refreshLength(a,n),r&&(r[e]=s),e<this.equalsCount&&(this.equalsCount=e),o}}},{key:"toJSON",value:function(){for(var e=this.displayerTarget(),t=[],n=0;n<e.length;++n)t[n]=e[n];return t}},{key:"releaseDisplayer",value:function(e){}},{key:"refreshLength",value:function(e,t){if(e!==t.length){var n=this.sideTarget(),r=ua();if(e>t.length){n&&n.splice(t.length);for(var i=t.length;i<e;++i)r.removeProperty(this,i)}else for(var a=e;a<t.length;++a)n&&(n[a]=t[a]),r.addProperty(this,a,t[a]);r.setProperty(this,"length",t.length)}}}],[{key:"createArrayValidMethods",value:function(){var e,t,n;or.addListener((function(r,i){i&&r.tools?(e=r.tools.idGenerator,t=r.coreFunctions.updater,n=r.coreFunctions.creator):(e=void 0,t=void 0,n=void 0)}));var r,i=function(t,r){return t===r?t[xo]:n(r,e.generate())},a={},o=A(_i);try{var s=function(){var e=r.value,n=e.methodName,o=e.returnArray,s=e.lengthChanged,c=e.elementChanged,u=e.touchLength,l=e.cleanEqualsCount,h=e.pickTouchedSegment,d=Array.prototype[n],f=s||c;a[n]=function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];var p=this,v=p.length,m=p[xo],g=d.apply(p,r);if(f&&!Va(m))throw new Error("Magix is frozen, you can't call Array.".concat(n,"()"));var y=h&&h(p,r);if(s&&m.refreshLength(v,p),y)for(var b=Math.min(p.length,y.beginIndex+y.length),k=m.sideTarget(),w=ua(),S=y.beginIndex;S<b;++S){if(c){var x=p[S];k&&(k[S]=x),w.setProperty(m,S,x)}m.touchKey(S)}return u&&m.touchKey(),l&&(m.equalsCount=0),f&&t(m),o?i(p,g):g}};for(o.s();!(r=o.n()).done;)s()}catch(e){o.e(e)}finally{o.f()}return Object.freeze(a)}}]),n}(So),Lo=No;function jo(e){return e instanceof Fo}Lo.arrayValidMethods=No.createArrayValidMethods();var Do,Fo=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"version",get:function(){return this._version}},{key:"objectFormatId",get:function(){return this._objectFormatId}},{key:"setHangMetadata",value:function(e){if(this._version||this._objectFormatId)throw new Error("did set version");this._version=e.version,this._objectFormatId=e.objectFormatId}},{key:"kind",get:function(){return wo.HangUpObject}}]),n}(Mo);function zo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return new Uo(t,n).copyValue(e)}!function(e){e[e.ExportsPropertyMode=0]="ExportsPropertyMode",e[e.SerializablePropertyMode=1]="SerializablePropertyMode"}(Do||(Do={}));var Bo,Uo=function(){function e(t,n){I(this,e),this.mode=t,this.creator=n,this.copedObjectMap={}}return M(e,[{key:"copyValue",value:function(e){return eo(e)?this.copyProxyNode(e.__proxy):bo(e)?this.copyProxyNode(e):e}},{key:"copyProxyNode",value:function(e){var t=e.identifier,n=this.copedObjectMap[t];if(!n){var r=e.displayerTarget();if(To(e)){var i={};for(var a in this.copedObjectMap[t]=n=i,r)i[a]=this.copyInsideValue(e.proxyRuntime,r[a])}else if(Io(e)){var o=e.struct,s=this.createAkkoObject(o.classReflection.clazz);this.copedObjectMap[t]=n=s;var c,u=A(this.getPropertiesToCopy(e));try{for(u.s();!(c=u.n()).done;){var l=c.value;s[l]=this.copyInsideValue(e.proxyRuntime,o.getValueFromProxyNode(e,l))}}catch(e){u.e(e)}finally{u.f()}}else if(Ro(e)){var h=r.length,d=[];this.copedObjectMap[t]=n=d;for(var f=0;f<h;++f)d[f]=this.copyInsideValue(e.proxyRuntime,r[f])}}return n}},{key:"getPropertiesToCopy",value:function(e){switch(this.mode){case 0:return e.struct.copyableProperties;case 1:return e.struct.serializableValueProperties;default:throw new Error("invalid mode ".concat(this.mode))}}},{key:"createAkkoObject",value:function(e){return this.creator?this.creator(e):{}}},{key:"copyInsideValue",value:function(e,t){return"object"!=T(t)||null===t?t:bo(t)?this.copyProxyNode(t):ke(t)?t.readonly?t:t.slice():e.escapeObjectFilter(t)?t:void 0}}]),e}();or.addListener((function(e,t){Bo=t&&e.tools?e.coreFunctions:null}));var Vo=function(){function e(){I(this,e),this.copedObjectMap={}}return M(e,[{key:"copyValue",value:function(e){return bo(e)?this.copyProxyNode(e):e}},{key:"copyProxyNode",value:function(e){var t=e.identifier,n=this.copedObjectMap[t];if(!n)if(To(e)||jo(e)){var r=Bo.creator({});for(var i in this.copedObjectMap[t]=n=r,Bo.unwrapper(e)){var a=this.copyValue(Bo.getter(e,i));Bo.setter(n,i,a)}}else if(Io(e)){var o=e.struct,s={};Object.setPrototypeOf(s,o.classReflection.clazz.prototype);var c=Bo.creator(s);this.copedObjectMap[t]=n=c;var u,l=A(o.serializableValueProperties);try{for(l.s();!(u=l.n()).done;){var h=u.value,d=this.copyValue(Bo.getter(e,h));Bo.setter(c,h,d)}}catch(e){l.e(e)}finally{l.f()}}else{if(!Ro(e))throw new Error("invalid proxy node");var f=Bo.getter(e,"length"),p=Bo.creator([]);this.copedObjectMap[t]=n=p;for(var v=0;v<f;++v){var m=this.copyValue(Bo.getter(e,v));Bo.setter(p,v,m)}}return n}}]),e}(),Wo=function(){function e(t,n){var r=this;I(this,e),this.listeners=new Ho,this.didDispose=!1,this.getProperty=function(e){var t,n=r._akkoProxyNode.proxyRuntime;switch(r.struct.getPropertyReadableKind(e)){case no.ReadValue:t=n.pullValue(r._akkoProxyNode.displayerTarget()[e]),r.touchKey(e);break;case no.ReadByGetter:var i=n.cache;t=i?i.valueWithKey(r,r._akkoProxyNode.identifier,e,r.readByGetter):r.readByGetter(e),r.touchKey(xo);break;case no.CanNotReadGetter:throw new Error("can't read property ".concat(JSON.stringify(e)," unless it has @noEffects"));case no.CanNotReadPrivateValue:case no.CanNotReadPrivateGetter:throw new Error("can't read private property ".concat(JSON.stringify(e)))}return t},this.readByGetter=function(e){var t=r._akkoProxyNode.proxyRuntime,n=t.runtime,i=n.observerId,a=t.noEffectsIdGenerator,o={authorId:i,mode:Ga.Outside,timestamp:Date.now(),identifierGenerator:a},s=n.runWithMagix(o,(function(){return r._akkoProxyNode.target()[e]}));return t.pullValue(s)},this.invokeMethod=function(e,t){var n=r._akkoProxyNode.callOutside(e,t);return r.touchKey(xo),n},this.onAkkoProxyNodeUpdated=function(e){if(r.observer){for(var t in e){var n=e[t],i=n.kind,a=n.value;r.observer.reportChanged(t,a,i)}r.listeners.dispatchUpdated(e)}},this.struct=t.struct,this.observerAdapter=n,this._akkoProxyNode=t,this.displayer=this.createDisplayer(t),this.valueProperties=Object.freeze([].concat(p(this.struct.transientValueProperties),p(this.struct.serializableValueProperties))),this.listenUpdated(t)}return M(e,[{key:"dispose",value:function(){this.didDispose||(this.unlistenUpdate(this._akkoProxyNode),this.listeners.dispatchDisposed(),this.didDispose=!0)}},{key:"getListeners",value:function(){return this.listeners}},{key:"akkoProxyNode",get:function(){return this._akkoProxyNode},set:function(e){var t=this;this._akkoProxyNode!==e&&(this.unlistenUpdate(this._akkoProxyNode),this.observerAdapter?this.observerAdapter.observeUpdate((function(){t.compareAndReportUpdated(t._akkoProxyNode,e),t._akkoProxyNode=e,uo.updateProxy(t.displayer,e)})):(this.compareAndReportUpdated(this._akkoProxyNode,e),this._akkoProxyNode=e,uo.updateProxy(this.displayer,e)),this.listenUpdated(this.akkoProxyNode))}},{key:"compareAndReportUpdated",value:function(e,t){var n=this.compareAndGetUpdatedObject(e,t);if(this.observer){for(var r in n){var i=n[r],a=i.value,o=i.kind;this.observer.reportChanged(r,a,o)}this.observer.reportChanged(xo,t,ci.Updated)}this.listeners.dispatchUpdated(n)}},{key:"compareAndGetUpdatedObject",value:function(e,t){var n,r=e.displayerTarget(),i=t.displayerTarget(),a={},o=A(this.valueProperties);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s in r,u=s in i,l="number"==typeof s,h=null;c&&!u?h={isIndex:l,kind:ci.Removed,value:void 0}:!c&&u?h={isIndex:l,kind:ci.Inserted,value:i[s]}:r[s]!==i[s]&&(h={isIndex:l,kind:ci.Updated,value:i[s]}),h&&(a[s]=h)}}catch(e){o.e(e)}finally{o.f()}return a}},{key:"createDisplayer",value:function(e){return new(uo.createClass({classReflection:e.struct.classReflection,getter:this.getProperty,invoker:this.invokeMethod}))(this,e)}},{key:"listenUpdated",value:function(e){var t;null==(t=e.getListeners())||t.listenUpdated({id:this.onAkkoProxyNodeUpdated,listener:this.onAkkoProxyNodeUpdated})}},{key:"unlistenUpdate",value:function(e){var t;null==(t=e.getListeners())||t.unlistenUpdated(this.onAkkoProxyNodeUpdated)}},{key:"touchKey",value:function(e){var t=this.observerAdapter;if(t){if(!this.observer){var n=this._akkoProxyNode.identifier;this.observer=t.create(n,"AkkoDisplayerHolder")}this.observer.reportObservedKey(e)}}}]),e}(),Ho=function(){function e(){I(this,e),this.updatedListeners=[],this.disposedListeners=[]}return M(e,[{key:"listenUpdated",value:function(e){this.updatedListeners.some((function(t){return t.id===e.id}))||this.updatedListeners.push(Object.freeze(Zi({},e)))}},{key:"unlistenUpdated",value:function(e){var t=this.updatedListeners.findIndex((function(t){return t.id===e}));-1!==t&&this.updatedListeners.splice(t,1)}},{key:"listenDisposed",value:function(e){-1===this.disposedListeners.indexOf(e)&&this.disposedListeners.push(e)}},{key:"unlistenDisposed",value:function(e){var t=this.disposedListeners.indexOf(e);-1!==t&&this.disposedListeners.splice(t,1)}},{key:"dispatchUpdated",value:function(e){var t,n=A(this.updatedListeners);try{for(n.s();!(t=n.n()).done;){var r=t.value.listener;try{r(e)}catch(e){console.error(e)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"dispatchDisposed",value:function(){var e,t=A(this.disposedListeners);try{for(t.s();!(e=t.n()).done;){var n=e.value;try{n()}catch(e){console.error(e)}}}catch(e){t.e(e)}finally{t.f()}}}]),e}(),_o=null;or.addListener((function(e,t){_o=t?e.coreFunctions:null}));var Go,Yo=function(){function e(){I(this,e)}return M(e,[{key:"isValidObject",value:function(e){return Io(e)}},{key:"isDisplayerObject",value:function(e){return eo(e)}},{key:"identifier",value:function(e){return e.identifier}},{key:"kind",value:function(e){if(Io(e))return rr.AkkoObject;if(To(e))return rr.FlatObject;if(Ro(e))return rr.Array;if(eo(e))return rr.Displayer;throw new Error("unrecognized proxy node")}},{key:"forEach",value:function(e,t){if(To(e)){var n=e.target();for(var r in n)t(n[r],r)}else if(Ro(e))for(var i=e.target(),a=0;a<i.length;++a)t(i[a],a);else if(Io(e)){var o,s=e.target(),c=A(e.struct.serializableValueProperties);try{for(c.s();!(o=c.n()).done;){var u=o.value;t(s[u],u)}}catch(e){c.e(e)}finally{c.f()}}}},{key:"createObject",value:function(e,t){return _o.creator(t,e)}},{key:"wrapDisplayer",value:function(e,t){return t.displayer}},{key:"unwrapDisplayer",value:function(e,t){return t.__proxy}},{key:"getClassReflection",value:function(e){var t=e;if(eo(t)&&(t=t.__proxy),Io(t))return t.struct.classReflection}},{key:"override",value:function(e,t,n){if(To(e)){for(var r in _o.unwrapper(e))r in t||_o.remover(e,r);for(var i in t)_o.setter(e,i,t[i])}else if(Ro(e)){var a=t,o=_o.getter(e,"length");a.length>o&&_o.caller(e,"splice",[o]);for(var s=0;s<a.length;++s)_o.setter(e,s,a[s])}else if(Io(e)){var c,u=e.proxyRuntime.getAkkoObjectStruct(n),l=A(u.transientValueProperties);try{for(l.s();!(c=l.n()).done;){var h=c.value;_o.remover(e,h)}}catch(e){l.e(e)}finally{l.f()}var d,f=A(u.serializableValueProperties);try{for(f.s();!(d=f.n()).done;){var p=d.value;_o.setter(e,p,t[p])}}catch(e){f.e(e)}finally{f.f()}}}},{key:"displayerPhase",value:function(e){if(eo(e))return to(e);throw new Error("it isn't akko wrapped object")}},{key:"copyDisplayer",value:function(e){return zo(e)}}]),e}();function Xo(e,t,n){return new Ao(e,t,n)}function qo(e,t,n,r){return new Po(e,t,n,r)}function Qo(e,t,n){return new Lo(e,t,n)}or.addListener((function(e,t){Go=t?e.coreFunctions.creator:void 0}));var Ko=function(){function e(t,n){I(this,e),this.decorateObjectEnums=Object.freeze([ht.Object]),this.proxyRuntime=t,this.covertIdToClass=n}return M(e,[{key:"createObject",value:function(e,t){if(t===ht.HangUpObject)return function(e,t,n){return new Fo(e,t,n)}(this.proxyRuntime,e,{});var n=t===ht.Array?[]:{};return Go?Go(n,e):ea(this.proxyRuntime,n,e)}},{key:"findIdentifier",value:function(e){var t=e.identifier;if(void 0===t)throw bo(e)?new Error("can't find identifier of proxy node"):new Error("object should be proxy node");return t}},{key:"findHangUpMetadata",value:function(e){if(!jo(e))throw new Error("it's not hang up object");return e}},{key:"checkObjectEnum",value:function(e){switch(e.kind){case wo.Array:return ht.Array;case wo.AkkoObject:case wo.FlatObject:return ht.Object;case wo.HangUpObject:return ht.HangUpObject;default:throw new Error("unrecognized object")}}},{key:"keys",value:function(e){return Object.keys(e.target())}},{key:"length",value:function(e){if(Ro(e))return e.target().length}},{key:"hasKey",value:function(e,t){return t in e.target()}},{key:"getValue",value:function(e,t){return e.target()[t]}},{key:"setValue",value:function(e,t,n){e.setValue(t,n)}},{key:"completeHangUpObject",value:function(e,t){jo(e)&&e.setHangMetadata(t)}},{key:"decorateObject",value:function(e,t,n,r,i){if(r&&t===lt.AssertedObject){var a=this.covertIdToClass(r.id);if(!a)throw new Tt("can't find class by object format id ".concat(r.id));var o=a[wr];To(e)&&e.covertToAkkoObjectProxyNode(o)}}}]),e}();var Zo=function(){function e(t,n){I(this,e),this.assertObjectFormat=function(e){if(Io(e))return e.struct.classReflection.objectFormat},this.proxyRuntime=t,this.objectAdapter=function(e,t){return new Ko(t,e.covertObjectFormatIdToClass)}(n,t),this.frameSerialization=function(e,t){var n=fi(e.rootClass);return er(new Ft({format:e.format,objectAdapter:t,assertObjectFormat:function(e){if(Io(e))return e.struct.classReflection.objectFormat}}),n)}(n,this.objectAdapter)}return M(e,[{key:"serializeSnapshotFrame",value:function(e){return this.frameSerialization.serializeSnapshotFrame(e)}},{key:"serializeActionFrame",value:function(e,t){return this.frameSerialization.serializeActionFrame(e,t)}},{key:"deserializeSnapshotFrame",value:function(e,t,n){return this.frameSerialization.deserializeSnapshotFrame(e,t,n)}},{key:"deserializeActionFrame",value:function(e,t,n,r){var i=this;return r?this.proxyRuntime.runtime.runWithSerialization(r,(function(){return i.frameSerialization.deserializeActionFrame(e,t,n)})):this.frameSerialization.deserializeActionFrame(e,t,n)}},{key:"createSerialization",value:function(e){return new Ft({format:e,objectAdapter:this.objectAdapter,assertObjectFormat:this.assertObjectFormat})}}]),e}(),Jo=function(){function e(t,n,r){I(this,e),this.runtime=t,this.rootObject=n,this.observerAdapter=r,this._pendingUpdatedRootObject=!1,this.didPenddingRootObject=!1}return M(e,[{key:"initialize",value:function(){this.holder=new Wo(this.rootObject,this.observerAdapter)}},{key:"initializeWithOriginRootObject",value:function(e){this.holder=e.holder,this._pendingUpdatedRootObject?this.didPenddingRootObject=!0:this.holder.akkoProxyNode=this.rootObject}},{key:"pendingUpdatedRootObject",get:function(){return this._pendingUpdatedRootObject},set:function(e){this._pendingUpdatedRootObject!==e&&(this._pendingUpdatedRootObject=e,!e&&this.didPenddingRootObject&&(this.didPenddingRootObject=!1,this.holder.akkoProxyNode=this.rootObject))}},{key:"observerId",get:function(){return this.runtime.observerId}},{key:"displayer",get:function(){return this.holder.displayer}},{key:"target",get:function(){return this.rootObject.target()}},{key:"getRootMethod",value:function(e){return this.rootObject.getMethod(e)}},{key:"snapshotRootObject",value:function(){return this.rootObject}}]),e}(),$o=function(){function e(t){I(this,e),this.params=Object.freeze(Zi({},t)),this.objectOperator=new Yo}return M(e,[{key:"createProxyRuntime",value:function(e,t){return new va(this.objectOperator,e,t,{escapeObjectFilter:this.params.escapeObjectFilter,jsxFactory:this.params.jsxFactory,observerAdapter:this.params.observerAdapter})}}]),e}();function es(e){if(!eo(e))throw new Error("it isn't akko wrapped object");return ir.Rejected!==to(e)}function ts(e,t){return eo(e)?e.__proxy.displayerTarget()instanceof t:bo(e)?e.displayerTarget()instanceof t:e instanceof t}function ns(e){var t=rs(e);if(t===Object)return-1;if(t===Array)return-2;if(void 0===t)return-3;var n=t[wr];return n?n.id:-3}function rs(e){switch(T(e)){case"function":return e;case"object":if(null!==e)return function(e){var t=e.__proxy;switch(function(e){if(Io(e))return rr.AkkoObject;if(To(e))return rr.FlatObject;if(Ro(e))return rr.AkkoObject;if(eo(e))return rr.Displayer;throw new Error("unrecognized proxy node")}(t)){case rr.FlatObject:return Object;case rr.Array:return Array;case rr.AkkoObject:return function(e){var t=e;if(eo(t)&&(t=t.__proxy),Io(t))return t.struct.classReflection}(t).clazz}return e.constructor}(e)}}function is(e){return or.currentNode?function(e){return(new Vo).copyValue(e)}(e):zo(e)}var as=X(n("cr+I")),os=X(n("cr+I")),ss=X(n("cr+I")),cs=X(n("cr+I")),us=X(n("cr+I")),ls=Object.defineProperty,hs=Object.defineProperties,ds=Object.getOwnPropertyDescriptors,fs=Object.getOwnPropertySymbols,ps=Object.prototype.hasOwnProperty,vs=Object.prototype.propertyIsEnumerable,ms=function(e,t,n){return t in e?ls(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},gs=function(e,t){for(var n in t||(t={}))ps.call(t,n)&&ms(e,n,t[n]);if(fs){var r,i=A(fs(t));try{for(i.s();!(r=i.n()).done;){n=r.value;vs.call(t,n)&&ms(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},ys=function(e,t){return hs(e,ds(t))},bs=function(){function e(){I(this,e)}return M(e,[{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new ks(e)}}]),e}(),ks=function(){function e(t){I(this,e),this.callbacks=Object.freeze(this.wrapCallbacks(t))}return M(e,[{key:"wrapCallbacks",value:function(t){var n,r={},i=A(e.callbackKeys);try{var a=function(){var e=n.value,i=t[e];r[e]=i||function(){throw new Error("can't call. ".concat(e," not register"))}};for(i.s();!(n=i.n()).done;)a()}catch(e){i.e(e)}finally{i.f()}return Object.freeze(r)}},{key:"convertIdToUrl",value:function(e){return this.callbacks.convertIdToUrl(e)}}]),e}();ks.callbackKeys=Object.freeze(["convertIdToUrl"]);var ws=function(){function e(){I(this,e),this.paddingResolves=[]}return M(e,[{key:"hasValue",get:function(){return!this.paddingResolves}},{key:"getValueRightNow",value:function(){return this.value}},{key:"getValue",value:function(){var e=this;return this.hasValue?this.error?Promise.reject(this.error):Promise.resolve(this.value):new Promise((function(t,n){return e.paddingResolves.push({resolve:t,reject:n})}))}},{key:"catchError",value:function(e){if(!this.hasValue){var t,n=A(this.paddingResolves);try{for(n.s();!(t=n.n()).done;){(0,t.value.reject)(e)}}catch(e){n.e(e)}finally{n.f()}this.value=void 0,this.error=e,this.paddingResolves=null}return this}},{key:"setValue",value:function(e){if(this.hasValue)throw new Error("did set value");this.value=e,this.error=void 0;var t,n=A(this.paddingResolves);try{for(n.s();!(t=n.n()).done;){(0,t.value.resolve)(e)}}catch(e){n.e(e)}finally{n.f()}return this.paddingResolves=null,this}}]),e}(),Ss=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,n.createMessage(e))).name=e.title,r.title=e.title,r.messages=e.messages?Object.freeze(p(e.messages)):n.emptyArray,r.statusCode=e.statusCode,r.errorCode=e.errorCode,r}return M(n,null,[{key:"createMessage",value:function(e){var t=e.title;return e.messages&&e.messages.length>0&&(t+=": "+e.messages.join("; ")),t}}]),n}(m(Error));Ss.emptyArray=Object.freeze([]);var xs=function(){function e(t,n,r,i){var a=this;I(this,e),this.keyFetcherValue=new ws,this.akkoVersionValue=n,t.getValue().then((function(e){return a.keyFetcherValue.setValue(e.getFetcher(r).fetch(i))})).catch((function(e){return a.keyFetcherValue.catchError(e)}))}var t,n,r;return M(e,[{key:"akkoVersion",get:function(){return this.akkoVersionValue.getValue()}},{key:"fetchJSON",value:(r=l(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyFetcherValue.getValue();case 2:return e.t0=e.sent,e.next=5,(0,e.t0)(t,n);case 5:if(r=e.sent,!this.isSuccessStatus(r,n)){e.next=13;break}return e.next=9,r.text();case 9:return i=e.sent,e.abrupt("return",""===i?void 0:JSON.parse(i));case 13:return e.next=15,this.createError(r);case 15:throw e.sent;case 16:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"fetchBuffer",value:(n=l(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.keyFetcherValue.getValue();case 2:return e.t0=e.sent,e.next=5,(0,e.t0)(t,n);case 5:if(404!==(r=e.sent).status){e.next=8;break}return e.abrupt("return",null);case 8:if(!this.isSuccessStatus(r,n)){e.next=23;break}if(!r.arrayBuffer){e.next=17;break}return e.t2=be,e.next=13,r.arrayBuffer();case 13:e.t3=e.sent,e.t1=(0,e.t2)(e.t3),e.next=22;break;case 17:return e.t4=be,e.next=20,r.buffer();case 20:e.t5=e.sent,e.t1=(0,e.t4)(e.t5);case 22:return e.abrupt("return",e.t1);case 23:return e.next=25,this.createError(r);case 25:throw e.sent;case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"createError",value:(t=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=t.headers.get("content-type"))&&!/application\/json/i.test(n)){e.next=17;break}return e.prev=2,e.next=5,t.json();case 5:r=e.sent,e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(2),e.abrupt("return",new Error("response with status "+t.status+" and parse error JSON failed: "+e.t0.message));case 11:if("object"==T(r.error)&&null!==r.error){e.next=13;break}return e.abrupt("return",new Error("response with status "+t.status+" without error object"));case 13:return i=r.error,a=i.code,o=i.title,s=i.messages,e.abrupt("return",new Ss({statusCode:t.status,errorCode:a,title:o,messages:s}));case 17:return e.t1=Error,e.t2="response with status "+t.status+" with text ",e.next=21,t.text();case 21:return e.t3=e.sent,e.t4=e.t2+e.t3,e.abrupt("return",new e.t1(e.t4));case 24:case"end":return e.stop()}}),e,null,[[2,8]])}))),function(e){return t.apply(this,arguments)})},{key:"isSuccessStatus",value:function(e,t){var n=e.status;switch(t&&t.method||"get"){case"get":return 200===n||206===n;case"delete":return 204===n;default:return 201===n}}}]),e}(),Cs=function(){function e(t,n){I(this,e),this.configmap=t,this.onIngoreFetchError=n,this.fetchers={},this.supportRegions=this.collectRegions(t)}return M(e,[{key:"collectRegions",value:function(e){var t={};for(var n in e)for(var r in e[n].hosts)t[r]=!0;return t}},{key:"getFetcher",value:function(e){var t=this.fetchers[e];if(!t){if(!this.supportRegions[e])throw new Error("invalid region ".concat(JSON.stringify(e)));t=this.fetchers[e]=new Je({fetcher:fetch.bind(window),region:e,configmap:this.configmap,onIngoreFetchError:this.onIngoreFetchError,retryCount:2,retryLoopsCount:0})}return t}}]),e}();function Is(e){if("object"==T(e)&&null!==e){for(var t in e)Is(e[t]);Object.freeze(e)}return e}function Ps(e){if("object"!=T(e)||null===e)return e;if(e instanceof Array){for(var t=[],n=0;n<e.length;++n)t[n]=Ps(e[n]);return t}var r={};for(var i in e)r[i]=Ps(e[i]);return r}var Ms,Ts=new(function(){function e(){I(this,e),this.node=null}var t,n;return M(e,[{key:"getAkkoAppConfigs",value:(n=l(regeneratorRuntime.mark((function e(t,n,r){var i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.node&&this.node.appIdentifier===t||(i=new ws,this.node=Object.freeze({appIdentifier:t,configsValue:i}),this.fetchAkkoAppConfigs(t,n,r).then((function(e){return i.setValue(Is(e))})).catch((function(e){i.catchError(e),setTimeout((function(){return a.node=null}),0)}))),e.t0=Ps,e.next=4,this.node.configsValue.getValue();case 4:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"fetchAkkoAppConfigs",value:(t=l(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=new Cs({api:{hosts:{"*":n}}},r),a=(new ws).setValue(i),o=new ws,s=new xs(a,o,"*","api"),c=(0,as.stringify)({app:t}),e.next=3,s.fetchJSON("https://shunt-api/v5/configs/regions?".concat(c));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}());function As(e,t,n){return Ts.getAkkoAppConfigs(e,t,n)}!function(e){e[e.Ready=0]="Ready",e[e.Setuping=1]="Setuping",e[e.Fail=2]="Fail"}(Ms||(Ms={}));var Es=function(){function e(t){var n=this;I(this,e),this.fetcherPhase=1,this.getAkkoFetcher=function(){var e=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return 2===n.fetcherPhase&&n.setupFetcher(),e.next=3,n.fetchersHubValue.getValue();case 3:return e.abrupt("return",e.sent.getFetcher(t));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onIngoreFetchError=function(e){console.warn("fetch failed but ignore: ".concat(e.message))},this.params=Object.freeze(ys(gs({},t),{shuntApiHosts:Object.freeze(p(t.shuntApiHosts))})),this.akkoVersionValue=new ws,this.setupFetcher()}var t;return M(e,[{key:"create",value:function(e){return new Os(this.fetchersHubValue,this.akkoVersionValue,this.getAkkoFetcher,e)}},{key:"setupFetcher",value:(t=l(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.params,n=t.appIdentifier,r=t.shuntApiHosts,i=t.onInterruptConfigs,a=t.onAkkoSetupFailed,e.prev=1,this.fetchersHubValue=new ws,this.fetcherPhase=1,e.next=5,As(n,r,this.onIngoreFetchError);case 5:o=e.sent,i&&(o=i(o)),this.akkoVersionValue.setValue(o.akkoVersion),this.fetchersHubValue.setValue(new Cs(o.configmap,this.onIngoreFetchError)),this.fetcherPhase=0,e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),this.fetchersHubValue.catchError(new Error("akko setup failed: ".concat(e.t0.message))),this.fetcherPhase=2,a&&a(e.t0);case 12:case"end":return e.stop()}}),e,this,[[1,9]])}))),function(){return t.apply(this,arguments)})}]),e}(),Os=function(){function e(t,n,r,i){I(this,e),this.fetchersHubValue=t,this.akkoVersionValue=n,this.getAkkoFetcher=r,this.region=i}var t,n;return M(e,[{key:"fetch",value:(n=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new xs(this.fetchersHubValue,this.akkoVersionValue,this.region,t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"origin",value:(t=l(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAkkoFetcher(this.region);case 2:return e.abrupt("return",e.sent.origin(t,n));case 3:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"reportSuccess",value:function(e,t){this.getAkkoFetcher(this.region).then((function(n){n.reportSuccess(e,t)}))}},{key:"reportFail",value:function(e,t){this.getAkkoFetcher(this.region).then((function(n){n.reportFail(e,t)}))}},{key:"akkoVersion",get:function(){return this.akkoVersionValue.getValue()}}]),e}(),Rs=function(){function e(t,n){var r=this;I(this,e),this.netState=t,this.onNetStateUpdate=n,this.paddingResolver=[],this._didDispose=!1,this.onOnline=function(){r._isOnline=!0,r.onNetStateUpdate&&r.onNetStateUpdate(!0),r.handleAllPaddingResolver(!0)},this.onOffline=function(){r._isOnline=!1,r.onNetStateUpdate&&r.onNetStateUpdate(!1)},t.addListener(this.listener={onOnline:this.onOnline,onOffline:this.onOffline}),this._isOnline=t.isOnline}return M(e,[{key:"isOnline",get:function(){return this._isOnline}},{key:"didDispose",get:function(){return this._didDispose}},{key:"dispose",value:function(){try{this.handleAllPaddingResolver(!1),this.netState.removeListener(this.listener)}finally{this._didDispose=!0}}},{key:"makeSureOnline",value:function(){var e=this;return this._didDispose?Promise.resolve(!1):this._isOnline?Promise.resolve(!0):new Promise((function(t){e.paddingResolver.push(t)}))}},{key:"handleAllPaddingResolver",value:function(e){var t,n=A(this.paddingResolver.splice(0,this.paddingResolver.length));try{for(n.s();!(t=n.n()).done;){(0,t.value)(e)}}catch(e){n.e(e)}finally{n.f()}}}]),e}();var Ns="undefined"!=typeof WebSocket?WebSocket:r.WebSocket;var Ls=function(){function e(t,n){var r=this,i=n.logger,a=n.timeout,o=n.roomToken,s=n.webSocketQuery,c=n.callbacks;I(this,e),this.disconnectedCallbacks=[],this.actionFramesInterrupter=[],this.snapshotFrameInterrupter=null,this._connectingDuration=-1,this.onReceiveSnapshotFrame=function(e){r.snapshotFrameInterrupter=e},this.onReceiveActionFrame=function(e){r.actionFramesInterrupter?r.actionFramesInterrupter.push(e):r.callbacks.onReceivedActionFrame(e)},this.onReceiveScopeSlices=function(e){r.callbacks.onReceivedScopeSlices(function(e){for(var t=new Zt(e),n=[],r=t.readUint32(),i=0;i<r;++i){var a=t.readInt53(),o=t.readUint32();n.push(Object.freeze({beginScopeId:a,count:o}))}return Object.freeze(n)}(e))},this.onHangUp=function(){r.socket.disconnect(),r.callbacks.onKickWithReason(si.GatewayAdjust)},this.onDisconnect=function(e){var t=e.reason,n=e.message,i=r.isConnected();r._sessionBuild=void 0;var a=t===An.WebSocketError||t===An.CommunicationError;if(r.disconnectedCallback(n,a),i)switch(t){case An.WebSocketError:case An.CommunicationError:r.callbacks.onDisconnectedWithSocketError(new Error(n));break;case An.Normal:r.callbacks.onKickWithReason(n);break;case An.RemoteError:r.callbacks.onDisconnectedByServer(new Error(n))}};var u="".concat(t,"?").concat(function(e,t){var n={room:t.uuid,token:e,combinable:!0,sessionToken:t.sessionToken,akkoVersion:t.akkoVersion,clientVersion:t.clientVersion,markWritable:t.markWritable,access:t.access};for(var r in n)void 0===n[r]&&delete n[r];return(0,os.stringify)(n)}(o,s)),l=new Ns(u);this.logger=i,this.timeout=a,this.uuid=s.uuid,this.libraryDescriptionSerialization=new Ii,this.socket=Ei.createSocket(l,i,{onDisconnect:this.onDisconnect}),this.socket.on("snapshot",this.onReceiveSnapshotFrame),this.socket.on("action",this.onReceiveActionFrame),this.socket.on("allocate-scope",this.onReceiveScopeSlices),this.socket.on("hang-up",this.onHangUp),this.callbacks=Object.freeze(gs({},c))}var t,n;return M(e,[{key:"connectingDuration",get:function(){return this._connectingDuration}},{key:"setAccessUpdaterSerialization",value:function(e){this.accessUpdaterSerialization=e}},{key:"bindPingPongNode",value:function(e){e.bindSocket(this.socket)}},{key:"sessionBuild",get:function(){if(!this._sessionBuild)throw new Error("not connected");return this._sessionBuild}},{key:"sendActionFrame",value:function(e){this.socket.emit("action",e)}},{key:"isConnected",value:function(){return!!this._sessionBuild}},{key:"connect",value:function(){var e=this;return new Promise((function(t,n){var r=function(){var t=e.disconnectedCallbacks.indexOf(a);-1!==t&&e.disconnectedCallbacks.splice(t,1),null!==i&&(clearTimeout(i),i=null),e.socket.off("session-build",o)},i=setTimeout((function(){r(),n(new Error("receive session-build event timeout"))}),e.timeout),a=function(e,i){r(),i?t(e):n(new Error("connect failed: ".concat(e)))};e.disconnectedCallbacks.push(a);var o=function(n){r();var i=e.snapshotFrameInterrupter,a=e.actionFramesInterrupter;e._sessionBuild=function(e){var t=new Zt(e),n=t.readString(),r=t.readString(),i=t.readString();return Object.freeze({session:n,sessionToken:r,slice:i})}(n),e.snapshotFrameInterrupter=null,e.actionFramesInterrupter=null,t({snapshot:i,actionFrames:a})};e.socket.on("session-build",o),e.socket.on("library-description",(function t(n){var r=e.libraryDescriptionSerialization.deserialize(n);e.callbacks.onReceivedLibraryDescription(r),e.socket.off("library-description",t)})),e.socket.waitToConnected().then((function(t){var n=t.duration;return e._connectingDuration=n})).catch((function(t){e.logger.warn(t.message),a(t.message,!0)}))}))}},{key:"disconnect",value:function(){return this.disconnectedCallback("disconnect",!1),this.socket.disconnect()}},{key:"disconnectWithError",value:function(e){return this.disconnectedCallback(e.message,!1),this.socket.disconnectWithErrorDescription({message:e.message})}},{key:"updateToWritable",value:(n=l(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={kind:ui.Writable,userPayload:t,connectedPayload:n},this.socket.emit("update-access",this.accessUpdaterSerialization.serialize(r)),e.next=4,this.interruptEvent("allocate-user",[Ai.WritableAccessForbidden,Ai.StuffedOfWritableUsers,Ai.WrongWritablePhase]);case 4:if(void 0===(i=e.sent).errorCode){e.next=12;break}e.t0=i.errorCode,e.next=e.t0===Ai.WritableAccessForbidden?9:e.t0===Ai.StuffedOfWritableUsers?10:e.t0===Ai.WrongWritablePhase?11:12;break;case 9:throw new Error("can't update to writable. you don't have permission");case 10:throw new Error("room is stuffed of writable users");case 11:throw new Error("it's wrong writable phase");case 12:return e.abrupt("return",void 0!==i.target?xi(i.target):null);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"updateToReadonly",value:(t=l(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={kind:ui.Readonly,payload:t},this.socket.emit("update-access",this.accessUpdaterSerialization.serialize(n)),e.next=4,this.interruptEvent("release-user",[Ai.NoUserToRelease,Ai.WrongWritablePhase]);case 4:if(void 0===(r=e.sent).errorCode){e.next=11;break}e.t0=r.errorCode,e.next=e.t0===Ai.NoUserToRelease?9:e.t0===Ai.WrongWritablePhase?10:11;break;case 9:throw new Error("room don't have user to release");case 10:throw new Error("it's wrong writable phase");case 11:return e.abrupt("return",void 0!==r.target);case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"disconnectedCallback",value:function(e,t){var n,r=A(this.disconnectedCallbacks.splice(0));try{for(r.s();!(n=r.n()).done;){(0,n.value)(e,t)}}catch(e){r.e(e)}finally{r.f()}}},{key:"interruptEvent",value:function(e,t){var n=this;return new Promise((function(r){var i=function(){var t=n.disconnectedCallbacks.indexOf(a);-1!==t&&n.disconnectedCallbacks.splice(t,1),n.socket.off(e,o),n.socket.off("error",s)},a=function(){i(),r({})};n.disconnectedCallbacks.push(a);var o=function(e){i(),r({target:e})},s=function(e){-1!==t.indexOf(e)&&(i(),r({errorCode:e}))};n.socket.on(e,o),n.socket.on("error",s)}))}}]),e}(),js=function(){function e(){I(this,e),this.switchOn=!0}return M(e,[{key:"wrapCallbacks",value:function(e){var t=this,n={},r=function(r){var i=e[r];n[r]="function"==typeof i?function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];if(t.switchOn)return i.apply(n,r)}:i};for(var i in e)r(i);return Object.freeze(n)}}]),e}(),Ds=Object.freeze([1e3,1e3,1e3,3e3,3e3,5e3,5e3]);function Fs(e){return new Promise((function(t){return setTimeout(t,e)}))}var zs=function(){function e(t,n,r){var i=this;I(this,e),this._didDispose=!1,this.connectionTask=null,this.operator=null,this.connectionNode=null,this.onNetStateUpdate=function(e){i._didDispose||(e?i.connectionTask&&i.startConnectionTask():i.operator&&(i.operator.cancel(),i.operator=null))},this.logger=t,this.fetcher=n,this.netStatePaddingNode=r&&new Rs(r,this.onNetStateUpdate)}var t;return M(e,[{key:"dispose",value:function(){this._didDispose||(this._didDispose=!0,this.operator&&this.operator.cancel(),this.connectionTask=null,this.operator=null,this.netStatePaddingNode&&this.netStatePaddingNode.dispose())}},{key:"connect",value:(t=l(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._didDispose){e.next=2;break}throw new Error("did dispose");case 2:if(!this.connectionTask){e.next=4;break}throw new Error("is connecting");case 4:if(this.connectionNode&&(this.connectionNode.filter.switchOn=!1,this.connectionNode=null),e.t0=this.netStatePaddingNode,!e.t0){e.next=10;break}return e.next=9,this.netStatePaddingNode.makeSureOnline();case 9:e.t0=!e.sent;case 10:if(!e.t0){e.next=12;break}throw new Error("offline");case 12:return n=new Promise((function(e,n){var i=new js;r.connectionTask={resolve:e,reject:n,filter:i,params:ys(gs({},t),{callbacks:i.wrapCallbacks(t.callbacks)})}})),this.startConnectionTask(),e.prev=14,e.next=17,n;case 17:return e.abrupt("return",e.sent);case 18:return e.prev=18,this.connectionTask=null,e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[14,,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"startConnectionTask",value:function(){var e=this,t=new Bs(this.logger,this.fetcher),n=this.connectionTask,r=n.params,i=n.filter,a=n.resolve,o=n.reject;this.operator=t,this.operator.connect(r).then((function(n){n&&t===e.operator&&(a(n),e.operator=null,e.connectionNode={filter:i,connection:n.connection})})).catch((function(n){t===e.operator&&(o(n),e.operator=null)}))}}]),e}(),Bs=function(){function e(t,n){I(this,e),this.logger=t,this.fetcher=n,this.connection=null,this.isCancel=!1}var t;return M(e,[{key:"connect",value:(t=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="",r=0;case 2:if(!(r<Ds.length+1)){e.next=33;break}return e.next=5,this.fetcher.origin("wss","realtime");case 5:return i=e.sent,a=Date.now(),this.connection=new Ls(i,t),o=Date.now(),e.next=11,this.connection.connect();case 11:if(s=e.sent,!this.isCancel){e.next=19;break}if(this.fetcher.reportSuccess("realtime",Date.now()-a),e.t0=s&&this.connection,!e.t0){e.next=18;break}return e.next=18,this.connection.disconnectWithError(new Error("cancel connect"));case 18:return e.abrupt("return",null);case 19:if("object"!=T(s)){e.next=21;break}return e.abrupt("return",(this.fetcher.reportSuccess("realtime",Date.now()-a),{connection:this.connection,snapshot:s.snapshot,actionFrames:s.actionFrames,retryCount:r}));case 21:if(this.fetcher.reportFail("realtime",Date.now()-a),n=s,this.connection=null,c=Ds[r],e.t1=void 0!==c&&o+c-Date.now()>0,!e.t1){e.next=28;break}return e.next=27,Fs(c);case 27:e.t1=this.isCancel;case 28:if(!e.t1){e.next=30;break}return e.abrupt("return",null);case 30:++r,e.next=2;break;case 33:throw new Error("connect fail after multiple retries: "+n);case 34:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"cancel",value:function(){var e=this;this.connection&&(this.connection.disconnectWithError(new Error("cancel connect")).catch((function(t){return e.logger.error(t)})),this.connection=null),this.isCancel=!0}}]),e}();function Us(e){var t=hi(e);if(!t)throw new Error("can't find library from ".concat(e.name,". it's not root class"));return t}var Vs=function(){};function Ws(e){return Hs.apply(this,arguments)}function Hs(){return(Hs=l(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Gs(t),e.next=3,n.connect();case 3:return r=e.sent,e.abrupt("return",{session:n,snapshot:r.snapshot,actionFrames:r.actionFrames,connection:r.connection,retryCount:r.retryCount});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _s,Gs=function(){function e(t){var n=this;I(this,e),this.connectingResult=null,this._connection=null,this._libraryNode=null,this.onDisconnectedByServer=function(e){n._connection=null,n._libraryNode=null,n.callbacks.onDisconnectedByServer&&n.callbacks.onDisconnectedByServer(e)},this.onKickWithReason=function(e){n._connection=null,n._libraryNode=null,n.reconnectionOptions.disableReconnect||e!==si.GatewayAdjust&&e!==si.RoomZombie?n.callbacks.onKickWithReason&&n.callbacks.onKickWithReason(e):n.startReconnect(new Error("room became zombie"))},this.onDisconnectedWithSocketError=function(){var e=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n._connection=null,n._libraryNode=null,!n.reconnectionOptions.disableReconnect){e.next=6;break}n.callbacks.onDisconnectedWithSocketError&&n.callbacks.onDisconnectedWithSocketError(t),e.next=8;break;case 6:return e.next=8,n.startReconnect(t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.logger=t.logger,this.uuid=t.uuid,this.roomToken=t.roomToken,this.timeout=t.timeout,this.markWritable=t.markWritable,this.clientVersion=t.clientVersion,this.reconnectionOptions=t.reconnectionOptions,this.access=t.access,this.objectOperator=t.objectOperator,this.libraryNodeFetcher=t.libraryNodeFetcher,this.connectionBuilder=new zs(t.logger,t.fetcher,t.netState),this.callbacks=Object.freeze(gs({},t.callbacks))}var t,n;return M(e,[{key:"session",get:function(){return this.sessionBuild.session}},{key:"slice",get:function(){return this.sessionBuild.slice}},{key:"connection",get:function(){return this._connection}},{key:"libraryNode",get:function(){return this._libraryNode}},{key:"dispose",value:function(){this.connectionBuilder.dispose()}},{key:"connect",value:(n=l(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connectingResult){e.next=2;break}throw new Error("WebSocketSession is connecting");case 2:return t=new ws,n=this.connectingResult=new ws,e.prev=3,e.next=6,this.connectionBuilder.connect({logger:this.logger,roomToken:this.roomToken,timeout:this.timeout,webSocketQuery:{uuid:this.uuid,akkoVersion:We,clientVersion:this.clientVersion,markWritable:this.markWritable,access:this.access,sessionToken:this.sessionBuild&&this.sessionBuild.sessionToken},callbacks:{onReceivedLibraryDescription:this.createLibraryDescriptionReceiver(t),onReceivedActionFrame:this.callbacks.onReceivedActionFrame||Vs,onReceivedScopeSlices:this.callbacks.onReceivedScopeSlices||Vs,onDisconnectedByServer:this.onDisconnectedByServer,onKickWithReason:this.onKickWithReason,onDisconnectedWithSocketError:this.onDisconnectedWithSocketError}});case 6:return r=e.sent,this.sessionBuild&&(i=r.connection.sessionBuild,a=i.session,o=i.slice,this.callbacks.onSessionUpdate&&this.sessionBuild.session!==a&&this.callbacks.onSessionUpdate(a),this.callbacks.onSliceUpdate&&this.sessionBuild.slice!==o&&this.callbacks.onSliceUpdate(o)),this._connection=r.connection,e.next=11,t.getValue();case 11:return this._libraryNode=e.sent,this.sessionBuild=r.connection.sessionBuild,this._connection.setAccessUpdaterSerialization(new Ci(this.objectOperator,Us(this._libraryNode.libraryClass))),this.connectingResult=null,n.setValue(r),e.abrupt("return",r);case 19:throw e.prev=19,e.t0=e.catch(3),t.catchError(e.t0),n.catchError(e.t0),e.t0;case 22:case"end":return e.stop()}}),e,this,[[3,19]])}))),function(){return n.apply(this,arguments)})},{key:"reconnectWithError",value:function(e){this._connection&&(this._connection.disconnect(),this._connection=null,this._libraryNode=null),this.startReconnect(e)}},{key:"createLibraryDescriptionReceiver",value:function(e){var t=this;return function(){var n=l(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.t0=e,n.next=4,t.libraryNodeFetcher(r);case 4:n.t1=n.sent,n.t0.setValue.call(n.t0,n.t1),n.next=11;break;case 8:n.prev=8,n.t2=n.catch(0),e.catchError(n.t2);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}()}},{key:"startReconnect",value:(t=l(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connectingResult){e.next=5;break}return e.next=3,this.connectingResult.getValue();case 3:e.next=0;break;case 5:return e.prev=5,n=this.callbacks,r=n.onBeginReconnect,i=n.onReconnected,r&&Promise.resolve().then((function(){return r(t)})),e.next=10,this.connect();case 10:a=e.sent,i&&Promise.resolve().then((function(){return i(a)})),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(5),this.callbacks.onDisconnectedWithSocketError&&this.callbacks.onDisconnectedWithSocketError(e.t0);case 17:case"end":return e.stop()}}),e,this,[[5,14]])}))),function(e){return t.apply(this,arguments)})}]),e}(),Ys=Object.freeze({disableReconnect:!1});!function(e){e[e.Success=0]="Success",e[e.Break=1]="Break"}(_s||(_s={}));var Xs=function(){function e(t){var n=this;I(this,e),this.idle=De({timeout:800,checkingTimeMod:2,maxPaddingDuration:1600,maxInvokingDuration:100}),this.nextId=0,this.socket=null,this.pingProgress=null,this.promiseSleep=null,this.deltaTime=void 0,this.latestAdjustedTimestamp=0,this.isFirstAdjustedTime=!0,this.onPong=function(e){var t=Mi(e),r=t.id,i=t.timestamp;if(n.pingProgress){var a=n.pingProgress,o=a.id,s=a.padding,c=a.timer,u=a.timestamp;if(o===r){clearTimeout(c);var l,h={remoteTimestamp:i,shouldBreak:!1,sendAt:u,receivedAt:Date.now()},d=A(s);try{for(d.s();!(l=d.n()).done;){(0,l.value.resolve)(h)}}catch(e){d.e(e)}finally{d.f()}n.pingProgress=null}}},this.onPingFailed=t}var t,n,r;return M(e,[{key:"calibrationTimestamp",get:function(){if(void 0===this.deltaTime)return Date.now();var e=Math.max(this.latestAdjustedTimestamp,Date.now()+this.deltaTime);return this.latestAdjustedTimestamp=e,e}},{key:"bindSocket",value:function(e){this.socket&&this.unbindSocket(),this.socket=e,this.socket.on("pong",this.onPong),this.handleStartPingLoop().catch(this.onPingFailed)}},{key:"unbindSocket",value:function(){if(this.socket&&(this.socket.off("pong",this.onPong),this.socket=null),this.promiseSleep&&(clearTimeout(this.promiseSleep.sleepTimer),this.promiseSleep.resolve(1),this.promiseSleep=null),this.pingProgress){var e,t={shouldBreak:!0,remoteTimestamp:0,sendAt:0,receivedAt:0},n=A(this.pingProgress.padding);try{for(n.s();!(e=n.n()).done;){(0,e.value.resolve)(t)}}catch(e){n.e(e)}finally{n.f()}this.pingProgress=null}}},{key:"handleStartPingLoop",value:(r=l(regeneratorRuntime.mark((function t(){var n,r=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=regeneratorRuntime.mark((function t(){var n,i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=0,i=0,t.next=4,r.doProgress(r.onPingFailed,l(regeneratorRuntime.mark((function e(){var t,a,o,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.startPing();case 2:if(t=e.sent,a=t.shouldBreak,o=t.remoteTimestamp,s=t.sendAt,c=t.receivedAt,!a){e.next=9;break}return e.abrupt("return",1);case 9:return u=c-s,e.abrupt("return",(n+=o+u/2-c,i+=1,r.isFirstAdjustedTime&&r.updateDeltaTime(Math.floor(n/i)),0));case 11:case"end":return e.stop()}}),e)}))));case 4:if(a=t.sent,t.t0=1===a,t.t0){t.next=12;break}return r.isFirstAdjustedTime?r.isFirstAdjustedTime=!1:i>=(e.processTimeIntervalList.length+1)/2&&r.updateDeltaTime(Math.floor(n/i)),t.next=10,r.sleep(r.withFloatRate(e.processInterval));case 10:a=t.sent,t.t0=1===a;case 12:if(!t.t0){t.next=14;break}return t.abrupt("return","break");case 14:case"end":return t.stop()}}),t)}));case 1:if(!this.socket){t.next=8;break}return t.delegateYield(n(),"t0",3);case 3:if("break"!==t.t0){t.next=6;break}return t.abrupt("break",8);case 6:t.next=1;break;case 8:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)})},{key:"updateDeltaTime",value:function(e){this.deltaTime=e}},{key:"doProgress",value:(n=l(regeneratorRuntime.mark((function t(n,r){var i,a,o,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=0,t.prev=1,t.next=4,r();case 4:i=t.sent,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(1),n(t.t0);case 10:if(0!==i){t.next=43;break}a=A(e.processTimeIntervalList),t.prev=12,a.s();case 14:if((o=a.n()).done){t.next=35;break}return s=o.value,t.prev=16,t.next=19,this.sleep(this.withFloatRate(s));case 19:if(i=t.sent,t.t1=1===i,t.t1){t.next=26;break}return t.next=24,r();case 24:i=t.sent,t.t1=1===i;case 26:if(!t.t1){t.next=28;break}return t.abrupt("break",35);case 28:t.next=33;break;case 30:t.prev=30,t.t2=t.catch(16),n(t.t2);case 33:t.next=14;break;case 35:t.next=40;break;case 37:t.prev=37,t.t3=t.catch(12),a.e(t.t3);case 40:return t.prev=40,a.f(),t.finish(40);case 43:return t.abrupt("return",i);case 44:case"end":return t.stop()}}),t,this,[[1,7],[12,37,40,43],[16,30]])}))),function(e,t){return n.apply(this,arguments)})},{key:"startPing",value:(t=l(regeneratorRuntime.mark((function t(){var n,r,i,a,o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.pingProgress){t.next=4;break}n=this.pingProgress.id,r=this.pingProgress.padding,t.next=14;break;case 4:return i=Date.now(),a=setTimeout((function(){return o.onPongTimeout(n)}),e.pongTimeout),n=this.getNextId(),r=[],this.pingProgress={id:n,timer:a,timestamp:i,padding:r},t.prev=6,t.next=9,this.idle.invokeOnIdle((function(){o.socket&&o.socket.emit("ping",Pi({id:n,timestamp:i}))}));case 9:t.next=14;break;case 11:throw t.prev=11,t.t0=t.catch(6),this.pingProgress&&(clearTimeout(a),this.pingProgress=null),t.t0;case 14:return t.next=16,new Promise((function(e,t){r.push({resolve:e,reject:t})}));case 16:return t.abrupt("return",t.sent);case 17:case"end":return t.stop()}}),t,this,[[6,11]])}))),function(){return t.apply(this,arguments)})},{key:"onPongTimeout",value:function(e){if(this.pingProgress){var t=this.pingProgress,n=t.id,r=t.padding;if(n===e){var i,a=new Error("pong timeout"),o=A(r);try{for(o.s();!(i=o.n()).done;){(0,i.value.reject)(a)}}catch(e){o.e(e)}finally{o.f()}this.pingProgress=null}}}},{key:"getNextId",value:function(){this.nextId>e.maxId&&(this.nextId=0);var t=this.nextId;return this.nextId+=1,t}},{key:"withFloatRate",value:function(t){var n=1-e.timeFloatRate+2*e.timeFloatRate*Math.random();return Math.floor(n*t)}},{key:"sleep",value:function(e){var t=this;if(this.promiseSleep)throw new Error("did call sleep");return new Promise((function(n){var r=setTimeout((function(){t.promiseSleep=null,n(0)}),e);t.promiseSleep={resolve:n,sleepTimer:r}}))}}]),e}();Xs.maxId=Math.pow(2,32)-1,Xs.pongTimeout=6e3,Xs.timeFloatRate=.35,Xs.processInterval=3e5,Xs.processTimeIntervalList=Object.freeze([5e3,7e3,12e3,15e3]);var qs,Qs,Ks=function(){function e(t){var n=this;I(this,e),this.invoker=t,this.animationFrameId=null,this.shouldInvokeNextFrame=!1,this.blockInvoke=!1,this.fireTick=function(){if(n.shouldInvokeNextFrame)try{n.invoker()}catch(e){console.error(e)}n.shouldInvokeNextFrame=!1,n.blockInvoke=!1,n.animationFrameId=null}}return M(e,[{key:"invoke",value:function(){if(this.blockInvoke)this.shouldInvokeNextFrame=!0;else{try{this.invoker()}catch(e){console.error(e)}null===this.animationFrameId&&(this.animationFrameId=window.requestAnimationFrame(this.fireTick)),this.blockInvoke=!0}}}]),e}();!function(e){e.Playing="playing",e.Pausing="pausing",e.PausingAndWaiting="pausingAndWaiting",e.Waiting="waiting",e.Ended="ended"}(qs||(qs={})),function(e){e[e.AutoBlockNewFrames=0]="AutoBlockNewFrames",e[e.DoNotBlockNewFrames=1]="DoNotBlockNewFrames"}(Qs||(Qs={}));var Zs,Js=function(){function e(){I(this,e),this.blockMode=1,this.queue=[],this.blockIndex=this.queue.length}return M(e,[{key:"hasFrames",get:function(){return this.queue.length>0}},{key:"hasAccessibleFrames",get:function(){return this.blockIndex>0}},{key:"hasBlockedFrames",get:function(){return this.queue.length>this.blockIndex}},{key:"accessibleLength",get:function(){return this.blockIndex}},{key:"rearFrame",get:function(){return this.frameAt(0)}},{key:"latestFrameIncludesBlocked",get:function(){var e;return null==(e=this.queue[this.queue.length-1])?void 0:e.proto}},{key:"blockedFrame",get:function(){var e;return null==(e=this.queue[this.blockIndex])?void 0:e.proto}},{key:"blockedReceivedAt",get:function(){var e=this.queue[this.blockIndex];return e?e.receivedAt:-1}},{key:"timeInterval",get:function(){if(this.blockIndex>0){var e=this.queue[this.blockIndex-1],t=this.queue[0];return e.proto.timestamp-t.proto.timestamp}return 0}},{key:"timeIntervalBefore",value:function(e){var t,n=0,r=null==(t=this.queue[0])?void 0:t.proto.timestamp;if(void 0!==r){for(var i=-1,a=this.blockIndex-1;a>=0;--a){var o=this.queue[a];if(o.proto.timestamp<=e){i=o.proto.timestamp;break}}-1!==i&&(n=i-r)}return n}},{key:"frameAt",value:function(e){if(e<this.blockIndex)return this.queue[e].proto}},{key:"push",value:function(e){var t=Date.now();1===this.blockMode&&(this.blockIndex+=e.length);var n,r=A(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.queue.push({proto:i,receivedAt:t})}}catch(e){r.e(e)}finally{r.f()}}},{key:"shift",value:function(){var e;if(this.frameAt(0))return this.blockIndex-=1,null==(e=this.queue.shift())?void 0:e.proto}},{key:"unblockOneFrame",value:function(){this.blockIndex<this.queue.length&&(this.blockIndex+=1)}}]),e}();!function(e){e.Realtime="realtime",e.Reconstruction="reconstruction"}(Zs||(Zs={}));var $s=function(){function e(t){var n=this;I(this,e),this.framesQueue=new Js,this.isPlaying=!1,this._didCompletePushFrames=!1,this.didCompletePlaying=!1,this.handleTickEvent=function(){try{n.onTick()}finally{n.shouldTickNextFrame()&&n.tickLimiter.invoke(),n.phaseNode.touch()}},this.currentPhase=function(){return n.didCompletePlaying?qs.Ended:n._didCompletePushFrames||n.framesQueue.hasAccessibleFrames?n.isPlaying?qs.Playing:qs.Pausing:n.isPlaying?qs.Waiting:qs.PausingAndWaiting},this.onPhaseChanged=function(e,t){t===qs.Playing&&e!==qs.Playing?n.onPlayingStop():t!==qs.Playing&&e===qs.Playing&&n.onPlayingContinue(),n.callbacks.onPhaseChanged&&n.callbacks.onPhaseChanged(e)},this.logger=t.logger,this.mode=t.mode,this.callbacks=Object.freeze(gs({},t.callbacks));var r=t.enableAnimationFrame,i=t.frameInterval,a=void 0===i?17:i,o=t.remainLowTimeInterval,s=void 0===o?12e3:o;if(r){var c=new Ks(this.handleTickEvent);this.tickLimiter=new Be(a,(function(){return c.invoke()}))}else this.tickLimiter=new Be(a,this.handleTickEvent);this.remainLowTimeInterval=s,this.phaseNode=new Kr({getCurrentPhase:this.currentPhase,onPhaseChanged:this.onPhaseChanged})}return M(e,[{key:"didCompletePushFrames",get:function(){return this._didCompletePushFrames}},{key:"completePlaying",value:function(){this.didCompletePlaying=!0,this.phaseNode.touch(),this.tickLimiter.cancel()}},{key:"frameInterval",get:function(){return this.tickLimiter.limitDuration},set:function(e){this.tickLimiter.limitDuration=e}},{key:"phase",get:function(){return this.phaseNode.phase}},{key:"shouldTickNextFrame",value:function(){return!this.didCompletePlaying&&(!!this.willTickEveryFrames||!(!this.isPlaying||!this.framesQueue.hasFrames))}},{key:"pushFrames",value:function(e){this.framesQueue.push(e),e.length>0&&this.isPlaying&&this.tickLimiter.invoke(),this.phaseNode.touch()}},{key:"play",value:function(){!this.isPlaying&&this.phaseNode.phase!==qs.Ended&&(this.isPlaying=!0,this.framesQueue.hasAccessibleFrames&&this.tickLimiter.invoke(),this.phaseNode.touch())}},{key:"pause",value:function(){this.isPlaying&&(this.isPlaying=!1,this.tickLimiter.cancel(),this.phaseNode.touch())}},{key:"completePushFrames",value:function(){this._didCompletePushFrames=!0,this.framesQueue.hasAccessibleFrames||(this.didCompletePlaying=!0,this.tickLimiter.cancel()),this.phaseNode.touch()}}]),e}(),ec=function(){function e(t,n){I(this,e),this.lastTimestamp=0,this.targetValue=t,this._momentValue=t,this.halfLifeInterval=n}return M(e,[{key:"value",get:function(){return this.targetValue},set:function(e){this.targetValue!==e&&(this.targetValue!==this._momentValue&&this.refreshMomentValue(),this.targetValue=e)}},{key:"momentValue",get:function(){return this.targetValue!==this._momentValue&&this.refreshMomentValue(),this._momentValue}},{key:"refreshMomentValue",value:function(){var t,n=Date.now(),r=n-this.lastTimestamp;if(r>this.halfLifeInterval*e.convergenceTimes)t=this.targetValue;else{var i=Math.pow(.5,r/this.halfLifeInterval);t=this._momentValue*i+this.targetValue*(1-i),Math.abs(t-this.targetValue)<e.minNumber&&(t=this.targetValue)}this._momentValue=t,this.lastTimestamp=n}}]),e}();ec.convergenceTimes=6,ec.minNumber=.01;var tc=Object.freeze([Object.freeze({duration:1200,rate:1}),Object.freeze({duration:1e3,rate:.75}),Object.freeze({duration:3e3,rate:.5}),Object.freeze({duration:5e3,rate:.25})]);var nc,rc=function(){var e,t=0,n=A(tc);try{for(n.s();!(e=n.n()).done;){t+=e.value.duration}}catch(e){n.e(e)}finally{n.f()}return t}(),ic=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).latestTimestamp=null,r.syncDelta=null,r.framesQueue.blockMode=Qs.AutoBlockNewFrames,r.frameDelayGradient=new ec(e.frameDelay||0,1200),r}return M(n,[{key:"frameDelay",get:function(){return this.frameDelayGradient.value},set:function(e){this.frameDelayGradient.value=e}},{key:"isPlaybackSpeedModifiable",get:function(){return!1}},{key:"playbackSpeed",get:function(){return 1},set:function(e){}},{key:"willTickEveryFrames",get:function(){return!1}},{key:"syncBlockTimestamp",value:function(e){var t=e-Date.now();this.syncDelta?this.syncDelta.value=t:this.syncDelta=new ec(t,1200)}},{key:"stopBlockTimestamp",value:function(){this.syncDelta=null}},{key:"onPlayingContinue",value:function(){}},{key:"onPlayingStop",value:function(){}},{key:"onTick",value:function(){var e=Date.now(),t=[];if(this.unblockFramesIfNeed(e),this.fillOverIntervalFrames(e,t),this.fillShouldPlayFrames(e,t),this.playFrames(t),this.callbacks.onBufferRemainLow&&this.latestTimestamp&&!this.didCompletePushFrames){var n=0;if(this.framesQueue.hasAccessibleFrames)n=this.framesQueue.latestFrameIncludesBlocked.timestamp-this.latestTimestamp.ack;n<this.remainLowTimeInterval&&this.callbacks.onBufferRemainLow()}}},{key:"unblockFramesIfNeed",value:function(e){if(this.syncDelta)for(var t=e+this.syncDelta.momentValue;this.framesQueue.hasBlockedFrames&&this.framesQueue.blockedFrame.timestamp<=t;)this.framesQueue.unblockOneFrame();else for(;this.framesQueue.hasBlockedFrames;){if(!(e>=this.framesQueue.blockedReceivedAt+this.frameDelayGradient.momentValue))break;this.framesQueue.unblockOneFrame()}}},{key:"fillOverIntervalFrames",value:function(e,t){for(;this.framesQueue.timeInterval>rc;)t.push(this.framesQueue.shift());t.length>0&&this.updateLatestTimestamp(e,t[t.length-1])}},{key:"fillShouldPlayFrames",value:function(e,t){for(var n=function(e){var t,n=e,r=A(tc);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(n<=i.duration)return i.rate;n-=i.duration}}catch(e){r.e(e)}finally{r.f()}throw new Error("durationTime is too large:"+n)}(this.framesQueue.timeIntervalBefore(e));this.framesQueue.hasAccessibleFrames;){var r=this.framesQueue.rearFrame,i=!1;if(this.latestTimestamp){var a=r.timestamp-this.latestTimestamp.ack,o=this.latestTimestamp.device+a*n;i=e+this.frameInterval>=o}else i=!0;if(!i)break;t.push(this.framesQueue.shift()),this.updateLatestTimestamp(e,r)}}},{key:"playFrames",value:function(e){if(e.length>0)try{this.callbacks.onPlayActionFrames&&this.callbacks.onPlayActionFrames(e)}catch(e){this.logger.error(e)}}},{key:"updateLatestTimestamp",value:function(e,t){var n=t.timestamp;this.latestTimestamp?(this.latestTimestamp.ack=n,this.latestTimestamp.device=e):this.latestTimestamp={ack:n,device:e}}}]),n}($s),ac=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).frameDelay=0,r._playbackSpeed=1,r.endFrameTimestamp=e.endFrameTimestamp,r.anchor={deviceTimestamp:Date.now(),playerTimestamp:e.initFrameTimestamp},r}return M(n,[{key:"syncBlockTimestamp",value:function(e){}},{key:"stopBlockTimestamp",value:function(){}},{key:"play",value:function(){c(C(n.prototype),"play",this).call(this);var e=this.callbacks.onBufferRemainLow;e&&this.isBufferRemainLow&&Promise.resolve().then(e).catch((function(e){return console.error(e)}))}},{key:"isPlaybackSpeedModifiable",get:function(){return!0}},{key:"playbackSpeed",get:function(){return this._playbackSpeed},set:function(e){if(e<0)throw new Error("invalid playback speed ".concat(e,". it shouldn't be nagative number"));if(Number.isNaN(e)||e===1/0)throw new Error("invalid playback speed. it can not be ".concat(e));this._playbackSpeed!==e&&(this.phase===qs.Playing&&this.refreshAnchor(this._playbackSpeed),this._playbackSpeed=e)}},{key:"willTickEveryFrames",get:function(){return!0}},{key:"onPlayingContinue",value:function(){this.refreshAnchor(0)}},{key:"onPlayingStop",value:function(){this.refreshAnchor(this._playbackSpeed)}},{key:"onTick",value:function(){for(var e=[],t=this.playbackSpeed*(Date.now()-this.anchor.deviceTimestamp+this.frameInterval),n=this.anchor.playerTimestamp+t;this.framesQueue.hasAccessibleFrames&&this.framesQueue.rearFrame.timestamp<=n;)e.push(this.framesQueue.shift());if(e.length>0)try{this.callbacks.onPlayActionFrames&&this.callbacks.onPlayActionFrames(e)}catch(r){this.logger.error(r)}if(this.callbacks.onTick)if(e.length>0){var r=e[e.length-1],i=Math.max(this.anchor.playerTimestamp,r.timestamp);this.callbacks.onTick(i,!1)}else this.callbacks.onTick(n,!0);this.callbacks.onBufferRemainLow&&!this.didCompletePushFrames&&this.isBufferRemainLow&&this.callbacks.onBufferRemainLow(),this.didCompletePushFrames&&0===e.length&&void 0!==this.endFrameTimestamp&&n>=this.endFrameTimestamp&&this.completePlaying()}},{key:"refreshAnchor",value:function(e){var t=Date.now(),n=e*(t-this.anchor.deviceTimestamp);this.anchor={deviceTimestamp:t,playerTimestamp:this.anchor.playerTimestamp+n}}},{key:"isBufferRemainLow",get:function(){return this.framesQueue.timeInterval<this.remainLowTimeInterval}}]),n}($s),oc=new(function(){function e(){I(this,e)}return M(e,[{key:"create",value:function(e){switch(e.mode){case Zs.Realtime:return new ic(e);case Zs.Reconstruction:return new ac(e);default:throw new Error("invalid mode ".concat(e.mode))}}}]),e}()),sc=function(){function e(t){I(this,e),this.latestReceivedFrameId=-1,this.didAssertedCount=0,this.latestReceivedFrameId=t}return M(e,[{key:"assertReceivedFrameId",value:function(e){var t=this.latestReceivedFrameId+1;if(e!==t)throw new Error("Magix want frameId ".concat(t,", instead of ").concat(e," (did asserted ").concat(this.didAssertedCount," frames)"));this.latestReceivedFrameId=e,this.didAssertedCount+=1}}]),e}(),cc=function(){function e(t){var n,r=this;I(this,e),this.latestTimestamp=null,this.receivedActionFramePicker=function(e){r.frameIdAsserter.assertReceivedFrameId(e.frameId),r.playerBuffer.pushFrames([e])},this.onPlayActionFrames=function(e){r.onFrameReceivedInterval&&e.length>0&&r.onFrameReceivedInterval(r.getFrameReceivedInterval(e));var t,n=[],i=A(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n.push(a.frameBuffer)}}catch(e){i.e(e)}finally{i.f()}try{r.image.appendActionFrames(n)}catch(a){if(!r.onClientCrashWithError)throw a;r.onClientCrashWithError(a)}},this.connection=t.connection,this.image=t.imageFactory.createWithSnapshot({logger:t.logger,observerId:hn,library:t.library,snapshotFrame:t.snapshot,pendingReportChanged:t.pendingReportChanged,actionFrames:p(t.initializeActionFrames),originalImage:null==(n=t.originalMagixSession)?void 0:n.image,includesFrameHash:!1,ignoreHashChecking:!0,roomUUID:t.connection.uuid,toolsExtra:t.toolsExtra,callbacks:{onModified:t.callbacks.onModified,onPhaseChanged:t.callbacks.onImagePhaseChanged,onGeneratedActionFrame:t.callbacks.onGeneratedActionFrame,onCatchErrorWhenAppendFrame:t.callbacks.onCatchErrorWhenAppendFrame,onReceivedRttReport:t.callbacks.onReceivedRttReport,onIllusionQueueLengthChanged:t.callbacks.onIllusionQueueLengthChanged,onEventFire:t.callbacks.onEventFire,onEventFireACK:t.callbacks.onEventFireACK,onClientCrashWithError:t.callbacks.onClientCrashWithError}}),this.frameIdAsserter=new sc(this.image.frameId),this.playerBuffer=oc.create({logger:t.logger,mode:Zs.Realtime,frameDelay:t.timeDelay,enableAnimationFrame:t.enableAnimationFrame,initFrameTimestamp:this.image.timestamp,callbacks:{onPlayActionFrames:this.onPlayActionFrames}}),this.onFrameReceivedInterval=t.callbacks.onFrameReceivedInterval,this.onClientCrashWithError=t.callbacks.onClientCrashWithError,this.playerBuffer.play()}return M(e,[{key:"imagePhase",get:function(){return this.image.phase}},{key:"timestamp",get:function(){return this.image.timestamp}},{key:"trigger",get:function(){return this.image.trigger}},{key:"pendingReportChanged",get:function(){return this.image.pendingReportChanged},set:function(e){this.image.pendingReportChanged=e}},{key:"receivedScopeSlices",value:function(e){this.image.appendScopeSlices(e)}},{key:"dispatch",value:function(e,t){this.image.dispatch(e,t)}},{key:"updateTimeDelay",value:function(e){this.playerBuffer.frameDelay=e}},{key:"syncBlockTimestamp",value:function(e){this.playerBuffer.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function(){this.playerBuffer.stopBlockTimestamp()}},{key:"setModifiable",value:function(e){this.image.modifiable=e}},{key:"setAllocatedUser",value:function(e){return this.image.setAllocatedUser(e)}},{key:"removeAllocatedUser",value:function(){return this.image.removeAllocatedUser()}},{key:"destroy",value:function(){this.image.destroy()}},{key:"getFrameReceivedInterval",value:function(e){var t,n=Date.now(),r=0,i=0,a=A(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;if(this.latestTimestamp){var s=n-this.latestTimestamp.recevied,c=o.timestamp-this.latestTimestamp.arbitrated;this.latestTimestamp.recevied=n,this.latestTimestamp.arbitrated=o.timestamp,r+=Math.abs(s-c),i+=1}else this.latestTimestamp={recevied:n,arbitrated:o.timestamp}}}catch(e){a.e(e)}finally{a.f()}var u=0;return i>0&&(u=r/i),u}}]),e}(),uc=function(){function e(t,n,r){I(this,e),this.userPayload=t,this.onSelfUserIdUpdate=n,this.onConvertToWritable=r,this._selfUserId=void 0,this.invokerBlock=Promise.resolve(),this.isConnectedSessionWritable=!1,this.connectedSession=null}var t;return M(e,[{key:"selfUserId",get:function(){return this._selfUserId}},{key:"setConnectedMagixSession",value:function(e){this.connectedSession!==e&&(!this.connectedSession&&e&&this.paddingAndWaitSession&&(this.paddingAndWaitSession(e),this.paddingAndWaitSession=void 0),this.connectedSession=e,this.isConnectedSessionWritable=!1)}},{key:"setWritable",value:function(e,t){return this.invokerBlock=this.convertTo(this.invokerBlock,e,t)}},{key:"convertTo",value:(t=l(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(this.isConnectedSessionWritable!==n){e.next=4;break}return e.abrupt("return");case 4:this.updateObserverId(void 0),i=null;case 6:return e.next=8,this.waitAndGetConnectedSession();case 8:if(a=e.sent,this.isConnectedSessionWritable!==n){e.next=11;break}return e.abrupt("break",31);case 11:if(!n){e.next=21;break}return e.next=14,a.connection.updateToWritable(this.userPayload,r);case 14:if(i=e.sent){e.next=17;break}return e.abrupt("continue",29);case 17:return e.next=19,a.setAllocatedUser(i);case 19:e.next=27;break;case 21:return e.next=23,a.connection.updateToReadonly(r);case 23:if(e.sent){e.next=25;break}return e.abrupt("continue",29);case 25:return e.next=27,a.removeAllocatedUser();case 27:return this.isConnectedSessionWritable=n,e.abrupt("break",31);case 29:e.next=6;break;case 31:i&&this.updateObserverId(i.userId),this.onConvertToWritable&&this.onConvertToWritable(!!i);case 32:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"waitAndGetConnectedSession",value:function(){var e=this;return this.connectedSession?Promise.resolve(this.connectedSession):new Promise((function(t){return e.paddingAndWaitSession=t}))}},{key:"updateObserverId",value:function(e){this._selfUserId!==e&&(this._selfUserId=e,this.onSelfUserIdUpdate&&this.onSelfUserIdUpdate(e))}}]),e}(),lc="NETLESSROOM_".length;function hc(e){if(!/^NETLESSROOM_.+/.test(e)){if(/^WHITE.+/.test(e))return"writable";throw new Error("invalid room token: ".concat(JSON.stringify(e)))}var t=e.substring(lc),n=(0,ss.parse)(function(e){return atob(e.replace(/_/g,"/").replace(/-/g,"+"))}(t)),r=parseFloat("".concat(n.role));if(Number.isNaN(r)||!Number.isSafeInteger(r))throw new Error("invalid room token with wrong role: ".concat(JSON.stringify(e)));switch(r){case 0:case 1:return"writable";case 2:return"readonly";default:throw new Error("find unrecognized role from roomToken: ".concat(r))}}!function(e){e[e.Admin=0]="Admin",e[e.Writer=1]="Writer",e[e.Reader=2]="Reader"}(nc||(nc={}));var dc=function(){function e(t,n){var r=this;I(this,e),this.queue=[],this._isWorking=!0,this.onDelayFire=function(){r.queue.splice(0),r.onTimeout()},this.timeout=t,this.delayer=new je(this.onDelayFire),this.onTimeout=n}return M(e,[{key:"isWorking",get:function(){return this._isWorking},set:function(e){this._isWorking!==e&&(this._isWorking=e,e?this.activeFirstNode():this.delayer.cancel())}},{key:"fireSend",value:function(e){var t=e.frameId,n=Date.now();this.queue.push({frameId:t,sendAt:n}),this._isWorking&&1===this.queue.length&&this.delayer.refreshAndInvokeAfterInterval(this.timeout)}},{key:"fireACK",value:function(e){var t=e.originalFrameId,n=this.queue.findIndex((function(e){return e.frameId===t}));-1!==n&&(this.queue.splice(n,1),this._isWorking&&this.activeFirstNode())}},{key:"activeFirstNode",value:function(){if(0===this.queue.length)this.delayer.cancel();else{var e=this.queue[0].sendAt+this.timeout-Date.now();e>0?this.delayer.refreshAndInvokeAfterInterval(e):(this.delayer.cancel(),this.onDelayFire())}}}]),e}(),fc=function(){function e(t){var n=this;I(this,e),this.idle=De({timeout:250,checkingTimeMod:7,maxPaddingDuration:800,maxInvokingDuration:5}),this.actionFramePickersList=[],this._phase=pc.Ready,this._modifiable=!0,this._timeDelay=0,this.switchWritable=!1,this.switchWritableTaskId=0,this.isReconnecting=!1,this.beginReconnectAt=0,this.onReceivedActionFrame=function(e){var t=new Jn(e);try{if(n.magixSession){if(n.actionFramePickersList.length>0){var r,i=A(n.cleanActionFramesBufferList());try{for(i.s();!(r=i.n()).done;){var a=r.value;n.magixSession.receivedActionFramePicker(a)}}catch(e){i.e(e)}finally{i.f()}}n.magixSession.receivedActionFramePicker(t)}else n.actionFramePickersList.push(t)}catch(a){n.logger.error("found error when receive action frame: "+a.message),n.socketSession.reconnectWithError(a)}finally{n.ackTimeout.fireACK(t)}},this.onReceivedScopeSlices=function(e){try{n.magixSession&&n.magixSession.receivedScopeSlices(e)}catch(e){n.logger.error("found error when receive scope slices: "+e.message),n.socketSession.reconnectWithError(e)}},this.onBeginReconnect=function(e){var t=n._phase===pc.Connecting;n.beginReconnectAt=Date.now(),n.refreshACKTimeoutIsWorking(),t||(n.callbacks.onReconnectWithError?n.callbacks.onReconnectWithError(e):n.logger.error(e)),n.switchWritableTaskId+=1,n.magixSession.destroy(),n.pingPongNode.unbindSocket(),t||n.changePhase(pc.Reconnecting),n.isReconnecting=!0,n.authorState.setConnectedMagixSession(null)},this.onReconnected=function(){var e=l(regeneratorRuntime.mark((function e(t){var r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.connection,i=t.snapshot,a=t.actionFrames,o=t.retryCount,n.buildMagixSession({connection:r,snapshot:i,actionFrames:a,pendingReportChanged:!0}),s=n._phase===pc.Connecting,c=n.switchWritableTaskId,e.t0=n.switchWritable,!e.t0){e.next=7;break}return e.next=7,n.authorState.setWritable(!0,n.settingWritablePayload);case 7:c===n.switchWritableTaskId&&(n.magixSession.pendingReportChanged=!1,s||(n.changePhase(pc.Connected),n.onModified()),n.isReconnecting=!1,n.reconnectionResultReceiver&&(n.reconnectionResultReceiver(null),n.reconnectionResultReceiver=null),n.callbacks.onReconnected&&!s&&n.callbacks.onReconnected({retryCount:o,buildWebSocketDuration:r.connectingDuration,buildMagixDuration:Date.now()-n.beginReconnectAt})),n.beginReconnectAt=0,n.refreshACKTimeoutIsWorking();case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onGeneratedActionFrame=function(e){var t;n.idle.invokeOnIdle(l(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=e.get();case 1:case"end":return n.stop()}}),n)})))).catch((function(e){var t,r;return null==(r=(t=n.callbacks).onReceivedWarning)?void 0:r.call(t,e.message)})),n.idle.invokeOnIdle(l(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(n.socketSession.connection.sendActionFrame(t),n.ackTimeout.fireSend(new Jn(t)));case 1:case"end":return e.stop()}}),e)})))).catch((function(e){var t,r;return null==(r=(t=n.callbacks).onReceivedWarning)?void 0:r.call(t,e.message)}))},this.onSelfUserIdUpdate=function(e){n.callbacks.onSelfUserIdUpdate&&n._phase!==pc.Ready&&n._phase!==pc.Connecting&&n.callbacks.onSelfUserIdUpdate(e)},this.onModified=function(){n.callbacks.onModified&&n._phase!==pc.Ready&&n._phase!==pc.Connecting&&(n.animationFrameTicker?n.animationFrameTicker.invoke():n.callbacks.onModified())},this.onACKTimeout=function(){n.onClientCrashWithError(new Error("receive ACK frame timeout"))},this.onClientCrashWithError=function(e){n._phase===pc.Connected&&n.socketSession.reconnectWithError(e)},this.onFrameReceivedInterval=function(t){n.callbacks.onFrameReceivedInterval&&(n.callbacks.onFrameReceivedInterval(t),n.receivedIntervalResetter.refreshAndInvokeAfterInterval(e.receivedIntervalResetterCleanInterval))},this.onDisconnectWithError=function(e){if(n.magixSession.destroy(),n.pingPongNode.unbindSocket(),n.phase!==pc.Disconnected){var t=n._phase;n.socketSession.dispose(),n.isReconnecting=!1,n.changePhase(pc.Disconnected),n.reconnectionResultReceiver&&(n.reconnectionResultReceiver(e),n.reconnectionResultReceiver=null),t===pc.Connecting?n.errorWhenConnecting=e:n.callbacks.onDisconnectWithError&&n.callbacks.onDisconnectWithError(e)}},this.onKickedWithReason=function(e){if(n.magixSession.destroy(),n.pingPongNode.unbindSocket(),n.phase!==pc.Disconnected){var t=n._phase,r=new Error("kicked by server when connecting: ".concat(e));n.socketSession.dispose(),n.isReconnecting=!1,n.changePhase(pc.Disconnected),n.reconnectionResultReceiver&&(n.reconnectionResultReceiver(r),n.reconnectionResultReceiver=null),t===pc.Connecting&&(n.errorWhenConnecting=r),n.callbacks.onKickedWithReason&&n.callbacks.onKickedWithReason(e)}},this.logger=t.logger,this.imageFactory=t.imageFactory,this.libraryNodeFetcher=t.libraryNodeFetcher,this.fetcherFactory=t.fetcherFactory,this.enableAnimationFrame=t.enableAnimationFrame,this.reconnectionOptions=t.reconnectionOptions,this.toolsExtra=t.toolsExtra,this.netState=t.netState,this.clientVersion=t.clientVersion,this.callbacks=Lr(t.callbacks),this.callbacks.onModified&&t.enableAnimationFrame&&(this.animationFrameTicker=new Ks(this.callbacks.onModified)),this.pingPongNode=new Xs(this.logger.warn),this.authorState=new uc(t.userPayload,this.onSelfUserIdUpdate,this.onModified),this.ackTimeout=new dc(e.ackTimeout,this.onACKTimeout),this.receivedIntervalResetter=new je((function(){n.callbacks.onFrameReceivedInterval&&n.callbacks.onFrameReceivedInterval(0)}))}var t,n,r;return M(e,[{key:"modifiable",get:function(){return this._modifiable}},{key:"phase",get:function(){return this._phase}},{key:"calibrationTimestamp",get:function(){return this.pingPongNode.calibrationTimestamp}},{key:"timeDelay",get:function(){return this._timeDelay},set:function(e){this._timeDelay=e,this.magixSession&&this.magixSession.updateTimeDelay(e)}},{key:"session",get:function(){return this.socketSession&&this.socketSession.session}},{key:"slice",get:function(){return this.socketSession&&this.socketSession.slice}},{key:"changePhase",value:function(e){if(this._phase!==e){switch(this._phase=e,e){case pc.Disconnecting:case pc.Disconnected:this.refreshACKTimeoutIsWorking()}this.callbacks.onPhaseChanged&&this.callbacks.onPhaseChanged(e)}}},{key:"selfUserId",get:function(){return this.authorState.selfUserId}},{key:"isWritable",get:function(){return void 0!==this.authorState.selfUserId}},{key:"imagePhase",get:function(){if(!this.magixSession)throw new Error("image phase not exist when Magix's phase is ".concat(this.phase));return this.magixSession.imagePhase}},{key:"trigger",get:function(){if(!this.magixSession)throw new Error("trigger object not exist when Magix's phase is ".concat(this.phase));return this.magixSession.trigger}},{key:"syncBlockTimestamp",value:function(e){var t;null==(t=this.magixSession)||t.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function(){var e;null==(e=this.magixSession)||e.stopBlockTimestamp()}},{key:"setWritable",value:(r=l(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._phase!==pc.Connected&&this._phase!==pc.Reconnecting){e.next=10;break}return this.switchWritable=t,this.settingWritablePayload=t?n:void 0,this.refreshACKTimeoutIsWorking(),e.prev=2,e.next=5,this.authorState.setWritable(t,n);case 5:return e.prev=5,this.refreshACKTimeoutIsWorking(),e.finish(5);case 8:e.next=11;break;case 10:throw new Error("can't only set writable when connected or reconnecting");case 11:case"end":return e.stop()}}),e,this,[[2,,5,8]])}))),function(e,t){return r.apply(this,arguments)})},{key:"connect",value:(n=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=Date.now(),this.phase===pc.Ready){e.next=3;break}throw new Error("can't connect when Magix's phase is ".concat(this.phase));case 3:return this.changePhase(pc.Connecting),e.prev=4,e.next=7,Ws({logger:this.logger,fetcher:this.fetcherFactory.create(t.region),uuid:t.uuid,roomToken:t.roomToken,timeout:45e3,markWritable:t.isWritable,clientVersion:this.clientVersion,access:hc(t.roomToken),netState:this.netState,reconnectionOptions:this.reconnectionOptions,objectOperator:this.imageFactory.proxyManager.objectOperator,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:{onReceivedActionFrame:this.onReceivedActionFrame,onReceivedScopeSlices:this.onReceivedScopeSlices,onBeginReconnect:this.onBeginReconnect,onReconnected:this.onReconnected,onSliceUpdate:this.callbacks.onSliceChanged,onSessionUpdate:this.callbacks.onSessionChanged,onDisconnectedByServer:this.onDisconnectWithError,onDisconnectedWithSocketError:this.onDisconnectWithError,onKickWithReason:this.onKickedWithReason}});case 7:if(r=e.sent,i=r.session,a=r.connection,o=r.snapshot,s=r.actionFrames,c=r.retryCount,this.socketSession=i,this.settingWritablePayload=t.connectedPayload,this.buildMagixSession({connection:a,snapshot:o,actionFrames:s,pendingReportChanged:!1}),e.t0=t.isWritable,!e.t0){e.next=21;break}return e.next=20,this.authorState.setWritable(!0,t.connectedPayload);case 20:this.switchWritable=!0;case 21:if(!this.isReconnecting){e.next=29;break}return e.next=24,new Promise((function(e){l.reconnectionResultReceiver=e}));case 24:if(!(u=e.sent)){e.next=27;break}throw u;case 27:e.next=31;break;case 29:if(this._phase===pc.Connecting){e.next=31;break}throw this.errorWhenConnecting?this.errorWhenConnecting:new Error("magix connect fail with invalid phase ".concat(this._phase));case 31:return e.abrupt("return",(this.changePhase(pc.Connected),{libraryNode:i.libraryNode,statistics:{retryCount:c,buildWebSocketDuration:i.connection.connectingDuration,buildMagixDuration:Date.now()-n}}));case 34:throw e.prev=34,e.t1=e.catch(4),this.cleanActionFramesBufferList(),this.changePhase(pc.Disconnected),this.pingPongNode.unbindSocket(),e.t1;case 37:case"end":return e.stop()}}),e,this,[[4,34]])}))),function(e){return n.apply(this,arguments)})},{key:"reconnectWithError",value:function(e){if(this._phase!==pc.Reconnecting){if(this._phase!==pc.Connected)throw new Error("can't reconnect when magix's phase is ".concat(this._phase));this.socketSession.reconnectWithError(e)}}},{key:"buildMagixSession",value:function(e){var t=this,n=e.connection,r=e.snapshot,i=e.actionFrames,a=e.pendingReportChanged;this.magixSession&&this.magixSession.destroy();var o=this.magixSession=new cc({logger:this.logger,library:Us(this.socketSession.libraryNode.libraryClass),connection:n,pendingReportChanged:a,snapshot:r,initializeActionFrames:i,imageFactory:this.imageFactory,enableAnimationFrame:this.enableAnimationFrame,originalMagixSession:this.magixSession,timeDelay:this._timeDelay,toolsExtra:this.toolsExtra,callbacks:{onImagePhaseChanged:function(e){return t.onImagePhaseChanged(o,e)},onGeneratedActionFrame:this.onGeneratedActionFrame,onModified:this.onModified,onEventFire:this.wrapeEventFireCallback(this.callbacks.onEventFire),onEventFireACK:this.wrapeEventFireCallback(this.callbacks.onEventFireACK),onClientCrashWithError:this.onClientCrashWithError,onFrameReceivedInterval:this.onFrameReceivedInterval,onReceivedRttReport:this.callbacks.onReceivedRttReport,onIllusionQueueLengthChanged:this.callbacks.onIllusionQueueLengthChanged,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame||function(e,n){return t.logger.error(n)}}});n.bindPingPongNode(this.pingPongNode),this.magixSession.setModifiable(this._modifiable),this.authorState.setConnectedMagixSession(this.magixSession)}},{key:"disconnect",value:(t=l(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isReconnecting=!1,this.phase!==pc.Reconnecting){e.next=4;break}this.socketSession.dispose(),this.pingPongNode.unbindSocket(),this.changePhase(pc.Disconnected),e.next=15;break;case 4:if(this.phase!==pc.Connected){e.next=14;break}return this.pingPongNode.unbindSocket(),this.changePhase(pc.Disconnecting),e.prev=6,e.next=9,this.socketSession.connection.disconnect();case 9:return e.prev=9,this.changePhase(pc.Disconnected),e.finish(9);case 12:e.next=15;break;case 14:throw new Error("can't disconnect when Magix's phase is ".concat(this.phase));case 15:case"end":return e.stop()}}),e,this,[[6,,9,12]])}))),function(){return t.apply(this,arguments)})},{key:"dispatch",value:function(e,t){if(this.phase!==pc.Connected)throw new Error("can't dispatch event when Magix's phase is ".concat(this.phase));this.magixSession.dispatch(e,t)}},{key:"refreshACKTimeoutIsWorking",value:function(){0===this.beginReconnectAt&&this.switchWritable&&this.isWritable&&this._phase===pc.Connected?this.ackTimeout.isWorking=!0:this.ackTimeout.isWorking=!1}},{key:"onImagePhaseChanged",value:function(e,t){this.callbacks.onImagePhaseChanged&&this.magixSession===e&&this.callbacks.onImagePhaseChanged(t)}},{key:"wrapeEventFireCallback",value:function(e){if(e)return function(t){return e(mr(t,dr.Dispatched))}}},{key:"cleanActionFramesBufferList",value:function(){return this.actionFramePickersList.splice(0,this.actionFramePickersList.length)}}]),e}();fc.receivedIntervalResetterCleanInterval=700,fc.ackTimeout=7e3;var pc,vc=function(){function e(t,n,r,i,a,o){I(this,e),this.fetcherFactory=t,this.imageFactory=n,this.reconnectionOptions=r,this.netState=i,this.clientVersion=a,this.magixConfiguration=Object.freeze(gs({},o))}return M(e,[{key:"createMagix",value:function(e,t){return new fc({logger:t.logger,fetcherFactory:this.fetcherFactory,libraryNodeFetcher:t.libraryNodeFetcher,imageFactory:this.imageFactory,toolsExtra:e,enableAnimationFrame:this.magixConfiguration.enableAnimationFrame,reconnectionOptions:this.reconnectionOptions,netState:this.netState,userPayload:t.userPayload,clientVersion:this.clientVersion,callbacks:t.callbacks||{}})}}]),e}();function mc(e){return gc.apply(this,arguments)}function gc(){return(gc=l(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=3,i=0;case 2:if(!(i<n)){e.next=15;break}return e.prev=3,e.next=6,t();case 6:return e.abrupt("return",e.sent);case 9:e.prev=9,e.t0=e.catch(3),r=e.t0;case 12:++i,e.next=2;break;case 15:throw r;case 16:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}!function(e){e.Ready="ready",e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnecting="disconnecting",e.Disconnected="disconnected"}(pc||(pc={}));var yc=function(){function e(t){var n=this;I(this,e),this.isDownloading=!1,this.didDestroy=!1,this.onPlayActionFrames=function(e){var t,r=[],i=A(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.sequenceInitializer,s=a.framePicker;o&&(r.length>0&&(n.image.appendActionFrames(r),r=[]),n.image=n.createImage(o,n.image),n._libIdentifier=o.libIdentifier,n._libraryNode=o.libraryNode,n.playingSliceIndex+=1,n.callbacks.onSliceChanged&&n.callbacks.onSliceChanged()),s&&r.push(s.frameBuffer)}}catch(e){i.e(e)}finally{i.f()}r.length>0&&n.image.appendActionFrames(r)},this.onBufferRemainLow=function(){n.isDownloading||n.loadActionFrames()},this.onPlayerBufferPhaseChanged=function(e){n.callbacks.onPhaseChanged&&n.callbacks.onPhaseChanged(e)},this.logger=t.logger,this.imageFactory=t.imageFactory,this.sliceChunk=t.sliceChunk,this.sequenceFetcher=t.sequenceFetcher,this.toolsExtra=t.toolsExtra,this.fetchingSliceIndex=t.beginSliceIndex,this.playingSliceIndex=t.beginSliceIndex,this.callbacks=t.callbacks,this.isFirstSlice=!0,this.image=this.createImage(t.sequenceInitializer,t.originalReconstructorLine&&t.originalReconstructorLine.image),this.latestFetchingFrameId=this.image.frameId,this.latestPlayingFrameId=this.image.frameId,this.beginTimestamp=void 0===t.initFrameTimestamp?this.image.timestamp:t.initFrameTimestamp,this._libIdentifier=t.sequenceInitializer.libIdentifier,this._libraryNode=t.sequenceInitializer.libraryNode,this.playerBuffer=oc.create({logger:t.logger,mode:Zs.Reconstruction,enableAnimationFrame:t.enableAnimationFrame,initFrameTimestamp:this.beginTimestamp,endFrameTimestamp:this.sliceChunk.beginTimestamp+this.sliceChunk.duration,callbacks:{onBufferRemainLow:this.onBufferRemainLow,onPlayActionFrames:this.onPlayActionFrames,onPhaseChanged:this.onPlayerBufferPhaseChanged,onTick:t.callbacks.onTick}}),this.playerBuffer.playbackSpeed=t.playbackSpeed}var t,n;return M(e,[{key:"trigger",get:function(){return this.image.trigger}},{key:"libIdentifier",get:function(){return this._libIdentifier}},{key:"libraryNode",get:function(){return this._libraryNode}},{key:"playbackSpeed",get:function(){return this.playerBuffer.playbackSpeed},set:function(e){this.playerBuffer.playbackSpeed=e}},{key:"createImage",value:function(e,t){var n=e.snapshot,r=e.actionFrames,i=e.akkoSerVersion,a=e.libraryNode,o=this.imageFactory.createWithSnapshot({logger:this.logger,observerId:hn,library:Us(a.libraryClass),snapshotFrame:n,actionFrames:r,originalImage:t,toolsExtra:this.toolsExtra,roomUUID:this.sliceChunk.roomUUID,includesFrameHash:!1,ignoreHashChecking:!0,pendingReportChanged:!1,snapshotDeserializerVersion:i,actionDeserializerVersion:i,callbacks:{onModified:this.callbacks.onModified,onEventFire:this.callbacks.onEventFire,onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame}});return o.modifiable=!1,o}},{key:"slice",get:function(){return this.sliceChunk.sliceAt(this.playingSliceIndex)}},{key:"sliceIndex",get:function(){return this.playingSliceIndex}},{key:"play",value:function(){this.playerBuffer.play()}},{key:"pause",value:function(){this.playerBuffer.pause()}},{key:"setup",value:function(){var e=this.sliceChunk.beginTimestamp+this.sliceChunk.duration;this.beginTimestamp<e?this.loadActionFrames():this.playerBuffer.completePushFrames()}},{key:"destroy",value:function(){this.didDestroy||(this.playerBuffer.pause(),this.image.destroy(),this.didDestroy=!0)}},{key:"phase",get:function(){return this.playerBuffer.phase}},{key:"isRemainFramesToFetch",value:function(){return this.fetchingSliceIndex<this.sliceChunk.slicesCount}},{key:"loadActionFrames",value:function(){var e=this;this.fillActionFramesIntoBuffer().catch((function(t){return e.logger.error(t)}))}},{key:"fillActionFramesIntoBuffer",value:(n=l(regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isRemainFramesToFetch()){e.next=18;break}return e.prev=1,this.isDownloading=!0,e.next=5,this.fetchFrames();case 5:t=e.sent,n=this.sliceChunk.beginTimestamp+this.sliceChunk.duration,r=this.removeTimestampOverFrames(t,n),(i=t[t.length-1])&&(this.latestPlayingFrameId=i.frameId),this.shouldPushEndSpaceHolderFrame(t,r,n)&&t.push({frameId:this.latestPlayingFrameId+1,timestamp:n}),t.length>0&&this.playerBuffer.pushFrames(t),this.isRemainFramesToFetch()||this.playerBuffer.completePushFrames(),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),this.callbacks.onCatchErrorWhenFetchBuffer&&this.callbacks.onCatchErrorWhenFetchBuffer(e.t0);case 15:return e.prev=15,this.isDownloading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[1,12,15,18]])}))),function(){return n.apply(this,arguments)})},{key:"shouldPushEndSpaceHolderFrame",value:function(e,t,n){var r=e[e.length-1];return(t||!this.isRemainFramesToFetch())&&(!r||r.timestamp<n)}},{key:"fetchFrames",value:(t=l(regeneratorRuntime.mark((function t(){var n,r,i,a,o,s,c,u,l,d,f,p,v=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.sliceChunk.sliceAt(this.fetchingSliceIndex)){t.next=2;break}return t.abrupt("return",[]);case 2:if(!((r=n.framesCount-this.latestFetchingFrameId)>0)){t.next=4;break}return t.abrupt("break",7);case 4:this.latestFetchingFrameId=0,this.latestPlayingFrameId=0,this.fetchingSliceIndex+=1,this.isFirstSlice=!1;case 5:t.next=0;break;case 7:return i=Math.min(r,e.fetchFramesCountOnce),a=0===this.latestFetchingFrameId&&!this.isFirstSlice,t.next=11,Promise.all([mc((function(){return v.sequenceFetcher.fetchFramePickers(n,v.latestFetchingFrameId,i)})),a?mc((function(){return v.sequenceFetcher.initializeWithFrameId(n,v.latestFetchingFrameId)})):Promise.resolve(void 0)]);case 11:o=t.sent,s=h(o,2),c=s[0],u=s[1],l=[],d=A(c);try{for(d.s();!(f=d.n()).done;)p=f.value,this.latestFetchingFrameId=p.frameId,l.push({frameId:p.frameId,timestamp:p.timestamp,framePicker:p})}catch(e){d.e(e)}finally{d.f()}return t.abrupt("return",(u&&(l[0].sequenceInitializer=u),l));case 19:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"removeTimestampOverFrames",value:function(e,t){var n=e.findIndex((function(e){return e.timestamp>t}));return-1!==n&&(e.splice(n,e.length-n),!0)}}]),e}();yc.fetchFramesCountOnce=600;var bc,kc=function(){function e(t){I(this,e),this.sliceChunk=t.sliceChunk,this.imageFactory=t.imageFactory,this.sequenceFetcher=t.sequenceFetcher,this.toolsExtra=t.toolsExtra,this.enableAnimationFrame=t.enableAnimationFrame}var t,n;return M(e,[{key:"createWithFrameId",value:(n=l(regeneratorRuntime.mark((function e(t,n,r,i,a){var o,s,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.sliceChunk.getFrameDescriptionWithFrameId(n),s=o.sliceIndex,c=o.frameId,u=this.sliceChunk.sliceAt(s),e.next=6,this.sequenceFetcher.initializeWithFrameId(u,c);case 6:return l=e.sent,e.abrupt("return",new yc({logger:t,imageFactory:this.imageFactory,sequenceFetcher:this.sequenceFetcher,originalReconstructorLine:a,sliceChunk:this.sliceChunk,toolsExtra:this.toolsExtra,beginSliceIndex:s,initFrameTimestamp:this.sliceChunk.beginTimestamp,sequenceInitializer:l,enableAnimationFrame:this.enableAnimationFrame,playbackSpeed:r,callbacks:i}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i,a){return n.apply(this,arguments)})},{key:"createWithProgressTime",value:(t=l(regeneratorRuntime.mark((function e(t,n,r,i,a){var o,s,c,u,l,h;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.sliceChunk.getFrameDescriptionWithTimestamp(n),s=o.sliceIndex,c=o.timestamp,u=this.sliceChunk.sliceAt(s),l=c+u.beginTimestamp,e.next=7,this.sequenceFetcher.initializeWithTimestamp(u,l);case 7:return h=e.sent,e.abrupt("return",new yc({logger:t,imageFactory:this.imageFactory,sequenceFetcher:this.sequenceFetcher,originalReconstructorLine:a,sliceChunk:this.sliceChunk,toolsExtra:this.toolsExtra,beginSliceIndex:s,initFrameTimestamp:this.sliceChunk.beginTimestamp+n,sequenceInitializer:h,enableAnimationFrame:this.enableAnimationFrame,playbackSpeed:r,callbacks:i}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r,i,a){return t.apply(this,arguments)})}]),e}();!function(e){e[e.FrameId=0]="FrameId",e[e.ProgressTime=1]="ProgressTime"}(bc||(bc={}));var wc=function(){function e(t){I(this,e),this.isRunningLoop=!1,this.task=null,this.id=0,this.callbacks=Object.freeze(gs({},t))}var t;return M(e,[{key:"currentTaskId",get:function(){return this.id}},{key:"isSeeking",get:function(){return this.isRunningLoop}},{key:"stopSeeking",value:function(){this.task&&(this.task.complete(Ic.Stopped),this.task=null),this.id+=1}},{key:"seekToFrameId",value:function(e){var t=this;return new Promise((function(n){t.task&&0===t.task.mode&&t.task.value===e?n(Ic.SuccessButUnnecessary):(t.setNewTask(0,e,n),t.startTaskLoop().catch((function(e){return console.error(e)})))}))}},{key:"seekToProgressTime",value:function(e){var t=this;return new Promise((function(n){t.task&&1===t.task.mode&&t.task.value===e?n(Ic.SuccessButUnnecessary):(t.setNewTask(1,e,n),t.startTaskLoop().catch((function(e){return console.error(e)})))}))}},{key:"setNewTask",value:function(e,t,n){var r=this.id+=1;this.task&&this.task.complete(Ic.Override),this.task={id:r,mode:e,value:t,complete:n}}},{key:"startTaskLoop",value:(t=l(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.isRunningLoop){e.next=23;break}e.prev=1,this.isRunningLoop=!0,this.callbacks.updateIsSeeking();case 3:if(!this.task){e.next=20;break}n=this.task,r=n.id,i=n.mode,a=n.value,o=void 0,e.t0=i,e.next=0===e.t0?8:1===e.t0?12:16;break;case 8:return e.next=10,this.callbacks.startSeekingToFrameId(r,a);case 10:return o=e.sent,e.abrupt("break",17);case 12:return e.next=14,this.callbacks.startSeekingToProgressTime(r,a);case 14:return o=e.sent,e.abrupt("break",17);case 16:throw new Error("invalid mode ".concat(i));case 17:this.id===r?(null==(t=this.task)||t.complete(Ic.Success),this.task=null,this.callbacks.afterSeeking(o)):this.callbacks.cancelSeeking(o);case 18:e.next=3;break;case 20:return e.prev=20,this.isRunningLoop=!1,this.callbacks.updateIsSeeking(),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[1,,20,23]])}))),function(){return t.apply(this,arguments)})}]),e}(),Sc=function(){function e(t){var n=this;I(this,e),this._progressTime=0,this._playbackSpeed=1,this.isPlaying=!1,this.isMaskPhaseUpdating=!1,this.didStop=!1,this.currentLine=void 0,this.startSeekingToFrameId=function(){var e=l(regeneratorRuntime.mark((function e(t,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r,i=Math.max(i,0),i=Math.min(i,n.framesCount),a=function(e){return n.lineFactory.createWithFrameId(n.logger,i,n.playbackSpeed,e,n.currentLine)},e.next=5,n.startSeekingTask(t,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.startSeekingToProgressTime=function(){var e=l(regeneratorRuntime.mark((function e(t,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r,i=Math.max(i,0),i=Math.min(i,n.duration),Number.isSafeInteger(i)||(i=Math.floor(i)),a=function(e){return n.lineFactory.createWithProgressTime(n.logger,i,n.playbackSpeed,e,n.currentLine)},e.next=5,n.startSeekingTask(t,a);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.afterSeeking=function(e){try{n.isMaskPhaseUpdating=!0,e.setup()}finally{n.isMaskPhaseUpdating=!1}n.changeCurrentLine(e)},this.cancelSeeking=function(e){e.destroy()},this.onLineSliceChanged=function(){var e,t;n.currentLine&&(n.sliceStateUpdater.refreshReconstructorLine(n.currentLine),n.callbacks.onModified&&n.callbacks.onModified(),n.onTick(n.currentLine.beginTimestamp),null==(t=(e=n.callbacks).onTriggerBuilt)||t.call(e))},this.currentIsPlayable=function(){if(n.didStop||!n.currentLine||n.seekingNode.isSeeking)return!1;switch(n.currentLine.phase){case qs.Playing:case qs.Pausing:return!0;case qs.PausingAndWaiting:case qs.Waiting:case qs.Ended:default:return!1}},this.currentPhase=function(){if(n.didStop)return Cc.Stopped;if(!n.currentLine)return Cc.WaitingFirstFrame;if(n.seekingNode.isSeeking)return Cc.Seeking;switch(n.currentLine.phase){case qs.Playing:return Cc.Playing;case qs.Pausing:case qs.PausingAndWaiting:return Cc.Pause;case qs.Waiting:return Cc.Buffering;case qs.Ended:return Cc.Ended;default:throw new Error("invalid phase ".concat(n.currentLine.phase))}},this.touchPhaseChanged=function(){n.isMaskPhaseUpdating||(n.phaseNode.touch(),n.isPlayableNode.touch())},this.onTick=function(e){var t=Math.min(e-n.beginTimestamp,n.sliceChunk.duration);n._progressTime=t,n.callbacks.onProgressTimeChanged&&n.callbacks.onProgressTimeChanged(t)},this.onCatchError=function(e){n.didStop||(n.stop(),n.callbacks.onStoppedWithError&&n.callbacks.onStoppedWithError(e))},this.onEventFire=function(e){n.callbacks.onEventFire&&n.callbacks.onEventFire(mr(e,dr.Dispatched))},this.logger=t.logger,this.sliceChunk=t.sliceChunk,this.sequenceFetcher=t.sequenceFetcher,this.callbacks=Lr(t.callbacks),this.sliceStateUpdater=t.sliceStateUpdater,this.sliceStateUpdater.onSliceChanged=this.callbacks.onSliceChanged,this.sliceStateUpdater.onLibraryNodeChanged=this.callbacks.onLibraryNodeChanged,this.seekingNode=new wc({startSeekingToFrameId:this.startSeekingToFrameId,startSeekingToProgressTime:this.startSeekingToProgressTime,afterSeeking:this.afterSeeking,cancelSeeking:this.cancelSeeking,updateIsSeeking:this.touchPhaseChanged}),this.isPlayableNode=new Kr({phase:!1,onPhaseChanged:t.callbacks.onIsPlayableChanged,getCurrentPhase:this.currentIsPlayable}),this.phaseNode=new Kr({phase:Cc.WaitingFirstFrame,onPhaseChanged:t.callbacks.onPhaseChanged,getCurrentPhase:this.currentPhase}),this.lineFactory=new kc({sliceChunk:t.sliceChunk,imageFactory:t.imageFactory,sequenceFetcher:t.sequenceFetcher,toolsExtra:t.toolsExtra,enableAnimationFrame:t.enableAnimationFrame})}var t;return M(e,[{key:"trigger",get:function(){if(!this.currentLine)throw new Error("trigger object not exist when Reconstructor's phase is ".concat(this.phase));return this.currentLine.trigger}},{key:"isPlayable",get:function(){return this.isPlayableNode.phase}},{key:"phase",get:function(){return this.phaseNode.phase}},{key:"progressTime",get:function(){return this._progressTime}},{key:"slice",get:function(){return this.sliceStateUpdater.slice}},{key:"sliceIndex",get:function(){return this.sliceStateUpdater.sliceIndex}},{key:"libIdentifier",get:function(){return this.sliceStateUpdater.libIdentifier}},{key:"libraryNode",get:function(){return this.sliceStateUpdater.libraryNode}},{key:"roomUUID",get:function(){return this.sliceChunk.roomUUID}},{key:"duration",get:function(){return this.sliceChunk.duration}},{key:"framesCount",get:function(){return this.sliceChunk.framesCount}},{key:"beginTimestamp",get:function(){return this.sliceChunk.beginTimestamp}},{key:"playbackSpeed",get:function(){return this.currentLine?this.currentLine.playbackSpeed:this._playbackSpeed},set:function(e){this._playbackSpeed=e,this.currentLine&&(this.currentLine.playbackSpeed=e)}},{key:"play",value:function(){var e=this;if(this.assertNotStop(),this.phaseNode.phase!==Cc.Ended){var t=this.isPlaying;this.isPlaying=!0,!t&&!this.seekingNode.isSeeking&&(this.currentLine?this.currentLine.play():this.seekToProgressTime(0).catch((function(t){return e.logger.error(t)}))),this.touchPhaseChanged()}}},{key:"pause",value:function(){this.assertNotStop(),this.isPlaying&&!this.seekingNode.isSeeking&&this.currentLine&&this.currentLine.pause(),this.isPlaying=!1,this.touchPhaseChanged()}},{key:"stop",value:function(){this.assertNotStop(),this.seekingNode.stopSeeking(),this.currentLine&&(this.currentLine.destroy(),this.currentLine=void 0),this.didStop=!0,this.touchPhaseChanged()}},{key:"seekToFrameId",value:function(e){return this.assertNotStop(),this.seekingNode.seekToFrameId(e)}},{key:"seekToProgressTime",value:function(e){return this.assertNotStop(),this.seekingNode.seekToProgressTime(e)}},{key:"startSeekingTask",value:(t=l(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=gs({},this.wrapCallbacksWithTaskChecking(t,{onCatchErrorWhenAppendFrame:this.callbacks.onCatchErrorWhenAppendFrame,onCatchErrorWhenFetchBuffer:this.onCatchError,onModified:this.callbacks.onModified,onSliceChanged:this.onLineSliceChanged,onEventFire:this.onEventFire,onTick:this.onTick,onPhaseChanged:this.touchPhaseChanged})),e.next=4,n(r);case 4:return e.abrupt("return",e.sent);case 7:throw e.prev=7,e.t0=e.catch(0),this.onCatchError(e.t0),e.t0;case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e,n){return t.apply(this,arguments)})},{key:"changeCurrentLine",value:function(e){var t,n;this.currentLine&&this.currentLine.destroy(),this.currentLine=e,this.sliceStateUpdater.refreshReconstructorLine(e),this.isPlaying&&e.play(),this.callbacks.onModified&&this.callbacks.onModified(),this.onTick(e.beginTimestamp),null==(n=(t=this.callbacks).onTriggerBuilt)||n.call(t)}},{key:"wrapCallbacksWithTaskChecking",value:function(e,t){var n=this,r={},i=function(i){var a=t[i];a&&(r[i]=function(){if(e===n.seekingNode.currentTaskId)return a.apply(void 0,arguments)})};for(var a in t)i(a);return r}},{key:"assertNotStop",value:function(){if(this.didStop)throw new Error("Reconstructor did stop")}}]),e}();function xc(e,t,n){var r=Math.min(e,n),i=Math.max(e,n),a=t;return t<r?a=r:t>i&&(a=i),a}var Cc,Ic,Pc=function(){function e(t){var n=this;I(this,e),this.fetchLibraryNode=function(){var e=l(regeneratorRuntime.mark((function e(t,r){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.previousLibraryNode||n.previousLibraryNode.libIdentifier!==r){e.next=2;break}return e.abrupt("return",n.previousLibraryNode.libraryNode);case 2:return e.next=4,n.libraryNodeFetcher({appIdentifier:t.appIdentifier,appVersion:t.appVersion,appHash:t.appHash,libIdentifier:r});case 4:return i=e.sent,e.abrupt("return",(n.previousLibraryNode=Object.freeze({libIdentifier:r,libraryNode:i}),i));case 6:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.logger=t.logger,this.fetcher=t.fetcher,this.roomToken=t.roomToken,this.libraryNodeFetcher=t.libraryNodeFetcher}var t,n,r,i,a,o,s,c,u;return M(e,[{key:"initializeWithTimestamp",value:(u=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.libIdentifier,e.next=3,Promise.all([this.sequenceImageInitializerWithTimestamp(t,n),this.fetchLibraryNode(t,r)]);case 3:return i=e.sent,a=h(i,2),o=a[0],s=a[1],e.abrupt("return",ys(gs({},o),{libraryNode:s,libIdentifier:r}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return u.apply(this,arguments)})},{key:"initializeWithFrameId",value:(c=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.libIdentifier,e.next=3,Promise.all([this.sequenceImageInitializerWithFrameId(t,n),this.fetchLibraryNode(t,r)]);case 3:return i=e.sent,a=h(i,2),o=a[0],s=a[1],e.abrupt("return",ys(gs({},o),{libraryNode:s,libIdentifier:r}));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return c.apply(this,arguments)})},{key:"sequenceImageInitializerWithTimestamp",value:(s=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u,l,h,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=xc(t.beginTimestamp,n,t.beginTimestamp+t.duration),e.next=3,this.fetcher.fetch("persistence");case 3:return i=e.sent,a=(0,us.stringify)({timestamp:r}),o="https://persistence/pv/rooms/".concat(t.roomUUID,"/slices/").concat(t.uuid,"/snapshots?").concat(a),e.next=8,i.fetchJSON(o,{method:"get",headers:{"content-type":"application/json",token:this.roomToken}});case 8:return(s=e.sent)||(this.logger.warn("cannot find snapshot that timestamp=".concat(r," and slice=").concat(t.uuid)),s={frameId:0,timestamp:t.beginTimestamp}),e.next=12,this.fetchFrameRouterPicker(t,s.frameId);case 12:for(c=e.sent,u=0,l=0;l<c.framesCount&&c.timestampAt(l)<=n;l++)u+=1;return e.next=17,this.fetchSnapshot(t,s.frameId);case 17:if(h=e.sent,0!==u){e.next=22;break}e.t0=[],e.next=25;break;case 22:return e.next=24,this.fetchFramePickers(t,s.frameId,u);case 24:e.t0=e.sent;case 25:return d=e.t0,e.abrupt("return",{snapshot:h.frameBuffer,actionFrames:d.map((function(e){return e.frameBuffer})),akkoSerVersion:Dt(t.akkoVersion)});case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"sequenceImageInitializerWithFrameId",value:(o=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=xc(0,n,t.framesCount-1),e.next=3,this.fetchSnapshot(t,r);case 3:if(i=e.sent,0!=(a=r-i.frameId)){e.next=7;break}return e.abrupt("return",{snapshot:i.frameBuffer,actionFrames:[],akkoSerVersion:Dt(t.akkoVersion)});case 7:return e.next=9,this.fetchFramePickers(t,i.frameId,a);case 9:return o=e.sent,e.abrupt("return",{snapshot:i.frameBuffer,actionFrames:o.map((function(e){return e.frameBuffer})),akkoSerVersion:Dt(t.akkoVersion)});case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"fetchFramePickers",value:(a=l(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c,u,l,h,d,f,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,"framesRouter");case 2:return i=e.sent,a=i.fetcher,o=i.url,e.next=7,Mc.pick(a,o,n,r);case 7:return s=e.sent,e.next=10,this.fetchBody(t,"framesBody",s.offset,s.length);case 10:c=e.sent,u=[],l=0;case 13:if(!(l<s.framesCount)){e.next=22;break}if(h=s.offsetAt(l)-s.offset,d=s.lengthAt(l),!(c.byteLength<h+d)){e.next=17;break}return e.abrupt("break",22);case 17:f=c.slice(h,d),p=new Jn(f),u.push(p);case 19:++l,e.next=13;break;case 22:return e.abrupt("return",u);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return a.apply(this,arguments)})},{key:"fetchSnapshot",value:(i=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,"snapshotsRouter");case 2:return r=e.sent,i=r.fetcher,a=r.url,o=Math.floor(n/t.snapshotIdInterval),e.next=8,Mc.pick(i,a,o,1);case 8:if(0!==(s=e.sent).framesCount){e.next=11;break}throw new Error("can't find snapshot with frameId ".concat(n));case 11:return c=s.offsetAt(0),u=s.lengthAt(0),e.next=15,this.fetchBody(t,"snapshotsBody",c,u);case 15:return l=e.sent,e.abrupt("return",new Jn(l));case 17:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"fetchFrameRouterPicker",value:(r=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,"framesRouter");case 2:return r=e.sent,i=r.fetcher,a=r.url,o=Math.min(t.framesCount-n,t.snapshotIdInterval-1),e.abrupt("return",Mc.pick(i,a,n,o));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"fetchBody",value:(n=l(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAssetsFetcherAndURL(t,n);case 2:return a=e.sent,o=a.fetcher,s=a.url,e.next=7,o.fetchBuffer(s,{method:"get",headers:{"content-type":"application/json",Accept:"application/octet-stream",Range:"bytes=".concat(r,"-").concat(r+i)}});case 7:if(c=e.sent){e.next=10;break}throw new Error("can't find \"".concat(s,'"'));case 10:return e.abrupt("return",c);case 11:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"getAssetsFetcherAndURL",value:(t=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.uuid,i=t.roomUUID,a=t.token,e.t0=n,e.next="framesBody"===e.t0?4:"framesRouter"===e.t0?6:"snapshotsBody"===e.t0?8:"snapshotsRouter"===e.t0?10:12;break;case 4:return o="frames.body",e.abrupt("break",12);case 6:return o="frames.router",e.abrupt("break",12);case 8:return o="snapshots.body",e.abrupt("break",12);case 10:return o="snapshots.router",e.abrupt("break",12);case 12:return a?(s="assets-auth",c=a[n]):s="assets",u="https://".concat(s,"/").concat(i,"/").concat(r,"/").concat(o),c&&(u+="?auth_key="+c),e.next=17,this.fetcher.fetch(s);case 17:return e.t1=e.sent,e.t2=u,e.abrupt("return",{fetcher:e.t1,url:e.t2});case 20:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),Mc=function(){function e(t,n){I(this,e),this.buffer=t,this.framesCount=n,this.framesCount>0?this.offset=this.offsetAt(0):this.offset=Number.NaN}var t;return M(e,[{key:"length",get:function(){if(void 0===this._length){this._length=0;for(var e=0;e<this.framesCount;++e)this._length+=this.lengthAt(e)}return this._length}},{key:"timestampAt",value:function(e){var t=24*e+0;return this.buffer.getUint64(t)}},{key:"offsetAt",value:function(e){var t=24*e+8;return this.buffer.getUint64(t)}},{key:"lengthAt",value:function(e){var t=24*e+16;return this.buffer.getUint64(t)}}],[{key:"pick",value:(t=l(regeneratorRuntime.mark((function t(n,r,i,a){var o,s,c,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=i*(o=24),c=(i+a)*o-1,t.next=5,n.fetchBuffer(r,{method:"get",headers:{"content-type":"application/json",Accept:"application/octet-stream",Range:"bytes=".concat(s,"-").concat(c)}});case 5:return(u=t.sent)||(u=ye(0)),l=Math.floor(u.byteLength/o),t.abrupt("return",new e(u,l));case 9:case"end":return t.stop()}}),t)}))),function(e,n,r,i){return t.apply(this,arguments)})}]),e}(),Tc=function(){function e(t){I(this,e),this.slices=Object.freeze(p(t.slices).sort((function(e,t){return e.beginTimestamp-t.beginTimestamp}))),this.beginAt=t.beginAt,this.endAt=t.endAt,this.roomUUID=this.getRoomUUID(),this.framesCount=this.getFramesCount()}return M(e,[{key:"getRoomUUID",value:function(){for(var e=this.slices[0].roomUUID,t=1;t<this.slices.length;++t)if(e!==this.slices[t].roomUUID)throw new Error("all slices should have the same roomUUID");return e}},{key:"getFramesCount",value:function(){var e,t=0,n=A(this.slices);try{for(n.s();!(e=n.n()).done;){t+=e.value.framesCount}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"beginTimestamp",get:function(){return this.beginAt}},{key:"duration",get:function(){return this.endAt-this.beginAt}},{key:"slicesCount",get:function(){return this.slices.length}},{key:"sliceAt",value:function(e){return this.slices[e]}},{key:"getFrameDescriptionWithFrameId",value:function(e){for(var t=e,n=0,r=0;r<this.slices.length;++r){var i=this.slices[r];if(n=r,t<i.framesCount)break;t-=i.framesCount}return{frameId:t,sliceIndex:n}}},{key:"getFrameDescriptionWithTimestamp",value:function(e){for(var t=e+this.beginAt,n=0,r=0;r<this.slices.length;++r){var i=this.slices[r];if(n=r,t<i.beginTimestamp+i.duration)break}return{sliceIndex:n,timestamp:Math.max(0,t-this.slices[n].beginTimestamp)}}}]),e}(),Ac=function(){function e(t){var n=this;I(this,e),this._libraryNodeFetcher=t,this.libraryNodeFetcher=function(e){return n._libraryNode&&n._libIdentifier===e.libIdentifier?Promise.resolve(n._libraryNode):n._libraryNodeFetcher(e)}}return M(e,[{key:"sliceIndex",get:function(){return this._sliceIndex}},{key:"slice",get:function(){return this._slice}},{key:"libIdentifier",get:function(){return this._libIdentifier}},{key:"libraryNode",get:function(){return this._libraryNode}},{key:"refreshReconstructorLine",value:function(e){(e.libIdentifier!==this._libIdentifier||e.libraryNode!==this._libraryNode)&&(this._libIdentifier=e.libIdentifier,this._libraryNode=e.libraryNode,this.onLibraryNodeChanged&&this.onLibraryNodeChanged(this._libIdentifier,this._libraryNode)),e.sliceIndex!==this._sliceIndex&&(this._sliceIndex=e.sliceIndex,this._slice=e.slice,this.onSliceChanged&&this.onSliceChanged(this._slice,this._sliceIndex))}}]),e}(),Ec=function(){function e(t,n,r,i){I(this,e),this.fetcherFactory=t,this.imageFactory=n,this.clientVersion=r,this.enableAnimationFrame=i}var t,n,r;return M(e,[{key:"createReconstructor",value:(r=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.rangeQuery,i=new Ac(n.libraryNodeFetcher),a=new Pc({logger:n.logger,roomToken:n.roomToken,fetcher:this.fetcherFactory.create(r.region),libraryNodeFetcher:i.libraryNodeFetcher}),e.next=5,this.fetchSliceChunk(r);case 5:if(o=e.sent){e.next=8;break}throw new Error("couldn't find any matching slices");case 8:return e.abrupt("return",new Sc({logger:n.logger,sliceChunk:o,imageFactory:this.imageFactory,sequenceFetcher:a,sliceStateUpdater:i,toolsExtra:t,enableAnimationFrame:this.enableAnimationFrame,callbacks:n.callbacks||{}}));case 9:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"searchSlices",value:(n=l(regeneratorRuntime.mark((function e(t){var n,r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchSliceChunk(t);case 2:if(n=e.sent,r=[],n)for(i=0;i<n.slicesCount;++i)r.push(n.sliceAt(i));return e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fetchSliceChunk",value:(t=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l,h,d,f,v,m,g=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetcherFactory.create(t.region).fetch("persistence");case 2:if(n=e.sent,void 0===t.slice){e.next=14;break}return i={clientVersion:this.clientVersion},a="https://persistence/pv/rooms/".concat(t.room,"/slices/").concat(t.slice,"?").concat((0,cs.stringify)(i)),e.next=8,n.fetchJSON(a,{headers:{"content-type":"application/json",token:t.roomToken}});case 8:if(o=e.sent,void 0===t.room||t.room===o.roomUUID){e.next=11;break}throw new Error("slice ".concat(o.uuid," is not belongs to room ").concat(t.room));case 11:r=[o],e.next=22;break;case 14:if(void 0===t.room){e.next=21;break}return s=t.beginTimestamp,c=void 0!==t.beginTimestamp&&void 0!==t.duration?t.beginTimestamp+t.duration:void 0,u={beginAt:s,endAt:c,clientVersion:this.clientVersion},l="https://persistence/pv/rooms/".concat(t.room,"/slices?").concat((0,cs.stringify)(u)),e.next=18,n.fetchJSON(l,{headers:{"content-type":"application/json",token:t.roomToken}});case 18:r=e.sent,e.next=22;break;case 21:throw new Error("expect either room or slice");case 22:if(!((r=r.map((function(e){return g.fillSliceLibIdentifier(e)}))).length>0)){e.next=31;break}void 0===(h=t.beginTimestamp)&&(h=Math.min.apply(Math,p(r.map((function(e){return e.beginTimestamp}))))),d=t.duration?h+t.duration:Math.max.apply(Math,p(r.map((function(e){return e.beginTimestamp+e.duration})))),f=A(r);try{for(f.s();!(v=f.n()).done;)m=v.value,Object.freeze(m)}catch(e){f.e(e)}finally{f.f()}return e.abrupt("return",(r=r.filter((function(e){var t=e.beginTimestamp;return e.beginTimestamp+e.duration>=h&&t<=d})),new Tc({beginAt:h,endAt:d,slices:r})));case 31:return e.abrupt("return",null);case 32:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"fillSliceLibIdentifier",value:function(e){var t,n=h(e.libIdentifier.replace(/\.\w+$/im,"").split("-"),2),r=n[0],i=n[1];if(r&&i)try{if(Ve.compare(Ve.parse(i),Ve.parse("2.7.0"))<0)switch(r){case"2.0.0":t="2.0.0-2.7.9.0f385eb562396be49fb451e80c1d85fa";break;case"2.1.0":t="2.1.0-2.8.0.fb7b9e324522d815ee4e40990d061a0b"}}catch(e){console.warn(e)}return t?ys(gs({},e),{libIdentifier:t}):e}}]),e}();!function(e){e.WaitingFirstFrame="waitingFirstFrame",e.Playing="playing",e.Pause="pause",e.Stopped="stopped",e.Ended="ended",e.Buffering="buffering",e.Seeking="seeking"}(Cc||(Cc={})),function(e){e[e.Success=0]="Success",e[e.SuccessButUnnecessary=1]="SuccessButUnnecessary",e[e.Override=2]="Override",e[e.Stopped=3]="Stopped"}(Ic||(Ic={}));var Oc=function(){function e(t){I(this,e);var n=t.onAkkoSetupFailed,r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new $o(e)}({escapeObjectFilter:t.escapeObjectFilter,jsxFactory:t.jsxFactory,observerAdapter:t.observerAdapter});if(this.imageFactory=new Hi(r),this.convertIdToUrl=t.convertIdToUrl,t.shuntApiHosts){var i=new Es({appIdentifier:t.appIdentifier,shuntApiHosts:t.shuntApiHosts,onInterruptConfigs:t.configsInterrupter,onAkkoSetupFailed:function(e){console.error("akko setup failed: ".concat(e.stack||e.message)),n&&n(e)}}),a=!!t.enableAnimationFrame,o={enableAnimationFrame:a},s=function(e){return!1===e?{disableReconnect:!0}:gs(gs({},Ys),e)}(t.reconnectionOptions);this.magixFactory=new vc(i,this.imageFactory,s,t.netStateAdapter,t.clientVersion,o),this.playerFactory=new Ec(i,this.imageFactory,t.clientVersion,a)}}var t;return M(e,[{key:"createMagix",value:function(e){if(!this.magixFactory)throw new Error("expect shuntApiHosts");var t=(new bs).create({convertIdToUrl:this.convertIdToUrl}),n=Object.freeze({resource:t});return this.magixFactory.createMagix(n,e)}},{key:"createReconstructor",value:function(e){if(!this.playerFactory)throw new Error("expect shuntApiHosts");var t=(new bs).create({convertIdToUrl:this.convertIdToUrl}),n=Object.freeze({resource:t});return this.playerFactory.createReconstructor(n,e)}},{key:"searchSlices",value:(t=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.playerFactory){e.next=2;break}throw new Error("expect shuntApiHosts");case 2:return e.next=4,this.playerFactory.searchSlices(t);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),Rc={};Y(Rc,{AnimationMode:function(){return bd},Boundless:function(){return Sd},BoundlessEventKind:function(){return Kc},CNode:function(){return El},CameraTransformation:function(){return yd},CanvasPaitingMode:function(){return gd},CanvasRenderMode:function(){return Sl},CanvasRenderState:function(){return md},ComponentKind:function(){return vd},DeviceType:function(){return ld},LayoutKind:function(){return kd},LayoutRenderMode:function(){return wd},RectangleAdapterMode:function(){return pd},RectangleTesting:function(){return Nh},RenderLayoutMode:function(){return Zc},creatHTMLRenderEngine:function(){return jl},createCanvasRenderEngine:function(){return Ml},createComponentDefinition:function(){return xd},distance:function(){return Pd},isCanvasRenderEngine:function(){return Tl},isHTMLRenderEngine:function(){return Dl},midpoint:function(){return Cd},unitVector:function(){return Id}});var Nc=X(n("aaBP")),Lc=Object.defineProperty,jc=Object.defineProperties,Dc=Object.getOwnPropertyDescriptors,Fc=Object.getOwnPropertySymbols,zc=Object.prototype.hasOwnProperty,Bc=Object.prototype.propertyIsEnumerable,Uc=function(e,t,n){return t in e?Lc(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Vc=function(e,t){for(var n in t||(t={}))zc.call(t,n)&&Uc(e,n,t[n]);if(Fc){var r,i=A(Fc(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Bc.call(t,n)&&Uc(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Wc=Object.freeze({debug:0,info:1,warn:2,error:3}),Hc=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.prefix,r=t.levelMask;I(this,e),this.prefix=n,this.levelMaskIndex=Wc[r||"info"]}return M(e,[{key:"log",value:function(e,t,n){Wc[t]>=this.levelMaskIndex&&(this.prefix?console[t](this.prefix,n):console[t](n))}},{key:"commit",value:function(){}},{key:"isSupportedEvents",value:function(e){return!0}}]),e}();function _c(e){var t={};for(var n in e){var r=e[n];void 0!==r&&(t[n]=r)}return t}function Gc(e,t,n){if(!e.isSupportedEvents(t))throw new Error("unsupported event name: ".concat(t));return function e(t,n,r){var i={debug:Yc(t,"debug",n,r),info:Yc(t,"info",n,r),warn:Yc(t,"warn",n,r),error:Yc(t,"error",n,r),withContext:function(i){return e(t,n,{context:Vc(Vc({},r.context),i)})}};return Object.defineProperty(i,"context",{enumerable:!1,set:function(e){return r.context=e},get:function(){return r.context}}),Object.freeze(i)}(e,t,n?{context:_c(n)}:{})}function Yc(e,t,n,r){return function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];for(var s=0;s<a.length;++s)a[s]=qc(a[s]);var c=Xc(r),u=a.join(" ");e.log(n,t,u,c)}}function Xc(e){var t;if(e.context)for(var n in t||(t={}),e.context)t[n]=e.context[n];return Object.freeze(t)}function qc(e){if(e instanceof Error){var t="Error: "+e.message+"\n";return"string"==typeof e.stack?t+e.stack.replace(t,""):t}try{return"".concat(e)}catch(t){return"[".concat(T(e)," ").concat(JSON.stringify(t.message),"]")}}function Qc(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.isSupportedEvents(t))throw new Error("unsupported event name: ".concat(t));var r=Object.freeze(_c(n));return Object.freeze({commit:function(n){e.commit(t,Vc(Vc({},r),n))}})}var Kc,Zc,Jc=function(){function t(e,n){I(this,t),this.argusEvents=function e(t){if("object"!=T(t)||null===t)return t;if(t instanceof Array){var n,r=[],i=A(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.push(e(a))}}catch(e){i.e(e)}finally{i.f()}return Object.freeze(r)}var o={};for(var s in t)o[s]=e(t[s]);return Object.freeze(o)}(e),this.vid=n}return M(t,[{key:"encode",value:function(t,n){var r=function(e,t){return jc(e,Dc(t))}(Vc({},n),{vid:this.vid,lts:Date.now(),clientIP:"__#CLIENT_IP#__"}),a=this.argusEvents[t],o=a.eventID,s=a.proto,c=s.verify(r);if(c)throw new Error(c);var u=s.create(r),l=function(t){if("object"==(void 0===i?"undefined":T(i))&&i+""=="[object process]")return e.from(t).toString("base64");for(var n,r="",a=0,o=t.length;a<o;)n=t.subarray(a,Math.min(a+32768,o)),r+=String.fromCharCode.apply(null,n),a+=32768;return btoa(r)}(s.encode(u).finish()),h="whiteBoard",d=Math.floor(Date.now()/1e3),f=Nc.default.hash("payload=".concat(l,"&src=").concat(h,"&ts=").concat(d));return{id:o,src:h,payload:l,qos:1===this.vid?101:1,ts:d,sign:f}}}]),t}(),$c=function(){function e(){I(this,e),this.queue=[]}return M(e,[{key:"append",value:function(e){this.queue.push(e)}},{key:"next",get:function(){return this.queue[0]}},{key:"done",value:function(){this.queue.shift()}},{key:"length",get:function(){return this.queue.length}}]),e}(),eu=function(){var e=l(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=regeneratorRuntime.mark((function e(r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t(n);case 3:return e.abrupt("return","break");case 6:if(e.prev=6,e.t0=e.catch(0),3!==r){e.next=10;break}throw new Error("report log failed (with ".concat(3," times failed), error: ").concat(e.t0));case 10:return e.next=12,new Promise((function(e){setTimeout(e,1e3*r)}));case 12:case"end":return e.stop()}}),e,null,[[0,6]])})),i=1;case 2:if(!(i<=3)){e.next=10;break}return e.delegateYield(r(i),"t0",4);case 4:if("break"!==e.t0){e.next=7;break}return e.abrupt("break",10);case 7:i++,e.next=2;break;case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),tu=function(){function e(t,n,r,i){I(this,e),this.logQueue=t,this.resourceURL=n,this.request=r,this.warnLog=i}var t;return M(e,[{key:"report",value:(t=l(regeneratorRuntime.mark((function e(t){var n,r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logQueue.append(t),1!==this.logQueue.length){e.next=19;break}case 1:if(!(n=this.logQueue.next)){e.next=16;break}return e.prev=3,e.next=6,eu((function(e){return r.request(e,r.resourceURL)}),n);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),this.warnLog(e.t0);case 11:return e.prev=11,this.logQueue.done(),e.finish(11);case 14:e.next=17;break;case 16:return e.abrupt("break",19);case 17:e.next=1;break;case 19:case"end":return e.stop()}}),e,this,[[3,8,11,14]])}))),function(e){return t.apply(this,arguments)})}]),e}(),nu=X(n("q1tI")),ru=X(n("q1tI")),iu=X(n("q1tI")),au=X(n("q1tI")),ou=X(n("q1tI")),su=X(n("q1tI")),cu=X(n("0Q2g")),uu=X(n("q1tI")),lu=X(n("q1tI")),hu=X(n("q1tI")),du=X(n("i8i4")),fu=X(n("q1tI")),pu=X(n("q1tI")),vu=X(n("lOZ2")),mu=Object.defineProperty,gu=Object.defineProperties,yu=Object.getOwnPropertyDescriptors,bu=Object.getOwnPropertySymbols,ku=Object.prototype.hasOwnProperty,wu=Object.prototype.propertyIsEnumerable,Su=function(e,t,n){return t in e?mu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},xu=function(e,t){for(var n in t||(t={}))ku.call(t,n)&&Su(e,n,t[n]);if(bu){var r,i=A(bu(t));try{for(i.s();!(r=i.n()).done;){n=r.value;wu.call(t,n)&&Su(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Cu=function(e,t){return gu(e,yu(t))};!function(e){e.MouseDown="MouseDown",e.MouseMove="MouseMove",e.MouseUp="MouseUp",e.MouseLeave="MouseLeave",e.MouseWheel="MouseWheel",e.TouchStart="TouchStart",e.TouchMove="TouchMove",e.TouchEnd="TouchEnd",e.TouchCancel="TouchCancel",e.SortedTouchStart="SortedTouchStart",e.SortedTouchMove="SortedTouchMove",e.SortedTouchEnd="SortedTouchEnd",e.SortedTouchCancel="SortedTouchCancel",e.KeyDown="KeyDown",e.KeyUp="KeyUp"}(Kc||(Kc={})),function(e){e[e.Normal=0]="Normal",e[e.Preview=1]="Preview"}(Zc||(Zc={}));var Iu,Pu=function(){function e(t){I(this,e),this.definitions={},this.id="".concat(e.nextId),this.orderIndex=t,e.nextId+=1}return M(e,[{key:"addDefinition",value:function(e){this.definitions[e.id]=e}}]),e}();Pu.nextId=0,function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.Safari=2]="Safari",e[e.IE=3]="IE",e[e.Other=4]="Other",e[e.Unkown=5]="Unkown"}(Iu||(Iu={}));var Mu=new(function(){function e(){I(this,e),this.kind=5}return M(e,[{key:"getContext",value:function(e){var t=e.getContext("2d");switch(t.imageSmoothingEnabled=!1,this.kind){case 0:t.mozImageSmoothingEnabled=!1;break;case 1:t.oImageSmoothingEnabled=!1;break;case 2:t.webkitImageSmoothingEnabled=!1;break;case 3:t.msImageSmoothingEnabled=!1;break;case 5:void 0!==t.mozImageSmoothingEnabled?(t.mozImageSmoothingEnabled=!1,this.kind=0):void 0!==t.oImageSmoothingEnabled?(t.oImageSmoothingEnabled=!1,this.kind=1):void 0!==t.webkitImageSmoothingEnabled?(t.webkitImageSmoothingEnabled=!1,this.kind=2):void 0!==t.msImageSmoothingEnabled&&(t.msImageSmoothingEnabled=!1,this.kind=3)}return t}}]),e}());function Tu(e){return Mu.getContext(e)}var Au,Eu=function(){function e(){I(this,e),this.paintFloatCount=0,this.generateCacheCount=0,this.paintCacheCount=0,this.fuseCacheCount=0,this.fuseCount=0,this.splitCount=0}return M(e,[{key:"recordPaintFloat",value:function(){this.paintFloatCount+=1}},{key:"recordGenerateCache",value:function(){this.generateCacheCount+=1}},{key:"recordPaintCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.paintCacheCount+=e}},{key:"recordFuseCache",value:function(){this.fuseCacheCount+=1}},{key:"recordFuse",value:function(e){this.fuseCount+=e}},{key:"recordSplit",value:function(){this.splitCount+=1}},{key:"clear",value:function(){this.paintFloatCount=0,this.generateCacheCount=0,this.paintCacheCount=0,this.fuseCacheCount=0,this.fuseCount=0,this.splitCount=0}},{key:"print",value:function(){console.log("\n========="),console.log("paintFloatCount",this.paintFloatCount),console.log("generateCacheCount",this.generateCacheCount),console.log("paintCacheCount",this.paintCacheCount),console.log("fuseCacheCount",this.fuseCacheCount),console.log("fuseCount",this.fuseCount),console.log("splitCount",this.splitCount),this.clear()}}]),e}(),Ou=Object.freeze({forEach:function(){return!1}});!function(e){e[e.Fusion=0]="Fusion",e[e.Rejection=1]="Rejection"}(Au||(Au={}));var Ru=function(){function e(t,n,r){var i=this;I(this,e),this.cells={},this.forEach=function(t){if(0===i.mode)for(var n in i.cells){var r=i.cells[n],a=r.row,o=r.column;if(t(a,o))return!0}return i.range.forEach((function(n,r){var a=e.key(n,r);return!(i.cells[a]||!t(n,r))}))},this.mode=t,this.range=n;var a,o=A(r);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=e.key(s.row,s.column);this.cells[c]=s}}catch(e){o.e(e)}finally{o.f()}}return M(e,null,[{key:"key",value:function(e,t){return"".concat(e,":").concat(t)}}]),e}(),Nu=function(){function e(t,n,r,i){var a=this;I(this,e),this.row0=t,this.row1=n,this.column0=r,this.column1=i,this.forEach=function(e){for(var t=a.row0,n=a.row1,r=a.column0,i=a.column1,o=t;o<n;++o)for(var s=r;s<i;++s)if(e(o,s))return!0;return!1}}return M(e,[{key:"toString",value:function(){return"[row0=".concat(this.row0," row1=").concat(this.row1," column0=").concat(this.column0," column1=").concat(this.column1,"]")}},{key:"excludeForEach",value:function(e){var t=this.row0,n=this.row1,r=this.column0,i=this.column1,a=t,o=this.clamp(t,e.row0,n),s=this.clamp(t,e.row1,n),c=n,u=r,l=this.clamp(r,e.column0,i),h=this.clamp(r,e.column1,i),d=i;return{forEach:function(e){for(var t=a;t<o;++t)for(var n=r;n<i;++n)if(e(t,n))return!0;for(var f=s;f<c;++f)for(var p=r;p<i;++p)if(e(f,p))return!0;for(var v=o;v<s;++v)for(var m=u;m<l;++m)if(e(v,m))return!0;for(var g=o;g<s;++g)for(var y=h;y<d;++y)if(e(g,y))return!0;return!1}}}},{key:"clamp",value:function(e,t,n){var r=t;return r<e?r=e:r>n&&(r=n),r}},{key:"rowsCount",get:function(){return this.row1-this.row0}},{key:"columnsCount",get:function(){return this.column1-this.column0}},{key:"includes",value:function(e,t){return this.row0<=e&&e<this.row1&&this.column0<=t&&t<this.column1}},{key:"includesRange",value:function(e){var t=e.row0,n=e.row1,r=e.column0,i=e.column1;return this.row0<=t&&n<=this.row1&&this.column0<=r&&i<=this.column1}},{key:"merge",value:function(t,n,r){for(var i=new e(Math.floor(this.row0/t),Math.ceil(this.row1/t),Math.floor(this.column0/n),Math.ceil(this.column1/n)),a=i.row0,o=i.row1,s=i.column0,c=i.column1,u=a;u<o;++u)for(var l=s;l<c;++l){var h=!1,d=u*t,f=(u+1)*t,p=l*n,v=(l+1)*n;d<this.row0&&(d=this.row0,h=!0),f>this.row1&&(f=this.row1,h=!0),p<this.column0&&(p=this.column0,h=!0),v>this.column1&&(v=this.column1,h=!0);var m=new e(d,f,p,v);m.rowsCount>0&&m.columnsCount>0&&r(u,l,m,h)}return i}},{key:"fork",value:function(t,n,r){for(var i=this.row0,a=this.row1,o=this.column0,s=this.column1,c=i;c<a;++c)for(var u=o;u<s;++u)r(c,u,new e(c*t,(c+1)*t,u*n,(u+1)*n));return new e(this.row0*t,this.row1*t,this.column0*n,this.column1*n)}}],[{key:"rectToRange",value:function(t,n){var r=t.originX,i=t.originY,a=t.width,o=t.height,s=n.width,c=n.height,u=Math.floor(i/c),l=Math.floor(r/s);return new e(u,Math.floor((i+o)/c)+1,l,Math.floor((r+a)/s)+1)}},{key:"cellToRect",value:function(e,t,n){var r=n.width,i=n.height;return{originX:t*r,originY:e*i,width:r,height:i}}},{key:"calcIntersection",value:function(t,n){var r=Math.max(t.row0,n.row0),i=Math.min(t.row1,n.row1),a=Math.max(t.column0,n.column0),o=Math.min(t.column1,n.column1);return r<i&&a<o?new e(r,i,a,o):null}},{key:"calcDiff",value:function(e,t){var n=this.calcIntersection(e,t);return{addedRange:e.excludeForEach(t),removedRange:t.excludeForEach(e),keepRange:n?{forEach:n.forEach}:Ou}}},{key:"isEquals",value:function(e,t){return e.row0===t.row0&&e.row1===t.row1&&e.column0===t.column0&&e.column1===t.column1}}]),e}(),Lu=function(){function e(){I(this,e),this.nodes={}}return M(e,[{key:"get",value:function(t,n){var r,i=e.key(t,n);return null==(r=this.nodes[i])?void 0:r.element}},{key:"set",value:function(t,n,r){var i=e.key(t,n);return this.nodes[i]=Object.freeze({element:r,row:t,column:n,key:i}),r}},{key:"delete",value:function(t,n){var r=e.key(t,n),i=this.nodes[r];if(i)return delete this.nodes[r],i.element}},{key:"fill",value:function(e){var t=e.nodes;for(var n in t)this.nodes[n]=t[n]}},{key:"clear",value:function(e){if(e)for(var t in this.nodes)e(this.nodes[t].element);this.nodes={}}},{key:"forEach",value:function(e){for(var t in this.nodes){var n=this.nodes[t];e(n.element,n.row,n.column)}}}],[{key:"key",value:function(e,t){return"".concat(e,":").concat(t)}}]),e}();function ju(e,t){if(T(e)!=T(t))return!1;if("object"!=T(e)||null===e)return e===t;if(e.constructor!==t.constructor)return!1;if(e.constructor===Object){for(var n in e){if(!(n in t))return!1;if(!ju(e[n],t[n]))return!1}for(var r in t)if(!(r in e))return!1;return!0}if(e.constructor===Array){var i=e,a=t;if(i.length!==a.length)return!1;for(var o=0;o<i.length;++o)if(!ju(e[o],t[o]))return!1;return!0}return!0}function Du(e){for(var t in e)return!0;return!1}var Fu=function(){function e(t){I(this,e),this.rate=t.rate,this.bucketUnitSize=Object.freeze(xu({},t.bucketUnitSize)),this.favorBucketsCount=t.favorBucketsCount,this.tree=t.tree,this.visions=t.visions,this.bucketFactory=t.bucketFactory,this.visibleNodes=this.initVisibleNodes(this.visions),this.onLeafNodeVisible=t.onLeafNodeVisible,this.onLeafNodeInvisible=t.onLeafNodeInvisible,this.visionCover=this.calcVisionCover(t.visionRectangle),this._projectiveSize=this.calcProjectiveSize(this.visionCover,t.scale),this.buckets=new Lu,this.searchAndFillVisibleNodes(this.visionCover.range,this._projectiveSize,this.visionCover.unitSize)}return M(e,[{key:"projectiveSize",get:function(){return this._projectiveSize}},{key:"unitSize",get:function(){return this.visionCover.unitSize}},{key:"range",get:function(){return this.visionCover.range}},{key:"forEachBuckets",value:function(e){this.buckets.forEach(e)}},{key:"bucket",value:function(e,t){return this.buckets.get(e,t)}},{key:"update",value:function(e){var t=this;this.refreshVisibleNodes(e.diff);var n=this.updateVision(e),r=n.addedRange,i=n.keepRange,a=n.updatedProjectiveSize,o=xu({},e.updateSet),s=!!e.dirtyCells,c=[];return i.forEach((function(n,r){var i=t.buckets.get(n,r),a=t.appendDiff(n,r,i,e,s),u=a.movedLeaves,l=a.touchedLeaves;l&&c.push({row:n,column:r,touchedLeaves:l}),Object.assign(o,u)})),r.forEach((function(n,r){var i,a=t.buckets.get(n,r).collectLeaves();null==(i=e.dirtyCells)||i.collect(n,r),Object.assign(o,a)})),i.forEach((function(n,r){var i=t.buckets.get(n,r);i.handleUpdatedLeaves(o),i.fuseChunksWithNeighbours(),i.increaseChunksLife(),a&&i.updateProjectiveSize(a,e.refresh)})),e.shouldUpdateAll&&this.forEachBuckets((function(e){return e.notifyGlobalUpdate()})),this.callbackLeavesVisible(e),c}},{key:"initVisibleNodes",value:function(e){var t={};return e.forEach((function(e){t[e.id]=e})),t}},{key:"refreshVisibleNodes",value:function(e){var t=e.addedSet,n=e.removedSet;for(var r in t)this.visibleNodes[r]=t[r];for(var i in n)delete this.visibleNodes[i]}},{key:"updateVision",value:function(t){var n=Ou,r=this.visionCover.range,i=null;if(t.visionRectangle){var a=this.calcVisionCover(t.visionRectangle,this.visionCover.exponent),o=this.calcProjectiveSize(a,t.scale);if(!e.isVisionCoversEquals(a,this.visionCover)){var s=this.forkOrMegeAndGetRangeDiff(a,o);this.searchAndFillVisibleNodes(s.addedRange,o,a.unitSize),this.visionCover=a,n=s.addedRange,r=s.keepRange}ju(o,this._projectiveSize)||(this._projectiveSize=o,i=o)}return{addedRange:n,keepRange:r,updatedProjectiveSize:i}}},{key:"forkOrMegeAndGetRangeDiff",value:function(e,t){var n,r=this,i=e.exponent-this.visionCover.exponent;if(i>0){var a=Math.pow(this.rate,i),o=new Lu,s=[],c=this.visionCover.range.merge(a,a,(function(n,i,a,c){if(e.range.includes(n,i))if(c)s.push({row:n,column:i});else{var u=r.bucketFactory.merge(r.buckets,{range:a,unitSize:e.unitSize,projectiveSize:t});o.set(n,i,u)}}));if(n=Nu.calcDiff(e.range,c),s.length>0){var u=function(e,t){return new Ru(Au.Fusion,e,t)}(n.addedRange,s),l=function(e,t){return new Ru(Au.Rejection,e,t)}(n.keepRange,s);n=Cu(xu({},n),{addedRange:u,keepRange:l})}this.buckets.forEach((function(e){return e.dispose()})),this.buckets=o}else if(i<0){var h=Math.pow(this.rate,Math.abs(i)),d=new Lu,f=this.visionCover.range.fork(h,h,(function(n,i,a){var o=Nu.calcIntersection(a,e.range),s=r.buckets.get(n,i);if(o&&s){var c=r.bucketFactory.fork(s,{range:o,unitSize:e.unitSize,projectiveSize:t});d.fill(c)}}));n=Nu.calcDiff(e.range,f),this.buckets.forEach((function(e){return e.dispose()})),this.buckets=d}else(n=Nu.calcDiff(e.range,this.visionCover.range)).removedRange.forEach((function(e,t){var n;null==(n=r.buckets.delete(e,t))||n.dispose()}));return n}},{key:"searchAndFillVisibleNodes",value:function(e,t,n){var r=this,i=null;e.forEach((function(e,a){if(!i)for(var o in i={},r.visibleNodes){var s=r.rangeOfLeafNode(r.visibleNodes[o],n);s&&(i[o]=s)}var c=Nu.cellToRect(e,a,n),u=r.bucketFactory.build(r.tree,c,t,(function(t){var n=i[t.id];return!(!n||!n.includes(e,a))}));r.buckets.set(e,a,u)}))}},{key:"appendDiff",value:function(e,t,n,r,i){var a=r.diff,o=r.moveSet,s=a.addedSet,c=this.visionCover.unitSize,u=[],l=[],h=[];for(var d in s){var f=this.rangeOfLeafNode(s[d],c);f&&!f.includes(e,t)&&u.push(d)}var p={};for(var v in o){var m=o[v],g=this.rangeOfLeafNode(m,c);if(g){var y=n.has(v),b=g.includes(e,t);y&&b?p[v]=m:y&&!b?h.push(m):!y&&b&&l.push(m)}}var k=i?{}:null;if(u.length>0||l.length>0||h.length>0){if(k){var w,S=A(u);try{for(S.s();!(w=S.n()).done;){k[w.value]=!0}}catch(e){S.e(e)}finally{S.f()}var x,C=A(l);try{for(C.s();!(x=C.n()).done;){k[x.value.id]=!0}}catch(e){C.e(e)}finally{C.f()}var I,P=A(h);try{for(P.s();!(I=P.n()).done;){k[I.value.id]=!0}}catch(e){P.e(e)}finally{P.f()}}a=a.decorate({maskAdded:u,insertToAdded:l,insertToRemoved:h})}if(k){for(var M in p)k[M]=!0;for(var T in r.updateSet)k[T]=!0;for(var E in r.diff.sortedSet)k[E]=!0;for(var O in r.diff.removedSet)k[O]=!0;Du(k)||(k=null)}return n.appendDiff(a),{movedLeaves:p,touchedLeaves:k}}},{key:"isLeavesTouchBucket",value:function(e,t){var n=!1;for(var r in t)if(e.has(r)){n=!0;break}return n}},{key:"callbackLeavesVisible",value:function(e){var t=e.diff,n=t.addedSet,r=t.removedSet;for(var i in n)this.onLeafNodeVisible(n[i]);for(var a in r)this.onLeafNodeInvisible(r[a])}},{key:"calcVisionCover",value:function(t,n){var r=t.width*t.height;0===r&&(r=1);var i=this.rate,a=this.favorBucketsCount,o=this.bucketUnitSize,s=o.width*o.height,c=Math.log(r/(a*s))/(2*Math.log(i));if(void 0===n)c=Math.ceil(c);else{var u=n+e.ExponentBuffer,l=n-1-e.ExponentBuffer;c=c>u||c<l?Math.ceil(c):n}var h=Math.pow(i,c),d=Object.freeze({width:o.width*h,height:o.height*h}),f=Nu.rectToRange(t,d);return Object.freeze({exponent:c,range:f,unitSize:d})}},{key:"calcProjectiveSize",value:function(e,t){var n=e.unitSize,r=n.width,i=n.height;return Object.freeze({width:Math.ceil(r*t),height:Math.ceil(i*t)})}},{key:"rangeOfLeafNode",value:function(e,t){var n=this.visions.vision(e.id);return n?Nu.rectToRange(n.sceneRect,t):null}}],[{key:"isVisionCoversEquals",value:function(e,t){return e.exponent===t.exponent&&e.unitSize.width===t.unitSize.width&&e.unitSize.height===t.unitSize.height&&Nu.isEquals(e.range,t.range)}}]),e}();Fu.ExponentBuffer=.25;var zu=function(){function e(t,n,r,i,a,o){var s=this;I(this,e),this.touch=function(){s.onRepaint(s.leaf.value)},this.screen=t,this.visions=n,this.id=r.id,this.leaf=r,this.fixedSize=i,this.render=a,this.onRepaint=o}return M(e,[{key:"refreshPayload",value:function(){this.render.updatePayload(this.leaf.value.payload)}},{key:"updateContext",value:function(e){this.render.updateContext(e)}},{key:"paint",value:function(e,t,n){var r=this.leaf.value,i=this.visions.vision(this.leaf.id),a=this.createPaintParams(e,i,r,t,n),o=i.screenRect.originX,s=i.screenRect.originY;if(n&&(o-=n.originX,s-=n.originY),e.translate(o,s),this.fixedSize){var c=i.scale;1!==c&&e.scale(c,c)}this.render.paint(a)}},{key:"createPaintParams",value:function(e,t,n,r,i){var a,o,s,c=t.screenRect,u=this.touch,l=this.createTailor(t,i);if(this.fixedSize){s=1,o={width:n.width,height:n.height};var h=t.scale,d=t.margin,f=c.width/h-o.width,p=c.height/h-o.height,v=f/(d.left+d.right),m=p/(d.top+d.bottom);a={left:d.left*v,right:d.right*v,top:d.top*m,bottom:d.bottom*m}}else s=t.scale,a=t.margin,o={width:c.width-a.left-a.right,height:c.height-a.top-a.bottom};var g={context:e,margin:a,scale:s,size:o,tailor:l,paintingMode:r,touch:u,screen:this.screen},y=this.createFakeScreenRect(o,l);return g.screenSize=y,g.screenRect=y,g}},{key:"createTailor",value:function(e,t){var n=e.tailor,r=n.left,i=n.top,a=n.right,o=n.bottom;if(t){var s=e.screenRect,c=s.originX,u=s.originY,l=c+s.width,h=u+s.height,d=c+r,f=u+i,p=l-a,v=h-o;r=(d=Math.max(d,t.originX))-c,i=(f=Math.max(f,t.originY))-u,a=l-(p=Math.min(p,t.originX+t.width)),o=h-(v=Math.min(v,t.originY+t.width))}if(this.fixedSize){var m=e.scale;r/=m,i/=m,a/=m,o/=m}return{left:r,top:i,right:a,bottom:o}}},{key:"createFakeScreenRect",value:function(e,t){var n=t.left,r=t.top;return{originX:n,originY:r,width:e.width-t.right-n,height:e.height-t.bottom-r}}}]),e}(),Bu=function(){function e(t){I(this,e),this.nodes=null,this.id="".concat(e.nextId+=1),this.life=0,this.context=t}return M(e,[{key:"isFloat",get:function(){var t;return this.life<e.fuseThreshold&&1===(null==(t=this.nodes)?void 0:t.length)}},{key:"onFuse",value:function(e,t){}},{key:"onSplit",value:function(){}},{key:"onRemoved",value:function(){}},{key:Symbol.iterator,value:function(){return new Uu(this.getNodes())}},{key:"previousChunk",get:function(){var e,t;return(null==(t=null==(e=this.getNodes()[0])?void 0:e.previousNode)?void 0:t.value)||null}},{key:"nextChunk",get:function(){var e,t,n=this.getNodes();return(null==(t=null==(e=n[n.length-1])?void 0:e.nextNode)?void 0:t.value)||null}},{key:"isFuseable",get:function(){return this.life>=e.fuseThreshold}},{key:"getSampleNode",value:function(){return this.nodes&&this.nodes.length>0?this.nodes[0]:null}},{key:"initWithNode",value:function(e){if(this.nodes)throw new Error("it is not init chunk");return this.nodes=[e],e.value=this,this}},{key:"initWithShadowList",value:function(e){if(this.nodes)throw new Error("it is not init chunk");this.nodes=[];var t,n=A(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.nodes.push(r),r.value=this}}catch(e){n.e(e)}finally{n.f()}return this}},{key:"increaseLife",value:function(){var t=this;this.life<e.fuseThreshold&&this.watchIsFloatUpdate((function(){t.life+=1}))}},{key:"cutOff",value:function(e,t){var n=this;return this.watchIsFloatUpdate((function(){var r=n.getNodes(),i=r.indexOf(e),a=r.indexOf(t);if(-1===i)throw new Error("cannot find begin node id=".concat(e.id," to cut off"));if(-1===a)throw new Error("cannot find end node id=".concat(e.id," to cut off"));var o=r.splice(a),s=n.createChunkWithNodes(o),c=r.splice(0,i+1);return{left:n.createChunkWithNodes(c),right:s,becomeBlank:0===r.length}}))}},{key:"split",value:function(e){var t=this;return this.watchIsFloatUpdate((function(){var n=t.getNodes(),r=n.indexOf(e),i=null,a=null;if(-1===r)throw new Error("cannot find node id=".concat(e.id," to split"));if(r<n.length-1){var o=n.splice(r+1);i=t.createChunkWithNodes(o)}if(r>0){var s=n.splice(0,r);a=t.createChunkWithNodes(s)}return t.onSplit(),{left:a,right:i}}))}},{key:"createChunkWithNodes",value:function(e){var t=this.context.create();t.nodes=e;var n,r=A(e);try{for(r.s();!(n=r.n()).done;){n.value.value=t}}catch(e){r.e(e)}finally{r.f()}return t.isFloat&&t.context.bind(t,e[0].related),t}},{key:"fuseNeighboursBeforeMe",value:function(){for(var e=this,t=[];e&&(null==(e=e.previousChunk)?void 0:e.isFuseable);)this.unshift(e),t.unshift(e);return t}},{key:"fuseNeighboursAfterMe",value:function(){for(var e=this,t=[];e&&(null==(e=e.nextChunk)?void 0:e.isFuseable);)this.push(e),t.push(e);return t}},{key:"unshift",value:function(e){var t=e.nodes;if(t){var n;(n=this.getNodes()).unshift.apply(n,p(t));var r,i=A(t);try{for(i.s();!(r=i.n()).done;){r.value.value=this}}catch(e){i.e(e)}finally{i.f()}}}},{key:"push",value:function(e){var t=e.nodes;if(t){var n;(n=this.getNodes()).push.apply(n,p(t));var r,i=A(t);try{for(i.s();!(r=i.n()).done;){r.value.value=this}}catch(e){i.e(e)}finally{i.f()}}}},{key:"resetLife",value:function(){this.life=0}},{key:"dispose",value:function(){this.isFloat&&this.context.unbind(this,this.nodes[0].related),this.nodes=null,this.life=0,this.onRemoved()}},{key:"getNodes",value:function(){return this.nodes||(this.nodes=[]),this.nodes}},{key:"watchIsFloatUpdate",value:function(e){var t=this.isFloat,n=this.nodes&&this.nodes[0].related,r=e(),i=this.isFloat;return!t&&i?this.context.bind(this,this.nodes[0].related):t&&!i&&this.context.unbind(this,n),r}}],[{key:"fuseEachNeighbours",value:function(e){var t=[],n={};for(var r in e)n[r]||function(){n[r]=!0;var i=e[r];i.isFuseable&&i.watchIsFloatUpdate((function(){var e=i.fuseNeighboursBeforeMe(),r=i.fuseNeighboursAfterMe();(e.length>0||r.length>0)&&(i.life=0,i.onFuse(e,r));var a,o=A(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;n[s.id]=!0,t.push(s)}}catch(e){o.e(e)}finally{o.f()}var c,u=A(r);try{for(u.s();!(c=u.n()).done;){var l=c.value;n[l.id]=!0,t.push(l)}}catch(e){u.e(e)}finally{u.f()}}))}();return t}}]),e}();Bu.fuseThreshold=5,Bu.nextId=0;var Uu=function(){function e(t){I(this,e),this.nodes=t,this.index=0}return M(e,[{key:"next",value:function(){var e;return this.index<this.nodes.length?(e={value:this.nodes[this.index],done:!1},this.index+=1):e={value:void 0,done:!0},e}}]),e}(),Vu=function(){function e(t){I(this,e),this.addedSet={},this.sortedSet={},this.removedSet={},this.id="".concat(e.nextId),this.releaser=t,e.nextId+=1}return M(e,[{key:"fetchDiff",value:function(){var e=new Wu(this.addedSet,this.sortedSet,this.removedSet);return this.addedSet={},this.sortedSet={},this.removedSet={},e}},{key:"release",value:function(){this.releaser(this.id)}},{key:"markAdded",value:function(e){this.addedSet[e.id]=e,delete this.sortedSet[e.id],delete this.removedSet[e.id]}},{key:"markSorted",value:function(e){this.addedSet[e.id]||(this.sortedSet[e.id]=e)}},{key:"markRemoved",value:function(e){this.removedSet[e.id]=e,delete this.addedSet[e.id],delete this.sortedSet[e.id]}}]),e}();Vu.nextId=0;var Wu=function(){function e(t,n,r){I(this,e),this.addedSet=t,this.sortedSet=n,this.removedSet=r}return M(e,[{key:"isBlank",get:function(){return!Du(this.addedSet)&&!Du(this.sortedSet)&&!Du(this.removedSet)}},{key:"decorate",value:function(t){var n=t.insertToAdded,r=t.insertToRemoved,i=t.maskAdded,a=null,o=null;if(n&&n.length>0){a=xu({},this.addedSet);var s,c=A(n);try{for(c.s();!(s=c.n()).done;){var u=s.value;a[u.id]=u}}catch(e){c.e(e)}finally{c.f()}}if(i&&i.length>0){a=a||xu({},this.addedSet);var l,h=A(i);try{for(h.s();!(l=h.n()).done;){delete a[l.value]}}catch(e){h.e(e)}finally{h.f()}}if(r&&r.length>0){o=xu({},this.removedSet);var d,f=A(r);try{for(f.s();!(d=f.n()).done;){var p=d.value;o[p.id]=p}}catch(e){f.e(e)}finally{f.f()}}return a=a||this.addedSet,o=o||this.removedSet,new e(a,this.sortedSet,o)}}],[{key:"createInsertDiff",value:function(t){var n,r={},i=A(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a.id]=a}}catch(e){i.e(e)}finally{i.f()}return new e(r,{},{})}}]),e}(),Hu=function(){function e(t){I(this,e);var n,r={},i=A(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r[a.id]={leaf:a,nex:null}}}catch(e){i.e(e)}finally{i.f()}this.nodes=r,this.leaves=t}return M(e,[{key:"sort",value:function(){for(var e in this.leaves.splice(0),this.nodes){var t=this.nodes[e],n=this.findNextNode(t);n&&(t.nex=n,delete this.nodes[n.leaf.id])}for(var r in this.nodes)for(var i=this.nodes[r];i;)this.leaves.push(i.leaf),i=i.nex;return this.leaves}},{key:"findNextNode",value:function(e){for(var t=e.leaf.nexLeaf();t;){var n=this.nodes[t.id];if(n)return n;t=t.nexLeaf()}return null}}]),e}(),_u=function(){function e(t,n){I(this,e),this.par=null,this.pre=null,this.nex=null,this.tree=t,this.value=n,this.id=String(e.nextId),e.nextId+=1}return M(e,[{key:"parent",get:function(){return this.par}},{key:"assertBlank",value:function(e){if(this.assertBelongsTo(e),this.par||this.pre||this.nex)throw new Error("node is not empty")}},{key:"assertAddedTo",value:function(e){if(this.assertBelongsTo(e),this.isFreeNode())throw new Error("this node did not add to any tree")}},{key:"assertBelongsTo",value:function(e){if(this.tree!==e)throw new Error("this node is belongs to another tree")}},{key:"isFreeNode",value:function(){return null===this.par}},{key:"preLeaf",value:function(){return this.pre?this.pre.lastLeaf():this.par?this.par.preLeaf():null}},{key:"nexLeaf",value:function(){return this.nex?this.nex.firstLeaf():this.par?this.par.nexLeaf():null}}]),e}();_u.nextId=0;var Gu=function(e){y(n,e);var t=k(n);function n(e,r){return I(this,n),t.call(this,e,r)}return M(n,[{key:"firstLeaf",value:function(){return this}},{key:"lastLeaf",value:function(){return this}}]),n}(_u),Yu=function(e){y(n,e);var t=k(n);function n(e,r){var i,a;I(this,n),(a=t.call(this,e,r)).fir=null,a.las=null,a.forEachLeaves=function(e){for(var t=a.fir;t;)t instanceof Gu?e(t):t.forEachLeaves(e),t=t.nex};var s=(o(i={},Symbol.iterator,(function(){return new qu(S(a))})),o(i,"forEach",a.forEachLeaves),i);return a.leaves=Object.freeze(s),a}return M(n,[{key:Symbol.iterator,value:function(){return new Xu(this.fir)}},{key:"nodes",get:function(){for(var e=[],t=this.fir;t;)e.push(t),t=t.nex;return e}},{key:"assertBlank",value:function(e){if(c(C(n.prototype),"assertBlank",this).call(this,e),this.fir||this.las)throw new Error("node is not empty")}},{key:"firstLeaf",value:function(){for(var e=this.fir;e;){var t=e.firstLeaf();if(t)return t;e=e.nex}return null}},{key:"lastLeaf",value:function(){for(var e=this.las;e;){var t=e.lastLeaf();if(t)return t;e=e.pre}return null}},{key:"forEach",value:function(e){for(var t=this.fir;t;)e(t),t=t.nex}},{key:"isFreeNode",value:function(){return c(C(n.prototype),"isFreeNode",this).call(this)&&this!==this.tree.root}}]),n}(_u),Xu=function(){function e(t){I(this,e),this.node=t}return M(e,[{key:"next",value:function(){var e;return this.node?(e={value:this.node,done:!1},this.node=this.node.nex):e={value:void 0,done:!0},e}}]),e}(),qu=function(){function e(t){I(this,e),this.node=t.firstLeaf(),this.lastLeaf=t.lastLeaf()}return M(e,[{key:"next",value:function(){var e;return this.node?(e={value:this.node,done:!1},this.node===this.lastLeaf?this.node=null:this.node=this.node.nexLeaf()):e={value:void 0,done:!0},e}}]),e}(),Qu=function(){function e(t){I(this,e),this.bufferMap={},this._root=new Yu(this),t&&t(this)}return M(e,[{key:"root",get:function(){return this._root}},{key:"createDiffBuffer",value:function(){var e=this,t=new Vu((function(t){return delete e.bufferMap[t]}));return this.bufferMap[t.id]=t,t}},{key:"wrapLeaf",value:function(e){return new Gu(this,e)}},{key:"wrapGroup",value:function(e){return new Yu(this,e)}},{key:Symbol.iterator,value:function(){return this._root.leaves[Symbol.iterator]()}},{key:"forEach",value:function(e){return this._root.leaves.forEach(e)}},{key:"append",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._root,n=e,r=t;n.assertBlank(this),r.assertAddedTo(this),this.appendTo(n,r),this.markAdded(n)}},{key:"addAfter",value:function(e,t){var n=e,r=t;if(n.assertBlank(this),r.assertAddedTo(this),r===this._root)throw new Error("cannot add after root");this.addAfterTo(n,r),this.markAdded(n)}},{key:"addBefore",value:function(e,t){var n=e,r=t;if(n.assertBlank(this),r.assertAddedTo(this),r===this._root)throw new Error("cannot add before root");this.addBeforeTo(n,r),this.markAdded(n)}},{key:"remove",value:function(e){var t=e;t.assertAddedTo(this),this.removeFrom(t),this.markRemoved(t)}},{key:"moveAppend",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._root,n=e,r=t;n.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(n),this.appendTo(n,r),this.markSorted(n)}},{key:"moveAfter",value:function(e,t){var n=e,r=t;n.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(n),this.addAfterTo(n,r),this.markSorted(n)}},{key:"moveBefore",value:function(e,t){var n=e,r=t;n.assertAddedTo(this),r.assertAddedTo(this),this.removeFrom(n),this.addBeforeTo(n,r),this.markSorted(n)}},{key:"appendTo",value:function(e,t){e.par=t,t.las?(e.pre=t.las,t.las.nex=e,t.las=e):(t.fir=e,t.las=e)}},{key:"addAfterTo",value:function(e,t){var n=t.nex,r=t.par;if(!r)throw new Error("cannot add after root");e.pre=t,e.nex=n,e.par=r,t.nex=e,n&&(n.pre=e),r.las===t&&(r.las=e)}},{key:"addBeforeTo",value:function(e,t){var n=t.pre,r=t.par;if(!r)throw new Error("cannot add before root");e.nex=t,e.pre=n,e.par=r,t.pre=e,n&&(n.nex=e),r.fir===t&&(r.fir=e)}},{key:"removeFrom",value:function(e){var t=e.pre,n=e.nex,r=e.par;if(!r)throw new Error("cannot remove root");t&&(t.nex=n),n&&(n.pre=t),r.fir===e&&(r.fir=n),r.las===e&&(r.las=t),e.par=null,e.pre=null,e.nex=null}},{key:"sortLeaves",value:function(e){return e.length<=1?e:new Hu(e).sort()}},{key:"sort",value:function(e,t){var n=e;n.assertAddedTo(this);var r=n.nodes,i=p(r).sort(t);this.rebuildList(n,i),this.checkAndMarkSorted(r,i)}},{key:"rebuildList",value:function(e,t){t.length>0&&(e.fir=t[0],e.las=t[t.length-1]);for(var n=null,r=0;r<t.length;++r){var i=t[r];n&&(n.nex=i),i.pre=n,n=i}n&&(n.nex=null)}},{key:"checkAndMarkSorted",value:function(e,t){for(var n={},r={},i=0;i<e.length;++i){n[e[i].id]=i}var a,o=[],s=!1,c=null,u=0,l=-1,h=A(t);try{for(h.s();!(a=h.n()).done;){var d=n[a.value.id];if(c){var f=!1,p=c[c.length-1];if(d<=p)f=!0;else switch(c.length){case 0:break;case 1:s=d===p+1;break;default:d===p+1!==s&&(f=!0)}f?(o.push(c),c.length>u&&(u=c.length,l=o.length-1),c=[d]):c.push(d)}else c=[d]}}catch(e){h.e(e)}finally{h.f()}if(c&&(o.push(c),c.length>u&&(u=c.length,l=o.length-1)),-1!==l){for(var v=o[l],m=v[0],g=v[v.length-1],y=l-1;y>=0;y--){var b=o[y];if(b[b.length-1]<m)m=b[0];else{var k,w=A(b);try{for(w.s();!(k=w.n()).done;){var S=e[k.value];r[S.id]=S}}catch(e){w.e(e)}finally{w.f()}}}for(var x=l+1;x<o.length;x++){var C=o[x];if(C[0]>g)g=C[C.length-1];else{var I,P=A(C);try{for(P.s();!(I=P.n()).done;){var M=e[I.value];r[M.id]=M}}catch(e){P.e(e)}finally{P.f()}}}}for(var T in r)this.markSorted(r[T])}},{key:"markAdded",value:function(e){for(var t in this.bufferMap){var n=this.bufferMap[t];if(e instanceof Gu)n.markAdded(e);else{var r,i=A(e.leaves);try{for(i.s();!(r=i.n()).done;){var a=r.value;n.markAdded(a)}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"markSorted",value:function(e){for(var t in this.bufferMap){var n=this.bufferMap[t];if(e instanceof Gu)n.markSorted(e);else{var r,i=A(e.leaves);try{for(i.s();!(r=i.n()).done;){var a=r.value;n.markSorted(a)}}catch(e){i.e(e)}finally{i.f()}}}}},{key:"markRemoved",value:function(e){for(var t in this.bufferMap){var n=this.bufferMap[t];if(e instanceof Gu)n.markRemoved(e);else{var r,i=A(e.leaves);try{for(i.s();!(r=i.n()).done;){var a=r.value;n.markRemoved(a)}}catch(e){i.e(e)}finally{i.f()}}}}}]),e}(),Ku=function(){function e(t){I(this,e),this.pre=null,this.nex=null,this.id=t.id,this.related=t}return M(e,[{key:"previousNode",get:function(){return this.pre}},{key:"nextNode",get:function(){return this.nex}}]),e}(),Zu=function(){function e(t){I(this,e),this.nodesSet={},this._length=0,this.fir=null,this.las=null,this.valueInitializer=t}return M(e,[{key:"length",get:function(){return this._length}},{key:"firstNode",get:function(){return this.fir}},{key:"node",value:function(e){return this.nodesSet[e]||null}},{key:"findNode",value:function(e){for(var t=this.fir;t&&!e(t);)t=t.nex;return t}},{key:Symbol.iterator,value:function(){return new Ju(this.fir)}},{key:"forEach",value:function(e){for(var t=this.fir;t;)e(t),t=t.nex}},{key:"appendDiff",value:function(e){var t=[],n=[],r=[];for(var i in e.removedSet){var a=this.nodesSet[i];a&&(this.removeNode(a),delete this.nodesSet[i],t.push(a),this._length-=1)}for(var o in e.sortedSet){var s=this.nodesSet[o];s&&!e.addedSet[o]&&(this.removeNode(s),r.push(s))}for(var c in e.addedSet)if(!this.nodesSet[c]){var u=e.addedSet[c],l=new Ku(u);l.value=this.valueInitializer(l),this.nodesSet[c]=l,n.push(l),this._length+=1}for(var h=0,d=n;h<d.length;h++){var f=d[h];this.addNode(f)}for(var p=0,v=r;p<v.length;p++){var m=v[p];this.addNode(m)}return{removedNodes:t,addedNodes:n,sortedNodes:r}}},{key:"filter",value:function(t){var n,r=new e(this.valueInitializer),i=A(this);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(t(a)){var o=a.related,s=a.value,c=new Ku(o);c.value=s,r.appendNode(c)}}}catch(e){i.e(e)}finally{i.f()}return r}},{key:"removeNode",value:function(e){var t=e.pre,n=e.nex;t&&(t.nex=n),n&&(n.pre=t),this.fir===e&&(this.fir=n),this.las===e&&(this.las=t),e.pre=null,e.nex=null}},{key:"appendNode",value:function(e){this.las?(e.pre=this.las,this.las.nex=e,this.las=e):(this.fir=e,this.las=e),this.nodesSet[e.id]=e,this._length+=1}},{key:"addNode",value:function(e){var t=this.findPreNode(e),n=this.findNexNode(e);t?(t.nex=e,e.pre=t):this.fir=e,n?(n.pre=e,e.nex=n):this.las=e}},{key:"findPreNode",value:function(e){for(var t=e.related.preLeaf();t;){var n=this.nodesSet[t.id];if(n)return n;t=t.preLeaf()}return null}},{key:"findNexNode",value:function(e){for(var t=e.related.nexLeaf();t;){var n=this.nodesSet[t.id];if(n)return n;t=t.nexLeaf()}return null}}],[{key:"create",value:function(t){var n,r=new e(t.valueInitializer),i=t.initLeafFilter||e.alwaysTrue,a=A(t.tree);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(i(o)){var s=new Ku(o);s.value=r.valueInitializer(s),r.appendNode(s)}}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"alwaysTrue",value:function(){return!0}},{key:"merge",value:function(t){if(t.length>0){var n,r=new e(t[0].valueInitializer),i=r.nodesSet,a=A(t);try{for(a.s();!(n=a.n()).done;){var o,s=A(n.value);try{for(s.s();!(o=s.n()).done;){var c=o.value,u=c.id,l=c.related,h=c.value;if(!i[u]){var d=new Ku(l);d.value=h,i[u]=d,r._length+=1,r.addNode(d)}}}catch(e){s.e(e)}finally{s.f()}}}catch(e){a.e(e)}finally{a.f()}return r}return null}}]),e}(),Ju=function(){function e(t){I(this,e),this.node=t}return M(e,[{key:"next",value:function(){var e;return this.node?(e={value:this.node,done:!1},this.node=this.node.nex):e={value:void 0,done:!0},e}}]),e}(),$u=function(){function e(t){I(this,e),this.visions=t}return M(e,[{key:"build",value:function(e,t,n,r){var i,a=this.canvasPool,s=this.chunkContext,c=Zu.create({tree:e,initLeafFilter:null!=r?r:function(){return!1},valueInitializer:function(){return null}});if(r&&c.length>0){var u=s.create().initWithShadowList(c);i=o({},u.id,u),u.isFloat&&s.bind(u,u.getSampleNode().related)}return this.create({canvasPool:a,rectangle:t,chunks:i,projectiveSize:n,shadowList:c,chunkContext:s})}},{key:"merge",value:function(e,t){var n=t.range,r=t.unitSize,i=t.projectiveSize,a=[];n.forEach((function(t,n){a.push(e.get(t,n).shadowList)}));var o=this.canvasPool,s=this.chunkContext,c=Zu.merge(a),u={};if(c.length>0){var l=s.create().initWithShadowList(c);u[l.id]=l,l.isFloat&&s.bind(l,l.getSampleNode().related)}var h=n.row0*n.rowsCount,d=n.column0*n.columnsCount,f=Nu.cellToRect(h,d,r);return this.create({canvasPool:o,rectangle:f,shadowList:c,chunks:u,projectiveSize:i,chunkContext:s})}},{key:"fork",value:function(e,t){var n=this,r=t.range,i=t.unitSize,a=t.projectiveSize,o=this.canvasPool,s=this.chunkContext,c={},u=new Lu;return e.shadowList.forEach((function(e){var t=n.visions.vision(e.related.id);if(t){var r=Nu.rectToRange(t.sceneRect,i);c[e.id]=r}})),r.forEach((function(t,r){var l=e.shadowList.filter((function(e){var n;return!!(null==(n=c[e.id])?void 0:n.includes(t,r))})),h={};if(l.length>0){var d=s.create().initWithShadowList(l);h[d.id]=d,s.bind(d,d.getSampleNode().related)}u.set(t,r,n.create({canvasPool:o,shadowList:l,chunks:h,projectiveSize:a,chunkContext:s,rectangle:Nu.cellToRect(t,r,i)}))})),u}}]),e}(),el=function(){function e(t){I(this,e),this.id="".concat(e.nextId+=1),this.chunkContext=t.chunkContext,this.rectangle=t.rectangle,this._projectiveSize=t.projectiveSize,this.shadowList=t.shadowList,this.chunks=t.chunks||{}}return M(e,[{key:"onProjectiveSizeUpdate",value:function(e,t){}},{key:"projectiveSize",get:function(){return this._projectiveSize}},{key:"firstChunk",get:function(){var e=this.shadowList.firstNode;return e?e.value:null}},{key:Symbol.iterator,value:function(){return new tl(this.firstChunk)}},{key:"has",value:function(e){return null!==this.shadowList.node(e)}},{key:"findChunk",value:function(e){var t=null,n=this.shadowList.node(e.id);return n&&(t=this.findChunkByNode(n)),t}},{key:"collectLeaves",value:function(){var e={};for(var t in this.chunks){var n,r=A(this.chunks[t]);try{for(r.s();!(n=r.n()).done;){var i=n.value;e[i.id]=i.related}}catch(e){r.e(e)}finally{r.f()}}return e}},{key:"appendDiff",value:function(e){var t,n=this.shadowList.appendDiff(e),r=n.removedNodes,i=n.addedNodes,a=n.sortedNodes,o=A(a);try{for(o.s();!(t=o.n()).done;){var s=t.value;this.removeNode(s)}}catch(e){o.e(e)}finally{o.f()}var c,u=A(r);try{for(u.s();!(c=u.n()).done;){var l=c.value;this.removeNode(l)}}catch(e){u.e(e)}finally{u.f()}var h,d=A(i);try{for(d.s();!(h=d.n()).done;){var f=h.value;this.addNode(f)}}catch(e){d.e(e)}finally{d.f()}var p,v=A(a);try{for(v.s();!(p=v.n()).done;){var m=p.value;this.addNode(m)}}catch(e){v.e(e)}finally{v.f()}}},{key:"removeNode",value:function(e){var t=this.findChunkByNode(e);if(t){var n=this.chunkContext,r=t.split(e),i=r.left,a=r.right;i&&(this.chunks[i.id]=i,i.isFloat&&n.bind(i,i.getSampleNode().related)),a&&(this.chunks[a.id]=a,a.isFloat&&n.bind(a,a.getSampleNode().related)),delete this.chunks[t.id],t.dispose()}}},{key:"addNode",value:function(e){var t=this.chunkContext,n=this.previousNode(e),r=null==n?void 0:n.value,i=this.nextNode(e),a=null==i?void 0:i.value;if(r&&r===a){var o=r,s=o.cutOff(n,i),c=s.left,u=s.right,l=s.becomeBlank;this.chunks[c.id]=c,this.chunks[u.id]=u,c.isFloat&&t.bind(c,c.getSampleNode().related),u.isFloat&&t.bind(u,u.getSampleNode().related),l?(delete this.chunks[o.id],o.dispose()):o.resetLife()}var h=this.chunkContext.create().initWithNode(e);this.chunks[h.id]=h,t.bind(h,h.getSampleNode().related)}},{key:"previousNode",value:function(e){for(var t=e.previousNode;t&&!t.value;)t=t.previousNode;return t}},{key:"nextNode",value:function(e){for(var t=e.nextNode;t&&!t.value;)t=t.nextNode;return t}},{key:"findChunkByNode",value:function(e){var t=e.value,n=null;if(t&&(n=this.chunks[t.id])!==t)throw new Error("invalid node");return n}},{key:"handleUpdatedLeaves",value:function(e){for(var t in e){var n=this.shadowList.node(t);if(null==n?void 0:n.value){var r=n.value,i=r.split(n),a=i.left,o=i.right,s=this.chunkContext;a&&(this.chunks[a.id]=a,a.isFloat&&s.bind(a,a.getSampleNode().related)),o&&(this.chunks[o.id]=o,o.isFloat&&s.bind(o,o.getSampleNode().related)),r.resetLife()}}}},{key:"fuseChunksWithNeighbours",value:function(){var e,t=this.chunks,n=A(Bu.fuseEachNeighbours(t));try{for(n.s();!(e=n.n()).done;){var r=e.value;delete t[r.id],r.dispose()}}catch(e){n.e(e)}finally{n.f()}}},{key:"increaseChunksLife",value:function(){var e=this.chunks;for(var t in e)e[t].increaseLife()}},{key:"updateProjectiveSize",value:function(e,t){this._projectiveSize=e,this.onProjectiveSizeUpdate(e,t)}},{key:"dispose",value:function(){var e,t={},n=A(this.shadowList);try{for(n.s();!(e=n.n()).done;){var r=e.value.value;r&&(t[r.id]=r)}}catch(e){n.e(e)}finally{n.f()}for(var i in t)t[i].dispose()}},{key:"notifyGlobalUpdate",value:function(){}}]),e}();el.nextId=0;var tl=function(){function e(t){I(this,e),this.chunk=t}return M(e,[{key:"next",value:function(){var e,t;return this.chunk?(t={value:this.chunk,done:!1},this.chunk=null!=(e=this.chunk.nextChunk)?e:null):t={value:void 0,done:!0},t}}]),e}(),nl=function(){function e(t){I(this,e),this.nodes={},this.factory=t}return M(e,[{key:"create",value:function(){return this.factory(this)}},{key:"forEachCandidateFloatNodes",value:function(e){for(var t in this.nodes)e(this.nodes[t].leaf)}},{key:"bind",value:function(e,t){var n=this.nodes[t.id];n||(n=this.nodes[t.id]={leaf:t,chunks:{}}),n.chunks[e.id]=e}},{key:"unbind",value:function(e,t){var n=this.nodes[t.id];if(n){var r=n.chunks;delete r[e.id],Du(r)||delete this.nodes[t.id]}}}]),e}(),rl=function(){function e(){I(this,e),this.refManager=new il,this.pool=[]}return M(e,[{key:"pull",value:function(){var e;if(0===this.pool.length){var t=document.createElement("canvas");e={canvas:t,context:Tu(t),size:{width:0,height:0}}}else e=this.pool.pop();return e}},{key:"push",value:function(e){this.pool.push(e)}},{key:"clear",value:function(){this.pool=[]}}]),e}(),il=function(){function e(){I(this,e),this.refs={},this._length=0}return M(e,[{key:"has",value:function(e){return e in this.refs}},{key:"set",value:function(e,t){if(!this.has(e)){var n={id:e,value:t,prev:this.tail};this.tail?(this.tail.next=n,this.tail=n):this.head=this.tail=n,this.refs[e]=n,this._length+=1}}},{key:"delete",value:function(e){if(this.has(e)){var t=this.refs[e],n=t.prev,r=t.next;n?n.next=r:this.head=r,r?r.prev=n:this.tail=n,delete this.refs[e],this._length-=1}}},{key:"shift",value:function(){var e=this.head;if(e)return this.delete(e.id),e.value}},{key:"length",get:function(){return this._length}}]),e}(),al=function(){function e(t){I(this,e),this.canvasPool=t,this.id="".concat(e.id+=1),this.value=null}return M(e,[{key:"get",value:function(){return this.value}},{key:"allocate",value:function(t){if(this.value)throw new Error("can not call allocate on non empty canvasRef!");var n;if(this.canvasPool.refManager.length<e.MaxRefsSize)n=this.canvasPool.pull();else{var r=this.canvasPool.refManager.shift();n=r.value,r.value=null}this.value=n,this.canvasPool.refManager.set(this.id,this);var i=n,a=i.canvas,o=i.context,s=n.size=t,c=s.width,u=s.height;return a.width=c+1,a.height=u+1,o.resetTransform(),n}},{key:"clear",value:function(){this.canvasPool.refManager.delete(this.id),this.value&&(this.canvasPool.push(this.value),this.value=null)}},{key:"isEmpty",value:function(){return null==this.value}},{key:"isSizeEquals",value:function(e){return!!this.value&&ju(this.value.size,e)}}]),e}();al.MaxRefsSize=256,al.id=0;var ol=function(e){y(n,e);var t=k(n);function n(e,r,i,a){var o;return I(this,n),(o=t.call(this,i)).ratio=1,o.cacheSize=n.initCacheSize,o.didCacheSizeUpdated=!1,o.projectiveRect=n.initProjectiveReact,o.painter=e,o.statistical=a,o.canvasPool=r,o.canvasRef=new al(r),o}return M(n,[{key:"onSplit",value:function(){var e;this.canvasRef.clear(),null==(e=this.statistical)||e.recordSplit()}},{key:"onRemoved",value:function(){this.canvasRef.clear()}},{key:"updateProjectiveRect",value:function(e){this.projectiveRect=e}},{key:"updateCacheInfo",value:function(e,t,n){this.ratio=e,ju(this.cacheSize,t)||(this.cacheSize=t,this.didCacheSizeUpdated=!0),n&&this.didCacheSizeUpdated&&(this.canvasRef.clear(),this.didCacheSizeUpdated=!1)}},{key:"onGlobalUpdate",value:function(){this.canvasRef.clear()}},{key:"paint",value:function(e){var t,n,r,i=this.canvasRef.get();if(i)r=i.canvas;else{var a=this.canvasRef.allocate(this.cacheSize),o=a.context,s=a.canvas;o.scale(this.ratio,this.ratio),this.paintNodes(o,this,gd.GenerateCache),null==(t=this.statistical)||t.recordGenerateCache(),r=s}if(this.canvasRef.isSizeEquals(this.cacheSize))e.drawImage(r,0,0);else{var c=this.cacheSize,u=c.width,l=c.height;e.drawImage(r,0,0,u+1,l+1)}null==(n=this.statistical)||n.recordPaintCache()}},{key:"onFuse",value:function(e,t){var n;if(!this.canvasRef.isEmpty()||this.hasAnyCache(e)||this.hasAnyCache(t)){var r,i=[].concat(p(e),[this],p(t)),a=i[0],o=i.slice(1);a.canvasRef.isSizeEquals(this.cacheSize)?r=a.canvasRef:(r=this.mergeChunk(new al(this.canvasPool),a),this.canvasRef.clear());var s,c=A(o);try{for(c.s();!(s=c.n()).done;){var u=s.value;r=this.mergeChunk(r,u)}}catch(e){c.e(e)}finally{c.f()}this.canvasRef=r}null==(n=this.statistical)||n.recordFuse(e.length+1+t.length)}},{key:"hasAnyCache",value:function(e){var t,n=A(e);try{for(n.s();!(t=n.n()).done;){if(!t.value.canvasRef.isEmpty())return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"mergeChunk",value:function(e,t){var n,r,i;if(e.isEmpty()?i=e.allocate(this.cacheSize).context:i=e.get().context,t.canvasRef.isEmpty()){var a=this.paintNodes(i,t,gd.GenerateCache);null==(n=this.statistical)||n.recordPaintCache(a)}else{i.resetTransform();var o=t.canvasRef.get().canvas;if(t.canvasRef.isSizeEquals(this.cacheSize))i.drawImage(o,0,0);else{var s=this.cacheSize,c=s.width,u=s.height;i.drawImage(o,0,0,c+1,u+1)}null==(r=this.statistical)||r.recordFuseCache()}return e}},{key:"paintNodes",value:function(e,t,n){var r,i,a=0,o=A(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;e.resetTransform(),e.scale(this.ratio,this.ratio),null==(r=this.painter(s.id))||r.paint(e,n,this.projectiveRect),a+=1}}catch(e){o.e(e)}finally{o.f()}return a}}]),n}(Bu);ol.initCacheSize=Object.freeze({width:1,height:1}),ol.initProjectiveReact=Object.freeze({originX:0,originY:0,width:1,height:1});var sl,cl,ul=function(e){y(n,e);var t=k(n);function n(e,r,i,a){var o;return I(this,n),(o=t.call(this,r)).canvasPool=i,o.chunkContext=new nl((function(t){return new ol(e,i,t,a)})),o}return M(n,[{key:"create",value:function(e){return new ll(e)}}]),n}($u),ll=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).ratio=1,r.cacheSize=Object.freeze({width:e.projectiveSize.width,height:e.projectiveSize.height}),r.projectiveRect=Object.freeze(xu({originX:0,originY:0},e.projectiveSize)),r}return M(n,[{key:"updatePaintInfo",value:function(e,t,n,r){this.projectiveRect=Object.freeze(Cu(xu({},this.projectiveRect),{originX:e,originY:t})),this.ratio=n,this.cacheSize=Object.freeze({width:this.projectiveSize.width*n,height:this.projectiveSize.height*n}),this.updateCacheInfo(this.ratio,this.cacheSize,r),this.updateProjectiveRect(this.projectiveRect)}},{key:"onProjectiveSizeUpdate",value:function(e,t){this.projectiveRect=Object.freeze(xu(xu({},this.projectiveRect),e)),this.cacheSize=Object.freeze({width:this.projectiveSize.width*this.ratio,height:this.projectiveSize.height*this.ratio}),this.updateCacheInfo(this.ratio,this.cacheSize,t),this.updateProjectiveRect(this.projectiveRect)}},{key:"updateCacheInfo",value:function(e,t,n){var r,i=A(this);try{for(i.s();!(r=i.n()).done;){r.value.updateCacheInfo(e,t,n)}}catch(e){i.e(e)}finally{i.f()}}},{key:"updateProjectiveRect",value:function(e){var t,n=A(this);try{for(n.s();!(t=n.n()).done;){t.value.updateProjectiveRect(e)}}catch(e){n.e(e)}finally{n.f()}}},{key:"notifyGlobalUpdate",value:function(){var e,t=A(this);try{for(t.s();!(e=t.n()).done;){e.value.onGlobalUpdate()}}catch(e){t.e(e)}finally{t.f()}}},{key:"paint",value:function(e,t,n){for(var r,i=n||this[Symbol.iterator](),a=null;!(r=i.next()).done;){var o=r.value;if(t(o)){a=o;break}o.paint(e)}return{iterator:i,floatChunk:a}}}]),n}(el);!function(e){e[e.None=0]="None",e[e.CoverByTop=1]="CoverByTop",e[e.Repaint=2]="Repaint"}(sl||(sl={})),function(e){e[e.None=0]="None",e[e.All=1]="All",e[e.Part=2]="Part"}(cl||(cl={}));var hl=function(){function e(){I(this,e),this.dirties=[]}return M(e,[{key:"createDirty",value:function(){var e=this,t=new fl((function(){var n=e.dirties.indexOf(t);-1!==n&&e.dirties.splice(n,1)}));return this.dirties.push(t),t}},{key:"canBeMoreDirty",get:function(){var e,t=!1,n=A(this.dirties);try{for(n.s();!(e=n.n()).done;){if(e.value.canBeMoreDirty){t=!0;break}}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"dirtyAll",value:function(){var e,t=A(this.dirties);try{for(t.s();!(e=t.n()).done;){e.value.dirtyAll()}}catch(e){t.e(e)}finally{t.f()}}},{key:"createDirtyCellsCollection",value:function(){var e=this;return new dl(null,(function(t,n){var r,i=A(e.dirties);try{for(i.s();!(r=i.n()).done;){r.value.dirtyCells(t,n)}}catch(e){i.e(e)}finally{i.f()}}))}}]),e}(),dl=function(){function e(t,n){I(this,e),this.cells={},this.subCells={},this.parent=t,this.onCollectedCells=n}return M(e,[{key:"createSub",value:function(){return new e(this,null)}},{key:"collect",value:function(e,t){var n=fl.key(e,t);n in this.cells||(this.cells[n]={row:e,column:t,level:0})}},{key:"complete",value:function(e){var t,n=this.putLevelAndCollectMaxLevel(e);this.assignSubCells(),this.parent&&this.reportToParent(this.parent),null==(t=this.onCollectedCells)||t.call(this,n,this.cells)}},{key:"putLevelAndCollectMaxLevel",value:function(e){var t=0;for(var n in this.cells){var r=this.cells[n].level;this.cells[n].level=Math.max(r,e),t=Math.max(t,e)}return t}},{key:"assignSubCells",value:function(){for(var e in this.subCells)if(e in this.cells){var t=this.cells[e].level;this.cells[e].level=Math.max(t,this.subCells[e].level)}else this.cells[e]=this.subCells[e]}},{key:"reportToParent",value:function(e){var t=e.subCells;for(var n in this.cells){var r=t[n],i=this.cells[n];r&&r.level>i.level&&(i=r),t[n]=i}}}]),e}(),fl=function(){function e(t){I(this,e),this.phase=1,this.cells=null,this.release=t}return M(e,[{key:"canBeMoreDirty",get:function(){return 1!==this.phase}},{key:"takeDirtyState",value:function(){var e=new pl(this.phase,this.cells);return this.phase=0,this.cells=null,e}},{key:"dirtyAll",value:function(){this.phase=1,this.cells=null}},{key:"dirtyCells",value:function(e,t){1!==this.phase&&(e>=2&&(this.phase=2),this.cells?Object.assign(this.cells,t):this.cells=xu({},t))}}],[{key:"key",value:function(e,t){return"".concat(e,",").concat(t)}}]),e}(),pl=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;I(this,e),this.cells=null,this.phase=t,this.cells=n}return M(e,[{key:"isDirty",value:function(e,t){switch(this.phase){case 2:if(this.cells){var n=fl.key(e,t),r=this.cells[n];return!!r&&r.level>=2}return!1;case 1:return!0;default:return!1}}},{key:"forEachDirtyBuckets",value:function(e,t,n){switch(this.phase){case 1:e.forEachBuckets(n);break;case 2:if(this.cells)for(var r in this.cells){var i=this.cells[r],a=i.row,o=i.column;if(i.level>=t){var s=e.bucket(a,o);s&&n(s,a,o)}}}}}]),e}(),vl=function(){function e(t){var n=this;I(this,e),this.paintableBucketsQueue=[],this.isFloatChunk=function(e){return e.id in n.chunkToFloatMap},this.grid=t.grid,this.cleanBucketsBackground=t.cleanBucketsBackground,this.dirtyState=t.dirtyState,this.floatLeafPainter=t.floatLeafPainter,this.paintBucket=t.bucketPainter,this.chunkToFloatMap=t.floatNodesInfo.chunkToFloatMap,this.pendingByFloats=t.floatNodesInfo.pendingByFloats}return M(e,[{key:"collectBuckets",value:function(){var e=this;this.dirtyState.forEachDirtyBuckets(this.grid,sl.CoverByTop,(function(t,n,r){e.startToPaintBucket({bucket:t,row:n,column:r},e.cleanBucketsBackground)}))}},{key:"runLoopToPaintAll",value:function(){for(;this.paintableBucketsQueue.length>0;)this.startToPaintBucket(this.paintableBucketsQueue.pop(),!1);Du(this.pendingByFloats)&&this.printPendingFloatNodesWarn()}},{key:"printPendingFloatNodesWarn",value:function(){for(var e in console.warn("found pending float nodes were never paint"),this.pendingByFloats){var t=this.pendingByFloats[e],n=t.untouched,r=t.pending,i=Object.keys(n).join(", "),a=Object.keys(r).join(", ");console.warn("float ".concat(e," is waiting ").concat(i," to touch, and is padding buckets ").concat(a))}}},{key:"startToPaintBucket",value:function(e,t){var n=e.bucket,r=e.row,i=e.column,a=e.iterator,o=this.paintBucket(n,r,i,this.isFloatChunk,t,a),s=o.iterator,c=o.floatChunk;if(c){var u=this.pendingByFloatInfo(c);if(u){var l=u.untouched,h=u.pending,d=c.getSampleNode();delete l[n.id],h[n.id]={bucket:n,row:r,column:i,iterator:s},Du(l)||this.startToPaintFloatNode(d,h)}}}},{key:"pendingByFloatInfo",value:function(e){var t=this.chunkToFloatMap[e.id];return t?t.info:null}},{key:"startToPaintFloatNode",value:function(e,t){for(var n in this.floatLeafPainter(e.related),delete this.pendingByFloats[e.id],t){var r=t[n];this.paintableBucketsQueue.unshift(r)}}}],[{key:"paintBuckets",value:function(t){var n=new e(t);n.collectBuckets(),n.runLoopToPaintAll()}}]),e}();var ml=function(){function e(t){I(this,e),this.chunkContext=t.chunkContext,this.grid=t.grid,this.visions=t.visions,this.dirtyCells=t.dirtyCells}return M(e,[{key:"search",value:function(){var e=this,t={},n={},r={};return this.chunkContext.forEachCandidateFloatNodes((function(i){var a,o=i,s=null==(a=e.dirtyCells)?void 0:a.createSub(),c=e.searchCoverBuckets(o,s);if(c){var u=c.buckets,l=c.range,h={},d=!0,f=!0,p=null;for(var v in u){var m=u[v].findChunk(o);if(!m||!m.isFloat){d=!1;break}p||(p={leaf:o,info:{untouched:u,pending:{}}}),m.nextChunk&&(f=!1),h[m.id]=p}d&&p&&(Object.assign(t,h),n[o.id]=p.info,f?r[o.id]={leaf:o,range:l,dirtyCells:s}:null==s||s.complete(sl.Repaint))}})),{chunkToFloatMap:t,pendingByFloats:n,topFloatNodes:r}}},{key:"searchCoverBuckets",value:function(e,t){var n=this,r=this.visions.vision(e.id);if(!r)return null;var i=Nu.rectToRange(r.sceneRect,this.grid.unitSize),a=Nu.calcIntersection(i,this.grid.range);if(!a)return null;var o={};return a.forEach((function(e,r){var i=n.grid.bucket(e,r);i&&(o[i.id]=i),null==t||t.collect(e,r)})),Du(o)?{range:a,buckets:o}:null}}]),e}(),gl=function(){function e(t){var n=this;I(this,e),this.painters={},this.canvasPool=new rl,this.floatCanvasSize=null,this.nextFloatNodesInfo=null,this.topFloatRangeSet={},this.onLeafNodeVisible=function(e){var t=e.value,r=n.getRenderConstructor(t.definition);if(r){var i=new r(t,n.context),a=new zu(n.screen,n.visions,e,n.fixedSize,i,n.onRepaint);n.painters[e.id]=a}},this.onLeafNodeInvisible=function(e){delete n.painters[e.id]},this.fixedSize=t.fixedSize,this.willPrintGrid=!!t.willPrintGrid,this.onRepaint=t.onRepaint,this.getRenderConstructor=t.getRenderConstructor,this.screen=t.screen,this.dirtyNotify=t.dirtyNotify,this.visions=t.visions,this.camera=this.screen.camera,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.context=t.context,this.statistical=t.statistical,this.visionRectangle=this.createVisionRectangle(this.camera,this.screenSize),this.bucketFactory=new ul((function(e){return n.painters[e]}),this.visions,this.canvasPool,this.statistical),this.grid=new Fu({tree:t.tree,visions:t.visions,bucketFactory:this.bucketFactory,visionRectangle:this.visionRectangle,scale:this.camera.scale,rate:t.rate,bucketUnitSize:t.bucketUnitSize,favorBucketsCount:t.favorBucketsCount,onLeafNodeVisible:this.onLeafNodeVisible,onLeafNodeInvisible:this.onLeafNodeInvisible});var r,i=A(t.tree);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.onLeafNodeVisible(a)}}catch(e){i.e(e)}finally{i.f()}}return M(e,[{key:"dispose",value:function(){this.canvasPool.clear()}},{key:"update",value:function(e){var t,n,r,i=!1,a=!1;if(e.context){for(var o in this.painters)this.painters[o].updateContext(e.context);this.context=e.context,i=!0}for(var s in e.camera&&(this.camera=e.camera,a=!0),e.screenSize&&(this.screenSize=e.screenSize,a=!0),e.updateSet)null==(t=this.painters[s])||t.refreshPayload();a&&(this.visionRectangle=n=this.createVisionRectangle(this.camera,this.screenSize)),i||a?this.dirtyNotify.dirtyAll():this.dirtyNotify.canBeMoreDirty&&(r=this.dirtyNotify.createDirtyCellsCollection());var c=this.grid.update({shouldUpdateAll:i,dirtyCells:r,visionRectangle:n,scale:this.camera.scale,diff:e.diff,updateSet:e.updateSet,moveSet:e.moveSet,refresh:e.refresh});e.floatCanvasSize&&(this.floatCanvasSize=e.floatCanvasSize),this.nextFloatNodesInfo=this.searchFloatNodes({dirtyCells:r,visions:this.visions,grid:this.grid,chunkContext:this.bucketFactory.chunkContext}),r&&(this.dirtyTouchedBuckets(r,this.nextFloatNodesInfo,c),r.complete(sl.Repaint))}},{key:"dirtyTouchedBuckets",value:function(t,n,r){var i=n.topFloatNodes;if(i){var a,o=i.leaves,s=A(r);try{for(s.s();!(a=s.n()).done;){var c=a.value,u=c.row,l=c.column,h=c.touchedLeaves;e.isAllKeysBelongTo(h,o)||t.collect(u,l)}}catch(e){s.e(e)}finally{s.f()}}else{var d,f=A(r);try{for(f.s();!(d=f.n()).done;){var p=d.value,v=p.row,m=p.column;t.collect(v,m)}}catch(e){f.e(e)}finally{f.f()}}}},{key:"createVisionRectangle",value:function(e,t){var n,r,i,a;return 0===e.scale?(n=0,r=0,i=0,a=0):(i=t.width/e.scale,a=t.height/e.scale,n=e.centerX-i/2,r=e.centerY-a/2),Object.freeze({originX:n,originY:r,width:i,height:a})}},{key:"paintTopFloatAndGetOrigin",value:function(e,t,n){var r,i=this.getPaintFloatNodesInfo().topFloatNodes,a=null;if(i){var o=i.zone,s=i.leaves;for(var c in a={x:o.originX,y:o.originY},t.resetTransform(),t.clearRect(0,0,e.width,e.height),s){var u=this.painters[c];u&&(t.resetTransform(),t.scale(n,n),t.translate(-a.x,-a.y),u.paint(t,gd.Directly),null==(r=this.statistical)||r.recordPaintFloat())}}return a}},{key:"paintBackground",value:function(t){var n,r,i=this,a=t.context,o=t.ratio,s=t.refresh,c=t.cleanBucketsBackground,u=t.dirtyState,l=this.getPaintFloatNodesInfo(),h=null!=(r=null==(n=l.topFloatNodes)?void 0:n.leaves)?r:e.voidLeaves;vl.paintBuckets({grid:this.grid,floatNodesInfo:l,dirtyState:u,cleanBucketsBackground:c,floatLeafPainter:function(e){var t,n=e.id,r=i.painters[n];r&&!h[n]&&(a.resetTransform(),a.scale(o,o),r.paint(a,gd.Directly),null==(t=i.statistical)||t.recordPaintFloat())},bucketPainter:function(e,t,n,r,c,u){var l=i.toScreenPoint(t,n,i.grid.unitSize),h=l.x,d=l.y;if(a.resetTransform(),a.translate(h*o,d*o),e.updatePaintInfo(h,d,o,s),c){var f=e.projectiveSize,p=f.width,v=f.height,m=p*o,g=v*o;a.clearRect(0,0,m,g)}return e.paint(a,r,u)}}),this.willPrintGrid&&(a.resetTransform(),a.scale(o,o),this.paintGrid(a))}},{key:"completePaint",value:function(){this.nextFloatNodesInfo=null}},{key:"getPaintFloatNodesInfo",value:function(){var e;return null!=(e=this.nextFloatNodesInfo)?e:this.searchFloatNodes({visions:this.visions,grid:this.grid,chunkContext:this.bucketFactory.chunkContext})}},{key:"paintGrid",value:function(e){var t=this,n=this.grid,r=n.range,i=n.unitSize;e.lineWidth=1,e.strokeStyle="rgba(0,0,0,0.5)",e.fillStyle="rgba(0,0,0,0.5)",r.forEach((function(n,r){var a=t.toScreenPoint(n,r,i),o=a.x,s=a.y,c=Math.ceil(i.width*t.camera.scale),u=Math.ceil(i.height*t.camera.scale);e.strokeRect(o,s,c,u),e.fillText("".concat(n,",").concat(r),o+2,s+14)}))}},{key:"searchFloatNodes",value:function(e){var t=function(e){return new ml(e).search()}(e),n=null,r=null;if(this.floatCanvasSize){var i=this.floatCanvasSize,a=i.width,o=i.height,s=this.searchBorderRectange(t.topFloatNodes);s&&s.width<=a&&s.height<=o&&(n=s)}var c={},u=e.dirtyCells;if(n){var l={};for(var h in t.topFloatNodes){var d=sl.CoverByTop,f=t.topFloatNodes[h],p=f.leaf,v=f.range,m=f.dirtyCells;l[h]=p,h in this.topFloatRangeSet?delete this.topFloatRangeSet[h]:d=sl.Repaint,null==m||m.complete(d),c[h]=v}r={zone:n,leaves:l}}else for(var g in t.topFloatNodes){var y=t.topFloatNodes[g].dirtyCells;y&&y.complete(sl.Repaint)}if(u)for(var b in this.topFloatRangeSet)this.topFloatRangeSet[b].forEach((function(e,t){u.collect(e,t)}));return this.topFloatRangeSet=c,{topFloatNodes:r,chunkToFloatMap:t.chunkToFloatMap,pendingByFloats:t.pendingByFloats}}},{key:"searchBorderRectange",value:function(e){var t=null,n=0,r=Number.MAX_SAFE_INTEGER,i=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER,o=Number.MIN_SAFE_INTEGER;for(var s in e){var c=this.visions.vision(s);if(c){var u=c.screenRect,l=u.originX,h=u.originX+u.width,d=u.originY,f=u.originY+u.height;r>l&&(r=l),i<h&&(i=h),a>d&&(a=d),o<f&&(o=f),n+=1}}if(n>0){var p=32*Math.floor(r/32),v=32*Math.floor(a/32);t={originX:p,originY:v,width:Math.ceil(i-p),height:Math.ceil(o-v)}}return t}},{key:"toScreenPoint",value:function(e,t,n){var r=t*n.width,i=e*n.height;return{x:(r-this.camera.centerX)*this.camera.scale+this.screenSize.width/2,y:(i-this.camera.centerY)*this.camera.scale+this.screenSize.height/2}}}],[{key:"isAllKeysBelongTo",value:function(e,t){for(var n in e)if(!(n in t))return!1;return!0}}]),e}();gl.voidLeaves={};var yl=new(function(){function e(){I(this,e),"undefined"==typeof performance?this.fetch=this.fetchByMilliseconds:this.fetch=this.fetchByMicroseconds}return M(e,[{key:"fetchByMilliseconds",value:function(){return 1e3*Date.now()}},{key:"fetchByMicroseconds",value:function(){return Math.floor(1e3*performance.now())}}]),e}());function bl(){return yl.fetch()}var kl=function(){function e(t,n,r){I(this,e),this.canvas=null,this.canvasSizeSetter=null,this._ratio=1,this._visibility=!0,this.canvasIndex=1,this._size=Object.freeze(xu({},t)),this.dirtyNotify=n,this.onSetupCanvas=r}return M(e,[{key:"size",get:function(){return this._size},set:function(e){(this._size.width!==e.width||this._size.height!==e.height)&&(this._size=Object.freeze(xu({},e)),this.canvas&&this._visibility&&this.refreshSize())}},{key:"visibility",get:function(){return this._visibility},set:function(e){this._visibility!==e&&(this._visibility=e,this.canvas&&this._visibility&&this.refreshSize(),this.refreshVisibility())}},{key:"ratio",get:function(){return this._ratio}},{key:"hasNextCanvasNode",get:function(){return!!this.canvas}},{key:"nextCanvasNode",value:function(){var e=null;if(this.canvas){var t=this.canvas;e=[t.node1,t.node2][this.canvasIndex-1]}return e}},{key:"updateToNextBuffering",value:function(){if(this.canvas)switch(this.refreshVisibility(),this.canvasIndex){case 1:this.canvasIndex=2;break;case 2:this.canvasIndex=1}}},{key:"setCanvas",value:function(e){var t,n,r,i,a,o,s,c=!1;if(e){var u=h(e,2),l=u[0],d=u[1];if(this.canvas){var f=this.canvas,p=f.node1,v=f.node2;(p.canvas!==l||v.canvas!==d)&&(null==(t=p.dirty)||t.release(),null==(n=v.dirty)||n.release(),this.canvas=null)}this.canvas||(c=!0,this.canvas=Object.freeze({node1:Object.freeze({canvas:l,dirty:null==(r=this.dirtyNotify)?void 0:r.createDirty()}),node2:Object.freeze({canvas:d,dirty:null==(i=this.dirtyNotify)?void 0:i.createDirty()})}))}else this.canvas&&(null==(a=this.canvas.node1.dirty)||a.release(),null==(o=this.canvas.node2.dirty)||o.release(),this.canvas=null);c&&(this._ratio=this.getRatioWithCanvasPair(this.canvas),this.refreshSize(),this.refreshVisibility(),null==(s=this.onSetupCanvas)||s.call(this))}},{key:"refreshSize",value:function(){var t;if(this.canvas){var n=this.canvas.node1.canvas,r=this.canvas.node2.canvas;if(!n.getContext("2d")||!r.getContext("2d"))throw new Error("cannot find 2d context from canvas");var i=Math.ceil(this._ratio*this._size.width),a=Math.ceil(this._ratio*this._size.height);e.setCanvasSize(n,i,a),e.setCanvasSize(r,i,a),null==(t=this.canvasSizeSetter)||t.call(this,{width:i/this._ratio,height:a/this.ratio})}}},{key:"refreshVisibility",value:function(){if(this.canvas){var e=this.canvas.node1.canvas,t=this.canvas.node2.canvas;if(this._visibility)switch(this.canvasIndex){case 1:e.style.visibility="visible",t.style.visibility="hidden";break;case 2:e.style.visibility="hidden",t.style.visibility="visible"}else e.style.visibility="hidden",t.style.visibility="hidden"}}},{key:"getRatioWithCanvasPair",value:function(e){var t=e.node1.canvas,n=e.node2.canvas;return Math.max(this.getRatioWithContext(Tu(t)),this.getRatioWithContext(Tu(n)))}},{key:"getRatioWithContext",value:function(e){var t=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return Math.max(1,(window.devicePixelRatio||1)/t)}},{key:"getRender",value:function(){var e=this;return function(t){y(r,t);var n=k(r);function r(t){var i;return I(this,r),(i=n.call(this,t)).canvas1=null,i.canvas2=null,i.onSetCanvas1Ref=function(e){i.canvas1=e,i.refreshCanvas()},i.onSetCanvas2Ref=function(e){i.canvas2=e,i.refreshCanvas()},i.state=xu({},e._size),e.canvasSizeSetter=function(e){return i.setState(e)},i}return M(r,[{key:"componentWillUnmount",value:function(){e.canvasSizeSetter=null}},{key:"refreshCanvas",value:function(){this.canvas1&&this.canvas2?e.setCanvas([this.canvas1,this.canvas2]):e.setCanvas(null)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.style,r=this.state,i=r.width,a=r.height,o=Cu(xu({},n),{width:i,height:a});return[(0,ru.createElement)("canvas",{key:"canvas1",className:t,ref:this.onSetCanvas1Ref,style:o}),(0,ru.createElement)("canvas",{key:"canvas2",className:t,ref:this.onSetCanvas2Ref,style:o})]}}]),r}(ru.Component)}}],[{key:"setCanvasSize",value:function(e,t,n){(e.width!==t||e.height!==n)&&(e.width=t,e.height=n)}}]),e}(),wl=function(){function e(t){var n=this;I(this,e),this.dirtyNotify=new hl,this.refresh=!0,this.onRepaint=function(e){n.screen.scene.reportComponentUpdate(e,ed.PropertiesUpdated)},this.renderMode=t.renderMode,this.engine=t.engine,this.screen=t.screen,this.onRenderDuration=t.onRenderDuration,this.statistical=t.willPrintStatistical?new Eu:void 0,this.className=t.className,this.style=Object.freeze(Cu(xu({},t.style),{position:"absolute",overflow:"hidden",pointerEvents:"none",zIndex:this.engine.orderIndex}));var r=new xl((function(){return n.paint()}));this.floatCanvas=new kl(this.createFloatSize(this.screen),void 0,r.createUnlockCall()),this.floatCanvas.visibility=!1,this.backgroundCanvas=new kl({width:this.screen.width,height:this.screen.height},this.dirtyNotify,r.createUnlockCall()),this.painter=new gl({tree:t.tree,fixedSize:t.fixedSize,screen:t.screen,visions:t.visions,context:this.screen.context,statistical:this.statistical,dirtyNotify:this.dirtyNotify,getRenderConstructor:t.getRenderConstructor,onRepaint:this.onRepaint,rate:2,favorBucketsCount:12,bucketUnitSize:Object.freeze({width:256,height:256})})}return M(e,[{key:"willInterruptEvent",value:function(){return!1}},{key:"findComponentWithTarget",value:function(){}},{key:"update",value:function(e){var t,n,r,i=bl();switch(e.screenSize&&(r=this.createFloatSize(e.screenSize),this.backgroundCanvas.size=e.screenSize,this.floatCanvas.size=r),this.renderMode){case Sl.HighQuality:this.refresh=!0;break;case Sl.PerformanceWhileTransition:this.refresh=!e.isTransition}this.painter.update({context:e.context,camera:e.camera,screenSize:e.screenSize,floatCanvasSize:r,diff:e.diff,updateSet:e.updateSet,moveSet:e.moveSet,refresh:this.refresh}),this.backgroundCanvas.hasNextCanvasNode?(this.paint(),null==(t=this.statistical)||t.print(),this.onRenderDuration&&this.onRenderDuration(bl()-i)):null==(n=this.statistical)||n.clear()}},{key:"paint",value:function(){var e=this,t=null,n=!1,r=this.floatCanvas.nextCanvasNode(),i=this.backgroundCanvas.nextCanvasNode();if(r){var a=Tu(r.canvas);a.resetTransform(),t=this.painter.paintTopFloatAndGetOrigin(r.canvas,a,this.floatCanvas.ratio)}if(i){var o=i.dirty.takeDirtyState();if(o.phase!==cl.None){var s=Tu(i.canvas),c=o.phase===cl.Part;if(s.resetTransform(),o.phase===cl.All){var u=i.canvas,l=u.width,h=u.height;s.clearRect(0,0,l,h)}this.painter.paintBackground({context:s,ratio:this.backgroundCanvas.ratio,refresh:this.refresh,dirtyState:o,cleanBucketsBackground:c}),n=!0}}this.painter.completePaint(),(!r||!i)&&console.warn("cannot find canvas"),(r||i)&&Promise.resolve().then((function(){return e.doAfterPaint(t,r,n)})).catch((function(e){return console.error(e)}))}},{key:"doAfterPaint",value:function(e,t,n){if(e&&t){var r=e.x,i=e.y;this.floatCanvas.visibility=!0,t.canvas.style.transform="translate(".concat(r,"px, ").concat(i,"px)"),this.floatCanvas.updateToNextBuffering()}else this.floatCanvas.visibility=!1;n&&this.backgroundCanvas.updateToNextBuffering()}},{key:"dispose",value:function(){this.painter.dispose()}},{key:"createFloatSize",value:function(t){var n=e.floatCanvasMaxSize,r=t.width*e.floatCanvasRate,i=t.height*e.floatCanvasRate;return r>n.width&&(r=n.width),i>n.height&&(i=n.height),{width:r=Math.floor(r),height:i=Math.floor(i)}}},{key:"getRender",value:function(){var e=this,t=this.backgroundCanvas.getRender(),n=this.floatCanvas.getRender();return function(r){y(a,r);var i=k(a);function a(e){return I(this,a),i.call(this,e)}return M(a,[{key:"componentWillUnmount",value:function(){e.dispose()}},{key:"render",value:function(){return(0,nu.createElement)(nu.Fragment,null,(0,nu.createElement)(t,{className:e.className,style:e.style}),(0,nu.createElement)(n,{className:e.className,style:e.style}))}}]),a}(nu.Component)}}]),e}();wl.floatCanvasRate=.25,wl.floatCanvasMaxSize=Object.freeze({width:340,height:240});var Sl,xl=function(){function e(t){I(this,e),this.onUnlock=t,this.didUnLock=!1,this.unlockCount=0,this.lockCount=0}return M(e,[{key:"createUnlockCall",value:function(){var e=this;return this.lockCount+=1,function(){e.unlockCount+=1,!e.didUnLock&&e.unlockCount===e.lockCount&&(e.didUnLock=!0,e.onUnlock())}}}]),e}();function Cl(e,t){return void 0===e?t:e}function Il(e,t){return"number"==typeof e?e:t}!function(e){e[e.HighQuality=0]="HighQuality",e[e.PerformanceWhileTransition=1]="PerformanceWhileTransition"}(Sl||(Sl={}));var Pl=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e.orderIndex)).constructors={},r.getRenderConstructor=function(e){return r.constructors[e.id]},r.fixedSize=e.fixedSize,r.renderMode=Cl(e.renderMode,0),r}return M(n,[{key:"bind",value:function(e,t){if(!(e instanceof ud))throw new Error("it is not ComponentDefinition");if(this.constructors[e.id])throw new Error("define duplicated ComponentDefinition");this.constructors[e.id]=t,e.addEngine(this,{isVisible:t.isVisible}),this.addDefinition(e)}},{key:"createRenderLayout",value:function(e){return new wl({engine:this,screen:e.screen,tree:e.tree,visions:e.visions,fixedSize:this.fixedSize,renderMode:this.renderMode,getRenderConstructor:this.getRenderConstructor,onRenderDuration:e.onRenderDuration})}}]),n}(Pu);function Ml(e){return new Pl(e)}function Tl(e){return e instanceof Pl}var Al=function(){function e(t){var n=this;I(this,e),this.setCNodeElement=function(e,t){var r=e.treeNode.id,i=n.shadowList.node(r);i&&(i.value=t)},this.engine=t.engine,this.renderComponent=t.renderComponent,this.screen=t.screen,this.fixedSize=t.fixedSize,this.className=t.className,this.style=t.style,this.visions=t.visions,this.leafFilter=t.leafFilter,this.mode=t.mode,this.camera=t.initCamera||this.screen.camera,this.context=this.screen.context,this.screenSize=Object.freeze({width:this.screen.width,height:this.screen.height}),this.shadowList=Zu.create({tree:t.tree,valueInitializer:function(){return null},initLeafFilter:function(e){return n.visions.includes(e.id)&&t.leafFilter(e)}})}return M(e,[{key:"willInterruptEvent",value:function(e,t,n){var r=this.findComponentWithTarget(n);if(r){var i=this.engine.getDefinitionNode(r.definition);if(i)return i.willInterruptEvent(e,r,t)}return!1}},{key:"findComponentWithTarget",value:function(e){var t=this.shadowList.findNode((function(t){var n=t.value;return!(!n||e!==n&&!n.contains(e))}));if(t){var n=t.related;if(n.value)return n.value}}},{key:"update",value:function(e){var t=this.shadowList.appendDiff(e.diff),n=!1;e.camera&&(this.camera=e.camera,n=!0),e.screenSize&&(this.screenSize=e.screenSize,n=!0),e.context&&(this.context=e.context,n=!0),(Du(e.updateSet)||Du(e.moveSet)||t.addedNodes.length>0||t.removedNodes.length>0||t.sortedNodes.length>0)&&(n=!0),this.setState&&n&&this.setState(this.getRenderLayoutState())}},{key:"getRender",value:function(){var e=this,t=this.renderComponent;return function(n){y(i,n);var r=k(i);function i(t){var n;return I(this,i),(n=r.call(this,t)).state=e.getRenderLayoutState(),e.setState=function(e){return n.setState(e)},n}return M(i,[{key:"componentWillUnmount",value:function(){e.setState=void 0}},{key:"render",value:function(){var n=this.state,r=n.camera,i=n.screenSize,a=n.context;return(0,iu.createElement)(t,{engine:e.engine,screen:e.screen,mode:e.mode,visions:e.visions,leafFilter:e.leafFilter,camera:r,screenSize:i,context:a,fixedSize:e.fixedSize,className:e.className,style:e.style,onCNodeRef:e.setCNodeElement})}}]),i}(iu.Component)}},{key:"getRenderLayoutState",value:function(){return{camera:this.camera,screenSize:this.screenSize,context:this.context}}}]),e}(),El=function(e){y(n,e);var t=k(n);function n(){var e;return I(this,n),(e=t.apply(this,arguments)).onRef=function(t){var n=e.props,r=n.onRef,i=n.context;r&&r(t);var a=i;a&&a.onRef(a.component,t)},e}return M(n,[{key:"render",value:function(){var e=this.props,t=e.context,n=e.children,r=e.fixedMode,i=e.style,a=t;if(a){var o=a.vision,s=a.component,c=a.margin,u=o.screenRect,l=u.originX,h=u.originY,d="absolute";if(r){var f=a.screen.bounding;l+=f.left,h+=f.top,d="fixed"}var p="translate(".concat(l,"px,").concat(h,"px) scale(").concat(a.scale,",").concat(a.scale,")"),v=xu({WebkitTransform:p,transform:p,WebkitTransformOrigin:"0px 0px 0px",transformOrigin:"0px 0px 0px",position:d,overflow:"visible",width:a.size.width+a.margin.left+a.margin.right,height:a.size.height+a.margin.top+a.margin.bottom,margin:0,paddingLeft:c.left,paddingRight:c.right,paddingTop:c.top,paddingBottom:c.bottom,zIndex:s.orderIndex},i),m=xu({},this.props);return delete m.context,delete m.fixedMode,delete m.onRef,(0,ou.createElement)("div",Cu(xu({},m),{style:v,ref:this.onRef}),n)}return(0,ou.createElement)(ou.Fragment,null,n)}}]),n}(ou.Component),Ol=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"getPreviewURL",value:function(e){if(this.props.mode===Zc.Preview)return e.previewURL}},{key:"getPositionInfo",value:function(e,t,n){var r,i,a,o=this.props.fixedSize;return a=e.absoluteCoordinates?1:n,o?(i={left:t.margin.left/a,right:t.margin.right/a,top:t.margin.top/a,bottom:t.margin.bottom/a},r={width:e.width,height:e.height}):(i=t.margin,r={width:t.screenRect.width-i.left-i.right,height:t.screenRect.height-i.top-i.bottom}),{margin:i,size:r,origin:{x:t.screenRect.originX,y:t.screenRect.originY},cnodeScale:a}}},{key:"renderPreview",value:function(e,t,n,r){var i=this.props,a=i.screen,o=i.onCNodeRef,s=this.getPositionInfo(e,t,r),c=s.margin,u=s.size,l={vision:t,component:e,screen:a,onRef:o,margin:c,size:u,scale:s.cnodeScale};return(0,au.createElement)(El,{key:e.id,context:l},(0,au.createElement)("img",{src:n,alt:"",width:u.width,height:u.height}))}},{key:"renderLeafNode",value:function(e,t,n,r){var i=e.definition,a=this.props,o=a.engine,s=a.context,c=a.screen,u=a.onCNodeRef,l=o.getDefinitionNode(i);if(l){var h=this.getPositionInfo(e,t,r),d=h.margin,f=h.size,p=h.origin,v=h.cnodeScale,m=l.render,g={vision:t,component:e,margin:d,size:f,scale:v,screen:c,onRef:u};return(0,au.createElement)(m,{key:e.id,id:e.id,cnode:g,screen:c,payload:e.payload,context:s,size:f,origin:p,margin:d,scale:n,layout:o.orderIndex})}return null}},{key:"render",value:function(){var e=this,t=[],n=this.props,r=n.visions,i=n.leafFilter,a=n.style,o=n.className,s=n.engine,c=n.fixedSize;return r.forEach((function(n,r){if(i(n)){var a=n.value,o=e.getPreviewURL(a),s=c?r.scale:1;if(o)t.push(e.renderPreview(a,r,o,s));else{var u=c?1:r.scale,l=e.renderLeafNode(a,r,u,s);t.push(l)}}})),(0,au.createElement)("div",{className:o,style:Cu(xu({},a),{width:"100%",height:"100%",position:"absolute",overflow:"hidden",zIndex:s.orderIndex})},t)}}]),n}(au.Component),Rl=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"shouldComponentUpdate",value:function(e){var t=this.props,n=t.origin,r=t.size,i=t.zIndex,a=t.margin,o=t.payload,s=t.context;return n.x!==e.origin.x||n.y!==e.origin.y||r.width!==e.size.width||r.height!==e.size.height||i!==e.zIndex||a.left!==e.margin.left||a.right!==e.margin.right||a.top!==e.margin.top||a.bottom!==e.margin.bottom||o!==e.payload||s!==e.context}},{key:"render",value:function(){var e=this.props,t=e.render,n=e.screen,r=e.engine,i=e.component,a=e.context,o=e.origin,s=e.zIndex,c=e.size,u=e.margin,l=e.payload,h="translate(".concat(o.x,"px,").concat(o.y,"px)");return(0,su.createElement)("g",{style:{transform:h,zIndex:s,WebkitTransform:h}},(0,su.createElement)(t,{id:i.id,screen:n,payload:l,context:a,size:c,origin:o,margin:u,scale:1,layout:r.orderIndex}))}}]),n}(su.Component),Nl=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"getPreviewURL",value:function(e){if(this.props.mode===Zc.Preview)return e.previewURL}},{key:"createViewBox",value:function(){var e=this.props,t=e.screenSize,n=e.camera,r=n.scale,i=n.centerX,a=n.centerY,o=t.width/r,s=t.height/r;return Number.isNaN(o)&&(o=0),Number.isNaN(s)&&(s=0),"".concat(i-o/2," ").concat(a-s/2," ").concat(o," ").concat(s)}},{key:"render",value:function(){var e=this,t=[],n=this.props,r=n.visions,i=n.leafFilter,a=n.className,o=n.screen,s=n.engine,c=n.context,u=n.style;return r.forEach((function(n,r){if(i(n)){var a=n.value,u=s.getDefinitionNode(a.definition);if(u){var l=e.getPreviewURL(a),h={x:a.originX,y:a.originY},d={width:a.width,height:a.height};if(l)t.push((0,su.createElement)("image",{key:a.id,x:h.x,y:h.y,width:d.width,height:d.height,xlinkHref:l}));else{var f=r.margin,p=a.orderIndex;t.push((0,su.createElement)(Rl,{key:a.id,screen:o,engine:s,render:u.render,context:c,component:a,margin:f,size:d,zIndex:p,origin:h,payload:a.payload}))}}}})),(0,su.createElement)("svg",{className:a,fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:this.createViewBox(),preserveAspectRatio:"xMidYMid",style:Cu(xu({},u),{width:"100%",height:"100%",position:"absolute",overflow:"hidden",zIndex:s.orderIndex})},t)}}]),n}(su.Component),Ll=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e.orderIndex)).definitionNodes={},r.fixedSize=e.fixedSize,r.isSVG=e.isSVG,r.className=e.className,r.style=e.style&&Object.freeze(xu({},e.style)),r}return M(n,[{key:"getDefinitionNode",value:function(e){return this.definitionNodes[e.id]}},{key:"bind",value:function(e){var t=this;return function(n){if(!(e instanceof ud))throw new Error("it is not ComponentDefinition");if(t.definitionNodes[e.id])throw new Error("define duplicated ComponentDefinition");var r;if("boolean"==typeof n.willInterruptEvent){var i=n.willInterruptEvent;r=function(){return i}}else r=n.willInterruptEvent?n.willInterruptEvent.bind(n):function(){return!1};return t.definitionNodes[e.id]=Object.freeze({willInterruptEvent:r,render:n}),e.addEngine(t,{isVisible:n.isVisible}),t.addDefinition(e),n}}},{key:"createRenderLayout",value:function(e){var t;return t=this.isSVG?Nl:Ol,new Al({engine:this,screen:e.screen,mode:e.mode,initCamera:e.initCamera,tree:e.tree,visions:e.visions,leafFilter:e.leafFilter,renderComponent:t,fixedSize:this.fixedSize,className:this.className,style:this.style})}}]),n}(Pu);function jl(e){return new Ll(e)}function Dl(e){return e instanceof Ll}var Fl=function(){function e(){I(this,e),this.nodes={}}return M(e,[{key:"includes",value:function(e){return e in this.nodes}},{key:"leaf",value:function(e){var t=this.nodes[e];return t?t.leaf:null}},{key:"vision",value:function(e){var t=this.nodes[e];return t?t.vision:null}},{key:"bindVision",value:function(e,t){var n=e.id,r=this.nodes[n];r?r.vision=t:this.nodes[n]={leaf:e,vision:t}}},{key:"unbindVision",value:function(e){delete this.nodes[e]}},{key:"forEach",value:function(e){for(var t in this.nodes){var n=this.nodes[t];e(n.leaf,n.vision)}}},{key:"clean",value:function(){this.nodes={}}}]),e}(),zl=function(){function e(t){var n=this;I(this,e),this.binder=t,this.isLeftButtonPressed=!1,this.onMouseDown=function(e){if(0===e.button&&(n.checkMouseDidUp(e),n.isLeftButtonPressed=!0,!n.binder.willInterruptMouseOrTouchEvent(e,e.target))){var t=n.binder.eventPosition(e),r={kind:Kc.MouseDown,nativeEvent:e,isOnScreen:!0,pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(r)}},this.onMouseMove=function(e){if(0===e.button){n.checkMouseDidUp(e);var t=n.binder.eventPosition(e),r={kind:Kc.MouseMove,nativeEvent:e,isOnScreen:n.binder.isEventFiredOnElement(e.target,n.binder.divElement),pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(r)}},this.onMouseLeave=function(e){if(0===e.button&&(n.checkMouseDidUp(e),e.target===n.binder.divElement)){var t=n.binder.eventPosition(e),r={kind:Kc.MouseLeave,nativeEvent:e,isOnScreen:n.binder.isEventFiredOnElement(e.target,n.binder.divElement),pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(r)}},this.onMouseUp=function(e){0===e.button&&(n.isLeftButtonPressed=!1,n.fireMouseUpEvent(e))}}return M(e,[{key:"checkMouseDidUp",value:function(e){var t=0!==e.which;this.isLeftButtonPressed&&!t&&this.fireMouseUpEvent(e)}},{key:"fireMouseUpEvent",value:function(e){var t=this.binder.eventPosition(e),n={kind:Kc.MouseUp,nativeEvent:e,isOnScreen:this.binder.isEventFiredOnElement(e.target,this.binder.divElement),pointOnScreen:t,pointOnScene:this.binder.toPointInScene(t.x,t.y)};this.binder.fireEvent(n)}}]),e}(),Bl=function(){function e(t){var n=this;I(this,e),this.binder=t,this.latestScale=1,this.onMouseWheel=function(e){if(!n.binder.willInterruptMouseOrTouchEvent(e,e.target)){var t=n.binder.eventPosition(e),r=e.deltaX,i=e.deltaY,a=Math.sqrt(r*r+i*i),o=0,s=0;"Windows"===n.binder.getOS()&&(a=-a),r+i<0&&(a=-a),n.isMacTouchpadTwoFingerZoom(e)?a=.5*-a:n.isMacTouchpadTwoFingerScroll(e)?(o=-r,s=-i,a=0):a*=.035;var c={kind:Kc.MouseWheel,nativeEvent:e,isOnScreen:n.binder.isEventFiredOnElement(e.target,n.binder.divElement),offsetPoint:{x:o,y:s},scale:n.adjustScale(a),pointOnScreen:t,pointOnScene:n.binder.toPointInScene(t.x,t.y)};n.binder.fireEvent(c)}e.preventDefault()},this.onGestureStart=function(e){n.binder.willInterruptMouseOrTouchEvent(e,e.target)||(e.preventDefault(),n.latestScale=1)},this.onGestureChange=function(t){if(!n.binder.willInterruptMouseOrTouchEvent(t,t.target)){t.preventDefault();var r=(t.scale/n.latestScale-1)*e.safariScaleNumber,i={x:t.layerX,y:t.layerY},a={kind:Kc.MouseWheel,nativeEvent:t,isOnScreen:n.binder.isEventFiredOnElement(t.target,n.binder.divElement),offsetPoint:{x:0,y:0},scale:n.adjustScale(r),pointOnScreen:i,pointOnScene:n.binder.toPointInScene(i.x,i.y)};n.binder.fireEvent(a)}},this.onGestureEnd=function(e){n.binder.willInterruptMouseOrTouchEvent(e,e.target)||e.preventDefault()},this.isMacTouchpadTwoFingerZoom=function(e){return-1!==navigator.platform.indexOf("Mac")&&e.ctrlKey},this.isMacTouchpadTwoFingerScroll=function(e){return-1!==navigator.platform.indexOf("Mac")&&(e.wheelDelta%120!=0||0!==e.movementX||0!==e.deltaX)}}return M(e,[{key:"adjustScale",value:function(t){return Math.max(t,e.minScaleStep)*e.scaleRate}}]),e}();Bl.safariScaleNumber=10,Bl.minScaleStep=-40,Bl.scaleRate=.02;var Ul,Vl=function(){function e(t){var n=this;I(this,e),this.binder=t,this.onTouchStart=function(e){var t=e.target,r=!t||t&&!t.classList.contains("ppt-event-source");e.cancelable&&r&&e.preventDefault();for(var i=[],a=0;a<e.changedTouches.length;++a){var o=e.changedTouches.item(a);if(!n.binder.willInterruptMouseOrTouchEvent(e,o.target)){var s="".concat(o.identifier),c=n.binder.eventPosition(o);i.push({identifier:s,pointOnScreen:c,pointOnScene:n.binder.toPointInScene(c.x,c.y)})}}if(i.length>0){var u={kind:Kc.TouchStart,nativeEvent:e,touches:i};n.binder.fireEvent(u)}},this.onTouchMove=function(e){e.cancelable&&e.preventDefault();for(var t=[],r=0;r<e.changedTouches.length;++r){var i=e.changedTouches.item(r),a="".concat(i.identifier),o=n.binder.eventPosition(i);t.push({identifier:a,pointOnScreen:o,pointOnScene:n.binder.toPointInScene(o.x,o.y)})}if(t.length>0){var s={kind:Kc.TouchMove,nativeEvent:e,touches:t};n.binder.fireEvent(s)}},this.onTouchEnd=function(e){var t=e.target,r=!t||t&&!t.classList.contains("ppt-event-source");e.cancelable&&r&&e.preventDefault();var i=n.cleanAcceptedTouchesByTouchEvent(e);if(i.length>0){var a={kind:Kc.TouchEnd,nativeEvent:e,touches:i};n.binder.fireEvent(a)}},this.onTouchCancel=function(e){e.cancelable&&e.preventDefault();var t=n.cleanAcceptedTouchesByTouchEvent(e);if(t.length>0){var r={kind:Kc.TouchCancel,nativeEvent:e,touches:t};n.binder.fireEvent(r)}}}return M(e,[{key:"cleanAcceptedTouchesByTouchEvent",value:function(e){for(var t=[],n=0;n<e.changedTouches.length;++n){var r=e.changedTouches.item(n),i="".concat(r.identifier),a=this.binder.eventPosition(r);t.push({identifier:i,pointOnScreen:a,pointOnScene:this.binder.toPointInScene(a.x,a.y)})}return t}}]),e}(),Wl=function e(t){var n=this;I(this,e),this.binder=t,this.onKeyDown=function(e){if(!n.binder.willInterruptKeyboardEvent(e,e.target)){var t=e.key,r=e.altKey,i=e.ctrlKey,a=e.shiftKey,o={kind:Kc.KeyDown,nativeEvent:e,key:t,altKey:r,ctrlKey:i,shiftKey:a};n.binder.fireEvent(o)}},this.onKeyUp=function(e){var t=e.key,r=e.altKey,i=e.ctrlKey,a=e.shiftKey,o={kind:Kc.KeyUp,nativeEvent:e,key:t,altKey:r,ctrlKey:i,shiftKey:a};n.binder.fireEvent(o)}},Hl=function(){function e(t,n,r){I(this,e),this.mouseEventHandler=new zl(this),this.touchEventHandler=new Vl(this),this.wheelEventHandler=new Bl(this),this.keyboardEventHandler=new Wl(this),this.divElement=n,this.eventParamMap=this.createEventParamMap(t),this.delegate=r,this.addListeners()}return M(e,[{key:"createEventParamMap",value:function(e){var t={};switch(e){case ld.Desktop:t=Cu(xu({},t),{keyup:{method:this.keyboardEventHandler.onKeyUp,element:document.body},keydown:{method:this.keyboardEventHandler.onKeyDown,element:document.body},mousedown:{method:this.mouseEventHandler.onMouseDown},mousemove:{method:this.mouseEventHandler.onMouseMove,element:document},mouseup:{method:this.mouseEventHandler.onMouseUp,element:document},mouseleave:{method:this.mouseEventHandler.onMouseLeave},wheel:{method:this.wheelEventHandler.onMouseWheel},gesturestart:{method:this.wheelEventHandler.onGestureStart,element:document.body},gesturechange:{method:this.wheelEventHandler.onGestureChange,element:document.body},gestureend:{method:this.wheelEventHandler.onGestureEnd,element:document.body}});break;case ld.Touch:t=Cu(xu({},t),{touchstart:{method:this.touchEventHandler.onTouchStart},touchmove:{method:this.touchEventHandler.onTouchMove},touchend:{method:this.touchEventHandler.onTouchEnd},touchcancel:{method:this.touchEventHandler.onTouchCancel}});break;case ld.Surface:t=Cu(xu({},t),{keyup:{method:this.keyboardEventHandler.onKeyUp,element:document.body},keydown:{method:this.keyboardEventHandler.onKeyDown,element:document.body},mousedown:{method:this.mouseEventHandler.onMouseDown},mousemove:{method:this.mouseEventHandler.onMouseMove,element:document},mouseup:{method:this.mouseEventHandler.onMouseUp,element:document},mouseleave:{method:this.mouseEventHandler.onMouseLeave},wheel:{method:this.wheelEventHandler.onMouseWheel},gesturestart:{method:this.wheelEventHandler.onGestureStart,element:document.body},gesturechange:{method:this.wheelEventHandler.onGestureChange,element:document.body},gestureend:{method:this.wheelEventHandler.onGestureEnd,element:document.body},touchstart:{method:this.touchEventHandler.onTouchStart},touchmove:{method:this.touchEventHandler.onTouchMove},touchend:{method:this.touchEventHandler.onTouchEnd},touchcancel:{method:this.touchEventHandler.onTouchCancel}})}return Object.freeze(t)}},{key:"addListeners",value:function(){for(var e in this.eventParamMap){var t=this.eventParamMap[e],n=t.method;(t.element||this.divElement).addEventListener(e,n,!0)}}},{key:"release",value:function(){for(var e in this.eventParamMap){var t=this.eventParamMap[e],n=t.method;(t.element||this.divElement).removeEventListener(e,n,!0)}}},{key:"fireEvent",value:function(e){this.delegate.fireEvent(e)}},{key:"getOS",value:function(){var e=window.navigator,t=e.userAgent,n=e.platform,r="";return-1!==["Macintosh","MacIntel","MacPPC","Mac68K"].indexOf(n)?r="Mac OS":-1!==["iPhone","iPad","iPod"].indexOf(n)?r="iOS":-1!==["Win32","Win64","Windows","WinCE"].indexOf(n)?r="Windows":/Android/.test(t)?r="Android":!r&&/Linux/.test(n)&&(r="Linux"),r}},{key:"toPointInScene",value:function(e,t){return this.delegate.toPointInScene(e,t)}},{key:"willInterruptMouseOrTouchEvent",value:function(e,t){return!!t&&(!this.isEventFiredOnElement(t,this.divElement)||this.delegate.willInterruptEvent(e,t))}},{key:"willInterruptKeyboardEvent",value:function(e,t){return!!t&&(!!this.delegate.willInterruptEvent(e,t)||t!==document.body&&!this.isEventFiredOnElement(t,this.divElement))}},{key:"isEventFiredOnElement",value:function(e,t){for(var n=e;n;){if(n===t)return!0;n=n.parentElement}return!1}},{key:"eventPosition",value:function(e){var t=this.divElement.getBoundingClientRect(),n=t.left,r=t.top;return{x:Math.floor(e.clientX)-n,y:Math.floor(e.clientY)-r}}}]),e}(),_l=function(){function e(){I(this,e),this.listeners=[]}return M(e,[{key:"dispatch",value:function(e){var t,n=A(this.listeners);try{for(n.s();!(t=n.n()).done;){var r=t.value;try{r(e)}catch(e){console.error(e)}}}catch(e){n.e(e)}finally{n.f()}}},{key:"addListener",value:function(e){-1===this.listeners.indexOf(e)&&this.listeners.push(e)}},{key:"removeListener",value:function(e){var t=this.listeners.indexOf(e);-1!==t&&this.listeners.splice(t,1)}},{key:"removeAllListeners",value:function(){this.listeners.splice(0)}}]),e}();!function(e){e[e.Start=0]="Start",e[e.Update=1]="Update",e[e.End=2]="End",e[e.Other=3]="Other"}(Ul||(Ul={}));var Gl=function(){function e(t,n){I(this,e),this._disable=!1,this.onCancelEvent=t,this.adapterNodes=Object.freeze(n.map((function(e){var t={},n={};return e.setEventDescriptionStateGetter&&e.setEventDescriptionStateGetter((function(e){var r=t[e];if(r)return{payload:r,isCanceled:!!n[e]}})),{adapter:e,payloads:t,canceledMap:n}})))}return M(e,[{key:"disable",get:function(){return this._disable},set:function(e){this._disable!==e&&(this._disable=e,e&&this.cancel())}},{key:"cancel",value:function(){var e,t=A(this.adapterNodes);try{for(t.s();!(e=t.n()).done;){var n=e.value,r=n.adapter,i=n.payloads,a=n.canceledMap,o={},s=!1;for(var c in i)c in a||(o[c]=i[c],a[c]=!0,s=!0);if(s){var u=r.createCancelEvent(o);u&&this.onCancelEvent(u)}}}catch(e){t.e(e)}finally{t.f()}}},{key:"interruptEvent",value:function(e){var t=this.adapterNodes.find((function(t){return t.adapter.isEventAccessible(e)}));if(t){var n,r=t.adapter,i=t.canceledMap,a=r.takeEventDescription(e),o=[],s=A(a?"number"==typeof a.length?a:[a]:[]);try{for(s.s();!(n=s.n()).done;){var c=n.value;if(3===c.phase)o.push(c);else{var u=this.handleAndCheckIgnoreEventDescription(t,c),l=i[c.identifier];!u&&!l&&o.push(c)}}}catch(e){s.e(e)}finally{s.f()}return!this._disable&&o.length>0?r.convertToEvent(e,o):null}return e}},{key:"handleAndCheckIgnoreEventDescription",value:function(e,t){var n=e.payloads,r=e.canceledMap,i=t.identifier,a=t.phase,o=t.payload;switch(a){case 0:return i in n||(n[i]=o,this._disable&&(r[i]=!0),!1);case 1:return!(i in n)||(n[i]=o,!1);case 2:if(i in n){var s=!!r[i];return delete n[i],delete r[i],s}return!0;default:return!0}}}]),e}(),Yl=function(){function e(){I(this,e),this.currentIdentifier=0}return M(e,[{key:"setEventDescriptionStateGetter",value:function(e){this.getDescriptionState=e}},{key:"isEventAccessible",value:function(e){return e.kind===Kc.MouseDown||e.kind===Kc.MouseMove||e.kind===Kc.MouseUp||e.kind===Kc.MouseLeave}},{key:"convertToEvent",value:function(e,t){var n=h(t,1)[0].payload;return{kind:e.kind,nativeEvent:e.nativeEvent,isOnScreen:n.isOnScreen,pointOnScreen:n.pointOnScreen,pointOnScene:n.pointOnScene}}},{key:"createCancelEvent",value:function(e){var t;for(var n in e)t=e[n];return{kind:Kc.MouseUp,isOnScreen:t.isOnScreen,pointOnScreen:t.pointOnScreen,pointOnScene:t.pointOnScene}}},{key:"takeEventDescription",value:function(e){e.kind===Kc.MouseDown&&(this.currentIdentifier+=1);var t,n="".concat(this.currentIdentifier);switch(e.kind===Kc.MouseUp&&(this.currentIdentifier+=1),e.kind){case Kc.MouseDown:t=Ul.Start;break;case Kc.MouseMove:case Kc.MouseLeave:var r=this.getDescriptionState(n);if(r){if(r.isCanceled)return null;t=Ul.Update}else{if(!e.isOnScreen)return null;t=Ul.Other}break;case Kc.MouseUp:t=Ul.End;break;default:return null}return{identifier:n,phase:t,payload:{isOnScreen:e.isOnScreen,pointOnScreen:e.pointOnScreen,pointOnScene:e.pointOnScene}}}}]),e}(),Xl=function(){function e(){I(this,e)}return M(e,[{key:"isEventAccessible",value:function(e){return e.kind===Kc.TouchStart||e.kind===Kc.TouchMove||e.kind===Kc.TouchEnd||e.kind===Kc.TouchCancel}},{key:"convertToEvent",value:function(e,t){var n,r=[],i=A(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.identifier,s=a.payload;r.push(xu({identifier:o},s))}}catch(e){i.e(e)}finally{i.f()}return{kind:e.kind,nativeEvent:e.nativeEvent,touches:r}}},{key:"createCancelEvent",value:function(e){var t=[];for(var n in e)t.push(xu({identifier:n},e[n]));return{kind:Kc.TouchCancel,touches:t}}},{key:"takeEventDescription",value:function(e){var t;switch(e.kind){case Kc.TouchStart:t=Ul.Start;break;case Kc.TouchMove:t=Ul.Update;break;case Kc.TouchEnd:case Kc.TouchCancel:t=Ul.End;break;default:return null}var n,r=[],i=A(e.touches);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.identifier,s=a.pointOnScene,c=a.pointOnScreen;r.push({identifier:o,phase:t,payload:{pointOnScene:s,pointOnScreen:c}})}}catch(e){i.e(e)}finally{i.f()}return r}}]),e}(),ql=function(){function e(){I(this,e)}return M(e,[{key:"isEventAccessible",value:function(e){return e.kind===Kc.SortedTouchStart||e.kind===Kc.SortedTouchMove||e.kind===Kc.SortedTouchEnd||e.kind===Kc.SortedTouchCancel}},{key:"convertToEvent",value:function(e,t){var n=h(t,1)[0],r=n.identifier,i=n.payload;return{kind:e.kind,nativeEvent:e.nativeEvent,identifier:r,pointOnScene:i.pointOnScene,pointOnScreen:i.pointOnScreen}}},{key:"createCancelEvent",value:function(e){var t;for(var n in e)t=n;var r=e[t],i=r.pointOnScene,a=r.pointOnScreen;return{kind:Kc.SortedTouchCancel,identifier:t,pointOnScene:i,pointOnScreen:a}}},{key:"takeEventDescription",value:function(e){var t;switch(e.kind){case Kc.SortedTouchStart:t=Ul.Start;break;case Kc.SortedTouchMove:t=Ul.Update;break;case Kc.SortedTouchEnd:case Kc.SortedTouchCancel:t=Ul.End;break;default:return null}return[{identifier:e.identifier,phase:t,payload:{pointOnScene:e.pointOnScene,pointOnScreen:e.pointOnScreen}}]}}]),e}(),Ql=function(){function e(){I(this,e)}return M(e,[{key:"isEventAccessible",value:function(e){return e.kind===Kc.KeyUp||e.kind===Kc.KeyDown}},{key:"convertToEvent",value:function(e,t){var n=h(t,1)[0].payload;return{kind:e.kind,nativeEvent:e.nativeEvent,key:n.key,altKey:n.altKey,ctrlKey:n.ctrlKey,shiftKey:n.shiftKey}}},{key:"createCancelEvent",value:function(e){var t;for(var n in e)t=e[n];return{kind:Kc.KeyUp,key:t.key,altKey:t.altKey,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey}}},{key:"takeEventDescription",value:function(e){var t,n;if(null==(t=e.nativeEvent)?void 0:t.metaKey)n=Ul.Other;else switch(e.kind){case Kc.KeyDown:n=Ul.Start;break;case Kc.KeyUp:n=Ul.End;break;default:return null}return{identifier:e.key,phase:n,payload:{key:e.key,altKey:e.altKey,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey}}}}]),e}(),Kl=function(){function e(){I(this,e),this.currentIdentifier=0}return M(e,[{key:"setEventDescriptionStateGetter",value:function(e){this.getDescriptionState=e}},{key:"isEventAccessible",value:function(e){return e.kind===Kc.MouseWheel}},{key:"takeEventDescription",value:function(e){var t="".concat(this.currentIdentifier);this.getDescriptionState(t),this.currentIdentifier+=1;var n={isOnScreen:e.isOnScreen,pointOnScene:e.pointOnScene,pointOnScreen:e.pointOnScreen,offsetPoint:e.offsetPoint,scale:e.scale};return{identifier:t,phase:Ul.Other,payload:n}}},{key:"convertToEvent",value:function(e,t){return e}},{key:"createCancelEvent",value:function(e){return null}}]),e}();function Zl(e){return new Gl(e,[new Yl,new Xl,new ql,new Ql,new Kl])}var Jl,$l=function(){function e(t,n){var r=this;I(this,e),this.eventDispatcher=new _l,this.binder=null,this.fireEvent=function(e){var t=r.continuityNode.interruptEvent(e);t&&r.eventDispatcher.dispatch(t)},this.screen=t,this.eventInterrupter=n,this.continuityNode=Zl((function(e){return r.eventDispatcher.dispatch(e)}))}return M(e,[{key:"bindDivElement",value:function(e){e!==(this.binder?this.binder.divElement:null)&&(this.binder&&this.binder.release(),this.binder=e?new Hl(this.screen.deviceType,e,this):null)}},{key:"disable",get:function(){return this.continuityNode.disable},set:function(e){this.continuityNode.disable=e}},{key:"cancelCurrentContinuityEvent",value:function(){this.continuityNode.cancel()}},{key:"toPointInScene",value:function(e,t){return this.screen.convertPointToScene(e,t)}},{key:"willInterruptEvent",value:function(e,t){return!(this.disable||!this.eventInterrupter(e))||!!t&&this.screen.willInterruptEvent(e,t)}},{key:"addListener",value:function(e){this.eventDispatcher.addListener(e)}},{key:"removeListener",value:function(e){this.eventDispatcher.removeListener(e)}}]),e}(),eh=function(){function e(t){var n=this;I(this,e),this.invoker=t,this.timer=null,this.fireAt=-1,this.invokeWhenTimeout=function(){var e=Date.now();if(e>=n.fireAt)n.timer=null,n.fireAt=-1,n.invoker();else{var t=n.fireAt-e;n.timer=setTimeout(n.invokeWhenTimeout,t)}}}return M(e,[{key:"isRunning",get:function(){return null!==this.timer}},{key:"refreshAndInvokeAfterInterval",value:function(e){var t=Date.now();if(null===this.timer)this.timer=setTimeout(this.invokeWhenTimeout,e),this.fireAt=t+e;else{var n=t+e;n<=this.fireAt&&(clearTimeout(this.timer),this.timer=setTimeout(this.invokeWhenTimeout,e)),this.fireAt=n}}},{key:"cancel",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null)}}]),e}(),th=function(){function e(t){var n=this;I(this,e),this.onPushedBoundlessEvent=t,this.operationBuffer=[],this.willBlockOperation=!1,this.flushingOperationBufferTimer=null,this.flushOperationBuffer=function(){if(n.operationBuffer){var e,t=A(n.operationBuffer);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(e){t.e(e)}finally{t.f()}n.operationBuffer.splice(0,n.operationBuffer.length),n.willBlockOperation=!1}n.flushingOperationBufferTimer=null}}return M(e,[{key:"unknownIsMultiFingers",get:function(){return this.willBlockOperation}},{key:"startOperation",value:function(){this.willBlockOperation=!0,this.flushingOperationBufferTimer=setTimeout(this.flushOperationBuffer,300)}},{key:"assertMultiFingers",value:function(){this.operationBuffer.splice(0,this.operationBuffer.length),this.willBlockOperation=!1,null!==this.flushingOperationBufferTimer&&(clearTimeout(this.flushingOperationBufferTimer),this.flushingOperationBufferTimer=null)}},{key:"assertSingleFinger",value:function(){null!==this.flushingOperationBufferTimer&&clearTimeout(this.flushingOperationBufferTimer),this.flushOperationBuffer()}},{key:"pushBoundlessEvent",value:function(e){var t=this;this.willBlockOperation?this.operationBuffer.push((function(){return t.onPushedBoundlessEvent(e)})):this.onPushedBoundlessEvent(e)}}]),e}(),nh=function(){function e(){I(this,e),this.pressedTouches={},this.emptyResolves=[],this.pressedTouchesCount=0}return M(e,[{key:"receiveTouchStartOrMoveEvent",value:function(e){var t,n=A(e.touches);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.identifier in this.pressedTouches||(this.pressedTouchesCount+=1),this.pressedTouches[r.identifier]=r}}catch(e){n.e(e)}finally{n.f()}}},{key:"receiveTouchEndOrCancelEvent",value:function(e){var t,n=A(e.touches);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.identifier in this.pressedTouches&&(this.pressedTouchesCount-=1,delete this.pressedTouches[r.identifier],0===this.pressedTouchesCount)){var i,a=A(this.emptyResolves.splice(0));try{for(a.s();!(i=a.n()).done;){(0,i.value)()}}catch(e){a.e(e)}finally{a.f()}}}}catch(e){n.e(e)}finally{n.f()}}},{key:"waitUntilNoPressedTouches",value:function(){var e=this;return 0===this.pressedTouchesCount?Promise.resolve():new Promise((function(t){return e.emptyResolves.push(t)}))}}]),e}();!function(e){e[e.None=0]="None",e[e.Event=1]="Event",e[e.Camera=2]="Camera",e[e.Cancel=3]="Cancel"}(Jl||(Jl={}));var rh=function(){function e(t){I(this,e),this.pressedTouches=new nh,this.state=0,this.pinchTouches=null,this.previousTouchesCount=0,this.firstPressedTouch=null,this.firstPressedTouchBeginX=0,this.firstPressedTouchBeginY=0,this.blocker=new th(t.onReceivedSortedTouchEvent),this.callbacks=Object.freeze(xu({},t))}return M(e,[{key:"pushTouchEvent",value:function(e){switch(e.kind){case Kc.TouchStart:this.pressedTouches.receiveTouchStartOrMoveEvent(e),this.pushTouchStartEvent(e);break;case Kc.TouchMove:this.pressedTouches.receiveTouchStartOrMoveEvent(e),this.pushTouchMoveEvent(e);break;case Kc.TouchEnd:case Kc.TouchCancel:this.pressedTouches.receiveTouchEndOrCancelEvent(e),this.pushTouchEndOrCancelEvent(e)}}},{key:"cancel",value:function(){var e=this;0!==this.state&&3!==this.state&&(this.state=3,this.pressedTouches.waitUntilNoPressedTouches().then((function(){e.state=0})).catch((function(e){return console.error(e)})))}},{key:"pushTouchStartEvent",value:function(e){var t=e.touches;switch(this.state){case 0:this.blocker.startOperation(),1===t.length?(this.state=1,this.firstPressedTouchBeginX=t[0].pointOnScreen.x,this.firstPressedTouchBeginY=t[0].pointOnScreen.y,this.firstPressedTouch={identifier:t[0].identifier,x:this.firstPressedTouchBeginX,y:this.firstPressedTouchBeginY},this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,0))):(this.state=2,this.pinchTouches=t.map((function(e){return{identifier:e.identifier,x:e.pointOnScreen.x,y:e.pointOnScreen.y}})),this.handleTouchEvents(this.pinchTouches));break;case 1:this.pinchTouches=[{identifier:this.firstPressedTouch.identifier,x:this.firstPressedTouch.x,y:this.firstPressedTouch.y}],this.blocker.unknownIsMultiFingers&&(this.blocker.assertMultiFingers(),this.firstPressedTouch=null),this.pushToPinchTouches(t),this.handleTouchEvents(this.pinchTouches),this.state=2;break;case 2:this.pushToPinchTouches(t),this.handleTouchEvents(this.pinchTouches)}}},{key:"pushTouchMoveEvent",value:function(e){var t=this,n=e.touches;switch(this.refreshFirstPressedTouch(n),this.state){case 1:var r=n.findIndex((function(e){return e.identifier===t.firstPressedTouch.identifier}));this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,r));break;case 2:var i,a=A(this.pinchTouches);try{var o=function(){var e=i.value,t=n.find((function(t){return t.identifier===e.identifier}));t&&(e.x=t.pointOnScreen.x,e.y=t.pointOnScreen.y)};for(a.s();!(i=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}this.handleTouchEvents(this.pinchTouches)}}},{key:"pushTouchEndOrCancelEvent",value:function(e){var t=this,n=e.touches;if(this.firstPressedTouch&&3!==this.state){var r=n.findIndex((function(e){return e.identifier===t.firstPressedTouch.identifier}));-1!==r&&(this.blocker.pushBoundlessEvent(this.covertToSortedTouchEvent(e,r)),this.firstPressedTouch=null)}switch(this.state){case 1:this.blocker.assertSingleFinger(),this.completeOperation();break;case 2:this.blocker.assertMultiFingers();var i,a=A(n);try{var o=function(){var e=i.value,n=t.pinchTouches.findIndex((function(t){return t.identifier===e.identifier}));-1!==n&&t.pinchTouches.splice(n,1)};for(a.s();!(i=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}this.firstPressedTouch&&1===this.pinchTouches.length?(this.state=1,this.handleTouchEvents([]),this.pinchTouches=null):0===this.pinchTouches.length?(this.handleTouchEvents(this.pinchTouches),this.pinchTouches=null,this.completeOperation()):this.handleTouchEvents(this.pinchTouches)}}},{key:"handleTouchEvents",value:function(e){try{0===this.previousTouchesCount&&e.length>0&&this.callbacks.onBeginTransformCamera(e),this.previousTouchesCount>0&&0===e.length?this.callbacks.onAfterTransformCamera():this.callbacks.onTransformCamera(e)}finally{this.previousTouchesCount=e.length}}},{key:"pushToPinchTouches",value:function(e){var t=this;if(this.pinchTouches){var n,r=A(e);try{var i=function(){var e=n.value;t.pinchTouches.some((function(t){return t.identifier===e.identifier}))||t.pinchTouches.push({x:e.pointOnScreen.x,y:e.pointOnScreen.y,identifier:e.identifier})};for(r.s();!(n=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}}}},{key:"refreshFirstPressedTouch",value:function(e){if(this.firstPressedTouch){var t,n=A(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.identifier===this.firstPressedTouch.identifier){this.firstPressedTouch.x=r.pointOnScreen.x,this.firstPressedTouch.y=r.pointOnScreen.y;break}}}catch(e){n.e(e)}finally{n.f()}if(this.blocker.unknownIsMultiFingers){var i=this.firstPressedTouch.x-this.firstPressedTouchBeginX,a=this.firstPressedTouch.y-this.firstPressedTouchBeginY;i*i+a*a>=9&&this.blocker.assertSingleFinger()}}}},{key:"completeOperation",value:function(){this.state=0,this.blocker.unknownIsMultiFingers&&this.blocker.assertMultiFingers(),this.callbacks.onCompleteGroupOfEvents()}},{key:"covertToSortedTouchEvent",value:function(e,t){var n,r=e.touches[t],i=r.identifier,a=r.pointOnScreen,o=r.pointOnScene;switch(e.kind){case Kc.TouchStart:n=Kc.SortedTouchStart;break;case Kc.TouchMove:n=Kc.SortedTouchMove;break;case Kc.TouchEnd:n=Kc.SortedTouchEnd;break;case Kc.TouchCancel:n=Kc.SortedTouchCancel;break;default:throw new Error("unexpected kind ".concat(e.kind))}return{identifier:i,nativeEvent:e.nativeEvent,kind:n,pointOnScreen:a,pointOnScene:o}}}]),e}();function ih(e,t,n,r){if(t===1/0||r===1/0)return{center:0,scale:1/0};var i=t/r;return Number.isNaN(i)&&(i=1),{center:n-e,scale:i}}var ah=function(){function e(t){I(this,e),this.originBorder=t,this.currentBorder=t,this._transform=Object.freeze({deltaX:0,deltaY:0,scale:1})}return M(e,[{key:"transform",get:function(){return this._transform}},{key:"adaptOriginBorder",get:function(){return this._adaptOriginBorder}},{key:"setCurrentBorder",value:function(e){this.currentBorder=e;var t=ih(this.originBorder.centerX,this.originBorder.width,this.currentBorder.centerX,this.currentBorder.width),n=t.center,r=t.scale,i=ih(this.originBorder.centerY,this.originBorder.height,this.currentBorder.centerY,this.currentBorder.height),a=i.center,o=i.scale,s=Math.min(r,o);s===1/0&&(s=1),this._transform=Object.freeze({deltaX:n,deltaY:a,scale:s}),this._adaptOriginBorder=Object.freeze({damping:e.damping,centerX:e.centerX-n,centerY:e.centerY-a,width:e.width*s,height:e.height*s,maxScale:e.maxScale/s,minScale:e.minScale/s})}}]),e}(),oh=function(){function e(){I(this,e),this.eccentricityRate=1,this.centroidXOffset=0,this.centroidYOffset=0,this.beginCentroidX=0,this.beginCentroidY=0,this.centroidX=0,this.centroidY=0,this._scale=1,this.isHanding=!1,this.previousTouchesCount=0}return M(e,[{key:"beginCentroid",get:function(){return this.isHanding?{x:this.beginCentroidX,y:this.beginCentroidY}:e.zeroPoint}},{key:"centroid",get:function(){return this.isHanding?{x:this.centroidX,y:this.centroidY}:e.zeroPoint}},{key:"scale",get:function(){return this.isHanding?this._scale:1}},{key:"handleTouches",value:function(e){var t=this.findTouchesExpression(e);this.isHanding?(this.previousTouchesCount!==e.length&&(this.centroidXOffset=this.centroidX-t.centroidX,this.centroidYOffset=this.centroidY-t.centroidY,this.eccentricityRate=this._scale/t.eccentricity,this.previousTouchesCount=e.length),this.centroidX=t.centroidX+this.centroidXOffset,this.centroidY=t.centroidY+this.centroidYOffset,this._scale=t.eccentricity*this.eccentricityRate):(this.centroidXOffset=0,this.centroidYOffset=0,this.eccentricityRate=1/t.eccentricity,this.beginCentroidX=t.centroidX,this.beginCentroidY=t.centroidY,this.centroidX=t.centroidX,this.centroidY=t.centroidY,this._scale=1,this.previousTouchesCount=e.length,this.isHanding=!0)}},{key:"findTouchesExpression",value:function(e){var t,n=0,r=0,i=A(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.x,s=a.y;n+=o,r+=s}}catch(e){i.e(e)}finally{i.f()}var c,u=n/e.length,l=r/e.length,h=0,d=A(e);try{for(d.s();!(c=d.n()).done;){var f=c.value,p=f.x,v=f.y,m=p-u,g=v-l;h+=Math.sqrt(m*m+g*g)}}catch(e){d.e(e)}finally{d.f()}return 0===h&&(h=1),{eccentricity:h,centroidX:u,centroidY:l}}}]),e}();oh.zeroPoint=Object.freeze({x:0,y:0});var sh=function(){function e(t){I(this,e),this.border={centerX:0,centerY:0,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},this.scaleStart=0,this.scaleEnd=Number.POSITIVE_INFINITY,this.screenSize=t}return M(e,[{key:"findClosestValidCamera",value:function(e){var t=this.findClosestValidScale(e.scale),n=e.centerX,r=e.centerY;if(this.pinPoint&&e.scale!==t){var i=n-this.pinPoint.x,a=r-this.pinPoint.y,o=t/e.scale;n=this.pinPoint.x+i/o,r=this.pinPoint.y+a/o}return{centerX:n=this.findClosestValidCenter(n,t,this.screenSize.width,this.border.centerX,this.border.width),centerY:r=this.findClosestValidCenter(r,t,this.screenSize.height,this.border.centerY,this.border.height),scale:t}}},{key:"findClosestValidScale",value:function(e){var t=e;return this.scaleStart>t?t=this.scaleStart:this.scaleEnd<t&&(t=this.scaleEnd),t}},{key:"findClosestValidCenter",value:function(e,t,n,r,i){var a=e;if(t<=n/i)a=r;else{var o=n/t/2,s=i/2,c=r-s+o,u=r+s-o;a<c?a=c:a>u&&(a=u)}return a}}]),e}();function ch(e,t){return{x:e.x-t.width/2,y:e.y-t.height/2}}function uh(e,t,n){var r=e.x-t.width/2,i=e.y-t.height/2;return{x:n.centerX+r/n.scale,y:n.centerY+i/n.scale}}var lh=function(){function e(t){I(this,e),this.pincher=null,this.damping=0,this.camera=null,this.lastValidCamera=null,this.domain=new sh(t)}return M(e,[{key:"isHandingPinch",get:function(){return!!this.pincher}},{key:"screenSize",get:function(){return this.domain.screenSize},set:function(e){this.domain.screenSize=e}},{key:"setCameraBorder",value:function(e){this.damping=e.damping,this.domain.scaleStart=e.minScale,this.domain.scaleEnd=e.maxScale,this.domain.border.centerX=e.centerX,this.domain.border.centerY=e.centerY,this.domain.border.width=e.width,this.domain.border.height=e.height}},{key:"beginWithCamera",value:function(e){this.pincher=new oh,this.camera=e}},{key:"handleTouchesAndGetCameraMoving",value:function(e){this.pincher.handleTouches(e);var t=this.pincher.centroid,n=this.currentTargetCamera();return this.transformToCombinedCamera(n,t)}},{key:"transformToCombinedCamera",value:function(e,t){var n=this.domain.screenSize,r=uh(t,n,e);this.domain.pinPoint=r;var i,a=this.domain.findClosestValidCamera(e);if(this.lastValidCamera=a,0===this.damping)i=e;else if(1===this.damping)i=a;else if(function(e,t){return e.centerX===t.centerX&&e.centerY===t.centerY&&e.scale===t.scale}(e,a))i=e;else{var o=uh(t,n,a);i=this.viewCamera(r,o,e,a,this.damping)}return{valid:a,view:i}}},{key:"completeAndGetValidCamera",value:function(){var e=this.lastValidCamera;return this.pincher=null,this.camera=null,this.lastValidCamera=null,e}},{key:"currentTargetCamera",value:function(){var e=this.camera,t=this.pincher,n=this.domain.screenSize,r=e.scale*t.scale,i=ch(t.beginCentroid,n),a=ch(t.centroid,n),o=i.x/e.scale-a.x/r,s=i.y/e.scale-a.y/r;return{centerX:e.centerX+o,centerY:e.centerY+s,scale:r}}},{key:"viewCamera",value:function(e,t,n,r,i){var a=Pd(n.centerX,n.centerY,e.x,e.y),o=Cd(n.scale,r.scale,i),s=a*n.scale/o,c=Cd(e.x,t.x,i),u=Cd(e.y,t.y,i),l=Id(Cd(n.centerX,r.centerX,i)-c,Cd(n.centerY,r.centerY,i)-u);return{centerX:c+s*l.x,centerY:u+s*l.y,scale:o}}}]),e}(),hh=function(){function e(t){I(this,e),this._isActive=!1,this._key=void 0,this.previousPressEvent=null,this.cameraman=t.cameraman,this.activeDispatch=t.activeDispatch}return M(e,[{key:"active",get:function(){return this._isActive},set:function(e){this._isActive=e}},{key:"key",get:function(){return this._key},set:function(e){this._key=e}},{key:"willInterruptEvent",value:function(e){return this.active&&!!e&&(e.kind===Kc.SortedTouchMove||e.kind===Kc.MouseMove)}},{key:"moveCameraByEvent",value:function(e){if(e&&this.previousPressEvent&&this.isMouseOrSortedTouch(this.previousPressEvent)&&this.isMouseOrSortedTouch(e)){var t=e.pointOnScreen.x-this.previousPressEvent.pointOnScreen.x,n=e.pointOnScreen.y-this.previousPressEvent.pointOnScreen.y,r=this.cameraman.screen.camera,i=r.centerX,a=r.centerY,o=r.scale;this.cameraman.transformCamera({centerX:i-t/o,centerY:a-n/o,scale:o,animationMode:bd.Immediately,operatorId:this.cameraman.operatorId,boundCamera:!0})}}},{key:"handlePreviousEvent",value:function(e){this.needUpdatePrevious(e)?this.previousPressEvent=e:this.needReleasePrevious(e)&&(this.previousPressEvent=null)}},{key:"isKeyEvent",value:function(e){return!!e.nativeEvent&&e.nativeEvent instanceof KeyboardEvent&&e.nativeEvent.key===this.key}},{key:"handleKeyEvent",value:function(e){var t=this.active;e.kind===Kc.KeyDown&&!0!==t?this.active=!0:e.kind===Kc.KeyUp&&!1!==t&&(this.active=!1),t!==this.active&&this.activeDispatch(this.active)}},{key:"isMouseOrSortedTouch",value:function(e){var t=e.kind;return t===Kc.MouseDown||t===Kc.MouseUp||t===Kc.MouseLeave||t===Kc.MouseMove||t===Kc.SortedTouchStart||t===Kc.SortedTouchMove||t===Kc.SortedTouchEnd||t===Kc.SortedTouchCancel}},{key:"needUpdatePrevious",value:function(e){return!(!e||(!this.previousPressEvent||e.kind!==Kc.MouseMove&&e.kind!==Kc.SortedTouchMove)&&e.kind!==Kc.MouseDown&&e.kind!==Kc.SortedTouchStart)}},{key:"needReleasePrevious",value:function(e){return!!e&&(e.kind===Kc.MouseUp||e.kind===Kc.SortedTouchEnd||e.kind===Kc.SortedTouchCancel)}}]),e}(),dh=function(){function e(t,n,r){var i=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};I(this,e),this.disableCameraTransform=!1,this.boundlessEventDispatcher=new _l,this.transformationEventDispatcher=new _l,this.handToolActiveEventDispatcher=new _l,this.transformer=null,this.border=Object.freeze({damping:.75,centerX:0,centerY:0,width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY,minScale:0,maxScale:Number.POSITIVE_INFINITY}),this.moveToCamera=null,this.didRelease=!1,this.isPaddingCameraOperations=!1,this.paddingCameraOperation=null,this.onBoundlessEvent=function(e){switch(i.screen.deviceType){case ld.Surface:i.handleBoundlessEventWhenItIsSurface(e);break;case ld.Desktop:i.handleBoundlessEventWhenItIsDesktop(e);break;case ld.Touch:i.handleBoundlessEventWhenItIsTouch(e)}},this.onScreenUpdatedListener=function(e){var t=e.camera,n=e.width,r=e.height,a=i.cameraView.screenSize;if(a.width!==n||a.height!==r){i.cameraView.screenSize=Object.freeze({width:n,height:r});var o=i.cameraView.transformToCombinedCamera(i.screen.camera,{x:n/2,y:r/2}).valid;(t.centerX!==o.centerX||t.centerY!==o.centerY||t.scale!==o.scale)&&i.screen.transformCamera(Cu(xu({},o),{animationMode:bd.Immediately}))}},this.dispatchBoundlessEvent=function(e){var t=i.continuityNode.interruptEvent(e);i.handTool.willInterruptEvent(t)?i.handTool.moveCameraByEvent(t):t&&i.boundlessEventDispatcher.dispatch(t),i.handTool.handlePreviousEvent(t)},this.onAfterMouseWheel=function(){i.transformationEventDispatcher.dispatch(yd.End),i.screen.setTransition(!1,i.operatorId)},this.onBeginTransformCamera=function(e){i.disableCameraTransform||(i.isPaddingCameraOperations=!0,i.transformationEventDispatcher.dispatch(yd.Begin),i.cameraView.beginWithCamera(i.screen.camera),i.transformer=new ah(i.border),i.onTransformCamera(e))},this.onTransformCamera=function(e){if(!i.disableCameraTransform){var t=i.cameraView.handleTouchesAndGetCameraMoving(e),n=Cu(xu({},i.cameraAppendBorderTransform(t.view)),{animationMode:bd.Immediately,operatorId:i.operatorId});i.moveToCamera=t.view,i.screen.setCameraTransfrom(n,!0)}},this.onAfterTransformCamera=function(){if(!i.disableCameraTransform){var e=i.cameraView.completeAndGetValidCamera();i.isPaddingCameraOperations=!1,i.moveToCamera=i.cameraAppendBorderTransform(e),i.cameraView.setCameraBorder(i.border),i.paddingCameraOperation&&(i.paddingCameraOperation(),i.paddingCameraOperation=null),i.transformer=null,i.transformationEventDispatcher.dispatch(yd.End)}},this.onCompleteGroupOfEvents=function(){if(i.moveToCamera){var e=i.screen.camera;if(i.moveToCamera.centerX!==e.centerX||i.moveToCamera.centerY!==e.centerY||i.moveToCamera.scale!==e.scale){var t=Cu(xu({},i.moveToCamera),{animationMode:bd.Continuous,operatorId:i.operatorId});i.screen.setCameraTransfrom(t,!1)}else i.screen.setTransition(!1,i.operatorId);i.moveToCamera=null}},this.onContinuityNodeCancel=function(e){i.boundlessEventDispatcher.dispatch(e),i.sorter&&i.sorter.cancel()},this.screen=t,this.operatorId=r,this.eventProxy=n,this.afterWheelDelayer=new eh(this.onAfterMouseWheel),this.continuityNode=Zl(this.onContinuityNodeCancel),this.cameraView=new lh({width:t.width,height:t.height}),this.handTool=new hh({cameraman:this,activeDispatch:function(e){return i.handToolActiveEventDispatcher.dispatch(e)}}),this.setCameraBorder(a),(t.deviceType===ld.Touch||t.deviceType===ld.Surface)&&(this.sorter=new rh({onBeginTransformCamera:this.onBeginTransformCamera,onTransformCamera:this.onTransformCamera,onAfterTransformCamera:this.onAfterTransformCamera,onCompleteGroupOfEvents:this.onCompleteGroupOfEvents,onReceivedSortedTouchEvent:this.dispatchBoundlessEvent})),n.addListener(this.onBoundlessEvent),t.addScreenUpdatedListener(this.onScreenUpdatedListener)}return M(e,[{key:"handToolActive",get:function(){return this.handTool.active},set:function(e){this.handTool.active=e}},{key:"handToolKey",get:function(){return this.handTool.key},set:function(e){this.handTool.key=e}},{key:"cameraBorder",get:function(){return this.border}},{key:"cancelCurrentContinuityEvent",value:function(){this.continuityNode.cancel()}},{key:"setCameraBorder",value:function(e){var t=this.border,n=this.border=Object.freeze(xu(xu({},this.border),e));if(!function(e,t){return e.centerX===t.centerX&&e.centerY===t.centerY&&e.damping===t.damping&&e.width===t.width&&e.height===t.height&&e.minScale===t.minScale&&e.maxScale===t.maxScale}(t,n)){var r;this.transformer?((r=this.transformer).setCurrentBorder(n),n=r.adaptOriginBorder):(r=new ah(t)).setCurrentBorder(n),this.cameraView.setCameraBorder(n);var i=this.moveToCamera||this.screen.camera,a=r.transform;(0!==a.deltaX||0!==a.deltaY||1!==a.scale)&&this.screen.transformCamera({animationMode:bd.Immediately,centerX:i.centerX+a.deltaX,centerY:i.centerY+a.deltaY,scale:i.scale*a.scale})}return this.border}},{key:"disableBoundlessEvent",get:function(){return this.continuityNode.disable},set:function(e){this.continuityNode.disable=e}},{key:"transformCamera",value:function(e){var t=this;this.isPaddingCameraOperations?this.paddingCameraOperation=function(){return t.executeTransformCamera(e)}:this.executeTransformCamera(e)}},{key:"executeTransformCamera",value:function(e){var t=e;if(t.boundCamera){var n=this.screen.camera,r=n.centerX,i=n.centerY,a=n.scale,o={centerX:Cl(t.centerX,r),centerY:Cl(t.centerY,i),scale:Cl(t.scale,a)},s=this.cameraView.screenSize,c=s.width,u=s.height,l=this.cameraView.transformToCombinedCamera(o,{x:c/2,y:u/2}).valid;(l.centerX!==o.centerX||l.centerY!==o.centerY||l.scale!==o.scale)&&(t=Cu(xu({},t),{centerX:l.centerX,centerY:l.centerY,scale:l.scale}))}this.screen.transformCamera(t)}},{key:"adaptRectangle",value:function(e){var t=this;this.isPaddingCameraOperations?this.paddingCameraOperation=function(){return t.screen.adaptRectangle(e)}:this.screen.adaptRectangle(e)}},{key:"release",value:function(){this.didRelease||(this.sorter&&this.sorter.cancel(),this.eventProxy.removeListener(this.onBoundlessEvent),this.screen.removeScreenUpdatedListener(this.onScreenUpdatedListener),this.afterWheelDelayer.cancel(),this.didRelease=!0)}},{key:"handleBoundlessEventWhenItIsDesktop",value:function(e){switch(e.kind){case Kc.MouseWheel:this.onMouseWheel(e);break;case Kc.TouchStart:case Kc.TouchMove:case Kc.TouchEnd:case Kc.TouchCancel:break;case Kc.KeyDown:case Kc.KeyUp:this.handTool.isKeyEvent(e)?this.handTool.handleKeyEvent(e):this.dispatchBoundlessEvent(e);break;default:this.dispatchBoundlessEvent(e)}}},{key:"handleBoundlessEventWhenItIsTouch",value:function(e){switch(e.kind){case Kc.TouchStart:case Kc.TouchMove:case Kc.TouchEnd:case Kc.TouchCancel:this.sorter.pushTouchEvent(e);break;case Kc.MouseDown:case Kc.MouseUp:case Kc.MouseMove:case Kc.MouseLeave:break;case Kc.KeyDown:case Kc.KeyUp:this.handTool.isKeyEvent(e)?this.handTool.handleKeyEvent(e):this.dispatchBoundlessEvent(e);break;default:this.dispatchBoundlessEvent(e)}}},{key:"handleBoundlessEventWhenItIsSurface",value:function(e){switch(e.kind){case Kc.MouseWheel:this.onMouseWheel(e);break;case Kc.TouchStart:case Kc.TouchMove:case Kc.TouchEnd:case Kc.TouchCancel:this.sorter.pushTouchEvent(e);break;case Kc.MouseDown:case Kc.MouseUp:case Kc.MouseMove:case Kc.MouseLeave:default:this.dispatchBoundlessEvent(e)}}},{key:"onMouseWheel",value:function(t){if(!this.disableCameraTransform){var n=this.screen.camera,r=n.centerX,i=n.centerY,a=n.scale;if(0!==t.scale){var o=1+t.scale,s=t.pointOnScreen.x,c=t.pointOnScreen.y,u=(1-1/o)/a;r+=u*(s-this.screen.width/2),i+=u*(c-this.screen.height/2),a*=o}r-=t.offsetPoint.x/a,i-=t.offsetPoint.y/a;var l=this.cameraView.transformToCombinedCamera({centerX:r,centerY:i,scale:a},t.pointOnScreen),h=Cu(xu({},this.cameraAppendBorderTransform(l.valid)),{animationMode:bd.Immediately,operatorId:this.operatorId});this.transformationEventDispatcher.dispatch(yd.Begin),this.afterWheelDelayer.refreshAndInvokeAfterInterval(e.RefreshTimeoutOnDesktop),this.screen.setCameraTransfrom(h,!0)}}},{key:"cameraAppendBorderTransform",value:function(e){if(this.transformer){var t=this.transformer.transform;return Object.freeze({centerX:e.centerX+t.deltaX,centerY:e.centerY+t.deltaY,scale:e.scale*t.scale})}return e}},{key:"addHandToolActiveListener",value:function(e){this.handToolActiveEventDispatcher.addListener(e)}},{key:"removeHandToolActiveListener",value:function(e){this.handToolActiveEventDispatcher.removeListener(e)}},{key:"addCameraTransformationListener",value:function(e){this.transformationEventDispatcher.addListener(e)}},{key:"removeCameraTransformationListener",value:function(e){this.transformationEventDispatcher.removeListener(e)}},{key:"addBoundlessEventListener",value:function(e){this.boundlessEventDispatcher.addListener(e)}},{key:"removeBoundlessEventListener",value:function(e){this.boundlessEventDispatcher.removeListener(e)}}]),e}();function fh(e,t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}function ph(e,t){-1===e.indexOf(t)&&e.push(t)}dh.RefreshTimeoutOnDesktop=200;var vh=function(){function e(){var t=this;I(this,e),this.animationPriorities=[],this.animations={},this.afterAnimationsInvokers=[],this.animationId=null,this.isInAnimationFrame=!1,this.onAnimationFrame=function(){try{t.isInAnimationFrame=!0;var e,n=A(t.animationPriorities);try{for(n.s();!(e=n.n()).done;)for(var r=e.value,i=0,a=p(t.animations[r]);i<a.length;i++){(0,a[i])()}}catch(e){n.e(e)}finally{n.f()}for(var o=0,s=p(t.afterAnimationsInvokers);o<s.length;o++){(0,s[o])()}t.animationPriorities.length>0?t.animationId=window.requestAnimationFrame(t.onAnimationFrame):t.animationId=null}finally{t.isInAnimationFrame=!1}}}return M(e,[{key:"addAnimation",value:function(e,t){var n=this.animations[e],r=!1;n||(n=this.animations[e]=[],this.animationPriorities.push(e),this.animationPriorities.sort(),r=1===this.animationPriorities.length),ph(n,t),r&&null===this.animationId&&(this.animationId=window.requestAnimationFrame(this.onAnimationFrame))}},{key:"removeAnimation",value:function(e,t){var n=this.animations[e];n&&(fh(n,t),0===n.length&&(delete this.animations[e],fh(this.animationPriorities,e),0===this.animationPriorities.length&&!this.isInAnimationFrame&&null!==this.animationId&&(window.cancelAnimationFrame(this.animationId),this.animationId=null)))}},{key:"addAfterAnimationsInvoker",value:function(e){ph(this.afterAnimationsInvokers,e)}},{key:"removeAfterAnimationsInvoker",value:function(e){fh(this.afterAnimationsInvokers,e)}}]),e}(),mh=function(){function e(){I(this,e)}return M(e,[{key:"createAnimationGroup",value:function(){return new gh}},{key:"createAnimation",value:function(e,t){return new yh(e,t)}},{key:"createAnimationFrameInvoker",value:function(e){return new kh(e)}},{key:"createAfterAnimationsInvoker",value:function(e){return new bh(e)}}]),e}();mh.animationFrames=new vh;var gh=function(){function e(){I(this,e),this.children=[]}return M(e,[{key:"createAnimation",value:function(e,t){var n=this,r=new yh(e,t,(function(e){return fh(n.children,e)}));return this.children.push(r),r}},{key:"createAfterAnimationsInvoker",value:function(e){var t=this,n=new bh(e,(function(e){return fh(t.children,e)}));return this.children.push(n),n}},{key:"release",value:function(){var e,t=A(this.children.splice(0));try{for(t.s();!(e=t.n()).done;){e.value.release()}}catch(e){t.e(e)}finally{t.f()}}}]),e}(),yh=function(){function e(t,n,r){var i=this;I(this,e),this.priority=t,this.onRefresh=n,this.onRelease=r,this.onAnimationFrame=function(){Sh(i,i.onRefresh)},mh.animationFrames.addAnimation(this.priority,this.onAnimationFrame)}return M(e,[{key:"release",value:function(){mh.animationFrames.removeAnimation(this.priority,this.onAnimationFrame),this.onRelease&&this.onRelease(this)}}]),e}(),bh=function(){function e(t,n){var r=this;I(this,e),this.onRefresh=t,this.onRelease=n,this.onAnimationFrame=function(){Sh(r,r.onRefresh)},mh.animationFrames.addAfterAnimationsInvoker(this.onAnimationFrame)}return M(e,[{key:"release",value:function(){mh.animationFrames.removeAfterAnimationsInvoker(this.onAnimationFrame),this.onRelease&&this.onRelease(this)}}]),e}(),kh=function(){function e(t){var n=this;I(this,e),this.priority=t,this.nextHandler=null,this.banAnimationChange=!1,this.onAnimationFrame=function(){if(n.nextHandler){var e=n.nextHandler;n.nextHandler=null;try{n.banAnimationChange=!0,Sh(n,e)}finally{n.banAnimationChange=!1}null===n.nextHandler&&mh.animationFrames.removeAnimation(n.priority,n.onAnimationFrame)}}}return M(e,[{key:"invoke",value:function(e){!this.banAnimationChange&&!this.nextHandler&&mh.animationFrames.addAnimation(this.priority,this.onAnimationFrame),this.nextHandler=e}},{key:"release",value:function(){!this.banAnimationChange&&this.nextHandler&&(this.nextHandler=null,mh.animationFrames.removeAnimation(this.priority,this.onAnimationFrame))}}]),e}(),wh=new mh;function Sh(e,t){try{t(e)}catch(e){console.error(e)}}function xh(e){var t=Math.abs(e),n=1/(1+t/2),r=n*Math.exp(-t*t-1.26551223+n*(1.00002368+n*(.37409196+n*(.09678418+n*(n*(.27886807+n*(n*(1.48851587+n*(.17087277*n-.82215223))-1.13520398))-.18628806)))));return e>=0?r:2-r}function Ch(e,t){return new Mh(e,t)}function Ih(e,t){return Ch(t/e,1/e)}var Ph,Mh=function(){function e(t,n){I(this,e),this.mean=t,this.variance=n,this.standardDeviation=Math.sqrt(n)}return M(e,[{key:"pdf",value:function(e){var t=this.standardDeviation*Math.sqrt(2*Math.PI);return Math.exp(-Math.pow(e-this.mean,2)/(2*this.variance))/t}},{key:"cdf",value:function(e){return.5*xh(-(e-this.mean)/(this.standardDeviation*Math.sqrt(2)))}},{key:"ppf",value:function(e){return this.mean-this.standardDeviation*Math.sqrt(2)*function(e){if(e>=2)return-100;if(e<=0)return 100;for(var t=e<1?e:2-e,n=Math.sqrt(-2*Math.log(t/2)),r=-.70711*((2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n),i=0;i<2;i++){var a=xh(r)-t;r+=a/(1.1283791670955126*Math.exp(-r*r)-r*a)}return e<1?r:-r}(2*e)}},{key:"mul",value:function(e){if("number"==typeof e)return this.scale(e);var t=1/this.variance,n=1/e.variance;return Ih(t+n,t*this.mean+n*e.mean)}},{key:"div",value:function(e){if("number"==typeof e)return this.scale(1/e);var t=1/this.variance,n=1/e.variance;return Ih(t-n,t*this.mean-n*e.mean)}},{key:"add",value:function(e){return Ch(this.mean+e.mean,this.variance+e.variance)}},{key:"sub",value:function(e){return Ch(this.mean-e.mean,this.variance+e.variance)}},{key:"scale",value:function(e){return Ch(this.mean*e,this.variance*e*e)}}]),e}(),Th=function(){function e(){I(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.configurations=Object.freeze(n.map((function(e){return Object.freeze(xu({},e))})))}return M(e,[{key:"create",value:function(e,t,n){return new Ah(e,p(this.configurations),t,n)}}]),e}(),Ah=function(){function e(t,n,r,i){var a=this;I(this,e),this.priority=t,this._point=r,this.onPointUpdate=i,this.completeTick=!1,this.playingAnimation=null,this.updateIdealPoint=function(t){e.setPoint(a.idealPoint,t),!a.playingAnimation&&a.shouldContinueMoving()&&(a.playingAnimation=wh.createAnimation(a.priority,a.onTick)),a.completeTick=!1},this.onTick=function(){if(a.completeTick)a.stop();else{a.executePhysicalSimulate();var e=!a.shouldContinueMoving();a.onPointUpdate&&a.onPointUpdate(a._point,e),e&&(a.completeTick=!0)}};var o=h(n.splice(0,1),1)[0];this.configuration=o,this._point=p(r),this.idealPoint=p(r),this.velocity=r.map((function(){return 0})),n.length>0&&(this.guider=new e(this.priority,n,r,this.updateIdealPoint));var s=this.configuration.pedesisSpeedMean,c=this.configuration.pedesisSpeedVariance;this.gaussian=0!==s&&0!==c?Ch(s,c):null,this.noPedesisRadius=(s+Math.sqrt(c))*e.noPedesisRadiusRate}return M(e,[{key:"point",get:function(){return this._point}},{key:"isPlayingAnimation",get:function(){return!!this.playingAnimation}},{key:"moveRightNow",value:function(t){this.guider&&this.guider.moveRightNow(t),e.setPoint(this.idealPoint,t),e.setPoint(this._point,t),e.setPointZero(this.velocity),this.playingAnimation&&(this.playingAnimation.release(),this.playingAnimation=null),this.completeTick=!1}},{key:"moveTo",value:function(e){this.guider?this.guider.moveTo(e):this.updateIdealPoint(e)}},{key:"moveToAndChangeCoordinate",value:function(e,t){for(var n=0;n<this._point.length;++n)this._point[n]+=e[n];this.guider?this.guider.moveToAndChangeCoordinate(e,t):this.updateIdealPoint(t)}},{key:"stop",value:function(){e.setPoint(this.idealPoint,this._point),e.setPointZero(this.velocity),this.playingAnimation&&(this.playingAnimation.release(),this.playingAnimation=null),this.completeTick=!1}},{key:"executePhysicalSimulate",value:function(){for(var e=this.squareDistanceToIdealPoint(),t=this.velocityDamping(e),n=e>this.noPedesisRadius*this.noPedesisRadius,r=0;r<this._point.length;++r){var i=this.idealPoint[r]-this._point[r],a=this.configuration.kDistance*i;if(this.velocity[r]+=a,n&&this.gaussian){var o=this.gaussian.ppf(Math.random());Math.random()>=.5&&(o=-o),this.velocity[r]+=o}this._point[r]+=this.velocity[r],this.velocity[r]*=1-t}}},{key:"velocityDamping",value:function(e){for(var t=0,n=0;n<this.velocity.length;++n)t+=this.velocity[n]*this.velocity[n];var r=this.configuration,i=r.heavyDampingRadius,a=r.heavyDampingSpeed;return t<a*a||e>i*i?this.configuration.velocityDamping:Math.min(1,t*this.configuration.velocityDamping)}},{key:"squareDistanceToIdealPoint",value:function(){for(var e=0,t=0;t<this.velocity.length;++t){var n=this.idealPoint[t]-this._point[t];e+=n*n}return e}},{key:"shouldContinueMoving",value:function(){for(var e=0;e<this._point.length;++e)if(Math.abs(this._point[e]-this.idealPoint[e])>this.configuration.matchingDistance||Math.abs(this.velocity[e])>this.configuration.zeroSpeed)return!0;return!1}}],[{key:"setPoint",value:function(e,t){for(var n=0;n<e.length;++n)e[n]=n in t?t[n]:0}},{key:"setPointZero",value:function(e){for(var t=0;t<e.length;++t)e[t]=0}}]),e}();Ah.noPedesisRadiusRate=2.7,function(e){e[e.ComponentMoving=0]="ComponentMoving",e[e.CameraMoving=1]="CameraMoving",e[e.Rendering=2]="Rendering"}(Ph||(Ph={}));var Eh=function(){function e(t,n){var r=this;I(this,e),this.referPoint=[],this._isTransition=!1;var i=n&&function(e,t){var i=r.convertPointToCamera(e,t),a=r._isTransition||!t;n(i,a,r.currentOperatorId),t&&(r.currentOperatorId=void 0)};this.referPoint[0]=t.centerX,this.referPoint[1]=t.centerY,this.referPoint[2]=t.scale*e.kScale,this.spaceSpring=e.spaceSpringFactory.create(Ph.CameraMoving,[0,0,0],i)}return M(e,[{key:"isTransition",get:function(){return this._isTransition}},{key:"convertPointToCamera",value:function(t,n){return n?{centerX:this.referPoint[0],centerY:this.referPoint[1],scale:this.referPoint[2]/e.kScale}:{centerX:this.referPoint[0]+t[0],centerY:this.referPoint[1]+t[1],scale:(this.referPoint[2]+t[2])/e.kScale}}},{key:"moveTo",value:function(t,n,r){var i=[this.referPoint[0]-t.centerX,this.referPoint[1]-t.centerY,this.referPoint[2]-t.scale*e.kScale];this._isTransition=n,this.currentOperatorId=r,this.referPoint[0]=t.centerX,this.referPoint[1]=t.centerY,this.referPoint[2]=t.scale*e.kScale,this.spaceSpring.moveToAndChangeCoordinate(i,[0,0,0])}},{key:"moveToRightNow",value:function(t,n){this._isTransition=n,this.referPoint[0]=t.centerX,this.referPoint[1]=t.centerY,this.referPoint[2]=t.scale*e.kScale,this.spaceSpring.moveRightNow([0,0,0])}}]),e}();function Oh(e,t){var n,r=t,i=A(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;r=(0,lu.createElement)(a,null,r)}}catch(e){i.e(e)}finally{i.f()}return r}function Rh(e){var t,n={},r=A(e.engines);try{var i=function(){var r=t.value;n[r.id]=r.createRenderLayout({screen:e.screen,tree:e.tree,mode:e.mode,initCamera:e.initCamera,visions:e.visions,leafFilter:function(e){return e.value.isVisible(r)},onRenderDuration:e.onRenderDuration})};for(r.s();!(t=r.n()).done;)i()}catch(e){r.e(e)}finally{r.f()}return n}Eh.kScale=700,Eh.spaceSpringFactory=new Th({matchingDistance:2,zeroSpeed:.55,kDistance:.17,velocityDamping:.55,heavyDampingRadius:15,heavyDampingSpeed:.25,pedesisSpeedMean:0,pedesisSpeedVariance:0},{matchingDistance:2,zeroSpeed:.55,kDistance:.12,velocityDamping:.35,heavyDampingRadius:15,heavyDampingSpeed:.35,pedesisSpeedMean:0,pedesisSpeedVariance:0});var Nh,Lh=function(){function e(t){I(this,e),this.className=t.screen.className,this.layouts=Object.freeze(Rh({tree:t.tree,screen:t.screen,initCamera:t.initCamera,visions:t.visions,engines:t.engines,onRenderDuration:t.onRenderDuration,mode:Zc.Preview}))}return M(e,[{key:"render",value:function(e){var t=[];for(var n in this.layouts){var r=this.layouts[n].getRender();t.push((0,uu.createElement)(r,{key:n}))}return Oh(e,(0,uu.createElement)("div",{className:this.className,style:{width:"100%",height:"100%",position:"relative"}},t))}}]),e}();function jh(e,t,n,r){var i=t,a=n,o=r,s=e>a;if(s){var c=e,u=i;a,a=c,i=o,o=u}return i<a?Nh.Result.Disjoint:i<o?Nh.Result.Cross:s?Nh.Result.IncludeByRectangle:Nh.Result.IncludeRectangle}!function(e){var t;(t=e.Result||(e.Result={}))[t.Disjoint=0]="Disjoint",t[t.Cross=1]="Cross",t[t.IncludeRectangle=2]="IncludeRectangle",t[t.IncludeByRectangle=3]="IncludeByRectangle",e.testPoint=function(e,t,n,r,i,a){return i>=e&&i<=e+n&&a>=t&&a<=t+r},e.testRectangle=function(e,t,n,r,i,a,o,s){var c=jh(e,e+n,i,i+o),u=jh(t,t+r,a,a+s);return 0===c||0===u?0:1===c||1===u?1:2===c&&2===u?2:3===c&&3===u?3:1},e.iterate=function(e,t,n,r,i){i(e,t),i(e+n,t),i(e+n,t+r),i(e,t+r)},e.allPoints=function(e,t,n,r){return[{x:e,y:t},{x:e+n,y:t},{x:e+n,y:t+r},{x:e,y:t+r}]}}(Nh||(Nh={}));var Dh=function(){function e(t){I(this,e),this.component=null,this.componentState={className:t.screen.className},this.layouts=Object.freeze(Rh({tree:t.tree,screen:t.screen,engines:t.engines,visions:t.visions,onRenderDuration:t.onRenderDuration,mode:Zc.Normal})),this.logger=t.screen.scene.logger,this.renderClass=this.createRender()}return M(e,[{key:"setState",value:function(e){var t;this.componentState=xu({},e),null==(t=this.component)||t.setState(e)}},{key:"renderLayouts",get:function(){return this.layouts}},{key:"getRender",value:function(){return this.renderClass}},{key:"createRender",value:function(){var e=this;return function(t){y(r,t);var n=k(r);function r(t){var i;return I(this,r),(i=n.call(this,t)).state=xu({},e.componentState),e.component=S(i),i}return M(r,[{key:"componentWillUnmount",value:function(){e.component=null}},{key:"render",value:function(){var t=[],n=this.state,r=n.className,i=n.style,a=Cu(xu({},i),{width:"100%",height:"100%",position:"relative"});for(var o in e.layouts)t.push((0,fu.createElement)(Fh,{key:o,logger:e.logger,layout:e.layouts[o]}));return(0,fu.createElement)("div",{className:r,style:a},t)}}]),r}(fu.Component)}}]),e}(),Fh=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).state={error:void 0},r}return M(n,[{key:"shouldComponentUpdate",value:function(e,t){var n=this.props.layout,r=this.state.error;return n!==e.layout||r!==t.error}},{key:"componentDidCatch",value:function(e,t){var n=this.props,r=n.layout;n.logger.error("boundless layout ".concat(r.engine.id," render catch error:"),e," stack: ",t.componentStack)}},{key:"render",value:function(){var e=this.props.layout;if(this.state.error)return null;var t=e.getRender();return(0,fu.createElement)(t,null)}}],[{key:"getDerivedStateFromError",value:function(e){return console.error(e),{error:e}}}]),n}(fu.Component),zh=function(){function e(t,n,r,i,a){I(this,e);var o={},s=function(e){var r=t.renderLayouts[e],i={};n.forEach((function(e){e.value.isVisible(r.engine)&&(i[e.id]=!0)})),o[e]=Object.seal({layout:r,visibleSet:i})};for(var c in t.renderLayouts)s(c);this.camera=i,this.screenSize=a,this.context=r,this.engineNodes=Object.freeze(o)}return M(e,[{key:"flush",value:function(e){var t,n,r;for(var i in ju(this.camera,e.camera)||(t=this.camera=e.camera),ju(this.screenSize,e.screenSize)||(n=this.screenSize=e.screenSize),this.context!==e.context&&(r=this.context=e.context),this.engineNodes)this.flushEngine(this.engineNodes[i],e,r,t,n)}},{key:"flushEngine",value:function(e,t,n,r,i){var a=e.visibleSet,o=e.layout.engine,s=t.testSet,c=t.updateSet,u=t.moveSet,l=t.isTransition,h=t.diff,d=h.addedSet,f=h.removedSet,p=[],v=[],m=[];for(var g in d)d[g].value.isVisible(o)?a[g]=!0:m.push(g);for(var y in s){var b=s[y],k=b.treeNode,w=b.isVisible(o),S=y in a;S&&!w?(v.push(k),delete a[y]):!S&&w&&(p.push(k),a[y]=!0)}for(var x in f)delete a[x];var C=t.diff.decorate({insertToAdded:p,insertToRemoved:v,maskAdded:m}),I={},P={};for(var M in c)M in a&&(I[M]=c[M].treeNode);for(var T in u)T in a&&(P[T]=u[T].treeNode);e.layout.update({context:n,camera:r,screenSize:i,isTransition:l,diff:C,updateSet:I,moveSet:P})}}]),e}(),Bh=function(){function e(t){var n=this;I(this,e),this.frameInvoker=wh.createAnimationFrameInvoker(Ph.Rendering),this.didReceiveTransitionFalse=!1,this.onFrameInvoke=function(){var e=!n.didReceiveTransitionFalse;n.didReceiveTransitionFalse=!1,n.frameHandler(e)},this.frameHandler=t}return M(e,[{key:"release",value:function(){this.frameInvoker.release()}},{key:"fire",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||(this.didReceiveTransitionFalse=!0),this.frameInvoker.invoke(this.onFrameInvoke)}}]),e}();function Uh(e,t,n,r){var i=_h(t);Hh(e.treeNode,i,n,r)}function Vh(e,t,n,r){switch(e.kind){case vd.Component:var i=e,a=Wh(i.treeNode.parent,t);if(a){var o=Xh(e,a);o?n(i,o):r(i)}break;case vd.Group:var s=e.treeNode,c=Wh(s,t);c&&Hh(s,c,n,r)}}function Wh(e,t){for(var n=[],r=e;r.parent;)n.push(r),r=r.parent;for(var i=_h(t),a=n.length-1;a>=0;a--){var o=n[a].value,s=Xh(o,i);if(!s){i=null;break}i=Yh(i,s,o)}return i}function Hh(e,t,n,r){var i,a=A(e);try{for(a.s();!(i=a.n()).done;){var o=i.value.value,s=Xh(o,t);switch(o.kind){case vd.Component:var c=o;s?n(c,s):r(c);break;case vd.Group:if(s){var u=o;Hh(u.treeNode,Yh(t,s,u),n,r)}}}}catch(e){a.e(e)}finally{a.f()}}function _h(e){var t=e.camera,n=e.width,r=e.height;return{scene:{dx:0,dy:0,scale:1},screen:{dx:-(t.centerX-n/t.scale/2)*t.scale,dy:-(t.centerY-r/t.scale/2)*t.scale,scale:t.scale},rect:{originX:0,originY:0,width:n,height:r},tailor:{left:0,right:0,top:0,bottom:0},absolute:Gh(n,r)}}function Gh(e,t){var n={scene:{dx:0,dy:0,scale:1},screen:{dx:e/2,dy:t/2,scale:1},rect:{originX:0,originY:0,width:e,height:t},tailor:{left:0,right:0,top:0,bottom:0},absolute:null};return n.absolute=n,n}function Yh(e,t,n){var r=t.sceneRect,i=t.screenRect,a=t.tailor;return{scene:{dx:r.originX,dy:r.originY,scale:e.scene.scale*n.scale},screen:{dx:i.originX,dy:i.originY,scale:e.screen.scale*n.scale},rect:i,tailor:a,absolute:e.absolute}}function Xh(e,t){if(e.kind===vd.Component&&!e.isVisible())return null;var n=t;e.absoluteCoordinates&&(n=n.absolute);var r=n,i=r.scene,a=r.screen,o=a.scale,s=a.dx,c=a.dy,u=function(e,t){var n=e.sceneMargin,r=e.parallaxMargin,i=n.left*t+r.left,a=n.top*t+r.top,o=n.right*t+r.right,s=n.bottom*t+r.bottom;return Object.freeze({left:i,right:o,top:a,bottom:s})}(e,o),l=e.originX*o+s-u.left,h=e.originY*o+c-u.top,d=e.width*o+u.left+u.right,f=e.height*o+u.top+u.bottom,p=n.rect,v=n.tailor,m=p.originX+v.left-l,g=p.originY+v.top-h,y=l+d-(p.originX+p.width-v.right),b=h+f-(p.originY+p.height-v.bottom);if(!e.disableVisionTrim&&(m>=d||y>=d||m+y>=d||g>=f||b>=f||g+b>=f))return null;var k={left:m,top:g,right:y,bottom:b},w={originX:l,originY:h,width:d,height:f},S=qh(e,o);return{margin:u,scale:o,tailor:k,sceneRect:{originX:e.originX+i.dx-S.left,originY:e.originY+i.dy-S.top,width:e.width*i.scale+S.left+S.right,height:e.height*i.scale+S.top+S.bottom},screenRect:w}}function qh(e,t){var n=e.sceneMargin,r=e.parallaxMargin,i=n.left+r.left/t,a=n.top+r.top/t,o=n.right+r.right/t,s=n.bottom+r.bottom/t;return Object.freeze({left:i,right:o,top:a,bottom:s})}function Qh(e,t,n){Uh(t,n,(function(t,n){e.bindVision(t.treeNode,n)}),(function(){}))}var Kh=function(){function e(t){var n=this;I(this,e),this.isCameraUpdated=!1,this.toTestAppearSet={},this.toTestVisibleSet={},this.toUpdateSet={},this.toSortSet={},this.toMoveSet={},this.toShowSet={},this.toHideSet={},this.onScreenUpdate=function(e){ju(n.screenState,e)||(n.isCameraUpdated=!0,n.screenState=e,n.refreshFrameNode.fire(e.isTransition))},this.onGroupSorted=function(e){n.toSortSet[e.treeNode.id]=e,n.refreshFrameNode.fire()},this.onComponentUpdate=function(e){var t=e.node;switch(e.behavior){case ed.Removed:delete n.toTestAppearSet[t.treeNode.id],delete n.toUpdateSet[t.treeNode.id],delete n.toTestVisibleSet[t.treeNode.id];break;case ed.Added:case ed.AppearUpdated:n.toTestAppearSet[t.treeNode.id]=t;break;case ed.VisibleUpdated:t instanceof hd&&(n.toTestVisibleSet[t.treeNode.id]=t);break;case ed.PropertiesUpdated:t instanceof hd&&(n.toUpdateSet[t.treeNode.id]=t)}n.refreshFrameNode.fire()},this.handleFrame=function(e){try{n.sortAllGroups();var t=n.diffBuffer.fetchDiff();n.testComponents(t);var r=n.commitVisibleAndDecorateDiff(t);n.notify(r,e),n.cleanSet()}catch(t){n.logger.error(t)}},this.refreshComponent=function(e,t){var r=e.treeNode.id,i=n.visions.leaf(r),a=n.visions.vision(r);if(a){var o=a.sceneRect,s=i.value;(!ju(o,t.sceneRect)||!ju(s.parallaxMargin,e.parallaxMargin)||!ju(s.sceneMargin,e.sceneMargin))&&(n.toMoveSet[r]={component:e,vision:t})}else n.toShowSet[r]={component:e,vision:t};i&&n.visions.bindVision(i,t)},this.removeComponent=function(e){var t=e.treeNode;n.visions.includes(t.id)&&(n.toHideSet[t.id]=e),n.visions.unbindVision(t.id)},this.screen=t.screen,this.visions=t.visions,this.logger=this.screen.scene.logger,this.tree=this.screen.scene.tree,this.diffBuffer=this.tree.createDiffBuffer(),this.screenState={width:this.screen.width,height:this.screen.height,camera:Object.freeze(xu({},this.screen.camera)),visionRectangle:this.screen.visionRectangle,isTransition:!1},Qh(this.visions,this.screen.scene,this.screenState),this.renderer=new Dh({screen:this.screen,engines:t.engines,tree:this.tree,visions:this.visions,onRenderDuration:t.onRenderDuration});var r=this.screen,i=r.context,a=r.camera;this.notifier=new zh(this.renderer,this.visions,i,a,Object.freeze({width:this.screen.width,height:this.screen.height})),this.refreshFrameNode=new Bh(this.handleFrame),this.screen.addScreenUpdatedListener(this.onScreenUpdate),this.screen.scene.addGroupSortedListener(this.onGroupSorted),this.screen.scene.addComponentUpdateListener(this.onComponentUpdate)}return M(e,[{key:"willInterruptEvent",value:function(e,t){for(var n in this.renderer.renderLayouts)if(this.renderer.renderLayouts[n].willInterruptEvent(this.screen,e,t))return!0;return!1}},{key:"findComponentWithTarget",value:function(e){for(var t in this.renderer.renderLayouts){var n=this.renderer.renderLayouts[t],r=n.findComponentWithTarget(e);if(r)return{component:r,engine:n.engine}}}},{key:"forEachVisibleComponent",value:function(e){var t,n=A(this.tree);try{for(n.s();!(t=n.n()).done;){e(t.value.value)}}catch(e){n.e(e)}finally{n.f()}}},{key:"release",value:function(){this.refreshFrameNode.release(),this.diffBuffer.release(),this.screen.removeScreenUpdatedListener(this.onScreenUpdate),this.screen.scene.removeGroupSortedListener(this.onGroupSorted),this.screen.scene.removeComponentUpdateListener(this.onComponentUpdate)}},{key:"refreshScreenContext",value:function(){this.refreshFrameNode.fire()}},{key:"sortAllGroups",value:function(){for(var e in this.toSortSet)this.toSortSet[e].sortIfNeed()}},{key:"testComponents",value:function(e){for(var t in e.removedSet)this.visions.includes(t)&&(this.toHideSet[t]=e.removedSet[t].value);if(this.isCameraUpdated)Uh(this.screen.scene,this.screenState,this.refreshComponent,this.removeComponent),this.isCameraUpdated=!1;else for(var n in this.toTestAppearSet){var r=this.toTestAppearSet[n];r.treeNode.parent&&Vh(r,this.screenState,this.refreshComponent,this.removeComponent)}}},{key:"commitVisibleAndDecorateDiff",value:function(e){var t=[],n=[],r=[];for(var i in this.toShowSet){var a=this.toShowSet[i],o=a.vision,s=a.component.treeNode;e.addedSet[i]||t.push(s),this.visions.bindVision(s,o)}for(var c in this.toMoveSet){var u=this.toMoveSet[c],l=u.vision,h=u.component.treeNode;this.visions.bindVision(h,l)}for(var d in this.toHideSet){var f=this.toHideSet[d].treeNode;e.removedSet[d]||n.push(f),this.visions.unbindVision(d)}for(var p in e.addedSet)this.visions.includes(p)||r.push(p);return e.decorate({insertToAdded:t,insertToRemoved:n,maskAdded:r})}},{key:"notify",value:function(e,t){var n={};for(var r in this.toMoveSet)n[r]=this.toMoveSet[r].component;for(var i in this.toUpdateSet)this.visions.includes(i)||delete this.toUpdateSet[i];for(var a in this.toTestVisibleSet)this.visions.includes(a)||delete this.toTestVisibleSet[a];this.notifier.flush({context:this.screen.context,camera:this.screenState.camera,diff:e,isTransition:t,moveSet:n,testSet:this.toTestVisibleSet,updateSet:this.toUpdateSet,screenSize:Object.freeze({width:this.screen.width,height:this.screen.height})})}},{key:"cleanSet",value:function(){this.toTestVisibleSet={},this.toUpdateSet={},Du(this.toTestAppearSet)&&(this.toTestAppearSet={}),Du(this.toSortSet)&&(this.toSortSet={}),Du(this.toMoveSet)&&(this.toMoveSet={}),Du(this.toShowSet)&&(this.toShowSet={}),Du(this.toHideSet)&&(this.toHideSet={})}}]),e}(),Zh=function(){function e(t){I(this,e),this.context=null,this.screen=t.screen,this.engines=t.engines,this.onRenderDuration=t.onRenderDuration,this.visions=new Fl,this._wrappedComponents=Object.freeze(p(t.wrappedComponents))}return M(e,[{key:"hitTest",value:function(e,t){var n=this,r=[];if(this.context){var i=t/this.screen.camera.scale;this.context.visibleTestNode.forEachVisibleComponent((function(t){n.isHitComponent(t,e,i)&&r.push(t.id)}))}return r.reverse()}},{key:"findComponentWithTarget",value:function(e){if(this.context)return this.context.visibleTestNode.findComponentWithTarget(e)}},{key:"willInterruptEvent",value:function(e,t){return!!this.context&&this.context.visibleTestNode.willInterruptEvent(e,t)}},{key:"refreshScreenRendererState",value:function(e){var t;null==(t=this.context)||t.visibleTestNode.renderer.setState(e)}},{key:"refreshScreenContext",value:function(){this.context&&this.context.visibleTestNode.refreshScreenContext()}},{key:"isHitComponent",value:function(e,t,n){var r=t.x,i=t.y,a=qh(e,this.screen.camera.scale),o=Math.max(a.left,n),s=Math.max(a.right,n),c=Math.max(a.top,n),u=Math.max(a.bottom,n),l=e.originX-o,h=e.originY-c,d=e.width+o+s,f=e.height+c+u;return!!Nh.testPoint(l,h,d,f,r,i)&&e.definition.hitTest(this.screen,e,r,i,n)}},{key:"divElement",get:function(){return this.context&&this.context.divElement},set:function(e){e!==(this.context&&this.context.divElement)&&(this.context&&(this.context.visibleTestNode.release(),(0,du.unmountComponentAtNode)(this.context.divElement)),e?this.context=Object.freeze({divElement:e,visibleTestNode:new Kh({screen:this.screen,engines:this.engines,visions:this.visions,onRenderDuration:this.onRenderDuration})}):(this.visions.clean(),this.context=null),this.refreshScreenRender())}},{key:"wrappedComponents",get:function(){return this._wrappedComponents},set:function(e){this._wrappedComponents!==e&&(this._wrappedComponents=Object.freeze(p(e)),this.refreshScreenRender())}},{key:"refreshScreenRender",value:function(){if(this.context){var e=(0,hu.createElement)(this.context.visibleTestNode.renderer.getRender()),t=Oh(this._wrappedComponents,e);(0,du.render)(t,this.context.divElement)}}}]),e}(),Jh=function(){function e(t){var n=this;I(this,e),this.screenUpdatedDispatcher=new _l,this.cameraUpdatedDispatcher=new _l,this.renderErrorCatchedDispatcher=new _l,this.sizeUpdatedDispatcher=new _l,this.centerX=0,this.centerY=0,this.scale=1,this.adaptedRectangle=null,this.dispatchUpdatedEvent=function(e,t,r){var i=n.convertVisionRectangle(e,n._width,n._height);n.screenUpdatedDispatcher.dispatch({width:n._width,height:n._height,camera:e,visionRectangle:i,isTransition:t}),n.cameraUpdatedDispatcher.dispatch(Cu(xu({},e),{operatorId:r}))},this.onResize=function(e){var t=e[0];if(t){var r=t.contentRect,i=r.width,a=r.height;n.refreshSize(i,a)}},this.deviceType=t.scene.deviceType,this.scene=t.scene,this._className=t.className,this._style=t.style,this._context=t.context,this._width=t.width,this._height=t.height,this.cameraAnimation=new Eh(this.camera,this.dispatchUpdatedEvent),this.eventInterrupter=t.eventInterrupter,this.onRenderDuration=t.onRenderDuration,this.updater=new Zh({screen:this,engines:t.engines,wrappedComponents:t.wrappedComponents,onRenderDuration:t.onRenderDuration}),t.autoResize&&(this.resizeObserver=new cu.ResizeObserver(this.onResize))}return M(e,[{key:"className",get:function(){return this._className},set:function(e){this._className!==e&&(this._className=e,this.updater.refreshScreenRendererState({className:e}))}},{key:"style",get:function(){return this._style},set:function(e){this._style!==e&&(this._style=e,this.updater.refreshScreenRendererState({style:e}))}},{key:"wrappedComponents",get:function(){return this.updater.wrappedComponents},set:function(e){this.updater.wrappedComponents=e}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"divElement",get:function(){return this.updater.divElement},set:function(e){var t=this.updater.divElement;if(t!==e){if(this.resizeObserver&&t&&this.resizeObserver.unobserve(t),this.updater.divElement=e,e){var n=e.clientWidth,r=e.clientHeight;this.refreshSize(n,r),this.resizeObserver&&this.resizeObserver.observe(e)}this._eventProxy&&this._eventProxy.bindDivElement(e)}}},{key:"eventProxy",get:function(){return this._eventProxy||(this._eventProxy=new $l(this,this.eventInterrupter),this._eventProxy.bindDivElement(this.divElement)),this._eventProxy}},{key:"context",get:function(){return this._context},set:function(e){this._context!==e&&(this._context=e,this.updater.refreshScreenContext())}},{key:"bounding",get:function(){if(this.divElement){var e=this.divElement.getBoundingClientRect();return{left:e.left,right:e.right,top:e.top,bottom:e.bottom,width:e.width,height:e.height}}return{left:0,right:0,top:0,bottom:0,width:0,height:0}}},{key:"bindCameraman",value:function(e,t){return new dh(this,this.eventProxy,t,e)}},{key:"convertPointToScreen",value:function(e,t){return{x:(e-this.centerX)*this.scale+this._width/2,y:(t-this.centerY)*this.scale+this._height/2}}},{key:"convertPointToScene",value:function(e,t){return{x:(e-this._width/2)/this.scale+this.centerX,y:(t-this._height/2)/this.scale+this.centerY}}},{key:"cameraWithAdaptRectangle",value:function(e,t){var n=e.originX+e.width/2,r=e.originY+e.height/2,i=this._width/e.width,a=this._height/e.height;switch((Number.isNaN(i)||i<=0)&&(i=1),(Number.isNaN(a)||a<=0)&&(a=1),t){case pd.Centering:return{centerX:n,centerY:r,scale:Math.min(i,a)};case pd.Tailor:return{centerX:n,centerY:r,scale:Math.max(i,a)};default:throw new Error("invalid adapter mode ".concat(t))}}},{key:"adaptRectangle",value:function(e){if(0===e.width||0===e.height)this.transformCamera({animationMode:e.animationMode,centerX:e.originX+e.width/2,centerY:e.originY+e.height/2,scale:1,operatorId:e.operatorId});else{var t=Cu(xu({},this.cameraWithAdaptRectangle(e,e.adapterMode)),{animationMode:e.animationMode,operatorId:e.operatorId});this.setCameraTransfrom(t,!1),this.adaptedRectangle=Object.freeze({originX:e.originX,originY:e.originY,width:e.width,height:e.height,adapterMode:e.adapterMode})}}},{key:"transformCamera",value:function(e){this.adaptedRectangle=null,this.setCameraTransfrom(e,!1)}},{key:"setTransition",value:function(e,t){e!==this.cameraAnimation.isTransition&&this.updateCameraAnimation(this.camera,bd.Immediately,e,t)}},{key:"setCameraTransfrom",value:function(e,t){var n=Il(e.centerX,this.centerX),r=Il(e.centerY,this.centerY),i=Il(e.scale,this.scale);(n!==this.centerX||r!==this.centerY||i!==this.scale||t!==this.cameraAnimation.isTransition)&&(this.centerX=n,this.centerY=r,this.scale=i,this.updateCameraAnimation(this.camera,e.animationMode,t,e.operatorId))}},{key:"updateCameraAnimation",value:function(e,t,n,r){switch(t){case bd.Immediately:this.dispatchUpdatedEvent(e,n,r),this.cameraAnimation.moveToRightNow(e,n);break;case bd.Continuous:this.cameraAnimation.moveTo(e,n,r)}}},{key:"camera",get:function(){return{centerX:this.centerX,centerY:this.centerY,scale:this.scale}}},{key:"visionRectangle",get:function(){return this.convertVisionRectangle(this.camera,this._width,this._height)}},{key:"willInterruptEvent",value:function(e,t){return this.updater.willInterruptEvent(e,t)}},{key:"convertVisionRectangle",value:function(e,t,n){var r=t/e.scale,i=n/e.scale;return{originX:e.centerX-r/2,originY:e.centerY-i/2,width:r,height:i}}},{key:"hitTest",value:function(e,t,n){return this.updater.hitTest(this.convertPointToScene(e,t),n)}},{key:"findComponentWithTarget",value:function(e){return this.updater.findComponentWithTarget(e)}},{key:"renderScreenshot",value:function(e){var t=Cl(e.camera,Object.freeze(this.camera)),n=Cl(e.width,this._width),r=Cl(e.height,this._height),i=new Fl;return Qh(i,this.scene,{width:this._width,height:this._height,camera:t,isTransition:!1,visionRectangle:this.convertVisionRectangle(t,n,r)}),new Lh({visions:i,tree:this.scene.tree,screen:this,initCamera:t,engines:this.updater.engines,onRenderDuration:this.onRenderDuration}).render(this.updater.wrappedComponents)}},{key:"resize",value:function(){if(this.divElement&&!this.resizeObserver){var e=this.divElement;this.refreshSize(e.clientWidth,e.clientHeight)}}},{key:"refreshSize",value:function(e,t){var n;this._width===e&&this._height===t||(this._width=e,this._height=t,n=this.adaptedRectangle?this.cameraWithAdaptRectangle(this.adaptedRectangle,this.adaptedRectangle.adapterMode):this.camera,this.setCameraTransfrom(Cu(xu({},n),{animationMode:bd.Immediately}),!1),this.dispatchUpdatedEvent(n,!1),this.sizeUpdatedDispatcher.dispatch({width:e,height:t}))}},{key:"addCameraUpdatedListener",value:function(e){this.cameraUpdatedDispatcher.addListener(e)}},{key:"removeCameraUpdatedListener",value:function(e){this.cameraUpdatedDispatcher.removeListener(e)}},{key:"addRenderErrorCatchedListener",value:function(e){this.renderErrorCatchedDispatcher.addListener(e)}},{key:"removeRenderErrorCatchedListener",value:function(e){this.renderErrorCatchedDispatcher.removeListener(e)}},{key:"addSizeUpdatedListener",value:function(e){this.sizeUpdatedDispatcher.addListener(e)}},{key:"removeSizeUpdatedListener",value:function(e){this.sizeUpdatedDispatcher.removeListener(e)}},{key:"addScreenUpdatedListener",value:function(e){this.screenUpdatedDispatcher.addListener(e)}},{key:"removeScreenUpdatedListener",value:function(e){this.screenUpdatedDispatcher.removeListener(e)}},{key:"layoutComponentWithTarget",value:function(e){var t=this.findComponentWithTarget(e);if(t)return{componentId:t.component.id,layout:t.engine.orderIndex}}}]),e}();function $h(e,t,n){var r=t,i=e.orderIndex,a=function(e){y(a,e);var n=k(a);function a(){return I(this,a),n.apply(this,arguments)}return M(a,[{key:"render",value:function(){var e=this.props,t=e.id,n=e.margin,a=e.origin,o=e.size,s=e.scale,c=e.payload,u=e.context,l=e.cnode;return(0,pu.createElement)(r,{id:t,layout:i,margin:n,origin:a,size:o,scale:s,payload:c,context:u,cnode:l})}}],[{key:"willInterruptEvent",value:function(e,n,r){return"function"==typeof t.willInterruptEvent?t.willInterruptEvent(e,n,i,r):"boolean"==typeof t.willInterruptEvent&&t.willInterruptEvent}}]),a}(pu.Component);return a.isVisible=n,a}var ed,td=function(){function e(t){I(this,e),this.definitionNodes=[];var n,r={},i={},a=A(p(t).sort((function(e,t){return e.layout-t.layout})));try{for(a.s();!(n=a.n()).done;){var o=n.value,s=this.createEngine(o);o.renderMode===wd.Screen&&(i[s.id]=!0),r[s.id]=s}}catch(e){a.e(e)}finally{a.f()}this.engines=Object.freeze(xu({},r)),this.absoluteCoordinatesSet=Object.freeze(xu({},i))}return M(e,[{key:"createEngine",value:function(e){var t,n=e.layout,r=e.kind,i=e.renderMode,a=e.className,o=e.style;switch(r){case kd.HTML:case kd.SVG:t=jl({orderIndex:n,fixedSize:i===wd.AbsoluteSize,isSVG:r===kd.SVG,className:a,style:o});break;case kd.CANVAS:t=Ml({orderIndex:n,fixedSize:!0});break;default:throw new Error("invalid kind ".concat(r))}return t}},{key:"adaptComponentConstructor",value:function(e){if(e.definition)return e;var t=e,n=this.findDefinitionNode(t).definition,r=this.checkIsAbsoluteCoordinates(t);return{id:t.id,definition:n,originX:t.originX,originY:t.originY,width:t.width,height:t.height,parallaxMargin:t.parallaxMargin,sceneMargin:t.sceneMargin,disableVisionTrim:t.disableVisionTrim,absoluteCoordinates:r,payload:t.payload,orderIndex:t.orderIndex}}},{key:"checkIsAbsoluteCoordinates",value:function(e){for(var t in e.render.layouts){var n=this.findEngineWithLayout(parseInt(t,10));if(n)return!!this.absoluteCoordinatesSet[n.id]}return!1}},{key:"findDefinitionNode",value:function(e){var t,n=null,r=A(this.definitionNodes);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.render===e.render){n=i;break}}}catch(e){r.e(e)}finally{r.f()}return n||(n=Object.freeze({definition:this.createDefinition(e),render:e.render,painter:e.painter}),this.definitionNodes.push(n)),n}},{key:"createDefinition",value:function(e){var t,n=e.render,r=new ud({name:n.name||"ComponentDefinition",hitTest:null==(t=n.hitTest)?void 0:t.bind(n)});for(var i in n.layouts){var a=this.findEngineWithLayout(parseInt(i,10)),o=n.layouts[i].isVisible;a instanceof Ll&&a.bind(r)($h(a,n,o))}return r}},{key:"findEngineWithLayout",value:function(e){for(var t in this.engines)if(this.engines[t].orderIndex===e)return this.engines[t];return null}}]),e}();!function(e){e[e.Added=0]="Added",e[e.Removed=1]="Removed",e[e.VisibleUpdated=2]="VisibleUpdated",e[e.AppearUpdated=3]="AppearUpdated",e[e.PropertiesUpdated=4]="PropertiesUpdated"}(ed||(ed={}));var nd=Object.freeze({left:0,right:0,top:0,bottom:0}),rd=new Th({matchingDistance:2,zeroSpeed:.55,kDistance:.17,velocityDamping:.55,heavyDampingRadius:15,heavyDampingSpeed:.25,pedesisSpeedMean:0,pedesisSpeedVariance:0},{matchingDistance:2,zeroSpeed:.55,kDistance:.12,velocityDamping:.35,heavyDampingRadius:15,heavyDampingSpeed:.35,pedesisSpeedMean:0,pedesisSpeedVariance:0}),id=function(){function e(t,n,r){var i=this;I(this,e),this.onRemovedDispatcher=new _l,this.onRectangleUpdatedDispatcher=new _l,this.onRectanglePointUpdate=function(){i.reporter.update(i,ed.AppearUpdated),i.onRectangleUpdatedDispatcher.dispatch(i)},this.reporter=t,this.id=n.id||(0,vu.v4)().replace(/-/g,""),this.treeNode=r,this._parallaxMargin=od(n.parallaxMargin),this._sceneMargin=od(n.sceneMargin),this.disableVisionTrim=!!n.disableVisionTrim,this.absoluteCoordinates=!!n.absoluteCoordinates,this._orderIndex=n.orderIndex,this.rectangleTarget={originX:ad(n.originX),originY:ad(n.originY),width:ad(n.width),height:ad(n.height)};var a=[this.rectangleTarget.originX,this.rectangleTarget.originY,this.rectangleTarget.width,this.rectangleTarget.height];this.rectangleAnimation=rd.create(Ph.ComponentMoving,a,this.onRectanglePointUpdate)}return M(e,[{key:"originX",get:function(){return this.rectangleAnimation.point[0]}},{key:"originY",get:function(){return this.rectangleAnimation.point[1]}},{key:"width",get:function(){return this.rectangleAnimation.point[2]}},{key:"height",get:function(){return this.rectangleAnimation.point[3]}},{key:"parallaxMargin",get:function(){return this._parallaxMargin}},{key:"sceneMargin",get:function(){return this._sceneMargin}},{key:"orderIndex",get:function(){return this._orderIndex},set:function(e){if(e!==this._orderIndex){var t=this.treeNode.parent.value;this._orderIndex=e,t.reportChildOrderUpdate()}}},{key:"moveTo",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bd.Immediately;(this.rectangleTarget.originX!==e||this.rectangleTarget.originY!==t)&&(this.rectangleTarget.originX=e,this.rectangleTarget.originY=t,this.syncRectangleTarget(n))}},{key:"resize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bd.Immediately;(this.rectangleTarget.width!==e||this.rectangleTarget.height!==t)&&(this.rectangleTarget.width=e,this.rectangleTarget.height=t,this.syncRectangleTarget(n))}},{key:"setRectangle",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bd.Immediately;(this.rectangleTarget.originX!==e||this.rectangleTarget.originY!==t||this.rectangleTarget.width!==n||this.rectangleTarget.height!==r)&&(this.rectangleTarget.originX=e,this.rectangleTarget.originY=t,this.rectangleTarget.width=n,this.rectangleTarget.height=r,this.syncRectangleTarget(i))}},{key:"syncRectangleTarget",value:function(e){var t=[this.rectangleTarget.originX,this.rectangleTarget.originY,this.rectangleTarget.width,this.rectangleTarget.height];switch(e){case bd.Immediately:this.rectangleAnimation.moveRightNow(t),this.reporter.update(this,ed.AppearUpdated);break;case bd.Continuous:this.rectangleAnimation.moveTo(t)}}},{key:"setParallaxMargin",value:function(e){sd(this._parallaxMargin,e)||(this._parallaxMargin=od(e),this.reporter.update(this,ed.AppearUpdated))}},{key:"setSceneMargin",value:function(e){sd(this._sceneMargin,e)||(this._sceneMargin=od(e),this.reporter.update(this,ed.AppearUpdated))}},{key:"release",value:function(){this.rectangleAnimation.stop(),this.onRemovedDispatcher.dispatch(this)}},{key:"addRemovedListener",value:function(e){this.onRemovedDispatcher.addListener(e)}},{key:"removeRemovedListener",value:function(e){this.onRemovedDispatcher.removeListener(e)}},{key:"addRectangleUpdatedListener",value:function(e){this.onRectangleUpdatedDispatcher.addListener(e)}},{key:"removeRectangleUpdatedListener",value:function(e){this.onRectangleUpdatedDispatcher.removeListener(e)}}]),e}();function ad(e){return"number"==typeof e?e:0}function od(e){return void 0===e||0===e?nd:"number"==typeof e?Object.freeze({left:e,right:e,top:e,bottom:e}):Object.freeze(xu({},e))}function sd(e,t){return void 0===t?0===e.top&&0===e.left&&0===e.right&&0===e.bottom:"number"==typeof t?e.top===t&&e.left===t&&e.right===t&&e.bottom===t:e.top===t.top&&e.left===t.left&&e.right===t.right&&e.bottom===t.bottom}var cd=function(e){y(n,e);var t=k(n);function n(e,r,i,a){var o;return I(this,n),(o=t.call(this,e,a,i)).group=new dd(e,r,i),o._scale=Cl(a.scale,1),o}return M(n,[{key:"kind",get:function(){return vd.Group}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale!==e&&(this._scale=e)}},{key:"components",get:function(){return this.group.components}},{key:"removeComponent",value:function(e){return this.group.removeComponent(e)}},{key:"reportChildOrderUpdate",value:function(){this.group.reportChildOrderUpdate()}},{key:"addComponent",value:function(e){return this.group.addComponent(e)}},{key:"addComponentGroup",value:function(e){return this.group.addComponentGroup(e)}}]),n}(id),ud=function(){function e(t){if(I(this,e),this.engineNodes={},this.enginesCache=null,this.id="".concat(e.nextId),this.name=t.name,e.nextId+=1,"boolean"==typeof t.hitTest){var n=t.hitTest;this.hitTest=function(){return n}}else t.hitTest?this.hitTest=t.hitTest:this.hitTest=function(){return!0}}return M(e,[{key:"engines",get:function(){if(!this.enginesCache){var e=[],t=[];for(var n in this.engineNodes){var r=this.engineNodes[n].engine;void 0===r.orderIndex?t.push(r):e.push(r)}e.sort((function(e,t){return e.orderIndex-t.orderIndex})),this.enginesCache=Object.freeze([].concat(e,t))}return this.enginesCache}},{key:"addEngine",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.enginesCache)throw new Error("definition is frozon. you can only do it before bind with screen");if(!(e instanceof Pu))throw new Error("it is not RenderEngine");this.engineNodes[e.id]=Object.freeze({engine:e,options:Object.freeze({isVisible:Cl(t.isVisible,!0)})})}},{key:"options",value:function(e){var t;return null==(t=this.engineNodes[e.id])?void 0:t.options}}]),e}();ud.nextId=0;var ld,hd=function(e){y(n,e);var t=k(n);function n(e,r,i){var a;if(I(this,n),(a=t.call(this,e,r,i)).visibleMap={},a.visibleCount=0,!(r.definition instanceof ud))throw new Error("it is not ComponentDefinition");a.definition=r.definition,a._payload=r.payload;var o,s=A(a.definition.engines);try{for(s.s();!(o=s.n()).done;){var c=o.value,u=a.definition.options(c).isVisible;u&&(a.visibleCount+=1),a.visibleMap[c.id]=u}}catch(e){s.e(e)}finally{s.f()}return a}return M(n,[{key:"kind",get:function(){return vd.Component}},{key:"payload",get:function(){return this._payload},set:function(e){e!==this._payload&&(this._payload=e,this.reporter.update(this,ed.PropertiesUpdated))}},{key:"isVisible",value:function(e){return"number"==typeof e?this.visibleMap[e]||!1:e?this.visibleMap[e.id]||!1:this.visibleCount>0}},{key:"setVisible",value:function(e,t){var n;if(n="number"==typeof e?"".concat(e):e.id,void 0!==this.visibleMap[n]&&this.visibleMap[n]!==t){var r=0===this.visibleCount;this.visibleMap[n]=t,t?this.visibleCount+=1:this.visibleCount-=1,r===(0===this.visibleCount)?this.reporter.update(this,ed.VisibleUpdated):this.reporter.update(this,ed.AppearUpdated)}}}]),n}(id),dd=function(){function e(t,n,r){I(this,e),this.shouldSort=!1,this.reporter=t,this.tree=n,this.treeNode=r}return M(e,[{key:"components",get:function(){this.sortIfNeed();var e,t=[],n=A(this.treeNode);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r.value)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"reportChildOrderUpdate",value:function(){this.shouldSort=!0,this.reporter.sortGroup(this)}},{key:"sortIfNeed",value:function(){this.shouldSort&&(this.shouldSort=!1,this.tree.sort(this.treeNode,(function(e,t){var n=e.value.orderIndex,r=t.value.orderIndex;return void 0!==n&&void 0!==r?n-r:void 0!==n?-1:void 0!==r?1:e.id.localeCompare(t.id)})))}},{key:"removeComponent",value:function(e){return this.treeNode===e.treeNode.parent&&(this.tree.remove(e.treeNode),this.reporter.update(e,ed.Removed),e.release(),!0)}},{key:"addComponent",value:function(e){var t=this.tree.wrapLeaf(),n=new hd(this.reporter,e,t);return this.addNode(t,n)}},{key:"addComponentGroup",value:function(e){var t=this.tree.wrapGroup(),n=new cd(this.reporter,this.tree,t,e);return this.addNode(t,n)}},{key:"addNode",value:function(e,t){return e.value=t,this.tree.append(e,this.treeNode),this.reporter.update(t,ed.Added),t}}]),e}(),fd=function(e){y(n,e);var t=k(n);function n(e,r,i,a,o){var s;return I(this,n),(s=t.call(this,a,o,o.root)).componentUpdateDispatcher=new _l,s.groupSortedDispatcher=new _l,s.deviceType=e,s.logger=r,s.legacy=i,s}return M(n,[{key:"createScreen",value:function(e){return new Jh({scene:this,context:e.context,className:e.className,autoResize:!!e.autoResize,width:Il(e.width,0),height:Il(e.height,0),engines:this.collectEngines(e),eventInterrupter:e.eventInterrupter||function(){return!1},wrappedComponents:e.wrappedComponents||[],onRenderDuration:e.onRenderDuration})}},{key:"collectEngines",value:function(e){var t;if(e.engines){t={};var n,r=A(e.engines);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!(i instanceof Pu))throw new Error("it is not RenderEngine");t[i.id]=i}}catch(e){r.e(e)}finally{r.f()}}else t=this.legacy.engines;var a=[],o=[];for(var s in t){var c=t[s];void 0===c.orderIndex?o.push(c):a.push(c)}return Object.freeze([].concat(a,o))}},{key:"getEngineWithLegacyLayout",value:function(e){for(var t in this.legacy.engines){var n=this.legacy.engines[t];if(n.orderIndex===e)return n}}},{key:"addComponentUpdateListener",value:function(e){this.componentUpdateDispatcher.addListener(e)}},{key:"removeComponentUpdateListener",value:function(e){this.componentUpdateDispatcher.removeListener(e)}},{key:"reportComponentUpdate",value:function(e,t){this.componentUpdateDispatcher.dispatch({node:e,behavior:t})}},{key:"addGroupSortedListener",value:function(e){this.groupSortedDispatcher.addListener(e)}},{key:"removeGroupSortedListener",value:function(e){this.groupSortedDispatcher.removeListener(e)}}],[{key:"create",value:function(e,t,r){var i,a=new Qu,o={update:function(e,t){return i.reportComponentUpdate(e,t)},sortGroup:function(e){return i.groupSortedDispatcher.dispatch(e)}};return i=new n(e,t,r,o,a),a.root.value=i,i}}]),n}(dd);!function(e){e.Desktop="desktop",e.Touch="touch",e.Surface="surface"}(ld||(ld={}));var pd,vd,md,gd,yd,bd,kd,wd,Sd=function(){function e(t){I(this,e),this.deviceType=t}return M(e,[{key:"createScene",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.createDefaultLogger();return fd.create(this.deviceType,t,new td([]))}},{key:"createSceneWithLegacyLayoutDescriptions",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.createDefaultLogger();return fd.create(this.deviceType,n,new td(t))}}],[{key:"createDefaultLogger",value:function(){return Gc(new Hc,"Boundless")}}]),e}();function xd(e){return new ud(e)}function Cd(e,t,n){return e+(t-e)*n}function Id(e,t){var n=Math.sqrt(e*e+t*t);return 0===n?{x:1,y:0}:{x:e/n,y:t/n}}function Pd(e,t,n,r){var i=e-n,a=t-r;return Math.sqrt(i*i+a*a)}!function(e){e.Centering="centering",e.Tailor="tailor"}(pd||(pd={})),function(e){e[e.Group=0]="Group",e[e.Component=1]="Component"}(vd||(vd={})),function(e){e[e.Unchanged=0]="Unchanged",e[e.Overlay=1]="Overlay",e[e.Changed=2]="Changed"}(md||(md={})),function(e){e[e.Directly=0]="Directly",e[e.GenerateCache=1]="GenerateCache",e[e.Overlay=2]="Overlay",e[e.OverlayOnCache=3]="OverlayOnCache"}(gd||(gd={})),function(e){e.Begin="Begin",e.End="End"}(yd||(yd={})),function(e){e.Continuous="continuous",e.Immediately="immediately"}(bd||(bd={})),function(e){e[e.HTML=0]="HTML",e[e.SVG=1]="SVG",e[e.CANVAS=2]="CANVAS"}(kd||(kd={})),function(e){e[e.AbsoluteSize=0]="AbsoluteSize",e[e.RelativeSize=1]="RelativeSize",e[e.Screen=2]="Screen"}(wd||(wd={}));var Md=X(n("0yMQ")),Td=X(n("/+6X")),Ad={};Y(Ad,{EmuToPt:function(){return am},EmuToPx:function(){return om},RenderMode:function(){return Vy},Slide:function(){return Xy},disableAutoPlayKey:function(){return Gy},loadPPT:function(){return ck},playLastStepKey:function(){return Yy},previewPPT:function(){return yk},sequenceIndexesKey:function(){return _y},toNumber:function(){return dm},toPt:function(){return lm}});var Ed,Od,Rd=X(n("q1tI")),Nd=X(n("uhBA")),Ld=X(n("q1tI")),jd=X(n("aSns")),Dd=X(n("Pes6")),Fd=X(n("q1tI")),zd=X(n("q1tI")),Bd=X(n("q1tI")),Ud=X(n("q1tI")),Vd=X(n("q1tI")),Wd=X(n("/OGU")),Hd=Object.defineProperty,_d=Object.defineProperties,Gd=Object.getOwnPropertyDescriptors,Yd=Object.getOwnPropertySymbols,Xd=Object.prototype.hasOwnProperty,qd=Object.prototype.propertyIsEnumerable,Qd=function(e,t,n){return t in e?Hd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},Kd=function(e,t){for(var n in t||(t={}))Xd.call(t,n)&&Qd(e,n,t[n]);if(Yd){var r,i=A(Yd(t));try{for(i.s();!(r=i.n()).done;){n=r.value;qd.call(t,n)&&Qd(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},Zd=function(e,t){return _d(e,Gd(t))};(Od=Ed||(Ed={}))[Od.Cmd=1]="Cmd",Od[Od.State=2]="State";var Jd=function(){function e(t){var n=t.playerID,r=t.players,i=t.effectType,a=void 0===i?"clickEffect":i;I(this,e),this.players=[],this._playerID=n,this.players=r,this.effectType=a,this.repeat=Math.max.apply(Math,p(r.map((function(e){return e.repeat}))).concat([1])),this.duration=Math.max.apply(Math,p(r.map((function(e){return e.duration}))).concat([0])),this.delay=r.length>0?Math.min.apply(Math,p(r.map((function(e){return e.delay})))):0}return M(e,[{key:"playerID",get:function(){return this._playerID||(this._playerID="par[".concat(this.players.map((function(e){return e.playerID})).join(","),"]")),this._playerID}},{key:"progressTime",get:function(){return Math.max.apply(Math,p(this.players.map((function(e){return e.progressTime}))||0))}},{key:"isPlaying",get:function(){return this.players.some((function(e){return e.isPlaying}))}},{key:"isComplete",get:function(){return this.players.every((function(e){return e.isComplete}))}},{key:"play",value:function(){this.players.forEach((function(e){return e.play()}))}},{key:"pause",value:function(){this.players.forEach((function(e){return e.pause()}))}},{key:"seek",value:function(e){if(e>this.progressTime)this.players.forEach((function(t){return t.seek(e)}));else if(e<this.progressTime)for(var t=this.players.length-1;t>=0;t--)this.players[t].seek(e)}},{key:"onFrame",value:function(e){if(e>this.progressTime)this.players.forEach((function(t){return t.onFrame(e)}));else if(e<this.progressTime)for(var t=this.players.length-1;t>=0;t--)this.players[t].onFrame(e)}},{key:"reset",value:function(){for(var e=this.players.length-1;e>=0;e--)this.players[e].reset()}},{key:"stop",value:function(){this.players.forEach((function(e){return e.stop()}))}},{key:"stopFinite",value:function(){this.players.forEach((function(e){return e.stopFinite()}))}}]),e}(),$d=function(){return($d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function ef(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}var tf=function(e,t){return function(n){return Math.max(Math.min(n,t),e)}},nf=function(e){return e%1?Number(e.toFixed(5)):e},rf=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,af={test:function(e){return"number"==typeof e},parse:parseFloat,transform:function(e){return e}},of=$d($d({},af),{transform:tf(0,1)}),sf=$d($d({},af),{default:1}),cf=function(e){return{test:function(t){return"string"==typeof t&&t.endsWith(e)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+e}}},uf=cf("deg"),lf=cf("%"),hf=cf("px"),df=$d($d({},lf),{parse:function(e){return lf.parse(e)/100},transform:function(e){return lf.transform(100*e)}}),ff=tf(0,255),pf=function(e){return void 0!==e.red},vf=function(e){return void 0!==e.hue},mf=function(e){return function(t){if("string"!=typeof t)return t;for(var n={},r=(a=t,a.substring(a.indexOf("(")+1,a.lastIndexOf(")"))).replace(/(,|\/)/g," ").split(/ \s*/),i=0;i<4;i++)n[e[i]]=void 0!==r[i]?parseFloat(r[i]):1;var a;return n}},gf=$d($d({},af),{transform:function(e){return Math.round(ff(e))}});function yf(e,t){return e.startsWith(t)&&rf.test(e)}var bf,kf={test:function(e){return"string"==typeof e?yf(e,"rgb"):pf(e)},parse:mf(["red","green","blue","alpha"]),transform:function(e){var t,n,r=e.red,i=e.green,a=e.blue,o=e.alpha,s=void 0===o?1:o;return"rgba("+(t={red:gf.transform(r),green:gf.transform(i),blue:gf.transform(a),alpha:nf(of.transform(s))}).red+", "+t.green+", "+t.blue+", "+(void 0===(n=t.alpha)?1:n)+")"}},wf={test:function(e){return"string"==typeof e?yf(e,"hsl"):vf(e)},parse:mf(["hue","saturation","lightness","alpha"]),transform:function(e){var t,n,r=e.hue,i=e.saturation,a=e.lightness,o=e.alpha,s=void 0===o?1:o;return"hsla("+(t={hue:Math.round(r),saturation:lf.transform(nf(i)),lightness:lf.transform(nf(a)),alpha:nf(of.transform(s))}).hue+", "+t.saturation+", "+t.lightness+", "+(void 0===(n=t.alpha)?1:n)+")"}},Sf=$d($d({},kf),{test:function(e){return"string"==typeof e&&yf(e,"#")},parse:function(e){var t="",n="",r="";return e.length>4?(t=e.substr(1,2),n=e.substr(3,2),r=e.substr(5,2)):(t=e.substr(1,1),n=e.substr(2,1),r=e.substr(3,1),t+=t,n+=n,r+=r),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(r,16),alpha:1}}}),xf={test:function(e){return"string"==typeof e&&rf.test(e)||pf(e)||vf(e)},parse:function(e){return kf.test(e)?kf.parse(e):wf.test(e)?wf.parse(e):Sf.test(e)?Sf.parse(e):e},transform:function(e){return pf(e)?kf.transform(e):vf(e)?wf.transform(e):e}},Cf=function(e){return e},If=(bf=function(e,t,n){return Math.min(Math.max(n,e),t)},function(e,t,n){return void 0!==n?bf(e,t,n):function(n){return bf(e,t,n)}});If(0,1);var Pf="undefined"!=typeof performance?function(){return performance.now()}:function(){return Date.now()},Mf="undefined"!=typeof window?function(e){return window.requestAnimationFrame(e)}:function(e){return setTimeout((function(){return e(Pf())}),16.666666666666668)},Tf=!0,Af=!1,Ef=!1,Of={delta:0,timestamp:0},Rf=["read","update","preRender","render","postRender"],Nf=Rf.reduce((function(e,t){var n,r,i,a,o,s,c;return e[t]=(n=function(){return Af=!0},r=[],i=[],a=0,o=!1,s=new WeakSet,c={schedule:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var c=n&&o,u=c?r:i;return t&&s.add(e),-1===u.indexOf(e)&&(u.push(e),c&&o&&(a=r.length)),e},cancel:function(e){var t=i.indexOf(e);-1!==t&&i.splice(t,1),s.delete(e)},process:function(e){var t;if(o=!0,r=(t=[i,r])[0],(i=t[1]).length=0,a=r.length)for(var u=0;u<a;u++){var l=r[u];l(e),s.has(l)&&(c.schedule(l),n())}o=!1}}),e}),{}),Lf=Rf.reduce((function(e,t){var n=Nf[t];return e[t]=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),Af||zf(),n.schedule(e,t,r)},e}),{}),jf=Rf.reduce((function(e,t){return e[t]=Nf[t].cancel,e}),{}),Df=function(e){return Nf[e].process(Of)},Ff=function e(t){Af=!1,Of.delta=Tf?16.666666666666668:Math.max(Math.min(t-Of.timestamp,40),1),Of.timestamp=t,Ef=!0,Rf.forEach(Df),Ef=!1,Af&&(Tf=!1,Mf(e))},zf=function(){Af=!0,Tf=!0,Ef||Mf(Ff)},Bf=function(){function e(t){var n=t.playerID,r=t.players,i=t.effectType,a=void 0===i?"clickEffect":i,o=t.repeat,s=t.rewind,c=void 0!==s&&s,u=t.reverse,l=void 0!==u&&u,h=t.delay,d=void 0===h?0:h;I(this,e),this.players=[],this.progressTime=0,this.loopCount=0,this.elapsed=0,this._playerID=n,this.players=r,this.effectType=a,this.roundDuration=Math.max.apply(Math,p(r.map((function(e){return e.duration}))).concat([0])),this.repeat=null!=o?Math.max(1,o):Math.max.apply(Math,p(r.map((function(e){return e.repeat}))).concat([1])),this.rewind=c,this.reverse=l,this.delay=d,this.duration=this.delay+this.roundDuration*(Number.isFinite(this.repeat)?this.repeat:1)*(this.reverse?2:1),this.loop=Number.isFinite(this.repeat)?this.reverse?2*(this.repeat-1)+1:this.repeat-1:this.repeat}return M(e,[{key:"playerID",get:function(){return this._playerID||(this._playerID="par-plus[".concat(this.players.map((function(e){return e.playerID})).join(","),"]")),this._playerID}},{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.progressTime>=this.duration}},{key:"play",value:function(){var e=this;this.isPlaying||this.isComplete||(this.frameProcess=Lf.update((function(t){var n=t.delta;if(e.progressTime+=n,!(e.progressTime<=e.delay)&&(e.elapsed+=n,e.update(),e.isPlaying&&e.elapsed>e.roundDuration)){if(e.loopCount<e.loop)return e.elapsed=0,void(e.loopCount+=1);e.pause()}}),!0))}},{key:"pause",value:function(){this.frameProcess&&(jf.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function(e){var t=this.progressTime;this.progressTime=If(0,this.duration,e),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1);var n=this.reverse&&this.loopCount%2!=0,r=n?this.roundDuration-this.elapsed:this.elapsed;if(t>e||n)for(var i=this.players.length-1;i>=0;i--)this.players[i].seek(r);else t<e&&this.players.forEach((function(e){return e.seek(r)}))}},{key:"onFrame",value:function(e){var t=this.progressTime;this.progressTime=If(0,this.duration,e),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1);var n=this.reverse&&this.loopCount%2!=0,r=n?this.roundDuration-this.elapsed:this.elapsed;if(t>e||n)for(var i=this.players.length-1;i>=0;i--)this.players[i].onFrame(r);else t<e&&this.players.forEach((function(e){return e.onFrame(r)}))}},{key:"reset",value:function(){if(this.progressTime>0){this.pause(),this.loopCount=0,this.elapsed=0,this.progressTime=0;for(var e=this.players.length-1;e>=0;e--)this.players[e].reset()}}},{key:"stop",value:function(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function(){Number.isFinite(this.repeat)&&this.stop()}},{key:"update",value:function(){var e=this;if(this.reverse&&this.loopCount%2!=0)for(var t=this.players.length-1;t>=0;t--)this.players[t].onFrame(this.roundDuration-this.elapsed);else this.players.forEach((function(t){return t.onFrame(e.elapsed)}))}}]),e}(),Uf=function(){function e(t){var n,r,i=t.playerID,a=t.players,o=t.effectType,s=void 0===o?"clickEffect":o;I(this,e),this.players=[],this.index=0,this.progressTime=0,this._playerIndex=0,this.elapsed=0,this._playerID=i,this.players=a,this.effectType=s,this.duration=a.reduce((function(e,t){return e+t.duration}),0),this.delay=null!=(r=null==(n=this.players[0])?void 0:n.delay)?r:0,this.blocks=[],this.indexBlocks=[];for(var c=0;c<this.players.length;c++)0!==c&&"clickEffect"!==this.players[c].effectType||this.blocks.push(c),this.indexBlocks.push(this.blocks.length-1)}return M(e,[{key:"playerID",get:function(){return this._playerID||(this._playerID="seq[".concat(this.players.map((function(e){return e.playerID})).join(","),"]")),this._playerID}},{key:"length",get:function(){return this.blocks.length}},{key:"currentPlayer",get:function(){return this.players[this._playerIndex]}},{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.index>=this.blocks.length}},{key:"repeat",get:function(){var e,t;return null!=(t=null==(e=this.currentPlayer)?void 0:e.repeat)?t:1}},{key:"play",value:function(){var e=this;!this.currentPlayer||this.isPlaying||this.isComplete||(this.currentPlayer.play(),this.frameProcess=Lf.update((function(t){var n,r=t.delta,i=e.currentPlayer;if(i){if(e.elapsed+=r,e.progressTime+=r,i.isPlaying||i.play(),e.elapsed>i.duration){e._playerIndex<e.players.length&&(e._playerIndex+=1,e.elapsed=0,e.index=null!=(n=e.indexBlocks[e._playerIndex])?n:e.blocks.length);var a=e.players[e._playerIndex];if(a&&"clickEffect"!==a.effectType)return void a.play();e.stopTimer()}}else e.stopTimer()}),!0))}},{key:"pause",value:function(){var e;null==(e=this.currentPlayer)||e.pause(),this.stopTimer()}},{key:"seek",value:function(e){var t,n;if(e>this.duration){this.pause();for(var r=this._playerIndex;r<this.players.length;r++){var i=this.players[r];i.seek(i.duration)}this.progressTime=this.duration,this.elapsed=0,this._playerIndex=this.players.length,this.index=this.blocks.length}this.progressTime=If(0,this.duration,e),this.elapsed=this.progressTime;for(var a=0;a<this.players.length;){var o=this.players[a];if(this.elapsed<=o.duration)break;this.elapsed-=o.duration,a++}if(this._playerIndex<a){for(var s=this._playerIndex;s<a;s++){var c=this.players[s];!Number.isFinite(c.repeat)&&c.isPlaying||c.seek(c.duration)}null==(t=this.players[a])||t.seek(this.elapsed)}else if(this._playerIndex>a)for(var u=this.safePlayerIndex(this._playerIndex);u>=a;u--){var l=this.players[u];u===a?(l.pause(),l.seek(this.elapsed)):l.reset()}this._playerIndex=a,this.index=null!=(n=this.indexBlocks[this._playerIndex])?n:this.blocks.length}},{key:"onFrame",value:function(e){throw new Error("onFrame not implemented in seq player")}},{key:"reset",value:function(){if(this.progressTime>0&&this.players.length>0)for(var e=this.safePlayerIndex(this._playerIndex);e>=0;e--)this.players[e].reset();this._playerIndex=0,this.index=0,this.progressTime=0,this.elapsed=0}},{key:"stop",value:function(){this.pause(),this.seek(this.duration+1)}},{key:"stopFinite",value:function(){this.players.forEach((function(e){return e.stopFinite()}))}},{key:"seekIndex",value:function(e){var t;this.seekPlayerIndex(null!=(t=this.blocks[e])?t:this.players.length)}},{key:"next",value:function(){this.elapsed>0&&this.seekIndex(this.index+1),this.play()}},{key:"back",value:function(){this.pause(),this.progressTime<=0||(this.seekIndex(this.elapsed>0?this.index:this.index-1),this.pause())}},{key:"stopTimer",value:function(){this.frameProcess&&(jf.update(this.frameProcess),this.frameProcess=void 0)}},{key:"safePlayerIndex",value:function(e){return Math.min(e,this.players.length-1)}},{key:"seekPlayerIndex",value:function(e){var t;if(e=If(0,this.players.length,e),this._playerIndex<e)for(var n=this._playerIndex;n<e;n++)this.players[n].stopFinite();else for(var r=this.safePlayerIndex(this._playerIndex);r>=e;r--)this.players[r].reset();this.progressTime=this.getProgressTimeByPlayerIndex(e),this._playerIndex=e,this.index=null!=(t=this.indexBlocks[e])?t:this.blocks.length,this.elapsed=0}},{key:"getProgressTimeByPlayerIndex",value:function(e){for(var t=0,n=0;n<e;n++)t+=this.players[n].duration;return t}}]),e}();function Vf(e,t,n){return(t-e)*n+e}var Wf={exports:{}},Hf={exports:{}},_f=function(e){return!(!e||"string"==typeof e)&&(e instanceof Array||Array.isArray(e)||e.length>=0&&(e.splice instanceof Function||Object.getOwnPropertyDescriptor(e,e.length-1)&&"String"!==e.constructor.name))},Gf=Array.prototype.concat,Yf=Array.prototype.slice,Xf=Hf.exports=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];_f(i)?t=Gf.call(t,Yf.call(i)):t.push(i)}return t};Xf.wrap=function(e){return function(){return e(Xf(arguments))}};var qf={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Qf=Hf.exports,Kf={};for(Zf in qf)qf.hasOwnProperty(Zf)&&(Kf[qf[Zf]]=Zf);var Zf,Jf=Wf.exports={to:{},get:{}};function $f(e,t,n){return Math.min(Math.max(t,e),n)}function ep(e){var t=e.toString(16).toUpperCase();return t.length<2?"0"+t:t}Jf.get=function(e){var t,n;switch(e.substring(0,3).toLowerCase()){case"hsl":t=Jf.get.hsl(e),n="hsl";break;case"hwb":t=Jf.get.hwb(e),n="hwb";break;default:t=Jf.get.rgb(e),n="rgb"}return t?{model:n,value:t}:null},Jf.get.rgb=function(e){if(!e)return null;var t,n,r,i=[0,0,0,1];if(t=e.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=t[2],t=t[1],n=0;n<3;n++){var a=2*n;i[n]=parseInt(t.slice(a,a+2),16)}r&&(i[3]=parseInt(r,16)/255)}else if(t=e.match(/^#([a-f0-9]{3,4})$/i)){for(r=(t=t[1])[3],n=0;n<3;n++)i[n]=parseInt(t[n]+t[n],16);r&&(i[3]=parseInt(r+r,16)/255)}else if(t=e.match(/^rgba?\(\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*,\s*([+-]?\d+)\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)){for(n=0;n<3;n++)i[n]=parseInt(t[n+1],0);t[4]&&(i[3]=parseFloat(t[4]))}else{if(!(t=e.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*,\s*([+-]?[\d\.]+)\%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/)))return(t=e.match(/(\D+)/))?"transparent"===t[1]?[0,0,0,0]:(i=qf[t[1]])?(i[3]=1,i):null:null;for(n=0;n<3;n++)i[n]=Math.round(2.55*parseFloat(t[n+1]));t[4]&&(i[3]=parseFloat(t[4]))}for(n=0;n<3;n++)i[n]=$f(i[n],0,255);return i[3]=$f(i[3],0,1),i},Jf.get.hsl=function(e){if(!e)return null;var t=e.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var n=parseFloat(t[4]);return[(parseFloat(t[1])+360)%360,$f(parseFloat(t[2]),0,100),$f(parseFloat(t[3]),0,100),$f(isNaN(n)?1:n,0,1)]}return null},Jf.get.hwb=function(e){if(!e)return null;var t=e.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?[\d\.]+)\s*)?\)$/);if(t){var n=parseFloat(t[4]);return[(parseFloat(t[1])%360+360)%360,$f(parseFloat(t[2]),0,100),$f(parseFloat(t[3]),0,100),$f(isNaN(n)?1:n,0,1)]}return null},Jf.to.hex=function(){var e=Qf(arguments);return"#"+ep(e[0])+ep(e[1])+ep(e[2])+(e[3]<1?ep(Math.round(255*e[3])):"")},Jf.to.rgb=function(){var e=Qf(arguments);return e.length<4||1===e[3]?"rgb("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+")":"rgba("+Math.round(e[0])+", "+Math.round(e[1])+", "+Math.round(e[2])+", "+e[3]+")"},Jf.to.rgb.percent=function(){var e=Qf(arguments),t=Math.round(e[0]/255*100),n=Math.round(e[1]/255*100),r=Math.round(e[2]/255*100);return e.length<4||1===e[3]?"rgb("+t+"%, "+n+"%, "+r+"%)":"rgba("+t+"%, "+n+"%, "+r+"%, "+e[3]+")"},Jf.to.hsl=function(){var e=Qf(arguments);return e.length<4||1===e[3]?"hsl("+e[0]+", "+e[1]+"%, "+e[2]+"%)":"hsla("+e[0]+", "+e[1]+"%, "+e[2]+"%, "+e[3]+")"},Jf.to.hwb=function(){var e=Qf(arguments),t="";return e.length>=4&&1!==e[3]&&(t=", "+e[3]),"hwb("+e[0]+", "+e[1]+"%, "+e[2]+"%"+t+")"},Jf.to.keyword=function(e){return Kf[e.slice(0,3)]};var tp,np,rp=Wf.exports;(np=tp||(tp={}))[np.RGB=0]="RGB",np[np.HSL=1]="HSL";var ip=function(){function e(t){I(this,e),this.animBox=t,this.$=1}return M(e,[{key:"snapshot",get:function(){if(!this._snapshot){var e=this;this._snapshot={$ppt_x:this.animBox.initState.ppt_x,$ppt_y:this.animBox.initState.ppt_y,$ppt_w:this.animBox.initState.ppt_w,$ppt_h:this.animBox.initState.ppt_h,ppt_x:Number(e.animBox.currentState.ppt_x),ppt_y:Number(e.animBox.currentState.ppt_y),ppt_w:Number(e.animBox.currentState.ppt_w),ppt_h:Number(e.animBox.currentState.ppt_h),get $(){return e.$}}}return this._snapshot}}]),e}(),ap=function(){function e(t,n){I(this,e),this.expr=t,this.scope=n}return M(e,[{key:"valueOf",value:function(){var e;return null!=(e=this.value)?e:this.evaluate(1)}},{key:"evaluate",value:function(e){this.scope.$=e;try{return this.value=this.formula.evaluate(this.scope.snapshot),this.value}catch(t){return console.error(t),e}}},{key:"formula",get:function(){if(!this._formula)try{this._formula=(0,Wd.compile)(this.expr.replace(/#/g,"$"))}catch(e){console.error(e),this._formula={evaluate:function(e){return e}}}return this._formula}}]),e}(),op=Object.prototype.hasOwnProperty;function sp(e,t){return op.call(e,t)}function cp(e){return e instanceof ap||"number"==typeof e&&!Number.isNaN(e)}function up(e){return e/12700+"pt"}var lp=function(){function e(t){if(I(this,e),"string"==typeof t){var n=rp.get(t);if(n){var r=n.model,i=n.value;switch(r){case"hsl":return this.model=tp.HSL,void(this._hslCache={h:i[0],s:i[1],l:i[2],a:i[3]});case"rgb":return this.model=tp.RGB,void(this._rgbCache={r:i[0],g:i[1],b:i[2],a:i[3]})}}}else{if(function(e){return!!(e&&sp(e,"r")&&sp(e,"g")&&sp(e,"b")&&sp(e,"a"))}(t))return this.model=tp.RGB,this._rgbCache=t,void(this._hslCache=void 0);if(function(e){return!!(e&&sp(e,"h")&&sp(e,"s")&&sp(e,"l")&&sp(e,"a"))}(t))return this.model=tp.HSL,this._hslCache=t,void(this._rgbCache=void 0)}throw new TypeError("[Animatic] incorrect color: ".concat(t))}return M(e,[{key:"rgb",get:function(){if(!this._rgbCache){if(!this._hslCache)throw new Error("[Animatic] No color available");this._rgbCache=this.hslToRgb(this._hslCache)}return this._rgbCache}},{key:"hsl",get:function(){if(!this._hslCache){if(!this._rgbCache)throw new Error("[Animatic] No color available");this._hslCache=this.rbgToHsl(this._rgbCache)}return this._hslCache}},{key:"toString",value:function(){if(this.model===tp.HSL){var e=this.hsl,t=e.h,n=e.s,r=e.l,i=e.a;return"hsla(".concat(t,",").concat(n,",").concat(r,",").concat(i,")")}var a=this.rgb,o=a.r,s=a.g,c=a.b,u=a.a;return"rgba(".concat(o,",").concat(s,",").concat(c,",").concat(u,")")}},{key:"lighten",value:function(t){var n=this.hsl;return new e(Zd(Kd({},n),{l:If(0,100,n.l*(1+t))}))}},{key:"darken",value:function(t){var n=this.hsl;return new e(Zd(Kd({},n),{l:If(0,100,n.l*(1-t))}))}},{key:"alpha",value:function(t){var n=this.model===tp.HSL?this.hsl:this.rgb;if(null==t)return n.a;var r=If(0,1,t);return r===n.a?this:new e(Zd(Kd({},n),{a:r}))}},{key:"rbgToHsl",value:function(e){var t=e.r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=a-i,s=0;a===i?s=0:t===a?s=(n-r)/o:n===a?s=2+(r-t)/o:r===a&&(s=4+(t-n)/o),(s=Math.min(60*s,360))<0&&(s+=360);var c=(i+a)/2;return{h:s,s:100*(a===i?0:c<=.5?o/(a+i):o/(2-a-i)),l:100*c,a:e.a}}},{key:"hslToRgb",value:function(e){var t=e.s/100,n=e.l/100;if(0===t){var r=255*n;return{r:r,g:r,b:r,a:e.a}}for(var i,a,o,s=e.h/360,c=2*n-(i=n<.5?n*(1+t):n+t-n*t),u=[0,0,0],l=0;l<3;l++)(a=s+1/3*-(l-1))<0&&a++,a>1&&a--,o=6*a<1?c+6*(i-c)*a:2*a<1?i:3*a<2?c+(i-c)*(2/3-a)*6:c,u[l]=255*o;return{r:u[0],g:u[1],b:u[2],a:e.a}}}]),e}();function hp(e,t,n){if(e.model===tp.HSL||t.model===tp.HSL){var r=e.hsl,i=t.hsl;return new lp({h:Vf(r.h,i.h,n),s:Vf(r.s,i.s,n),l:Vf(r.l,i.l,n),a:Vf(r.a,i.a,n)})}var a=e.rgb,o=t.rgb;return new lp({r:dp(a.r,o.r,n),g:dp(a.g,o.g,n),b:dp(a.b,o.b,n),a:Vf(a.a,o.a,n)})}function dp(e,t,n){var r=e*e,i=t*t;return Math.sqrt(Math.max(0,n*(i-r)+r))}function fp(e,t){var n=Object.keys(t),r=n.reduce((function(n,r){switch(r){case"visible":var i=e[r],a=t[r];n[r]=function(e){return e<=0?i:a};break;case"fillcolor":var o=e[r],s=t[r];if(!o||!s)throw new Error("Mismatch color animation (Key: ".concat(r,", From: ").concat(o,", To: ").concat(s,")"));n[r]=function(e){return hp(o,s,e)};break;default:var c=e[r],u=t[r];if(!cp(c)||!cp(u))throw new Error("Mismatch number animation (Key: ".concat(r,", From: ").concat(c,", To: ").concat(u,")"));n[r]=function(e){return Vf(c,u,e)}}return n}),{});return function(e){return n.reduce((function(t,n){var i,a=null==(i=r[n])?void 0:i.call(r,e);return null!=a&&(t[n]=a),t}),{})}}function pp(e,t){var n;return function(r){return n||(n=fp(e(),t)),n(r)}}var vp=function(){function e(t){var n=t.animBox,r=t.eventSource,i=t.playerID,a=t.effectType,o=void 0===a?"clickEffect":a,s=t.duration,c=t.transform,u=t.ease,l=void 0===u?Cf:u,h=t.repeat,d=void 0===h?0:h,f=t.rewind,p=void 0!==f&&f,v=t.reverse,m=void 0!==v&&v,g=t.delay,y=void 0===g?0:g,b=t.by,k=void 0!==b&&b;I(this,e),this.progressTime=0,this.loopCount=0,this.fvTime=0,this.elapsed=0,this.animBox=n,this.eventSource=r,this.playerID=i,this.effectType=o,this.roundDuration=s,this.ease=l,this.repeat=Math.max(1,d),this.rewind=p,this.reverse=m,this.delay=y,this.by=k,this.duration=this.delay+this.roundDuration*(Number.isFinite(this.repeat)?this.repeat:1)*(this.reverse?2:1),this.loop=Number.isFinite(this.repeat)?this.reverse?2*(this.repeat-1)+1:this.repeat-1:this.repeat,this.transform=function(e,t){return function(n){return t(e(n))}}(l,null!=c?c:this.noopTransform)}return M(e,[{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.progressTime>=this.duration}},{key:"play",value:function(){var e=this;this.isPlaying||this.isComplete||(this.preAnimationState||(this.preAnimationState=Kd({},this.animBox.currentPureState)),this.frameProcess=Lf.update((function(t){var n=t.delta;if(e.progressTime+=n,e.progressTime<=e.delay)e.fvTime=0;else if(e.fvTime<=0&&(e.fvTime=Date.now()),e.elapsed+=n,e.update(),e.isPlaying&&e.elapsed>e.roundDuration){if(e.loopCount<e.loop)return e.elapsed=0,void(e.loopCount+=1);e.pause()}}),!0))}},{key:"pause",value:function(){this.frameProcess&&(jf.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function(e){var t=this;this.preAnimationState||(this.preAnimationState=Kd({},this.animBox.currentPureState)),e<=0&&(this.fvTime=0),this.progressTime=If(0,this.duration,e),this.progressTime<=this.delay?(this.loopCount=0,this.elapsed=0):(this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration-1),this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1),Lf.update((function(){return t.update()}),!1,!1)}},{key:"onFrame",value:function(e){if(e<=0){if(this.progressTime<=0)return;this.fvTime=0}if(!(e>=this.duration&&this.progressTime>=this.duration)){if(this.preAnimationState||(this.preAnimationState=Kd({},this.animBox.currentPureState)),this.progressTime=If(0,this.duration,e),this.progressTime<=this.delay)return this.loopCount=0,this.elapsed=0,void(this.by&&this.update());this.loopCount=Math.floor((this.progressTime-this.delay)/this.roundDuration),this.reverse?this.elapsed=(this.progressTime-this.delay)%this.roundDuration:this.elapsed=(this.progressTime-this.delay-1)%this.roundDuration+1,this.update()}}},{key:"reset",value:function(){var e=this;this.progressTime>0&&(this.pause(),this.loopCount=0,this.fvTime=0,this.elapsed=0,this.progressTime=0),this.preAnimationState&&Lf.update((function(){e.preAnimationState&&(e.animBox.resetState(e.playerID,e.preAnimationState),e.preAnimationState=void 0)}),!1,!1)}},{key:"stop",value:function(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function(){Number.isFinite(this.repeat)&&this.stop()}},{key:"update",value:function(){var e=If(0,1,this.elapsed/this.roundDuration),t=this.transform(this.reverse&&this.loopCount%2!=0?1-e:e);null!=t&&this.animBox.handleStateEvent({type:Ed.State,playerID:this.playerID,srcID:this.eventSource,by:this.by,fvTime:this.fvTime,value:t})}},{key:"noopTransform",value:function(){return{}}}]),e}(),mp=function(){function e(t){var n=t.cmd,r=t.animBox,i=t.eventSource,a=t.playerID,o=t.effectType,s=void 0===o?"clickEffect":o,c=t.rewind,u=void 0!==c&&c,l=t.delay,h=void 0===l?0:l;I(this,e),this.repeat=1,this.progressTime=0,this.fvTime=0,this.cmd=n,this.animBox=r,this.eventSource=i,this.playerID=a,this.effectType=s,this.rewind=u,this.delay=h,this.duration=this.delay+1}return M(e,[{key:"isPlaying",get:function(){return Boolean(this.frameProcess)}},{key:"isComplete",get:function(){return this.progressTime>=this.duration}},{key:"play",value:function(){var e=this;if(!this.isPlaying&&!this.isComplete)return 1===this.duration?(this.progressTime=1,void Lf.update((function(){return e.sendEvent()}),!1,!1)):void(this.frameProcess=Lf.update((function(t){var n=t.delta;e.progressTime+=n,e.progressTime<=e.delay?e.fvTime=0:(e.fvTime<=0&&(e.fvTime=Date.now()),e.sendEvent(),e.pause())}),!0))}},{key:"pause",value:function(){this.frameProcess&&(jf.update(this.frameProcess),this.frameProcess=void 0)}},{key:"seek",value:function(e){e<=0&&(this.fvTime=0),this.progressTime=If(0,this.duration,e),e<=0&&"pause"!==this.cmd.name&&"stop"!==this.cmd.name&&this.animBox.handleCmdEvent({type:Ed.Cmd,playerID:this.playerID,srcID:this.eventSource,fvTime:Date.now(),value:{name:"pause"}})}},{key:"onFrame",value:function(e){e<=0&&(this.fvTime=0,this.progressTime<=0)||e>=this.duration&&this.progressTime>=this.duration||(this.progressTime=If(0,this.duration,e),this.progressTime>=this.delay&&this.sendEvent())}},{key:"reset",value:function(){this.progressTime>0&&(this.pause(),this.fvTime=0,this.progressTime=0)}},{key:"stop",value:function(){this.pause(),this.seek(this.duration)}},{key:"stopFinite",value:function(){Number.isFinite(this.repeat)&&this.stop()}},{key:"sendEvent",value:function(){this.animBox.handleCmdEvent({type:Ed.Cmd,playerID:this.playerID,srcID:this.eventSource,fvTime:this.fvTime,value:this.cmd})}}]),e}();function gp(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;if(e.model===tp.HSL&&e.model===t.model){var r=e.hsl,i=t.hsl,a=r.h,o=i.h;return new lp({h:a+n*(o>a&&o-a>180?o-(a+360):o<a&&a-o>180?o+360-a:o-a),s:r.s+n*(i.s-r.s),l:r.l+n*(i.l-r.l),a:r.a*n+i.a*(1-n)})}var s=e.rgb,c=t.rgb,u=2*n-1,l=s.a-c.a,h=((u*l==-1?u:(u+l)/(1+u*l))+1)/2,d=1-h;return new lp({r:h*s.r+d*c.r,g:h*s.g+d*c.g,b:h*s.b+d*c.b,a:s.a*n+c.a*(1-n)})}var yp,bp=new lp({r:0,g:0,b:0,a:0}),kp=0,wp="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(e){return window.requestAnimationFrame(e)}:function(e){var t=Date.now(),n=Math.max(0,16.7-(t-kp));kp=t+n,setTimeout((function(){return e(kp)}),n)},Sp=1/60*1e3,xp=!0,Cp=!1,Ip=!1,Pp={delta:0,timestamp:0},Mp=["read","update","preRender","render","postRender"],Tp=function(e){return Cp=e},Ap=Mp.reduce((function(e,t){var n,r,i,a,o,s,c,u,l;return e[t]=(n=Tp,r=[],i=[],a=0,o=!1,s=0,c=new WeakSet,u=new WeakSet,l={cancel:function(e){var t=i.indexOf(e);c.add(e),-1!==t&&i.splice(t,1)},process:function(e){var t,h;if(o=!0,r=(t=[i,r])[0],(i=t[1]).length=0,a=r.length)for(s=0;s<a;s++)(h=r[s])(e),!0!==u.has(h)||c.has(h)||(l.schedule(h),n(!0));o=!1},schedule:function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var s=n&&o,l=s?r:i;c.delete(e),t&&u.add(e),-1===l.indexOf(e)&&(l.push(e),s&&(a=r.length))}}),e}),{}),Ep=Mp.reduce((function(e,t){var n=Ap[t];return e[t]=function(e,t,r){return void 0===t&&(t=!1),void 0===r&&(r=!1),Cp||Np(),n.schedule(e,t,r),e},e}),{}),Op=function(e){return Ap[e].process(Pp)},Rp=function e(t){Cp=!1,Pp.delta=xp?Sp:Math.max(Math.min(t-Pp.timestamp,40),1),xp||(Sp=Pp.delta),Pp.timestamp=t,Ip=!0,Mp.forEach(Op),Ip=!1,Cp&&(xp=!1,wp(e))},Np=function(){Cp=!0,xp=!0,Ip||wp(Rp)},Lp=function(e){var t=e.onRead,n=e.onRender,r=e.uncachedValues,i=void 0===r?new Set:r,a=e.useCache,o=void 0===a||a;return function(e){void 0===e&&(e={});var r=ef(e,[]),a={},s=[],c=!1;function u(e,t){e.startsWith("--")&&(r.hasCSSVariable=!0);var n=a[e];a[e]=t,a[e]!==n&&(-1===s.indexOf(e)&&s.push(e),c||(c=!0,Ep.render(l.render)))}var l={get:function(e,n){return void 0===n&&(n=!1),n||!o||i.has(e)||void 0===a[e]?t(e,r):a[e]},set:function(e,t){if("string"==typeof e)u(e,t);else for(var n in e)u(n,e[n]);return this},render:function(e){return void 0===e&&(e=!1),(c||!0===e)&&(n(a,r,s),c=!1,s.length=0),this}};return l}},jp=/([a-z])([A-Z])/g,Dp=function(e){return e.replace(jp,"$1-$2").toLowerCase()},Fp=new Map,zp=new Map,Bp=["Webkit","Moz","O","ms",""],Up=Bp.length,Vp="undefined"!=typeof document,Wp=function(e,t){return zp.set(e,Dp(t))},Hp=function(e,t){void 0===t&&(t=!1);var n,r=t?zp:Fp;return r.has(e)||(Vp?function(e){yp=yp||document.createElement("div");for(var t=0;t<Up;t++){var n=Bp[t],r=""===n,i=r?e:n+e.charAt(0).toUpperCase()+e.slice(1);if(i in yp.style||r){if(r&&"clipPath"===e&&zp.has(e))return;Fp.set(e,i),Wp(e,(r?"":"-")+Dp(i))}}}(e):Wp(n=e,n)),r.get(e)||e},_p=["","X","Y","Z"],Gp=["translate","scale","rotate","skew","transformPerspective"].reduce((function(e,t){return _p.reduce((function(e,n){return e.push(t+n),e}),e)}),["x","y","z"]),Yp=Gp.reduce((function(e,t){return e[t]=!0,e}),{});function Xp(e){return!0===Yp[e]}function qp(e,t){return Gp.indexOf(e)-Gp.indexOf(t)}var Qp=new Set(["originX","originY","originZ"]);function Kp(e){return Qp.has(e)}var Zp=$d($d({},af),{transform:Math.round}),Jp={color:xf,backgroundColor:xf,outlineColor:xf,fill:xf,stroke:xf,borderColor:xf,borderTopColor:xf,borderRightColor:xf,borderBottomColor:xf,borderLeftColor:xf,borderWidth:hf,borderTopWidth:hf,borderRightWidth:hf,borderBottomWidth:hf,borderLeftWidth:hf,borderRadius:hf,radius:hf,borderTopLeftRadius:hf,borderTopRightRadius:hf,borderBottomRightRadius:hf,borderBottomLeftRadius:hf,width:hf,maxWidth:hf,height:hf,maxHeight:hf,size:hf,top:hf,right:hf,bottom:hf,left:hf,padding:hf,paddingTop:hf,paddingRight:hf,paddingBottom:hf,paddingLeft:hf,margin:hf,marginTop:hf,marginRight:hf,marginBottom:hf,marginLeft:hf,rotate:uf,rotateX:uf,rotateY:uf,rotateZ:uf,scale:sf,scaleX:sf,scaleY:sf,scaleZ:sf,skew:uf,skewX:uf,skewY:uf,distance:hf,translateX:hf,translateY:hf,translateZ:hf,x:hf,y:hf,z:hf,perspective:hf,opacity:of,originX:df,originY:df,originZ:hf,zIndex:Zp,fillOpacity:of,strokeOpacity:of,numOctaves:Zp},$p=function(e){return Jp[e]},ev=function(e,t){return t&&"number"==typeof e?t.transform(e):e},tv=new Set(["scrollLeft","scrollTop"]),nv=new Set(["scrollLeft","scrollTop","transform"]),rv={x:"translateX",y:"translateY",z:"translateZ"};function iv(e){return"function"==typeof e}function av(e){var t=void 0===e?{}:e,n=t.enableHardwareAcceleration,r=void 0===n||n,i=t.isDashCase,a=void 0===i||i,o=t.allowTransformNone,s=void 0===o||o,c={},u={},l={},h=[];return function(e){return h.length=0,function(e,t,n,r,i,a,o,s){void 0===t&&(t=!0),void 0===n&&(n={}),void 0===r&&(r={}),void 0===i&&(i={}),void 0===a&&(a=[]),void 0===o&&(o=!1),void 0===s&&(s=!0);var c=!0,u=!1,l=!1;for(var h in e){var d=e[h],f=$p(h),p=ev(d,f);Xp(h)?(u=!0,r[h]=p,a.push(h),c&&(f.default&&d!==f.default||!f.default&&0!==d)&&(c=!1)):Kp(h)?(i[h]=p,l=!0):nv.has(h)&&iv(p)||(n[Hp(h,o)]=p)}(u||"function"==typeof e.transform)&&(n.transform=function(e,t,n,r,i,a){void 0===a&&(a=!0);var o="",s=!1;n.sort(qp);for(var c=n.length,u=0;u<c;u++){var l=n[u];o+=(rv[l]||l)+"("+t[l]+") ",s="z"===l||s}return!s&&i?o+="translateZ(0)":o=o.trim(),iv(e.transform)?o=e.transform(t,r?"":o):a&&r&&(o="none"),o}(e,r,a,c,t,s)),l&&(n.transformOrigin=(i.originX||"50%")+" "+(i.originY||"50%")+" "+(i.originZ||0))}(e,r,c,u,l,h,a,s),c}}var ov=Lp({onRead:function(e,t){var n=t.element,r=t.preparseOutput,i=$p(e);if(Xp(e))return i&&i.default||0;if(tv.has(e))return n[e];var a=window.getComputedStyle(n,null).getPropertyValue(Hp(e,!0))||0;return r&&i&&i.test(a)&&i.parse?i.parse(a):a},onRender:function(e,t,n){var r=t.element,i=t.buildStyles,a=t.hasCSSVariable;if(Object.assign(r.style,i(e)),a)for(var o=n.length,s=0;s<o;s++){var c=n[s];c.startsWith("--")&&r.style.setProperty(c,e[c])}-1!==n.indexOf("scrollLeft")&&(r.scrollLeft=e.scrollLeft),-1!==n.indexOf("scrollTop")&&(r.scrollTop=e.scrollTop)},uncachedValues:tv}),sv=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues"]),cv=function(e,t){return hf.transform(e*t)},uv={x:0,y:0,width:0,height:0};function lv(e,t,n){return"string"==typeof e?e:hf.transform(t+n*e)}var hv={enableHardwareAcceleration:!1,isDashCase:!1};function dv(e,t,n){void 0===n&&(n=!0);var r={style:{}},i=av(hv);return function(a){return function(e,t,n,r,i,a){void 0===t&&(t=uv),void 0===r&&(r=av(hv)),void 0===i&&(i={style:{}}),void 0===a&&(a=!0);var o,s,c=e.attrX,u=e.attrY,l=e.originX,h=e.originY,d=e.pathLength,f=e.pathSpacing,p=void 0===f?1:f,v=e.pathOffset,m=void 0===v?0:v,g=r(ef(e,["attrX","attrY","originX","originY","pathLength","pathSpacing","pathOffset"]));for(var y in g)"transform"===y?i.style.transform=g[y]:i[a&&!sv.has(y)?Dp(y):y]=g[y];return(void 0!==l||void 0!==h||g.transform)&&(i.style.transformOrigin=(s=void 0!==h?h:.5,lv(void 0!==l?l:.5,(o=t).x,o.width)+" "+lv(s,o.y,o.height))),void 0!==c&&(i.x=c),void 0!==u&&(i.y=u),void 0!==n&&void 0!==d&&(i[a?"stroke-dashoffset":"strokeDashoffset"]=cv(-m,n),i[a?"stroke-dasharray":"strokeDasharray"]=cv(d,n)+" "+cv(p,n)),i}(a,e,t,i,r,n)}}var fv,pv,vv=Lp({onRead:function(e,t){var n=t.element;if(Xp(e=sv.has(e)?e:Dp(e))){var r=$p(e);return r&&r.default||0}return n.getAttribute(e)},onRender:function(e,t){var n=t.element,r=(0,t.buildAttrs)(e);for(var i in r)"style"===i?Object.assign(n.style,r.style):n.setAttribute(i,r[i])}}),mv=Lp({useCache:!1,onRead:function(e){return"scrollTop"===e?window.pageYOffset:window.pageXOffset},onRender:function(e){var t=e.scrollTop,n=void 0===t?0:t,r=e.scrollLeft,i=void 0===r?0:r;return window.scrollTo(i,n)}}),gv=new WeakMap;function yv(e,t){return n="string"==typeof e?document.querySelector(e):e,r=t,gv.has(n)?gv.get(n):function(e,t){var n,r,i,a,o;return e===window?n=mv(e):(o=e)instanceof HTMLElement||"function"==typeof o.click?n=function(e,t){void 0===t&&(t={});var n=t.enableHardwareAcceleration,r=t.allowTransformNone,i=ef(t,["enableHardwareAcceleration","allowTransformNone"]);return ov($d({element:e,buildStyles:av({enableHardwareAcceleration:n,allowTransformNone:r}),preparseOutput:!0},i))}(e,t):function(e){return e instanceof SVGElement||"ownerSVGElement"in e}(e)&&(i=function(e){try{return"function"==typeof(t=e).getBBox?t.getBBox():t.getBoundingClientRect()}catch(t){return{x:0,y:0,width:0,height:0}}var t}(r=e),a=function(e){return"path"===e.tagName}(r)&&r.getTotalLength?r.getTotalLength():void 0,n=vv({element:r,buildAttrs:dv(i,a)})),gv.set(e,n),n}(n,r);var n,r}function bv(e){switch(e){case"rotate":case"scaleX":case"scaleY":case"fillcolor":return!0;default:return!1}}(pv=fv||(fv={})).Paragraph="anim-p",pv.Text="anim-t";var kv=function(){function e(t){var n=this,r=t.target,i=t.pIndex,a=t.tIndex,o=t.constants,s=t.initState,c=void 0===s?{}:s,u=t.applyStyles;I(this,e),this.handleStateEvent=function(e){var t=e.playerID,r=e.by,i=e.value,a=Object.keys(i).filter((function(e){return null!=i[e]}));if(r){var o=n.byStates.get(t);o||(o={},n.byStates.set(t,o));var s,c=A(a);try{for(c.s();!(s=c.n()).done;){var u=s.value;bv(u)?(o[u]=i[u],n.currentState[u]=n.currentPureState[u]):(n.currentState[u]=i[u],n.currentPureState[u]=i[u])}}catch(e){c.e(e)}finally{c.f()}}else{n.lastStateEvent=e;var l,h=A(a);try{for(h.s();!(l=h.n()).done;){var d=l.value;n.currentState[d]=i[d],n.currentPureState[d]=i[d]}}catch(e){h.e(e)}finally{h.f()}}var f,p=A(n.byStates.values());try{for(p.s();!(f=p.n()).done;){var v,m=f.value,g=A(a);try{for(g.s();!(v=g.n()).done;){var y=v.value;n.mergeByStates(y,m)}}catch(e){g.e(e)}finally{g.f()}}}catch(e){p.e(e)}finally{p.f()}n.applyStyles(n.convertStyles(n.currentState))},this.handleCmdEvent=function(e){n.lastCmdEvent=e,"playFrom"===e.value.name?null==window||window.postMessage({type:"_changeAudioState",targetID:n.target,play:1,stop:0},"*"):"playSF"===e.value.name?null==window||window.postMessage({type:"_playSoundEffect",targetID:n.target,soundEffectId:e.value.value},"*"):null==window||window.postMessage({type:"_changeAudioState",targetID:n.target,play:0,stop:1},"*")},this.byStates=new Map,this.target=r,this.pIndex=i,this.tIndex=a,this.constants=o,this.withSubElem=null!=this.pIndex||null!=this.tIndex;var l=o.x,h=o.y,d=o.slideWidth,f=o.slideHeight,p=o.width,v=o.height;this.initState=Zd(Kd({scaleX:1,scaleY:1,rotate:0,opacity:1,xshear:0,yshear:0,fillcolor:bp,visible:!0},c),{ppt_x:l/d,ppt_y:h/f,ppt_w:p/d,ppt_h:v/f}),this.currentState=Kd({},this.initState),this.currentPureState=Kd({},this.initState),u&&(this.applyStyles=u)}return M(e,[{key:"resetState",value:function(e,t){this.lastStateEvent=void 0,this.lastCmdEvent=void 0,this.byStates.delete(e),Object.assign(this.currentPureState,t),Object.assign(this.currentState,this.currentPureState);var n,r=A(this.byStates.values());try{for(r.s();!(n=r.n()).done;){var i=n.value;for(var a in i)this.mergeByStates(a,i)}}catch(e){r.e(e)}finally{r.f()}this.applyStyles(this.convertStyles(this.currentState))}},{key:"applyStyles",value:function(e){var t=this.getStyler();t&&t.forEach((function(t,n){n?t.set({"pointer-events":e["pointer-events"]}):t.set(e)}))}},{key:"applyPreAnimation",value:function(){this.preAnimationState&&this.applyStyles(this.convertStyles(this.preAnimationState))}},{key:"preAnimation",value:function(e){if(!e)return this.preAnimationState;this.preAnimationState||(this.preAnimationState={});for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=e[r];null!=i&&(this.preAnimationState[r]=i,this.currentState[r]=i,this.currentPureState[r]=i)}}},{key:"clearCache",value:function(){this._stylerList=void 0}},{key:"mergeByStates",value:function(e,t){var n,r,i,a,o,s;switch(e){case"rotate":this.currentState.rotate=(null!=(n=this.currentState.rotate)?n:0)+(null!=(r=t.rotate)?r:0);break;case"scaleX":this.currentState.scaleX=(null!=(i=this.currentState.scaleX)?i:1)*(null!=(a=t.scaleX)?a:1);break;case"scaleY":this.currentState.scaleY=(null!=(o=this.currentState.scaleY)?o:1)*(null!=(s=t.scaleY)?s:1);break;case"fillcolor":this.currentState.fillcolor&&t.fillcolor?this.currentState.fillcolor=gp(this.currentState.fillcolor,t.fillcolor):t.fillcolor&&(this.currentState.fillcolor=t.fillcolor)}}},{key:"convertStyles",value:function(e){var t,n,r,i,a,o,s,c,u={"will-change":"opacity,transform"},l=this.constants,h=l.x,d=l.y,f=l.width,p=l.height,v=l.slideWidth,m=l.slideHeight;for(var g in e)if(sp(e,g))switch(g){case"ppt_x":var y=null!=(t=e.ppt_x)?t:this.currentState.ppt_x;u.translateX=up(y*v-h);break;case"ppt_y":var b=null!=(n=e.ppt_y)?n:this.currentState.ppt_y;u.translateY=up(b*m-d);break;case"scaleX":var k=null!=(r=e.scaleX)?r:1,w=this.currentState.ppt_w;u.scaleX=k*w*v/f;break;case"ppt_w":var S=null!=(i=this.currentState.scaleX)?i:1,x=null!=(a=e.ppt_w)?a:this.currentState.ppt_w;u.scaleX=S*x*v/f;break;case"scaleY":var C=null!=(o=e.scaleY)?o:1,I=this.currentState.ppt_h;u.scaleY=C*I*m/p;break;case"ppt_h":var P=null!=(s=this.currentState.scaleY)?s:1,M=null!=(c=e.ppt_h)?c:this.currentState.ppt_h;u.scaleY=P*M*m/p;break;case"fillcolor":if(null!=e.fillcolor){var T=e.fillcolor.hsl;u["--sp-fill"]="hsla(".concat(T.h,",").concat(T.s,"%,").concat(T.l,"%,").concat(T.a,")"),u["--sp-fill-h"]=T.h,u["--sp-fill-s"]=T.s+"%",u["--sp-fill-l"]=T.l+"%",u["--sp-fill-a"]=T.a}break;case"visible":null!=e.visible&&(u.opacity=this.currentState.opacity*(e.visible?1:0),u["pointer-events"]=e.visible?"initial":"none");break;case"opacity":null!=e.opacity&&(u.opacity=e.opacity*(this.currentState.visible?1:0));break;case"rotate":null!=e.rotate&&(u.rotate=Number(e.rotate));break;case"xshear":null!=e.xshear&&(u.skewX=45*e.xshear);break;case"yshear":null!=e.yshear&&(u.skewY=45*e.yshear);break;default:null!=e[g]&&(u[g]=e[g])}return this.constants.flipH&&sp(u,"scaleX")&&(u.scaleX*=-1),this.constants.flipV&&sp(u,"scaleY")&&(u.scaleY*=-1),sp(u,"rotate")&&(u.scaleX<0&&(u.rotate*=-1),u.scaleY<0&&(u.rotate*=-1)),u}},{key:"getStyler",value:function(){if(!this._stylerList){var e=document.getElementById(this.target);if(e&&null!=this.pIndex&&(e=e.querySelectorAll(".".concat(fv.Paragraph))[this.pIndex]),e&&null!=this.tIndex&&(e=e.querySelectorAll(".".concat(fv.Text))[this.tIndex]),e){this._stylerList=[yv(e)];for(var t=0;t<e.children.length;t+=1)e.children[t].classList.contains("ppt-event-source")&&this._stylerList.push(yv(e.children[t]))}}return this._stylerList}}]),e}(),wv={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,r,a,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,a||e,o),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],s]:e._events[c].push(s):(e._events[c]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,a=r.length,o=new Array(a);i<a;i++)o[i]=r[i].fn;return o},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,a,o){var s=n?n+e:e;if(!this._events[s])return!1;var c,u,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,a),!0;case 6:return l.fn.call(l.context,t,r,i,a,o),!0}for(u=1,c=new Array(h-1);u<h;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var d,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),h){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,i);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];l[u].fn.apply(l[u].context,c)}}return!0},s.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var a=n?n+e:e;if(!this._events[a])return this;if(!t)return o(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||o(this,a);else{for(var c=0,u=[],l=s.length;c<l;c++)(s[c].fn!==t||i&&!s[c].once||r&&s[c].context!==r)&&u.push(s[c]);u.length?this._events[a]=1===u.length?u[0]:u:o(this,a)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&o(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(wv);var Sv=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.call(this)}return n}(wv.exports),xv=X(n("q1tI")),Cv=X(n("q1tI")),Iv=X(n("q1tI")),Pv=X(n("q1tI")),Mv=X(n("q1tI")),Tv=X(n("q1tI")),Av=X(n("q1tI")),Ev=X(n("q1tI")),Ov=X(n("q1tI")),Rv=X(n("q1tI")),Nv=X(n("q1tI")),Lv=X(n("q1tI")),jv=X(n("q1tI")),Dv=X(n("i8i4")),Fv=X(n("q1tI")),zv=X(n("q1tI")),Bv=X(n("q1tI")),Uv=X(n("q1tI")),Vv=X(n("q1tI")),Wv=X(n("aSns")),Hv=X(n("tK0H")),_v=X(n("q1tI")),Gv=X(n("i8i4")),Yv=X(n("uhBA")),Xv=X(n("q1tI")),qv=X(n("q1tI")),Qv=X(n("q1tI")),Kv=Object.defineProperty,Zv=Object.defineProperties,Jv=Object.getOwnPropertyDescriptors,$v=Object.getOwnPropertySymbols,em=Object.prototype.hasOwnProperty,tm=Object.prototype.propertyIsEnumerable,nm=function(e,t,n){return t in e?Kv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},rm=function(e,t){for(var n in t||(t={}))em.call(t,n)&&nm(e,n,t[n]);if($v){var r,i=A($v(t));try{for(i.s();!(r=i.n()).done;){n=r.value;tm.call(t,n)&&nm(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},im=function(e,t){return Zv(e,Jv(t))},am=12700,om=9525,sm=1e5,cm=6e4;function um(e){if("number"==typeof e)return e/sm;var t=e.endsWith("%");return parseFloat(e)/(t?100:sm)}function lm(e){return"".concat(dm(e)/am,"pt")}function hm(e){return 0===e?0:e/cm}function dm(e){return"string"==typeof e?parseFloat(e):e}function fm(e){return.75*dm(e)}function pm(e){return dm(e)/.75}function vm(e,t){var n=function(e){var t,n={},r=A(e);try{for(r.s();!(t=r.n()).done;){var i=t.value.name||"";if(i in n)return!0;n[i]=!0}}catch(e){r.e(e)}finally{r.f()}return!1}(e.elements)||t;if(e.elements.length>0){var r,i={},a=n&&e.elements.length>1,o=A(e.elements);try{for(o.s();!(r=o.n()).done;){var s=r.value,c=mm(s,a),u=vm(s,t);void 0===s.text?i[c]=u:i[c]=im(rm({},u),{body:s.text})}}catch(e){o.e(e)}finally{o.f()}return i}return null}function mm(e,t){var n=[];e.attr.forEach((function(t){var r=e.attr.getOptional(t);"string"==typeof r?n.push("".concat(t,"=").concat(JSON.stringify(r))):n.push("".concat(t,"=").concat(r))}));var r="";return t&&(r+="[".concat(e.index,"] ")),r+="<".concat(e.name),n.length>0&&(r+=" "+n.join(" ")),r+=">"}var gm=function(){function e(t){I(this,e),this.tagName=t}return M(e,[{key:"get",value:function(e,t){return this.assignDefaultValue(e,this.getOptional(e),t)}},{key:"getString",value:function(e,t){return this.assignDefaultValue(e,this.getStringOptional(e),t)}},{key:"getNumber",value:function(e,t){return this.assignDefaultValue(e,this.getNumberOptional(e),t)}},{key:"getBoolean",value:function(e,t){return this.assignDefaultValue(e,this.getBooleanOptional(e),t)}},{key:"getColor",value:function(e,t){return this.assignDefaultValue(e,this.getColorOptional(e),t)}},{key:"getColorOptional",value:function(e){return this.getOptional(e)}},{key:"getStringOptional",value:function(e){var t=this.getOptional(e);return"number"==typeof t&&(t="".concat(t)),t}},{key:"getNumberOptional",value:function(e){var t=this.getOptional(e);if("string"!=typeof t||(t=parseInt(t,10),!Number.isNaN(t)))return t}},{key:"getBooleanOptional",value:function(e){var t=this.getOptional(e);return"true"===t||"1"===t||"on"===t?t=!0:"false"===t||"0"===t||"off"===t?t=!1:void 0!==t&&(t=!!t),t}},{key:"assignDefaultValue",value:function(e,t,n){var r=t;if(void 0===r&&(r=n),void 0===r)throw new Error("can't find attribute ".concat(JSON.stringify(e)," from ").concat(this.tagName));return r}}]),e}(),ym=function(e){y(n,e);var t=k(n);function n(e){return I(this,n),t.call(this,e)}return M(n,[{key:"length",value:function(){return 0}},{key:"forEach",value:function(e){}},{key:"getOptional",value:function(e){}},{key:"has",value:function(e){return!1}}]),n}(gm),bm=function(e){y(n,e);var t=k(n);function n(e,r){var i;return I(this,n),(i=t.call(this,e)).attributes=r,i}return M(n,[{key:"length",value:function(){return Object.keys(this.attributes).length}},{key:"forEach",value:function(e){for(var t in this.attributes)e(t)}},{key:"has",value:function(e){return e in this.attributes}},{key:"getOptional",value:function(e){return this.attributes[e]}}]),n}(gm),km=function(e){y(n,e);var t=k(n);function n(e,r,i){var a;return I(this,n),(a=t.call(this,e.name)).xml=e,a.picker=r,a.resourceType=i,a}return M(n,[{key:"length",value:function(){return-1}},{key:"forEach",value:function(e){void 0!==this.tagName&&this.picker.forEachAttributes(this.tagName,e)}},{key:"has",value:function(e){return void 0!==this.getOptional(e)}},{key:"getOptional",value:function(e){var t;return this.cachedValues&&e in this.cachedValues?t=this.cachedValues[e]:void 0!==this.tagName&&(this.cachedXMLMap||(this.cachedXMLMap={}),t=this.picker.getAttribute(this.tagName,e,this.xml,this.cachedXMLMap,this.resourceType),this.cachedValues||(this.cachedValues={}),this.cachedValues[e]=t),t}}]),n}(gm),wm=function(){function e(t,n){I(this,e),this.picker=n,this.resourceType=t}return M(e,[{key:"parse",value:function(e){return new xm(this.picker,null,0,(0,Dd.xml2js)(e,{compact:!1,captureSpacesBetweenElements:!0}),this.resourceType)}}]),e}(),Sm=function(){function e(){I(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.tagNames=n}return M(e,[{key:"execute",value:function(e){return void 0!==this.tagNames.find((function(t){return t===e}))}},{key:"toString",value:function(){return this.tagNames.join(" or ")}}]),e}(),xm=function(){function e(t,n,r,i,a){I(this,e),this.picker=t,this.parent=n,this.index=r,this.resourceType=a,this.name=i.name,this.type=i.type,this.attr=new bm(this.name,Object.freeze(rm({},i.attributes))),this.extraAttr=t?new km(this,t,a):new ym(this.name);var o=[];if(i.elements)for(var s=0;s<i.elements.length;++s){var c=i.elements[s];"text"===c.type?this.text=c.text:o.push(new e(t,this,s,c,a))}this.elements=Object.freeze(o)}return M(e,[{key:"element",get:function(){return this.elements[0]}},{key:"displayer",value:function(e){return function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return o({},mm(e,t),vm(e,t))}(this,e)}},{key:"elementWithName",value:function(e){var t,n=A(this.elements);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.name===e)return r}}catch(e){n.e(e)}finally{n.f()}}},{key:"extraElementWithName",value:function(e){if(this.picker&&this.name)return this.cachedXMLMap||(this.cachedXMLMap={}),this.picker.getChild(this.name,e,this,this.cachedXMLMap,this.resourceType)}},{key:"elementsWithName",value:function(e){var t,n=[],r=A(this.elements);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.name===e&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"childElementOptional",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=this.searchChildElement(t),i=r.xml,a=r.found;if(a)return i}},{key:"childElement",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=this.searchChildElement(t),i=r.xml,a=r.found;if(a)return i;"string"==typeof this.name&&t.unshift(this.name);var o=t.join(" -> "),s=t.findIndex((function(e){return e===i.name})),c=t.splice(s+1)[0],u=t.join(" -> ");throw new Error("can't find child ".concat(o,": lack of child ").concat(c," from ").concat(u))}},{key:"searchChildElement",value:function(e){for(var t=this,n=0;n<e.length;++n){var r,i=e[n],a=t,o=A(t.elements);try{for(o.s();!(r=o.n()).done;){var s=r.value;if("string"==typeof i){if(s.name===i){t=s;break}}else if(i.execute(s.name)){t=s;break}}}catch(e){o.e(e)}finally{o.f()}if(a===t)return{xml:t,found:!1}}return{xml:t,found:!0}}},{key:"hasChildElementWithName",value:function(e){var t,n=A(this.elements);try{for(n.s();!(t=n.n()).done;){if(t.value.name===e)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"parentElement",value:function(e){var t=this.parentElementOptional(e);if(t)return t;throw new Error("can't find parent ".concat(e," from ").concat(this.name))}},{key:"parentElementOptional",value:function(e){for(var t=this.parent;t;){if("string"==typeof e){if(t.name===e)return t}else if(e.execute(t.name))return t;t=t.parent}}}]),e}(),Cm={"Arial Rounded MT Bold":"https://convertcdn.netless.link/fonts/ArialRoundedMTBold.woff",Arial:"https://convertcdn.netless.link/fonts/arial.woff","Cooper Black":"https://convertcdn.netless.link/fonts/COOPBL.woff",Calibri:"https://convertcdn.netless.link/fonts/Calibri.woff","":"https://convertcdn.netless.link/fonts/msyh.woff","":"https://convertcdn.netless.link/fonts/HuaWenXinWei-1.woff","-":"https://convertcdn.netless.link/fonts/yuppy.woff","":"https://convertcdn.netless.link/fonts/simhei.woff","":"https://convertcdn.netless.link/fonts/simkai.woff",Heiti:"https://convertcdn.netless.link/fonts/simhei.woff",Aharoni:"https://convertcdn.netless.link/fonts/Aharoni.woff","Aharoni Bold":"https://convertcdn.netless.link/fonts/Aharoni%20Bold.woff","source-han-sans":"https://convertcdn.netless.link/fonts/simhei.woff"},Im="netless-ppt-font-face";function Pm(e,t,n){if(document&&n){var r=document.getElementById("".concat(Im,"-").concat(t));if(r)return;(r=document.createElement("style")).id="".concat(Im,"-").concat(t),document.head.appendChild(r);var i=n.filter((function(e){return e.src})).map((function(n){var r=n.src.split("."),i=r[(null==r?void 0:r.length)-1],a={"font-style":n.fontStyle,"font-weight":n.fontWeight,"font-family":'"'.concat(n.fontFamily,"-").concat(t,'"'),src:'url("'.concat(e,"/fonts/").concat(n.src,'") format("').concat(i,'")')};return JSON.parse(JSON.stringify(a))})).map((function(e){return"@font-face {".concat(Object.keys(e).reduce((function(t,n){return"".concat(t,"\n").concat(n,": ").concat(e[n],";")}),""),"}")}));r.innerHTML=i.join("\n")}}var Mm=new Map;function Tm(e,t){return Am.apply(this,arguments)}function Am(){return(Am=l(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Mm.has(t)||(Mm.set(t,!0),n&&n[t]?Em(t,n[t]).then((function(){}),(function(){})):n&&n["*"]?(Em(t,n["*"]).then((function(){}),(function(){})),Em(t,n["*-bold"],{weight:"500"}).then((function(){}),(function(){})),Em(t,n["*-italic"],{style:"italic"}).then((function(){}),(function(){})),Em(t,n["*-bold-italic"],{weight:"500",style:"italic"}).then((function(){}),(function(){}))):Cm[t]&&Em(t,Cm[t]).then((function(){}),(function(){})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Em(e,t,n){return Om.apply(this,arguments)}function Om(){return(Om=l(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n,!e.t0){e.next=7;break}return e.next=4,fetch(n,{cache:"force-cache"});case 4:return e.next=6,e.sent.arrayBuffer();case 6:i=e.sent;case 7:if(!i){e.next=20;break}return a=new FontFace(t,i,r),e.prev=9,e.next=12,a.load();case 12:document.fonts.add(a),e.next=18;break;case 15:e.prev=15,e.t1=e.catch(9),console.error("".concat(t," load error font"),e.t1);case 18:e.next=21;break;case 20:Mm.delete(t);case 21:case"end":return e.stop()}}),e,null,[[9,15]])})))).apply(this,arguments)}function Rm(e,t){if(t.masterThemeColorMapping[e]){var n="a:".concat(t.masterThemeColorMapping[e]),r=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",n,"a:srgbClr");if(r)return r.attr.getString("val");var i=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",n,"a:sysClr");return i?i.attr.getString("lastClr",e):e}var a="a:".concat(e),o=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",a,"a:srgbClr");if(o)return o.attr.getString("val");var s=t.theme.childElementOptional("a:theme","a:themeElements","a:clrScheme",a,"a:sysClr");return s?s.attr.getString("lastClr",e):e}function Nm(e){var t=Dm(e).childElementOptional("a:majorFont");return void 0===t?{}:jm(t)}function Lm(e){var t=Dm(e).childElementOptional("a:minorFont");return void 0===t?{}:jm(t)}function jm(e){var t={},n=e.childElementOptional("a:latin"),r=e.childElementOptional("a:ea"),i=e.childElementOptional("a:cs");n&&(t.latin=""===n.attr.getString("typeface","")?[]:[n.attr.getString("typeface")]),r&&(t.ea=""===r.attr.getString("typeface","")?[]:[r.attr.getString("typeface")]),i&&(t.cs=""===i.attr.getString("typeface","")?[]:[i.attr.getString("typeface")]);var a=e.elementsWithName("a:font").filter((function(e){return["Hans","Hant","Jpan","Hang"].includes(e.attr.getString("script"))})).map((function(e){return e.attr.getString("typeface")}));return void 0!==t.ea?t.ea=t.ea.concat(a):t.ea=a,t}function Dm(e){return e.theme.childElement("a:theme","a:themeElements","a:fontScheme")}function Fm(e){var t=[];return void 0!==e.latin&&t.concat(e.latin),void 0!==e.ea&&t.concat(e.ea),void 0!==e.cs&&t.concat(e.cs),t}var zm=["a:blipFill","a:gradFill","a:grpFill","a:noFill","a:pattFill","a:solidFill"],Bm=["a:hslClr","a:schemeClr","a:srgbClr","a:scrgbClr","a:sysClr","a:prstClr"];function Um(e,t){var n,r=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme"),i=e.childElement("a:effectRef"),a=i.childElement(g(Sm,Bm)),o=i.attr.getNumber("idx"),s=r.childElement("a:effectStyleLst").elements[o-1],c=e.childElement("a:fillRef"),u=c.childElement(g(Sm,Bm)),l=c.attr.getNumber("idx"),h=r.childElement("a:fillStyleLst").elements[l-1],d=e.childElement("a:fontRef"),f=d.attr.getString("idx");"none"!==f&&(n=Dm(t).childElement("a:".concat(f,"Font")));var p=e.childElement("a:lnRef"),v=p.childElement(g(Sm,Bm)),m=p.attr.getNumber("idx");return{effect:{xml:s,phClr:a},fill:{xml:h,phClr:u},font:{xml:n,fontRef:d},ln:{xml:r.childElement("a:lnStyleLst").elements[m-1],phClr:v}}}var Vm,Wm=(0,jd.default)("#FFFFFF").alpha(0),Hm=(0,jd.default)("#FFFFFF").alpha(0);!function(e){e.None="none",e.Norm="norm",e.Lighten="lighten",e.LightenLess="lightenLess",e.Darken="darken",e.DarkenLess="darkenLess"}(Vm||(Vm={}));var _m=function(){function e(){I(this,e),this.fillColor=Wm.hsl()}return M(e,[{key:"setFillColor",value:function(e){this.fillColor=e||Wm.hsl()}},{key:"hsl",value:function(){return this.fillColor.hsl()}},{key:"rgb",value:function(){return this.fillColor.rgb()}}]),e}(),Gm=function(){function e(t){I(this,e),this.alphaModFix=1,this.resId=t.childElement("a:blip").attr.getString("r:embed"),void 0!==t.childElementOptional("a:tile")?this.tile=!0:this.tile=!1;var n=t.childElement("a:blip").childElementOptional("a:alphaModFix");if(void 0!==n){var r=n.attr.getNumberOptional("amt");r&&(this.alphaModFix=um(r))}}return M(e,[{key:"getResId",value:function(){return this.resId}},{key:"getAlphaModFix",value:function(){return this.alphaModFix}},{key:"hsl",value:function(){return Wm.hsl()}},{key:"rgb",value:function(){return Wm.rgb()}}]),e}(),Ym=function(){function e(t,n,r,i){I(this,e),this.colors=[],this.rotation=0,this.path=void 0;var a=t.hasChildElementWithName("a:gsLst")?t.childElement("a:gsLst").elementsWithName("a:gs"):[];if(this.colors=a.sort((function(e,t){return e.attr.getNumber("pos")/sm-t.attr.getNumber("pos")/sm})).map((function(e){return{stop:e.attr.getNumber("pos")/sm,color:Xm(e.childElement(g(Sm,Bm)),n,r,i)}})),t.hasChildElementWithName("a:lin")&&(this.rotation=hm(t.childElement("a:lin").attr.getNumber("ang",0))),t.hasChildElementWithName("a:path")){var o=t.childElement("a:path"),s=o.attr.getStringOptional("path"),c=o.childElementOptional("a:fillToRect");if(!c)return void(this.path={path:s,fillToRect:{left:0,top:0,bottom:0,right:0}});var u=c.attr.getNumber("l",0),l=c.attr.getNumber("t",0),h=c.attr.getNumber("b",0),d=c.attr.getNumber("r",0);this.path={path:s,fillToRect:{left:u,top:l,bottom:h,right:d}}}}return M(e,[{key:"getGradientPath",value:function(){return this.path}},{key:"getColors",value:function(){return this.colors}},{key:"getRotation",value:function(){return this.rotation}},{key:"hsl",value:function(){return this.colors&&this.colors.length>0&&this.colors[0].color?this.colors[0].color.hsl():Wm.hsl()}},{key:"rgb",value:function(){return this.colors&&this.colors.length>0&&this.colors[0].color?this.colors[0].color.rgb():Wm.rgb()}},{key:"getGradientStyles",value:function(){var e="linear-gradient(".concat(this.rotation+90,"deg, ");return e+=this.colors.filter((function(e){return e.color})).map((function(e){var t;return"".concat(null==(t=e.color)?void 0:t.rgb().string()," ").concat(100*e.stop,"%")})).join(","),e+=")"}}]),e}();function Xm(e,t,n,r){var i;if(e.attr.has("val")){var a=e.childElementOptional("a:alpha"),o=e.childElementOptional("a:shade"),s=e.childElementOptional("a:tint"),c=e.childElementOptional("a:lumMod"),u=e.childElementOptional("a:satMod"),l=e.childElementOptional("a:satOff"),h=e.childElementOptional("a:lumOff"),d=e.childElementOptional("a:hueMod"),f=e.childElementOptional("a:hueOff");switch(e.name){case"a:prstClr":return Qm((0,jd.default)(e.attr.getString("val")),a,o,c,s,u,h,l,d,f);case"a:srgbClr":return Qm((0,jd.default)("#".concat(e.attr.getString("val"))),a,o,c,s,u,h,l,d,f);case"a:schemeClr":var p=e.attr.getString("val");return"phClr"===p&&(p=r||("a:sysClr"===n.name?null!=(i=n.attr.getStringOptional("lastClr"))?i:"accent1":n.attr.getString("val"))),Qm((0,jd.default)("#".concat(Rm(p,t))),a,o,c,s,u,h,l,d,f);case"a:hslClr":var v=e.attr.getNumber("hue")/cm,m=e.attr.getNumber("sat")/sm,g=e.attr.getNumber("lum")/sm;return Qm((0,jd.default)({h:v,s:m,l:g}),a,o,c,s,u,h);case"a:scrgbClr":var y=255*e.attr.getNumber("r")/sm,b=255*e.attr.getNumber("g")/sm,k=255*e.attr.getNumber("b")/sm;return Qm((0,jd.default)({r:y,g:b,b:k}),a,o,c,s,u,h);case"a:sysClr":return Qm((0,jd.default)("#".concat(e.attr.getString("lastClr"))),a,o,c,s,u,h,l,d,f);default:return}}}function qm(e,t){var n,r,i,a,o,s,c,u,l,h=Number(null==(n=e.alpha)?void 0:n.val),d=Number(null==(r=e.shade)?void 0:r.val),f=Number(null==(i=e.tint)?void 0:i.val),p=Number(null==(a=e.lumMod)?void 0:a.val),v=Number(null==(o=e.satMod)?void 0:o.val),m=Number(null==(s=e.satOff)?void 0:s.val),g=Number(null==(c=e.lumOff)?void 0:c.val),y=Number(null==(u=e.hueMod)?void 0:u.val),b=Number(null==(l=e.hueOff)?void 0:l.val);return function(e,t,n,r,i,a,o,s,c,u){var l=e;if(i&&(l=e.mix((0,jd.default)("white"),1-i/sm)),n&&(l=e.mix((0,jd.default)("black"),1-n/sm)),a){var h=e.hsl().object(),d=h.h,f=h.s,p=h.l,v=f*a/sm;l=(0,jd.default)({l:p,s:v,h:d})}if(s){var m=e.hsl().object(),g=m.h,y=m.s,b=m.l,k=s/sm*100+y;l=(0,jd.default)({l:b,s:k,h:g})}if(r){var w=e.hsl().object(),S=w.h,x=w.s,C=w.l*r/sm;l=(0,jd.default)({l:C,s:x,h:S})}if(o){var I=e.hsl().object(),P=I.h,M=I.s,T=I.l,A=o/sm*100+T;l=(0,jd.default)({l:A,s:M,h:P})}if(c){var E=e.hsl().object(),O=E.h,R=E.s,N=E.l,L=O*c/sm;l=(0,jd.default)({l:N,s:R,h:L})}if(u){var j=e.hsl().object(),D=j.h,F=j.s,z=j.l,B=u/cm+D;l=(0,jd.default)({l:z,s:F,h:B})}return t&&(l=e.alpha(t/sm)),l}((0,jd.default)("#".concat(Rm(e.val,t))),h,d,p,f,v,g,m,y,b)}function Qm(e,t,n,r,i,a,o,s,c,u){var l=e;if(i&&(l=l.mix((0,jd.default)("white"),1-i.attr.getNumber("val")/sm)),n&&(l=l.mix((0,jd.default)("black"),1-n.attr.getNumber("val")/sm)),a){var h=l.hsl().object(),d=h.h,f=h.s,p=h.l,v=f*a.attr.getNumber("val")/sm;l=(0,jd.default)({l:p,s:v,h:d})}if(s){var m=l.hsl().object(),g=m.h,y=m.s,b=m.l,k=s.attr.getNumber("val")/sm*100+y;l=(0,jd.default)({l:b,s:k,h:g})}if(r){var w=l.hsl().object(),S=w.h,x=w.s,C=w.l*r.attr.getNumber("val")/sm;l=(0,jd.default)({l:C,s:x,h:S})}if(o){var I=l.hsl().object(),P=I.h,M=I.s,T=I.l,A=o.attr.getNumber("val")/sm*100+T;l=(0,jd.default)({l:A,s:M,h:P})}if(c){var E=l.hsl().object(),O=E.h,R=E.s,N=E.l,L=O*c.attr.getNumber("val")/sm;l=(0,jd.default)({l:N,s:R,h:L})}if(u){var j=l.hsl().object(),D=j.h,F=j.s,z=j.l,B=u.attr.getNumber("val")/cm+D;l=(0,jd.default)({l:z,s:F,h:B})}return t&&(l=l.alpha(t.attr.getNumber("val")/sm)),l}var Km=function(){function e(t){I(this,e),this.placeHolderColor=t}return M(e,[{key:"read",value:function(e,t){if(void 0===e)return Hm;switch(e.name){case"a:noFill":return Wm;case"a:solidFill":return Xm(e.childElement(g(Sm,Bm)),t,this.placeHolderColor);case"a:gradFill":return new Ym(e,t,this.placeHolderColor);case"a:blipFill":return void 0!==(e.hasChildElementWithName("a:blip")?e.childElement("a:blip").attr.getStringOptional("r:embed"):void 0)?new Gm(e):Wm;case"a:grpFill":return new _m;case"a:pattFill":default:return Hm}}}]),e}();function Zm(e){return e instanceof Gm||void 0===e?"none":e.rgb().string()}function Jm(e,t){if("none"===e)return e;switch(t){case Vm.None:return"none";case Vm.Norm:return e;case Vm.Darken:return(0,jd.default)(e).darken(.4).rgb().string();case Vm.DarkenLess:return(0,jd.default)(e).darken(.2).rgb().string();case Vm.Lighten:return(0,jd.default)(e).lighten(.4).rgb().string();case Vm.LightenLess:return(0,jd.default)(e).lighten(.2).rgb().string();default:return e}}var $m=new(function(){function e(){I(this,e),this.tasks={slideDidUpdate:!1},this.isLoadFinished=!1}var t;return M(e,[{key:"reset",value:function(e){this.tasks={slideDidUpdate:!1},this.eventHub=e}},{key:"endLoadTask",value:function(e){var t=this;return this.tasks[e]=!0,!!Object.keys(this.tasks).every((function(e){return t.tasks[e]}))&&(this.eventHub.emit("__PresetTransactionReady__"),!0)}},{key:"addLoadTask",value:function(e){this.tasks[e]=!1}},{key:"loadImage",value:(t=l(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:return n=e.sent,r=new FileReader,e.next=7,n.blob();case 7:return i=e.sent,a=new Promise((function(e){r.onload=function(t){var n;e(null==(n=t.target)?void 0:n.result)},r.onerror=function(){e(t)}})),r.readAsDataURL(i),e.next=12,a;case 12:return e.abrupt("return",e.sent);case 15:return e.prev=15,e.t0=e.catch(0),e.abrupt("return",t);case 18:case"end":return e.stop()}}),e,null,[[0,15]])}))),function(e){return t.apply(this,arguments)})}]),e}()),eg=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).imageUrl="",r.state={imageBase64Url:""},r.updateImageUrl(r.props),r}return M(n,[{key:"UNSAFE_componentWillReceiveProps",value:function(e){this.updateImageUrl(e)}},{key:"updateImageUrl",value:function(e){var t=this,n=e.cSld.extraAttr.getStringOptional("backgroundResId"),r=e.cSld.extraAttr.getStringOptional("backgroundImageResourceType");if(n&&r){var i=e.resourceLoader.loadURL(r,n);this.imageUrl!==i&&(this.imageUrl=i,$m.addLoadTask(i),$m.loadImage(i).then((function(e){t.setState({imageBase64Url:e},(function(){$m.endLoadTask(i)}))}),(function(){})))}}},{key:"renderImage",value:function(e,t){var n=this.props.cSld,r=this.state.imageBase64Url,i=n.extraAttr.getStringOptional("backgroundResId"),a=n.extraAttr.getStringOptional("backgroundImageResourceType");if(i&&a){var o=n.extraElementWithName("getBackgroundImageFill");if(void 0===o||void 0===o.childElementOptional("a:blip"))return null;var s=o.childElement("a:blip").childElementOptional("a:alphaModFix"),c=!!o.childElementOptional("a:tile"),u=1;if(s){var l=s.attr.getNumberOptional("amt");l&&(u=um(l))}var h={position:"absolute",left:0,top:0,width:lm(e),height:lm(t),opacity:u,backgroundImage:"url(".concat(r,")"),backgroundSize:c?"auto":"".concat(lm(e)," ").concat(lm(t))};return Ld.default.createElement("div",{style:h})}var d,f=n.extraAttr.getColorOptional("backgroundColor");return d=f instanceof Ym?f.getGradientStyles():Zm(f),f?Ld.default.createElement("div",{style:{position:"absolute",left:0,top:0,width:lm(e),height:lm(t),background:d}}):null}},{key:"render",value:function(){var e=this.props,t=e.slideContext,n=e.slideRef,r=e.className,i=e.children,a={position:"relative",width:lm(t.slideWidth),height:lm(t.slideHeight),overflow:"hidden"};return Ld.default.createElement("div",{id:"ppt-animation-hub",ref:n,className:r,style:a},this.renderImage(t.slideWidth,t.slideHeight),i)}}]),n}(Ld.default.Component),tg=function(){function e(t){I(this,e),this.mapper=t}return M(e,[{key:"map",value:function(e,t,n){return(!this.buffer||this.buffer.source!==e)&&(this.buffer={source:e,target:this.mapper(e,t,void 0,n)}),this.buffer.target}}]),e}();function ng(e){switch(e){case"b":return"flex-end";case"ctr":return"center";default:return"flex-start"}}function rg(e){switch(e){case"l":return"left";case"r":return"right";case"ctr":return"center";case"just":case"dist":return"justify";default:return"left"}}function ig(e){switch(e){case"sng":return"underline";default:return"none"}}function ag(e,t){var n=t.scaleX,r=t.scaleY;return Math.abs(Math.cos(e/180*Math.PI))>=Math.abs(Math.sin(e/180*Math.PI))?{scaleX:n,scaleY:r}:{scaleX:r,scaleY:n}}var og=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"renderAutoNum",value:function(e){var t=this.props,n=t.buIndexCounter,r=t.paragraphXML,i=t.firstRangeXML,a=e.attr.getString("type"),o=e.attr.getNumber("startAt",1);return lg(n.get(r,o,i)+o,a)}},{key:"renderBuChar",value:function(e){return sg(e)}},{key:"render",value:function(){var e=this.props,t=e.buXML,n=e.buIndexCounter;switch(t.name){case"a:buChar":return n.reset(),this.renderBuChar(t.attr.getString("char"));case"a:buAutoNum":return this.renderAutoNum(t);case"a:buNone":case"a:buBlip":return n.reset(),""}return""}}]),n}(xv.default.Component);function sg(e){switch(e){case String.fromCodePoint(159):case" ":case"l":return"";case"":return"";case"":return"";case"n":return"";case"":return"";case"v":return"";case"u":return"";case"&":return"";case"":return"";case"p":return"";default:return e}}function cg(e){var t=e%26;t=0===t?26:t;var n=Math.ceil(e/26);return String.fromCodePoint(t+64).repeat(n)}function ug(e){var t={M:1e3,CM:900,D:500,CD:400,C:100,XC:90,L:50,XL:40,X:10,IX:9,V:5,IV:4,I:1},n="",r=e;for(var i in t)for(;r>=t[i];)n+=i,r-=t[i];return n}function lg(e,t){switch(t){case"alphaLcParenBoth":return"(".concat(cg(e),")");case"alphaLcParenR":return"".concat(cg(e).toLowerCase(),")");case"alphaLcPeriod":return"".concat(cg(e).toLowerCase(),".");case"alphaUcParenBoth":return"(".concat(cg(e),")");case"alphaUcParenR":return"".concat(cg(e),")");case"alphaUcPeriod":return"".concat(cg(e),".");case"arabicParenBoth":return"(".concat(e,")");case"arabicParenR":return"".concat(e,")");case"arabicPeriod":return"".concat(e,".");case"arabicPlain":return"".concat(e);case"ea1JpnChsDbParenBoth":return"(".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),")");case"ea1JpnChsDbParenR":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),")");case"ea1JpnChsDbPeriod":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"),".");case"ea1JpnChsDbPlain":return"".concat(e.toLocaleString("zh-Hans-CN-u-nu-hanidec"));case"circleNumDbPlain":return function(e){return e<=20?String.fromCodePoint(e+9311):e<=35?String.fromCodePoint(e+12860):e<=50?String.fromCodePoint(e+12941):"".concat(e)}(e);case"romanLcParenBoth":return"(".concat(ug(e).toLowerCase(),")");case"romanLcParenR":return"".concat(ug(e).toLowerCase(),")");case"romanLcPeriod":return"".concat(ug(e).toLowerCase(),".");case"romanUcParenBoth":return"(".concat(ug(e),")");case"romanUcParenR":return"".concat(ug(e),")");case"romanUcPeriod":return"".concat(ug(e),".");default:return"".concat(e,".")}}var hg,dg=function(e){y(n,e);var t=k(n);function n(e){return I(this,n),t.call(this,e)}return M(n,[{key:"hasUnderLine",value:function(e){switch(e){case"none":return"none";default:return"underline"}}},{key:"render",value:function(){var e=this.props,t=e.text,n=e.highlightColor,r=e.underLineStyle,i=e.indent,a=e.lineHeight,o=e.isTextWrap,s=e.fontFamily,c=e.isBold,u=e.color,l=e.isItalic,h=e.letterSpacing,d=e.fontSize;return t?Cv.default.createElement("span",{style:{display:"inline-flex",justifyContent:"space-between",backgroundColor:Zm(n),textDecoration:this.hasUnderLine(r),width:"100%"}},Array.from(t).map((function(e,t){return 0===t&&i?Cv.default.createElement("span",{key:"run-text-".concat(t),style:{display:i?"inline-block":"inline",lineHeight:a,whiteSpace:o?"pre-wrap":"pre",fontSize:"".concat(d,"pt"),fontFamily:s,fontWeight:c?500:400,color:Zm(u),fontStyle:l?"italic":"normal",letterSpacing:"".concat(h/100,"pt"),textIndent:i?lm(i):0}},e):Cv.default.createElement("span",{key:"run-text-".concat(t),style:{display:"inline",lineHeight:a,whiteSpace:o?"pre-wrap":"pre",fontSize:"".concat(d,"pt"),fontFamily:s,fontWeight:c?500:400,color:Zm(u),fontStyle:l?"italic":"normal",letterSpacing:"".concat(h/100,"pt")}},e)}))):null}}]),n}(Cv.default.Component),fg=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n),(r=t.call(this,e)).defaultPtSize=18;var i,a=e.rNodeOrBrNode,o=e.lineHeight,s=e.fontScale,c=a.extraAttr.getNumberOptional("sz");return i=void 0===c?r.defaultPtSize:c,r.lineHeight="string"==typeof o?o:"".concat(i*s*1.2*o,"pt"),r.fontSize="".concat(i*s,"pt"),r}return M(n,[{key:"hasUnderLine",value:function(e){switch(e){case"none":return"none";default:return"underline"}}},{key:"renderText",value:function(){var e,t=this.props,n=t.rNodeOrBrNode,r=t.slideIndex,i=t.fontScale,a=t.lineHeight,o=t.indent,s=t.isTextWrap,c=t.runIndex,u=t.align,l=t.lastRunInParagraph,h=n.attr.getStringOptional("type");if(h)switch(h){case"slidenum":e=r;break;default:e=new Date(Date.now()).toLocaleDateString()}var d=n.childElementOptional("a:t");if(void 0===d)return Cv.default.createElement("span",null);var f,p,v,m,g=n.extraAttr.getBoolean("b",!1),y=n.extraAttr.getString("u","none"),b=n.extraAttr.getNumber("spc",0),k=n.extraAttr.getBoolean("i",!1),w=n.extraAttr.getColorOptional("color"),S=n.extraAttr.getNumber("sz",0)*i,x=n.extraAttr.getString("fontType",""),C=n.extraAttr.getColorOptional("highlight",void 0),I=n.childElementOptional("a:rPr");(void 0!==I&&(f=I.attr.getNumberOptional("baseline")),void 0===f)?p=e||d.text:f>0?(v=40,p=Cv.default.createElement("sup",{style:{fontSize:"small",verticalAlign:"".concat(v+f/sm*100,"%")}},e||d.text)):f<0?(v=0,p=Cv.default.createElement("sub",{style:{fontSize:"small",verticalAlign:"".concat(v+f/sm*100,"%")}},e||d.text)):p=e||d.text;if(m="string"==typeof a?a:"".concat(1.2*S*a,"pt"),"dist"===u)return Cv.default.createElement(dg,{fontSize:S,text:"".concat(p),lineHeight:m,indent:o,isTextWrap:s,isBold:g,isItalic:k,underLineStyle:y,fontFamily:x,letterSpacing:b,color:w,highlightColor:C});var P={display:o?"inline-block":"inline",lineHeight:a,whiteSpace:s?"pre-wrap":"pre",backgroundColor:Zm(C),fontSize:"".concat(S,"pt"),textDecoration:this.hasUnderLine(y),fontFamily:x,fontWeight:g?500:400,color:Zm(w),fontStyle:k?"italic":"normal",letterSpacing:"".concat(b/100,"pt"),overflowWrap:"break-word",textIndent:o?lm(o):0};if(!l||"string"!=typeof p&&"number"!=typeof p)return Cv.default.createElement("span",{key:"run-".concat(c),style:P},p);var M="",T=p;if("string"==typeof p)p.length>0&&(T=p.substring(0,p.length-1),M=p.substring(p.length-1));else if("number"==typeof p){var A=p+"";T=A.substring(0,A.length-1),M=A.substring(A.length-1)}return P["--data-last-word-indent"]=o?"".concat(lm(-o)):"0pt",Cv.default.createElement("span",{className:"netless-ppt-last-run","data-last-word":M,key:"run-".concat(c),style:P},T)}},{key:"render",value:function(){var e=this.props,t=e.rNodeOrBrNode,n=e.runIndex,r=e.prevElement;switch(t.name){case"a:fld":case"a:r":return this.renderText();case"a:br":return Cv.default.createElement("span",{key:"br-".concat(n),style:{lineHeight:this.lineHeight,fontSize:this.fontSize}},Cv.default.createElement("br",null));case"a:endParaRPr":return r&&"a:br"===r.name?Cv.default.createElement("span",{key:"endParaRPr-".concat(n),style:{lineHeight:this.lineHeight,display:"inline",fontSize:this.fontSize}},Cv.default.createElement("br",null)):null;default:return null}}}]),n}(Cv.default.Component);function pg(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hg.Horz;switch(e){case hg.MongolianVert:case hg.WordArtVert:return"vertical-lr";case hg.WordArtVertRtl:case hg.EaVert:return"vertical-rl";default:return"horizontal-tb"}}function vg(e,t,n){var r,i,a,o=null!=(r=e.left)?r:0,s=null!=(i=e.right)?i:0,c=0,u=0;(null==(a=e.textBodyWrapResource)?void 0:a.prop)?(c=e.textBodyWrapResource.prop.width*om,u=e.textBodyWrapResource.prop.height*om):(c=e.width,u=e.height);var l=s?s-u/2+c/2:u/2-c/2;if(n===hg.Vert270&&t.paddingTop&&"string"==typeof t.paddingTop){var h=parseFloat(t.paddingTop)*am;Number.isNaN(h)||(l-=h)}return{left:lm(o?o-c/2+u/2:c/2-u/2),top:lm(l),width:lm(u),height:lm(c)}}function mg(e){var t=e.childElement("a:bodyPr").attr.getStringOptional("vert");if(!t){var n=e.parentElementOptional("a:tc");if(n){var r=n.childElementOptional("a:tcPr");r&&(t=r.attr.getStringOptional("vert"))}}return t||hg.Horz}function gg(e){if(void 0===e)return e;if(/^#([A-Fa-f0-9]{8})$/.test(e)){var t=parseInt(e.slice(1,3),16),n=parseInt(e.slice(3,5),16),r=parseInt(e.slice(5,7),16),i=parseInt(e.slice(7,9),16);return 255===i?"rgb(".concat(t,",").concat(n,",").concat(r,")"):"rgba(".concat(t,",").concat(n,",").concat(r,",").concat(i/256,")")}return e}function yg(e){var t,n,r,i=e.run.prop;i.underLine&&(n="underline"),i.strikeThrough&&(n=n?"".concat(n," line-through"):"line-through"),"tab"===e.run.runType&&(r={display:"inline-block",width:e.run.prop.width});var a="'".concat(i.font,"-").concat(e.uuid,"','").concat(i.font,"'"),o=(1-Math.abs(i.baseline))*i.size,s={fontSize:"".concat(o/e.transformScale,"px"),lineHeight:"".concat(i.lineSpacing/e.transformScale,"px")};return rm(rm({color:gg(null==(t=i.fillType)?void 0:t.color),fontFamily:a,fontSize:"".concat(o,"px"),fontStyle:i.italic?"italic":"normal",fontWeight:bg(i),letterSpacing:"".concat(i.kerning||0,"px"),lineHeight:"".concat(i.lineSpacing,"px"),backgroundColor:i.highlightColor,verticalAlign:i.baseline?"".concat(100*i.baseline,"%"):void 0,textDecoration:n},r),s)}function bg(e){return e.fontWeight?e.fontWeight:e.bold?"bold":"normal"}!function(e){e.Horz="horz",e.Vert="vert",e.Vert270="vert270",e.WordArtVert="wordArtVert",e.EaVert="eaVert",e.MongolianVert="mongolianVert",e.WordArtVertRtl="wordArtVertRtl"}(hg||(hg={}));var kg,wg={display:"inline-block",textIndent:0},Sg=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).styles=yg(e),r}return M(n,[{key:"renderSingleTextNodes",value:function(e){return e.split("").map((function(e,t){return Pv.default.createElement("span",{key:t,className:fv.Text,style:wg},e)}))}},{key:"render",value:function(){var e=this.props,t=e.run,n=e.withAnimation,r=t.text||" ",i=r.split("").map((function(e,t){return Pv.default.createElement("span",{key:t,className:fv.Text,style:wg},e)}));return Pv.default.createElement("span",{style:rm({},this.styles)},n?i:r)}}]),n}(Pv.default.Component),xg=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n),(r=t.call(this,e)).horizontalText="",r.needSideWayCharacterList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hg.Horz;switch(e){case hg.EaVert:return["","","","","","","","","","",""];case hg.WordArtVertRtl:case hg.WordArtVert:return["","","","","[","]","{","}","<",">","","","","(",")","",""];default:return[]}}(e.vert),r.needUpRightCharacterList=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hg.Horz;switch(e){case hg.EaVert:return["","","","",""];default:return[]}}(e.vert);var i=yg(e);return r.fontSpanStyle=rm(im(rm({},i),{maxHeight:i.fontSize}),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hg.Horz;return e===hg.WordArtVert||e===hg.WordArtVertRtl?{padding:"0.1em"}:{}}(e.vert)),r}return M(n,[{key:"renderHorizontalNumber",value:function(e,t){if(!this.horizontalText)return null;var n=this.horizontalText,r=this.props,i=r.run,a=r.vert;return this.horizontalText="",i.prop.kumimoji&&a===hg.EaVert?Pv.default.createElement("span",{className:fv.Text,key:t+n,style:rm(im(rm({},e),{writingMode:"horizontal-tb"}),wg)},n):Pv.default.createElement("span",{key:t+n,style:e},Pv.default.createElement("span",{className:fv.Text,style:wg},n))}},{key:"render",value:function(){var e=this,t=this.props,n=t.run,r=t.vert,i="tab"===n.runType?" ":n.text||" ",a=yg(this.props),o=im(rm({},this.fontSpanStyle),{display:"inline-block",verticalAlign:"middle",textIndent:0});return Pv.default.createElement("span",{style:rm({},a)},i&&i.split("").map((function(t,n){return r!==hg.EaVert||Number.isNaN(parseInt(t,10))?e.needSideWayCharacterList.includes(t)?Pv.default.createElement("span",{className:fv.Text,key:n,style:im(rm({},o),{transform:"rotate(90deg)",display:"inline-block"})},t):e.needUpRightCharacterList.includes(t)?Pv.default.createElement("span",{className:fv.Text,key:n,style:im(rm({},o),{transform:"rotate(-90deg)",display:"inline-block"})},t):Pv.default.createElement("span",{className:fv.Text,key:n,style:im(rm({},e.fontSpanStyle),{display:"inline-block"})},t):(e.horizontalText+=t,2===e.horizontalText.length||Number.isNaN(parseInt(i[n+1],10))?e.renderHorizontalNumber(e.fontSpanStyle,n):null)})))}}]),n}(Pv.default.Component),Cg=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"getScaleStyle",value:function(e){var t=e.reduce((function(e,t){return(1-Math.abs(t.prop.baseline))*t.prop.size<(1-Math.abs(e.prop.baseline))*e.prop.size?t:e})),n=(1-Math.abs(t.prop.baseline))*t.prop.size,r={},i=1;return n<12&&(i=n/12,r.transform="scale(".concat(i,")"),r.transformOrigin="0 0",r.lineHeight="1",r.display="block"),{scaleStyle:r,transformScale:i}}},{key:"splitRuns",value:function(e){function t(e){var t=e.codePointAt(0)||0;return t>=65&&t<=122}return(e.text||"").split("").reduce((function(n,r){var i=n[n.length-1];if(void 0===i)return n.push(im(rm({},e),{text:r})),n;var a=i.text||"",o=t(a[a.length-1]),s=t(r);return o&&s?i.text="".concat(a).concat(r):n.push(im(rm({},e),{text:r})),n}),[])}},{key:"render",value:function(){var e=this,t=this.props,n=t.line,r=t.justify,i=t.vert,a=t.lineIndent,o=t.align,s=t.textBodyWrapResource,c=n,u=this.props.uuid,l={};r?(c=n.reduce((function(t,n){var r=e.splitRuns(n),i=t;return i=i.concat(r)}),[]),l={display:"flex",justifyContent:"space-between",width:"calc(100% - ".concat(a||0,"px"),position:"relative",left:a}):l={textIndent:a};var h=c.reduce((function(e,t){return t.prop.lineSpacing>e.prop.lineSpacing?t:e})).prop.lineSpacing,d=0;c.forEach((function(e){d+=Number(e.prop.width)}));var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hg.Horz,t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r={};return e===hg.Horz?r.height="".concat(n,"px"):(r.height="".concat(t,"px"),r.width="".concat(n,"px"),(e===hg.Vert||e===hg.Vert270)&&(r.width="".concat(t,"px"),r.height="".concat(n,"px")),e===hg.WordArtVert||e===hg.WordArtVertRtl?r.margin="0 0.6em":r.whiteSpace="nowrap",(e===hg.EaVert||e===hg.WordArtVertRtl)&&(r.transformOrigin="100% 0")),r}(i,d,h);"dist"===o&&i!==hg.Horz&&(f.height=null==s?void 0:s.prop.height);var p=this.getScaleStyle(c),v=p.scaleStyle,m=p.transformScale,g=im(rm(rm(rm({},l),f),v),{whiteSpace:"pre"}),y=this.props.withAnimation;return i!==hg.Horz?Iv.default.createElement("div",{style:g},c.map((function(e,t){return Iv.default.createElement(xg,{withAnimation:y,transformScale:m,vert:i,uuid:u,key:t,run:e,firstRun:0===t})}))):Iv.default.createElement("div",{style:g},c.map((function(e,t){return Iv.default.createElement(Sg,{withAnimation:y,transformScale:m,uuid:u,key:t,run:e,firstRun:0===t})})))}}]),n}(Iv.default.Component);!function(e){e.r="r",e.l="l",e.crl="ctr",e.dist="dist",e.just="just"}(kg||(kg={}));var Ig=function(e){y(n,e);var t=k(n);function n(e){var r;if(I(this,n),r=t.call(this,e),!e.paragraphXML||!e.bodyPrXML)return w(r);var i=e.bodyPrXML,a=e.paragraphXML;r.runElements=a.elements.filter((function(e){return["a:fld","a:r","a:br","a:endParaRPr"].includes(e.name)})),r.biggestFontSize=p(r.runElements).filter((function(e){return"a:r"===e.name})).map((function(e){return e.extraAttr.getNumber("sz",0)})).sort((function(e,t){return e-t}))[0],r.fontScale=.01;var o=i.childElementOptional("a:normAutofit");if(o&&(r.fontScale=um(o.attr.getNumber("fontScale",sm))/100),r.buChar=a.extraElementWithName("bu"),r.indent=a.extraAttr.getNumber("indent",0),r.marL=a.extraAttr.getNumber("marL",0),r.lineHeightInXml=a.extraAttr.get("lineHeight"),"number"!=typeof r.lineHeightInXml)r.lineHeight="".concat(parseFloat(r.lineHeightInXml)*r.fontScale*100,"pt");else{var s=r.getBigestLineHeight(p(r.runElements),r.lineHeightInXml,r.fontScale);r.lineHeight=void 0===s?void 0:"".concat(s,"pt")}return r.buClr=a.extraAttr.getColorOptional("buClr"),r.noneBuChar=void 0===r.buChar||"a:buNone"===r.buChar.name,r.paddingBottom=r.getPaddingBottom(a.extraAttr.getStringOptional("a:spcAft"),r.biggestFontSize),r.paddingBottom=r.getPaddingTop(a.extraAttr.getStringOptional("a:spcBef"),r.biggestFontSize),r.align=a.extraAttr.getStringOptional("algn"),r}return M(n,[{key:"getPaddingBottom",value:function(e,t){var n=this.props,r=n.isLast,i=n.spcFirstLastPara;return r&&!i?"0pt":this.getPadding(e,t)}},{key:"getPaddingTop",value:function(e,t){var n=this.props,r=n.isFirst,i=n.spcFirstLastPara;return r&&!i?"0pt":this.getPadding(e,t)}},{key:"getPadding",value:function(e,t){if(e){if(-1!==e.indexOf("pt"))return e;if(t)return"".concat(t*parseFloat(e)/100,"pt")}return"0pt"}},{key:"getBigestLineHeight",value:function(e,t,n){var r;return e.forEach((function(e){switch(e.name){case"a:fld":case"a:r":case"a:br":case"a:endParaRPr":var i=1.2*e.extraAttr.getNumber("sz",0)*t*n;(void 0===r||r<i)&&(r=i)}})),r}},{key:"isFlexSpaceBetween",value:function(e,t,n){return e===kg.dist||e===kg.just&&t!==n-1}},{key:"renderWrapParagraph",value:function(e){var t=this.props,n=t.paragraphWrapResource,r=t.bulletInfo,i=t.vert,a=n,o=a.prop,s=o.spaceBefore,c=o.spaceAfter,u=o.firstLineIndent,l=a.prop,h=l.align,d=l.bulletChar,f=l.indent,p=l.marginLeft,v=l.marginRight;if(0===e.length&&a.endParagraphRunProp){var m=a.endParagraphRunProp;s=m.spaceBefore,c=m.spaceAfter}0===r.order&&(s=0),r.order+1===r.count&&(c=0);var g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hg.Horz,t=arguments.length>1?arguments[1]:void 0;return e===hg.WordArtVertRtl?im(rm({},t),{marginTop:t.marginLeft,marginLeft:t.marginBottom,marginRight:t.marginTop}):e===hg.EaVert||e===hg.WordArtVert?im(rm({},t),{marginTop:t.marginLeft,marginLeft:t.marginTop,marginRight:t.marginBottom}):t}(i,{marginLeft:p,marginRight:v,marginTop:s,marginBottom:c}),y=im(rm({textAlign:rg(h),position:"relative",fontSize:"0",lineHeight:"0"},g),{whiteSpace:"pre"});return void 0===u&&(u=Math.max(f,-p),d&&(u=f>=0?f:Math.max(0,-(p+f)))),Vd.default.createElement("div",{className:fv.Paragraph,style:y},d&&this.renderBulletCharNode(e),this.renderLines(e,u,h))}},{key:"renderBulletCharNode",value:function(e){var t,n=this.props,r=n.paragraphWrapResource,i=n.bulletInfo,a=n.vert,o=r.prop,s=o.bulletChar,c=o.indent;if(s){var u=0===e.length,l=i.number,h=e.slice(0,1),d=h[0]&&h[0][0],f=s.colorFollowText&&d?null==(t=d.prop.fillType)?void 0:t.color:s.color,p=s.fontFollowText&&d?d.prop.font:s.font,v=s.sizeFollowText&&d?d.prop.size:s.size,m=d?"".concat(d.prop.lineSpacing,"px"):void 0,g=void 0!==s.autoNumber&&void 0!==s.autoNumberType,y=c>=0?0:c,b="";u||(g&&l&&(b=lg(l,s.autoNumberType)),g||(b+=sg(s.character||"l")));var k={position:"absolute",fontFamily:p,fontSize:v,textIndent:y,color:f,lineHeight:m};return a===hg.EaVert&&(k.textOrientation="sideways"),Vd.default.createElement("div",{style:k},b)}}},{key:"renderLines",value:function(e,t,n){var r=this,i=this.props,a=i.paragraphWrapResource,o=i.uuid,s=i.vert,c=i.withAnimation,u=i.textBodyWrapResource;if(0===e.length){var l,h={},d=a.endParagraphRunProp?a.endParagraphRunProp.lineSpacing:void 0,f=a.endParagraphRunProp?a.endParagraphRunProp.size:void 0;if(f&&f<12){var p=f/12;f=12,d=d?d*p:void 0,l="scale(".concat(p,")"),h.display="inline-block"}return h.lineHeight="".concat(d,"px"),h.fontSize="".concat(f,"px"),h.transform=l,Vd.default.createElement("span",{style:{lineHeight:"".concat(d,"px"),fontSize:"".concat(f,"px"),transform:l}},Vd.default.createElement("br",null))}return e.map((function(i,a){return Vd.default.createElement(Cg,{key:a,withAnimation:c,uuid:o,vert:s,lineIndent:0===a?t:void 0,line:i,align:n,textBodyWrapResource:u,justify:r.isFlexSpaceBetween(n,a,e.length)})}))}},{key:"renderRunOrBrOrEnd",value:function(e,t,n,r,i,a,o,s,c){var u=this.props,l=u.isTextWrap,h=u.slideContext;return Vd.default.createElement(fg,{key:"".concat(t,"-").concat(n),isTextWrap:l,paragraphHasRange:void 0!==s,rNodeOrBrNode:e,fontScale:r,runIndex:n,indent:0===n&&this.noneBuChar&&0!==this.marL?a:void 0,slideIndex:h.slideIndex,prevElement:c,lineHeight:i,align:this.align?this.align:"l",lastRunInParagraph:o})}},{key:"render",value:function(){var e=this,t=this.props,n=t.paragraphXML,r=t.resourceType,i=t.paragraphIndex,a=t.paragraphWrapResource,o=t.firstRangeXML,s=t.buIndexCounter,c=t.isTextWrap,u=null==n?void 0:n.extraAttr.getBoolean("placeHolderType");if("slide"!==r&&u)return Vd.default.createElement("div",{key:"".concat(i)});if(a)return this.renderWrapParagraph(a.lines);if(!n)return null;var l,h=rg(this.align),d=this.runElements.map((function(t,n){var r="left"===h&&n===e.runElements.length-1,a=e.renderRunOrBrOrEnd(t,i,n,e.fontScale,e.lineHeightInXml,e.indent,r,o,l);return l=t,a})),f=0;if(o){if(this.buChar&&"a:buNone"!==this.buChar.name){var p=o.extraAttr.getNumber("sz",0),v=o.extraAttr.getString("fontType","");d.unshift(Vd.default.createElement("span",{key:"bu-".concat(f+=1),style:{display:"inline-block",position:"absolute",color:void 0!==this.buClr?Zm(this.buClr):Zm(o.extraAttr.getColorOptional("color")),fontSize:"".concat(p*this.fontScale,"pt"),lineHeight:this.lineHeight,fontFamily:v,textIndent:lm(this.indent)}},Vd.default.createElement(og,{paragraphXML:n,firstRangeXML:o,buXML:this.buChar,buIndexCounter:s})))}}else{var m=0,g=n.childElementOptional("a:endParaRPr");if(g){var y=g.extraAttr.getNumberOptional("sz");m=void 0===y?0:y}else m=n.extraAttr.getNumber("sz",0);d.push(Vd.default.createElement("span",{key:"end-".concat(f+=1),style:{display:"block",lineHeight:this.lineHeight,fontSize:"".concat(m*this.fontScale,"pt")}},Vd.default.createElement("br",null)))}return this.buChar&&"a:buNone"===this.buChar.name&&s.reset(),Vd.default.createElement("li",{key:"".concat(i),className:"".concat(fv.Paragraph," Paragraph-").concat(i),style:{whiteSpace:c?"normal":"nowrap",paddingTop:this.paddingTop,paddingBottom:this.paddingBottom,marginLeft:lm(n.extraAttr.getNumber("marL",0)),marginRight:lm(n.extraAttr.getNumber("marR",0)),lineHeight:"1pt",listStyleType:"none",textAlign:h}},d)}}]),n}(Vd.default.Component),Pg={"*/":function(e,t,n){return e*t/n},"+-":function(e,t,n){return e+t-n},"+/":function(e,t,n){return(e+t)/n},"?:":function(e,t,n){return e>0?t:n},abs:function(e){return Math.abs(e)},at2:function(e,t){return function(e){return e*(180/Math.PI)*cm}(Math.atan2(t,e))},cat2:function(e,t,n){return e*Math.cos(Math.atan2(n,t))},cos:function(e,t){return e*Math.cos(Mg(t))},max:function(e,t){return e>t?e:t},min:function(e,t){return e<t?e:t},mod:function(e,t,n){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)+Math.pow(n,2))},pin:function(e,t,n){return t<e?e:t>n?n:t},sat2:function(e,t,n){return e*Math.sin(Math.atan2(n,t))},sin:function(e,t){return e*Math.sin(Mg(t))},sqrt:function(e){return Math.sqrt(e)},tan:function(e,t){return e*Math.tan(Mg(t))},val:function(e){return e}};function Mg(e){return e/cm*(Math.PI/180)}var Tg=function(){function e(t){I(this,e),this.expr=t}return M(e,[{key:"standardizationTokenSplit",value:function(e){return e.replace(/\s+/g," ")}},{key:"eval",value:function(e){var t=this.standardizationTokenSplit(this.expr).split(" "),n=t.slice(1,t.length).map((function(t){return Number.isNaN(Number(t))?e.getRequiredVariable(t):parseInt(t,10)}));if(void 0===Pg[t[0]])throw new Error("Formula ".concat(t[0]," not supported"));return Pg[t[0]].apply(Pg,p(n))}}],[{key:"deconstructShapeGuide",value:function(e){var t=s(e.split(" ")),n=t[0],r=t.slice(1).map((function(e){return parseInt(e,10)}));return Pg[n].apply(Pg,p(r))}}]),e}();function Ag(e,t){return Eg.apply(this,arguments)}function Eg(){return(Eg=l(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jg(t,void 0,n,5e3);case 2:if(200===(r=e.sent).status){e.next=8;break}return e.next=6,r.text();case 6:throw i=e.sent,Ng(t,r.status,n,new Error(i)).then((function(){}),(function(){})),new Error("fetch ".concat(t," failed with ").concat(r.status));case 8:return e.next=10,r.text();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Og(e,t){return Rg.apply(this,arguments)}function Rg(){return(Rg=l(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,jg(t,{headers:{"content-type":"application/json",Accept:"application/json"}},n,5e3);case 2:if(200===(r=e.sent).status){e.next=8;break}return e.next=6,r.text();case 6:throw i=e.sent,Ng(t,r.status,n,new Error(i)).then((function(){}),(function(){})),new Error("fetch ".concat(t," failed with ").concat(r.status));case 8:return e.next=10,r.json();case 10:return e.abrupt("return",e.sent);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ng(e,t,n,r){return Lg.apply(this,arguments)}function Lg(){return(Lg=l(regeneratorRuntime.mark((function e(t,n,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window&&window.postMessage({name:"pptDataLoadError",src:t,event:"PPT data load failed",status:n},"*"),null==r||r.error("fetch ".concat(JSON.stringify(t)," failed with ").concat(n," : "),i);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jg(e,t,n,r){return Dg.apply(this,arguments)}function Dg(){return(Dg=l(regeneratorRuntime.mark((function e(t,n,r,i){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=setTimeout((function(){null==r||r.warn("fetch ".concat(t," for ").concat(i,"ms"))}),i),e.prev=1,e.next=4,fetch(t,rm({},n));case 4:return o=e.sent,e.abrupt("return",(clearTimeout(a),o));case 8:throw e.prev=8,e.t0=e.catch(1),clearTimeout(a),null==r||r.error("fetch ".concat(t," with error ").concat(e.t0)),e.t0;case 11:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}var Fg,zg=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"keyval-store",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"keyval";I(this,e),this.storeName=n,this._dbp=new Promise((function(e,r){var i=indexedDB.open(t,1);i.onerror=function(){return r(i.error)},i.onsuccess=function(){return e(i.result)},i.onupgradeneeded=function(){i.result.createObjectStore(n)}}))}return M(e,[{key:"_withIDBStore",value:function(e,t){var n=this;return this._dbp.then((function(r){return new Promise((function(i,a){var o=r.transaction(n.storeName,e);o.oncomplete=function(){return i()},o.onabort=o.onerror=function(){return a(o.error)},t(o.objectStore(n.storeName))}))}))}}]),e}();function Bg(){return Fg||(Fg=new zg),Fg}function Ug(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bg();return n._withIDBStore("readonly",(function(n){t=n.get(e)})).then((function(){return t.result}))}function Vg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bg();return n._withIDBStore("readwrite",(function(n){n.put(t,e)}))}var Wg,Hg=function(){function e(){I(this,e),this.attributePickers={},this.childPickers={}}return M(e,[{key:"createPickers",value:function(){return new Gg(this.attributePickers,this.childPickers)}},{key:"bindAttributePicker",value:function(e,t,n){this.bindPicker(e,t,n,this.attributePickers)}},{key:"bindChildPicker",value:function(e,t,n){this.bindPicker(e,t,n,this.childPickers)}},{key:"bindPicker",value:function(e,t,n,r){"string"==typeof e&&(e=[e]),"string"==typeof t&&(t=[t]);var i,a=A(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.bindPickerWithAttributeNames(o,t,n,r)}}catch(e){a.e(e)}finally{a.f()}}},{key:"bindPickerWithAttributeNames",value:function(e,t,n,r){var i=r[e];if(i||(i=r[e]={}),"object"==T(i)){var a,o=A(t);try{for(o.s();!(a=o.n()).done;){i[a.value]=n}}catch(e){o.e(e)}finally{o.f()}}}}]),e}(),_g=function(){function e(t){I(this,e),this.pickers=t}return M(e,[{key:"forEach",value:function(e,t){var n=this.pickers[e];if(n)for(var r in n)"*"!==r&&t(r)}},{key:"has",value:function(e,t){var n=this.pickers[e];return!!n&&(t in n||"*"in n)}},{key:"get",value:function(e,t,n,r,i,a){var o=this.pickers[t];if(o){var s=o[n];if(s||(s=o["*"]),s)return s(r,e,n,i,a)}}}]),e}(),Gg=function(){function e(t,n){I(this,e),this.attributePickers=new _g(t),this.childPickers=new _g(n)}return M(e,[{key:"forEachAttributes",value:function(e,t){this.attributePickers.forEach(e,t)}},{key:"hasAttribute",value:function(e,t){return this.attributePickers.has(e,t)}},{key:"getAttribute",value:function(e,t,n,r,i){if(this.context)return this.attributePickers.get(this.context,e,t,n,r,i)}},{key:"getChild",value:function(e,t,n,r,i){if(this.context)return this.childPickers.get(this.context,e,t,n,r,i)}}]),e}(),Yg=function(){function e(t){I(this,e),this.resourceScheme=t}var t,n,r,i,a,o;return M(e,[{key:"loadLumiaPSD",value:(o=l(regeneratorRuntime.mark((function t(n,r){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a="https://convertcdn.netless.link/publicFiles/xml/PresetShapeDefinitions.xml",this.resourceScheme&&(a=a.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),!1!==n){t.next=8;break}return t.next=5,Ag(a,r);case 5:i=t.sent,t.next=18;break;case 8:return t.next=10,Ug("PresetShapeDefinitions");case 10:if(i=t.sent,t.t0=void 0===i,!t.t0){t.next=18;break}return t.next=15,Ag(a,r);case 15:return i=t.sent,t.next=18,Vg("PresetShapeDefinitions",i);case 18:e.presetShapeDefinitons=new wm("slide").parse(i).childElement("presetShapeDefinitons");case 19:case"end":return t.stop()}}),t,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"preLoad",value:(a=l(regeneratorRuntime.mark((function e(t,n,r,i){var a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetchAllResourceUrl(n,r,i.logger);case 2:a=e.sent,o=0;case 4:if(!(o<a.length)){e.next=12;break}return s=o+1,c=a[o],e.next=8,this.prefetchPageResource(c);case 8:i.preloadProgress&&i.preloadProgress((s/a.length).toFixed(2));case 9:o++,e.next=4;break;case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,n,r){return a.apply(this,arguments)})},{key:"prefetchPageResource",value:(i=l(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=[],r=0,i=Object.keys(t);r<i.length;r++)a=i[r],n.push(this.prefetchResource(t[a]));return e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"prefetchResource",value:(r=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(Object.keys(t).length>0)){e.next=15;break}n=Object.keys(t),r=[],i=0,a=n;case 3:if(!(i<a.length)){e.next=13;break}if(o=a[i],!(s=t[o]).endsWith(".mp4")){e.next=8;break}return e.abrupt("continue",10);case 8:c=s,this.resourceScheme&&(c=s.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),r.push(this.fetch(c));case 10:i++,e.next=3;break;case 13:return e.next=15,Promise.all(r);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetch",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){var e=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.debug("cache fail",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}())},{key:"fetchAllResourceUrl",value:(n=l(regeneratorRuntime.mark((function e(t,n,r){var i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i=[],a=1;a<=n;a++)i.push(Og("".concat(t,"/resources/resource").concat(a,".json"),r));return e.next=4,Promise.all(i);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"fetchPageResource",value:(t=l(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Og("".concat(t,"/resources/resource").concat(n,".json"),r);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}(),Xg=function(){function e(t){I(this,e),this.foundStartPostion=!1,this.variablesMap=t,this.injectConstant()}return M(e,[{key:"injectConstant",value:function(){this.setVariable("3cd4",162e5),this.setVariable("3cd8",81e5),this.setVariable("5cd8",135e5),this.setVariable("7cd8",189e5),this.setVariable("b",new Tg("val h").eval(this)),this.setVariable("cd2",108e5),this.setVariable("cd4",54e5),this.setVariable("cd8",27e5),this.setVariable("hc",new Tg("*/ w 1.0 2.0").eval(this)),this.setVariable("hd2",new Tg("*/ h 1.0 2.0").eval(this)),this.setVariable("hd3",new Tg("*/ h 1.0 3.0").eval(this)),this.setVariable("hd4",new Tg("*/ h 1.0 4.0").eval(this)),this.setVariable("hd5",new Tg("*/ h 1.0 5.0").eval(this)),this.setVariable("hd6",new Tg("*/ h 1.0 6.0").eval(this)),this.setVariable("hd8",new Tg("*/ h 1.0 8.0").eval(this)),this.setVariable("l",0),this.setVariable("ls",new Tg("max w h").eval(this)),this.setVariable("r",new Tg("val w").eval(this)),this.setVariable("ss",new Tg("min w h").eval(this)),this.setVariable("ssd2",new Tg("*/ ss 1.0 2.0").eval(this)),this.setVariable("ssd4",new Tg("*/ ss 1.0 4.0").eval(this)),this.setVariable("ssd6",new Tg("*/ ss 1.0 6.0").eval(this)),this.setVariable("ssd8",new Tg("*/ ss 1.0 8.0").eval(this)),this.setVariable("ssd16",new Tg("*/ ss 1.0 16.0").eval(this)),this.setVariable("ssd32",new Tg("*/ ss 1.0 32.0").eval(this)),this.setVariable("t",0),this.setVariable("vc",new Tg("*/ h 1.0 2.0").eval(this)),this.setVariable("wd2",new Tg("*/ w 1.0 2.0").eval(this)),this.setVariable("wd3",new Tg("*/ w 1.0 3.0").eval(this)),this.setVariable("wd4",new Tg("*/ w 1.0 4.0").eval(this)),this.setVariable("wd5",new Tg("*/ w 1.0 5.0").eval(this)),this.setVariable("wd6",new Tg("*/ w 1.0 6.0").eval(this)),this.setVariable("wd8",new Tg("*/ w 1.0 8.0").eval(this)),this.setVariable("wd10",new Tg("*/ w 1.0 10.0").eval(this)),this.setVariable("wd12",new Tg("*/ w 1.0 12.0").eval(this)),this.setVariable("wd32",new Tg("*/ w 1.0 32.0").eval(this))}},{key:"getVariable",value:function(e,t){return void 0!==this.variablesMap[e]?this.variablesMap[e]:t}},{key:"getRequiredVariable",value:function(e){if(void 0!==this.variablesMap[e])return this.variablesMap[e];throw new Error("".concat(e," is required"))}},{key:"setVariable",value:function(e,t){this.variablesMap[e]=t}},{key:"setVariableIfNotExist",value:function(e,t){void 0===this.variablesMap[e]&&(this.variablesMap[e]=t)}},{key:"isNumeric",value:function(e){return/^-{0,1}\d+$/.test(e)}},{key:"accessValue",value:function(e){return this.isNumeric(e)?parseInt(e,10):this.getRequiredVariable(e)}},{key:"setLatestPostion",value:function(e,t){this.latestPostionX=e,this.latestPostionY=t,this.foundStartPostion||(this.startPostionX=e,this.startPostionY=t,this.foundStartPostion=!0)}},{key:"getLatestPostion",value:function(){return{x:this.latestPostionX,y:this.latestPostionY}}},{key:"getStartPostion",value:function(){return{x:this.startPostionX,y:this.startPostionY}}},{key:"inspect",value:function(){console.debug(JSON.stringify(this.variablesMap))}}]),e}(),qg=function(){function e(){I(this,e)}return M(e,[{key:"renderLumiaPath",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=e.childElementOptional("".concat(r,"avLst"));i&&i.elementsWithName("".concat(r,"gd")).forEach((function(e){var n=e.attr.getString("fmla"),r=new Tg(n).eval(t),i=e.attr.getString("name");t.setVariableIfNotExist(i,r)}));var a=e.childElementOptional("".concat(r,"gdLst"));a&&a.elementsWithName("".concat(r,"gd")).forEach((function(e){var n=e.attr.getString("fmla"),r=new Tg(n).eval(t),i=e.attr.getString("name");t.setVariable(i,r)}));var o=e.childElementOptional("".concat(r,"rect"));o?(t.setVariable("rectLeft",t.accessValue(o.attr.getString("l"))),t.setVariable("rectTop",t.accessValue(o.attr.getString("t"))),t.setVariable("rectRight",t.accessValue(o.attr.getString("r"))),t.setVariable("rectBottom",t.accessValue(o.attr.getString("b")))):(t.setVariable("rectLeft",t.accessValue("l")),t.setVariable("rectTop",t.accessValue("t")),t.setVariable("rectRight",t.accessValue("r")),t.setVariable("rectBottom",t.accessValue("b")));var s=e.childElement("".concat(r,"pathLst")).elementsWithName("".concat(r,"path")),c=[];return s.forEach((function(e){var i,a={fill:void 0,pathD:"",isBorder:null==(i=e.attr.getBooleanOptional("stroke"))||i};a.fill=e.attr.getStringOptional("fill")||void 0;var o=n.calcPathScale(e,t),s=o.pathWidthScale,u=o.pathHeightScale,l=e.elements.map((function(e){return new Qg(e,r,s,u).generate(t)}));a.pathD=l.join(" "),c.push(a)})),c}},{key:"calcPathScale",value:function(e,t){var n=e.attr.getNumberOptional("w"),r=e.attr.getNumberOptional("h"),i=1,a=1;return n&&(i=t.accessValue("w")/n),r&&(a=t.accessValue("h")/r),{pathWidthScale:i,pathHeightScale:a}}}]),e}(),Qg=function(){function e(t,n,r,i){I(this,e),this.actionXML=t,this.namespace=n,this.pathWidthScale=r,this.pathHeightScale=i}return M(e,[{key:"xUnitTransformAndPathScale",value:function(e){return e*this.pathWidthScale/om}},{key:"yUnitTransformAndPathScale",value:function(e){return e*this.pathHeightScale/om}},{key:"generate",value:function(e){var t=this,n=this.actionXML.elementsWithName("".concat(this.namespace,"pt")).map((function(e){return{x:e.attr.getString("x"),y:e.attr.getString("y")}})).map((function(n){return{x:t.getPtValue(n,e,"x"),y:t.getPtValue(n,e,"y")}})),r=n.length>0?n[0].x:0,i=n.length>0?n[0].y:0,a=n.length>1?n[1].x:0,o=n.length>1?n[1].y:0,s=n.length>2?n[2].x:0,c=n.length>2?n[2].y:0;switch(this.actionXML.name){case"".concat(this.namespace,"moveTo"):return e.setLatestPostion(r,i),["M",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i)].join(" ");case"".concat(this.namespace,"lnTo"):return e.setLatestPostion(r,i),["L",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i)].join(" ");case"".concat(this.namespace,"arcTo"):var u=e.accessValue(this.actionXML.attr.getString("wR")),l=e.accessValue(this.actionXML.attr.getString("hR")),h=e.accessValue(this.actionXML.attr.getString("stAng"))/cm,d=e.accessValue(this.actionXML.attr.getString("swAng"))/cm,f=e.getLatestPostion(),p=f.x,v=f.y,m=this.getSvgArc(u,l,h,d,p,v);return d>=360?(e.setLatestPostion(m.endX,m.endY),["A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.middleX),this.yUnitTransformAndPathScale(m.middleY),"A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.endX),this.yUnitTransformAndPathScale(m.endY)].join(" ")):(e.setLatestPostion(m.endX,m.endY),["A",this.xUnitTransformAndPathScale(m.radiusX),this.yUnitTransformAndPathScale(m.radiusY),m.xAxisRotation,m.largeArcFlag,m.sweepFlag,this.xUnitTransformAndPathScale(m.endX),this.yUnitTransformAndPathScale(m.endY)].join(" "));case"".concat(this.namespace,"cubicBezTo"):return e.setLatestPostion(s,c),["C",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i),this.xUnitTransformAndPathScale(a),this.yUnitTransformAndPathScale(o),this.xUnitTransformAndPathScale(s),this.yUnitTransformAndPathScale(c)].join(" ");case"".concat(this.namespace,"quadBezTo"):return e.setLatestPostion(n[1].x,n[1].y),["Q",this.xUnitTransformAndPathScale(r),this.yUnitTransformAndPathScale(i),this.xUnitTransformAndPathScale(a),this.yUnitTransformAndPathScale(o)].join(" ");case"".concat(this.namespace,"close"):return e.setLatestPostion(e.getStartPostion().x,e.getStartPostion().y),"Z";default:throw new Error("unknow ".concat(this.actionXML.name))}}},{key:"getPtValue",value:function(e,t,n){return t.accessValue(e[n])}},{key:"getSvgArc",value:function(e,t,n,r,i,a){var o,s,c,u,l,h=e,d=t;if(0===r)o=i,s=a,l=0;else if(r>=360)o=i,s=a,c=i+2*e*Math.abs(Math.cos(-n/180*Math.PI)),u=a+2*t*Math.sin(-n/180*Math.PI),l=1;else{var f=-n,p=-(n+r),v=this.getCoordinateOnEllipse(f,h,d),m=i-v.x,g=a+v.y,y=this.getCoordinateOnEllipse(p,h,d);o=y.x+m,s=g-y.y,l=r>=-360&&r<-180?1:r>=-180&&r<0||r>0&&r<180?0:1}return{radiusX:h,radiusY:d,xAxisRotation:0,largeArcFlag:l,sweepFlag:r>0?1:0,endX:o,endY:s,middleX:c,middleY:u}}},{key:"getCoordinateOnEllipse",value:function(e,t,n){var r,i,a=e%360;if(a%180==0)r=Math.cos(a*(Math.PI/180))*t,i=0;else if(a%90==0)r=0,i=Math.sin(a*(Math.PI/180))*n;else{var o=this.getTanDeg(a);r=t*n/Math.sqrt(Math.pow(n,2)+Math.pow(t*o,2)),(a>90&&a<270||a<-90&&a>-270)&&(r=-r),i=o*r}return{x:r,y:i}}},{key:"getTanDeg",value:function(e){var t=e*Math.PI/180;return Math.tan(t)}}]),e}();function Kg(e){return Yg.presetShapeDefinitons.childElementOptional(e)||(console.warn("".concat(e," not include preset shape.")),Yg.presetShapeDefinitons.childElement("rect"))}function Zg(e){switch(e){case"none":return 0;case"triangle":return 1;case"stealth":return 2;case"diamond":return 3;case"oval":return 4;case"arrow":return 5;default:return 0}}!function(e){e[e.none=0]="none",e[e.triangle=1]="triangle",e[e.stealth=2]="stealth",e[e.diamond=3]="diamond",e[e.oval=4]="oval",e[e.arrow=5]="arrow"}(Wg||(Wg={}));var Jg=function(){function e(t){I(this,e),this.logger=t}return M(e,[{key:"createMonitor",value:function(){return new $g(this.logger).ref}}]),e}(),$g=function(){function e(t){var n=this;I(this,e),this.logger=t,this.image=null,this.timer=null,this.beginTimestamp=0,this.ref=function(e){e?n.bindImage(e):n.releaseImage()},this.onLoad=function(){0!==n.beginTimestamp&&(n.beginTimestamp=0,n.clearTimer())},this.onError=function(e){var t,r;0!==n.beginTimestamp&&(n.beginTimestamp=0,n.clearTimer(),r="string"==typeof e?new Error(e):new Error("".concat(e.message)),null==(t=n.logger)||t.error("loading image ".concat(n.getImageUrl()," with error: ").concat(r)))},this.onTimeout=function(){var e;n.beginTimestamp=0,null==(e=n.logger)||e.warn("loading image ".concat(n.getImageUrl()," timeout for ").concat(1e4,"ms"))},this.getImageUrl=function(){var e,t;return n.image&&n.image instanceof SVGImageElement?null==(e=n.image)?void 0:e.href.animVal:null==(t=n.image)?void 0:t.src}}return M(e,[{key:"bindImage",value:function(e){e.onload=this.onLoad,e.onerror=this.onError,this.image=e,this.timer=setTimeout(this.onTimeout,1e4),this.beginTimestamp=Date.now()}},{key:"releaseImage",value:function(){this.image&&(this.image.onload=null,this.image.onerror=null,this.image=null,this.beginTimestamp=0,this.clearTimer())}},{key:"clearTimer",value:function(){null!==this.timer&&clearTimeout(this.timer)}}]),e}(),ey="body";function ty(e,t,n){var r=function(e){var t=!1,n=e.childElementOptional("p:nvSpPr");return n&&n.childElement("p:cNvSpPr").attr.getBooleanOptional("txBox")&&(t=!0),t}(e),i=!0;if("master"===n){var a=ny(e);if(!a)return i=!1,{allShape:[e],masterStyleXML:iy(t),isTextBox:r,hasPlaceHolder:i};var o=a.type||ey;return{placeHolderType:o,masterShape:e,masterStyleXML:ry(o,t,r),allShape:[e],isTextBox:r,hasPlaceHolder:i}}if("layout"===n){var s=ny(e);if(!s)return i=!1,{allShape:[e],masterStyleXML:iy(t),isTextBox:r,hasPlaceHolder:i};var c=ay(s.type||ey),u=t.masterIndex.typeIndex[c],l=[e];return u&&l.push(u),{allShape:l,placeHolderType:c,layoutShape:e,masterShape:u,masterStyleXML:ry(c,t,r),isTextBox:r,hasPlaceHolder:i}}var h,d=ny(e);if(!d)return i=!1,{allShape:[e],masterStyleXML:iy(t),isTextBox:r,hasPlaceHolder:i};if(function(e){return void 0!==e&&void 0!==e.idx&&"4294967295"===e.idx}(d)&&(d.idx="1"),d.idx?(h=t.layoutIndex.idxIndex[d.idx],d.type&&void 0===h&&(h=t.layoutIndex.typeIndex[d.type])):d.type&&(h=t.layoutIndex.typeIndex[d.type]),h){var f=ny(h);if(f){var p=ay(f.type||ey),v=t.masterIndex.typeIndex[p],m=[e];return h&&m.push(h),v&&m.push(v),{allShape:m,placeHolderType:p,layoutShape:h,masterShape:v,masterStyleXML:ry(p,t,r),isTextBox:r,hasPlaceHolder:i}}throw new Error("layout ph not existed.")}var g=ay(d.type||ey),y=t.masterIndex.typeIndex[g],b=[e];return y&&b.push(y),{allShape:b,placeHolderType:g,layoutShape:e,masterShape:y,masterStyleXML:ry(g,t,r),isTextBox:r,hasPlaceHolder:i}}function ny(e){if(e){var t=e.childElementOptional(new Sm("p:nvSpPr","p:nvCxnSpPr"));if(t){var n=t.childElementOptional("p:nvPr","p:ph");if(n){var r=n.attr.getStringOptional("idx"),i=n.attr.getStringOptional("type");return("title"===i||"ctrTitle"===i)&&(r=r||"0"),{idx:r,type:i}}}}}function ry(e,t,n){if(t.masterIndex.txStyle){var r=t.masterIndex.txStyle[e];return r||(r=n?t.masterIndex.txStyle[ey]:t.masterIndex.txStyle.other),r}}function iy(e){return e.main.childElementOptional("p:presentation","p:defaultTextStyle")}function ay(e){switch(e){case"ctrTitle":case"title":return"title";case"dt":return"dt";case"ftr":return"ftr";case"sldNum":return"sldNum";default:return"body"}}var oy=6350;function sy(e){var t="";return"master"===e?t="m":"layout"===e&&(t="l"),t}function cy(e,t,n,r){var i=n.lnStyleXMLDescription;return i||(i=n.lnStyleXMLDescription=Object.freeze(function(e,t,n){var r,i,a=[],o=ty(e,t,n),s=o.allShape,c=o.placeHolderType,u=A(s);try{for(u.s();!(i=u.n()).done;){var l=i.value,h=l.childElementOptional(new Sm("p:spPr","p:grpSpPr"));if(h){var d=h.childElementOptional("a:ln");d&&a.push(d)}var f=l.childElementOptional("p:style");if(f){var p=Um(f,t);p.ln.xml&&a.push(p.ln.xml),r=p.ln.phClr}}}catch(e){u.e(e)}finally{u.f()}return{shapeStyleXMLList:a,placeHolderType:c,placeHolderColor:r}}(e,t,r))),i}function uy(e,t,n,r){var i=n.fillStyleXMLDescription;return i||(i=n.fillStyleXMLDescription=Object.freeze(function(e,t,n){var r,i,a=[],o=ty(e,t,n),s=o.allShape,c=o.placeHolderType,u=A(s);try{for(u.s();!(i=u.n()).done;){var l=i.value,h=l.childElementOptional(new Sm("p:spPr","p:grpSpPr"),g(Sm,zm));h&&a.push(h);var d=l.childElementOptional("p:style");if(d){var f=Um(d,t);f.fill.xml&&a.push(f.fill.xml),r=f.fill.phClr}}}catch(e){u.e(e)}finally{u.f()}return{shapeStyleXMLList:a,placeHolderType:c,placeHolderColor:r}}(e,t,r))),i}var ly,hy=function(e,t,n,r,i){var a,o=A(ty(e,t,i).allShape);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional("p:spPr",n);if(s)return s}}catch(e){o.e(e)}finally{o.f()}},dy=function(e,t,n,r,i){if(e.attr.getBoolean("useBgFill",!1)){var a=e.parentElement("p:cSld");if(a){var o=a.extraAttr.getColorOptional("backgroundColor");if(o)return o}}var s,c=uy(e,t,r,i),u=A(c.shapeStyleXMLList);try{for(u.s();!(s=u.n()).done;){var l=s.value;return new Km(c.placeHolderColor).read(l,t)||void 0}}catch(e){u.e(e)}finally{u.f()}},fy=function(e,t,n,r,i){var a,o=cy(e,t,r,i),s=A(o.shapeStyleXMLList);try{for(s.s();!(a=s.n()).done;){var c=a.value.childElementOptional(g(Sm,zm));if(c){var u=new Km(o.placeHolderColor).read(c,t);if(u)return u}}}catch(e){s.e(e)}finally{s.f()}return Hm},py=function(e,t,n,r,i){var a,o=A(cy(e,t,r,i).shapeStyleXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s&&s.attr.has("w")){var c=s.attr.getNumber("w");return c>oy?c:oy}}}catch(e){o.e(e)}finally{o.f()}return oy},vy=function(e,t,n,r,i){var a,o=A(cy(e,t,r,i).shapeStyleXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional("a:prstDash");if(s&&s.attr.has("val"))return s.attr.getString("val")}}catch(e){o.e(e)}finally{o.f()}return"solid"},my=function(e,t,n,r,i){var a=py(e,t,n,r,i)/am;switch(vy(e,t,n,r,i)){case"solid":return"0";case"dash":return"".concat(5*a);case"dashDot":return" ".concat(5*a,", ").concat(5*a,", ").concat(a,", ").concat(5*a);case"dot":return"".concat(a,",  ").concat(5*a);case"lgDash":return"".concat(2*a,", ").concat(a);case"lgDashDot":return"".concat(10*a,", ").concat(5*a,", ").concat(a,", ").concat(5*a,", ").concat(a,", ").concat(5*a);case"sysDash":return"".concat(5*a,", ").concat(2*a);case"sysDashDot":return"".concat(5*a,", ").concat(2*a,", ").concat(a,", ").concat(5*a);case"sysDashDotDot":return"".concat(5*a,", ").concat(2*a,", ").concat(a,", ").concat(5*a,", ").concat(a,", ").concat(5*a);case"sysDot":return"".concat(2*a,", ").concat(5*a);default:return"0"}},gy=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n),(r=t.call(this,e)).isRender=!1,r.state={dataUrl:""};var i=e.xlinkHref||e.href;return i&&$m.addLoadTask(i),r}return M(n,[{key:"componentDidMount",value:function(){this.isRender=!0,this.loadImage()}},{key:"getSnapshotBeforeUpdate",value:function(e){var t=this.props,n=t.xlinkHref,r=t.href,i=n||r;return!((e.xlinkHref||e.href)===i||!i)&&($m.addLoadTask(i),!0)}},{key:"componentDidUpdate",value:function(e,t,n){n&&this.loadImage()}},{key:"componentWillUnmount",value:function(){this.isRender=!1}},{key:"updateImageState",value:function(e,t){this.isRender&&this.setState({dataUrl:e},t)}},{key:"loadImage",value:function(){var e=this,t=this.props,n=t.xlinkHref,r=t.href,i=n||r;i&&$m.loadImage(i).then((function(t){e.updateImageState(t,(function(){$m.endLoadTask(i)}))})).then((function(){}),(function(){}))}},{key:"render",value:function(){var e=this.state.dataUrl,t=this.props,n=t.innerref,r=t.vertTextType,i=t.width,a=t.height,o=t.x,s=t.y,c=t.opacity,u=t.clipPath,l=t.preserveAspectRatio;if(e){var h={};r&&(h.transform="scale(".concat(i/a,", ").concat(a/i,") rotate(270deg)"),h.transformOrigin="center");var d={xlinkHref:e,href:e,width:lm(i),height:lm(a),opacity:c,clipPath:u,preserveAspectRatio:l,x:o,y:s};return Av.default.createElement("image",im(rm({},d),{style:h,ref:n}))}return null}}]),n}(Av.default.Component),yy=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n),(r=t.call(this,e)).pathElements={},r.imageElement=Tv.default.createRef();var i=e.shapeXML;return r.spId=e.spId,r.graphType="p:sp"===e.shapeXML.name?"shape":"connection",r.prestGeomXML=i.extraElementWithName("a:prstGeom"),r.custGeomXML=i.extraElementWithName("a:custGeom"),r.svgLoadingMonitor=new Jg(e.logger).createMonitor(),r}return M(n,[{key:"getCssVaribleColor",value:function(e){switch(e){case Vm.Darken:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*0.6),var(--sp-fill-a))";case Vm.DarkenLess:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*0.8),var(--sp-fill-a))";case Vm.Lighten:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*1.4),var(--sp-fill-a))";case Vm.LightenLess:return"hsla(var(--sp-fill-h),var(--sp-fill-s),calc(var(--sp-fill-l)*1.2),var(--sp-fill-a))";default:return"hsla(var(--sp-fill-h),var(--sp-fill-s),var(--sp-fill-l),var(--sp-fill-a))"}}},{key:"updateFillColor",value:function(e){var t,n,r,i=this,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=[],s=0;if(e instanceof Ym)o=e.getColors(),s=e.getRotation(),n=e.getGradientPath(),t="url(#".concat(this.identification(),"-gradient-fill)");else if(e instanceof Gm)r=e.getResId();else if(e instanceof _m){var c=this.props.groupFillColor;t=Zm(c)}else t=Zm(e);if(a&&(Object.keys(this.pathElements).forEach((function(e){var n=i.pathElements[e];n&&t&&(void 0!==r?n.setAttribute("fill","none"):n.setAttribute("fill",t))})),this.imageElement.current&&e)){var u=e.getAlphaModFix();this.imageElement.current.setAttribute("opacity",u.toString())}return{path:n,imageResId:r,colorStops:o,rotation:s,fillColor:t}}},{key:"identification",value:function(){var e=this.props,t=e.slideIndex,n=e.spId;return"".concat(t,"-").concat(n,"-")}},{key:"injectAdjustValue",value:function(e,t){var n=e.childElementOptional("a:avLst");n&&n.elementsWithName("a:gd").forEach((function(e){var n=e.attr.getString("fmla"),r=new Tg(n).eval(t),i=e.attr.getString("name");t.setVariable(i,r)}))}},{key:"renderSVG",value:function(e,t,n,r){var i,a=null,o=null,s=this.props,c=s.shapeXML,u=s.width,l=s.height,h=s.fillColor,d=s.resourceLoader,f=s.resourceType,p=s.borderStyle,v=s.vertTextType,m=null==(i=c.childElementOptional("p:nvSpPr","p:cNvSpPr"))?void 0:i.attr.getBooleanOptional("txBox"),g=c.childElementOptional("p:spPr","a:blipFill","a:stretch","a:fillRect"),y=(g?g.attr.getNumber("l",0)/sm:0)*u,b=(g?g.attr.getNumber("b",0)/sm:0)*l,k=(g?g.attr.getNumber("r",0)/sm:0)*u,w=(g?g.attr.getNumber("t",0)/sm:0)*l;if(r){var S=h.getAlphaModFix();m||(a=Tv.default.createElement("clipPath",{id:"clippath-".concat(this.identification())},e));var x=d.loadURL(f,r);o=Tv.default.createElement(gy,{innerref:this.imageElement,xlinkHref:x,vertTextType:v,href:x,width:u-k-y,height:l-b-w,x:lm(y),y:lm(w),opacity:S,clipPath:"url(#clippath-".concat(this.identification(),")"),preserveAspectRatio:"none"})}var C,I,P="connection"===this.graphType&&p.color||"shape"===this.graphType;return C=dm(l)/om<1?"1px":lm(l),I=dm(u)/om<1?"1px":lm(u),P?Tv.default.createElement("svg",{style:{position:"absolute",width:I,height:C,overflow:"visible"}},Tv.default.createElement("defs",null,a,t,Tv.default.createElement("marker",{id:"".concat(this.identification(),"-arrow-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:1.5*n,markerHeight:1.5*n,stroke:Zm(p.color),fill:Zm(p.color),orient:"auto"},Tv.default.createElement("path",{d:"M 1 0 L 10 5 L 1 10 L 0 9 L 7.18 5 L 0 1 Z",fill:Zm(p.color)})),Tv.default.createElement("marker",{id:"".concat(this.identification(),"-arrow-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:1.5*n,markerHeight:1.5*n,stroke:Zm(p.color),fill:Zm(p.color),orient:"auto"},Tv.default.createElement("path",{d:"M 9 0 L 0 5 L 9 10 L 10 9 L 2.82 5 L 10 1 L 9 0 Z",fill:Zm(p.color)})),Tv.default.createElement("marker",{id:"".concat(this.identification(),"-triangle-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Tv.default.createElement("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:Zm(p.color)})),Tv.default.createElement("marker",{id:"".concat(this.identification(),"-triangle-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Tv.default.createElement("path",{d:"M 10 0 L 0 5 L 10 10 z",fill:Zm(p.color)})),Tv.default.createElement("marker",{id:"".concat(this.identification(),"-stealth-end"),viewBox:"0 0 10 10",refX:"10",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Tv.default.createElement("path",{d:"M 0 0 L 10 5 L 0 10 L 3 5 z",fill:Zm(p.color)})),Tv.default.createElement("marker",{id:"".concat(this.identification(),"-stealth-start"),viewBox:"0 0 10 10",refX:"0",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Tv.default.createElement("path",{d:"M 10 0 L 0 5 L 10 10 L 7 5 z",fill:Zm(p.color)})),Tv.default.createElement("marker",{id:"".concat(this.identification(),"-diamond-end"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Tv.default.createElement("path",{d:"M 5 0 L 10 5 L 5 10 L 0 5 z",fill:Zm(p.color)})),Tv.default.createElement("marker",{id:"".concat(this.identification(),"-diamond-start"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Tv.default.createElement("path",{d:"M 5 0 L 10 5 L 5 10 L 0 5 z",fill:Zm(p.color)})),Tv.default.createElement("marker",{id:"".concat(this.identification(),"-oval-end"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Tv.default.createElement("ellipse",{cx:"5",cy:"5",rx:"5",ry:"5",fill:Zm(p.color)})),Tv.default.createElement("marker",{id:"".concat(this.identification(),"-oval-start"),viewBox:"0 0 10 10",refX:"5",refY:"5",markerUnits:"userSpaceOnUse",markerWidth:n,markerHeight:n,orient:"auto"},Tv.default.createElement("ellipse",{cx:"5",cy:"5",rx:"5",ry:"5",fill:Zm(p.color)})),Tv.default.createElement("marker",{id:"".concat(this.identification(),"-none")})),o,e):null}},{key:"render",value:function(){var e,t,n=this;this.pathElements={};var r,i=this.props,a=i.width,o=i.height,s=i.shapeXML,c=i.fillColor,u=i.borderStyle,l=i.children,h=new Xg({w:a,h:o}),d="";if(this.prestGeomXML){var f=this.prestGeomXML.attr.getString("prst");this.injectAdjustValue(this.prestGeomXML,h),r=Kg(f)}else this.custGeomXML?(r=this.custGeomXML,d="a:"):r=Kg("rect");var p=Wg.none,v=Wg.none,m=s.childElementOptional("p:spPr","a:ln","a:headEnd"),g=s.childElementOptional("p:spPr","a:ln","a:tailEnd"),y=(null==(e=null==m?void 0:m.parent)?void 0:e.attr.getNumber("w",oy))||(null==(t=null==g?void 0:g.parent)?void 0:t.attr.getNumber("w",oy))||oy,b=Math.max(y/om*3,10);if(m){var k=m.attr.getString("type","none");p=Zg(k)}if(g){var w=g.attr.getString("type","none");v=Zg(w)}var S=this.updateFillColor(c,!1),x=S.fillColor,C=S.colorStops,I=S.imageResId,P=S.path,M=null;C.length>0&&(M=P?Tv.default.createElement("radialGradient",{id:"".concat(this.identification(),"-gradient-fill")},C.map((function(e,t){return Tv.default.createElement("stop",{key:"index-".concat(t),offset:e.stop,stopColor:Zm(e.color)})}))):Tv.default.createElement("linearGradient",{id:"".concat(this.identification(),"-gradient-fill")},C.map((function(e,t){return Tv.default.createElement("stop",{key:"index-".concat(t),offset:e.stop,stopColor:Zm(e.color)})}))));var T=(new qg).renderLumiaPath(r,h,d).map((function(e,t){var r="none"!==e.fill?x:"none",i=e.isBorder?Zm(u.color):"none";0===C.length&&(x&&e.fill&&(r=Jm(x,e.fill)),!s.childElementOptional("p:spPr","a:ln","a:solidFill")&&"none"!==x&&(i=Jm(i,Vm.Darken)));var c={};return"none"!==e.fill&&0===C.length&&(c.fill=n.getCssVaribleColor(e.fill)),Tv.default.createElement("path",{ref:function(e){n.pathElements[t.toString()]=e},key:"path".concat(t),d:e.pathD,style:c,fill:I?"none":r,height:lm(o),width:lm(a),stroke:i,strokeWidth:lm(u.width),strokeDasharray:u.strokeDashArray,markerStart:"url(#".concat(n.identification(),"-").concat(Wg[p],"-start)"),markerEnd:"url(#".concat(n.identification(),"-").concat(Wg[v],"-end)")})})),A=h.accessValue("rectLeft"),E=h.accessValue("rectTop"),O=h.accessValue("rectRight")-h.accessValue("rectLeft"),R=h.accessValue("rectBottom")-h.accessValue("rectTop"),N=Tv.default.Children.map(l,(function(e){return Tv.default.cloneElement(e,{left:A,right:E,width:O,height:R})}));return Tv.default.createElement(Tv.default.Fragment,null,N,this.renderSVG(T,M,b,I))}}]),n}(Tv.default.Component),by=["textPlain"];!function(e){e.textNoShape="textNoShape",e.textPlain="textPlain",e.textRingInside="textRingInside",e.textRingOutside="textRingOutside"}(ly||(ly={}));var ky=function(e){y(n,e);var t=k(n);function n(e){var r,i;I(this,n),(r=t.call(this,e)).contentWidth=0,r.fontRowCount=0;var a=e.textBodyWrapResource;r.gbDataList=e.shapeGuideList.map((function(e){return o({},e.attr.getString("name"),e.attr.getString("fmla"))})),r.textContent=null==(i=e.textBodyWrapResource.paragraphs[0].runs)?void 0:i.map((function(e){return e.text})).join(""),r.height=fm(a.prop.height),r.width=fm(a.prop.width);var s=0;return a.paragraphs.forEach((function(e){r.fontRowCount+=e.lines.length,e.lines.forEach((function(e){var t=0;e.forEach((function(e){t+=parseInt(e.prop.width,10),s||(s=e.prop.lineSpacing),r.fontSize||(r.fontSize=fm(e.prop.size))})),r.contentWidth=Math.max(r.contentWidth,t)}))})),r.contentHeight=pm((r.fontRowCount-1)*s+r.fontSize||r.fontSize),r}return M(n,[{key:"textNoShape",value:function(){var e=this,t={display:"flex",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"50%, 0",height:"".concat(this.height,"pt"),width:"".concat(this.width,"pt"),justifyContent:"center",alignItems:"center"},n=this.height,r=this.width,i=this.contentWidth,a=this.contentHeight,o=Number.isNaN(r/i)?1:pm(r/i),s=Number.isNaN(n/a)?1:pm(n/a),c={margin:0,padding:0,fontSize:"".concat(this.fontSize,"pt"),lineHeight:"".concat(this.fontSize,"pt"),height:"".concat(this.fontSize,"pt"),width:"".concat(this.fontSize,"pt"),display:"inline-block"},u=this.props.textBodyWrapResource;return Mv.default.createElement("div",{style:t},Mv.default.createElement("div",{ref:function(t){e.spanRef=t},style:{whiteSpace:"initial",transform:"scaleX(".concat(o,") scaleY(").concat(s,")")}},u.paragraphs.map((function(e,t){var n;return Mv.default.createElement("span",{key:t,style:{whiteSpace:"initial"}},null==(n=e.lines)?void 0:n.map((function(e,t){return Mv.default.createElement(Mv.default.Fragment,null,e.map((function(e){var n;return null==(n=e.text)?void 0:n.split("").map((function(e,n){return Mv.default.createElement("pre",{style:c,key:"".concat(t,"-").concat(n)},e)}))})),Mv.default.createElement("br",null))})))}))))}},{key:"textRing",value:function(e){var t,n,r,i=this,a=Math.atan(this.height/this.width),o=180*a/Math.PI,s=6e4;(null==(t=this.gbDataList[0])?void 0:t.adj)&&(s=Tg.deconstructShapeGuide(this.gbDataList[0].adj));var c=200,u=100,l=(1-um(s)*u)/this.fontSize;if(!(null==(n=this.textContent)?void 0:n.length))return this.textNoShape();var h=this.textContent.length;return Mv.default.createElement("div",{style:{display:"inline-block",position:"relative",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"50%, 0",height:"".concat(u,"pt"),width:"".concat(c,"pt"),transform:"scale(".concat(this.width/c,", ").concat(this.height/u/(Math.cos(a/180)*Math.PI),")")}},Mv.default.createElement("div",{style:{transformStyle:"preserve-3d",height:"".concat(u,"pt"),width:"".concat(c,"pt"),transform:"rotateX(".concat(-o,"deg)")}},null==(r=this.textContent)?void 0:r.split("").map((function(t,n){return Mv.default.createElement("span",{style:{position:"absolute",lineHeight:"".concat(i.fontSize,"pt"),left:"".concat(100-i.fontSize/2,"pt"),top:"".concat((u-i.fontSize)/2,"pt"),transform:e(n,h,l)},key:n},t)}))))}},{key:"textRingInside",value:function(){return this.textRing((function(e,t,n){return"rotateY(".concat(70-340/t*e,"deg) translateZ(").concat(-100,"pt) scaleY(").concat(n,")")}))}},{key:"textRingOutside",value:function(){return this.textRing((function(e,t,n){return"rotateY(".concat(320*e/(t-1)-60,"deg) translateZ(",100,"pt) scaleY(").concat(n,")")}))}},{key:"textPlain",value:function(){var e=this,t=this.gbDataList[0]?Tg.deconstructShapeGuide(this.gbDataList[0].adj):5e4,n=this.width,r=this.height,i=um(t),a=i>.5?(2*i-1)*n:(1-2*i)*n,o=Math.atan(a/r),s=180*o/Math.PI;i<.5&&(s=-s);var c={display:"flex",fontSize:"".concat(this.fontSize,"pt"),transformOrigin:"0, 0",height:"".concat(r,"pt"),width:"".concat(n,"pt"),justifyContent:"center",alignItems:"center"},u={display:"block",lineHeight:"".concat(this.fontSize,"pt"),textAlign:"center"},l={display:"inline-block",fontSize:"".concat(this.fontSize,"pt"),lineHeight:"".concat(this.fontSize,"pt"),height:"".concat(this.fontSize,"pt"),transformOrigin:"50% 0",margin:0,padding:"0"},h=this.contentWidth,d=this.contentHeight,f=Number.isNaN(n/h)?1:pm(n)/(h+Math.tan(o)*pm(r)),p=Number.isNaN(r/d)?1:pm(r/d),v=0,m=this.props.textBodyWrapResource;return Mv.default.createElement("div",{style:rm({},c)},Mv.default.createElement("div",{ref:function(t){e.spanRef=t},style:im(rm({},u),{whiteSpace:"initial",transform:"skew(".concat(s,"deg) scaleY(").concat(p,") scaleX(").concat(f,")")})},m.paragraphs.map((function(t,n){var r;return Mv.default.createElement("div",{key:"wordart-".concat(n),style:im(rm({},u),{whiteSpace:"initial"})},null==(r=t.lines)?void 0:r.map((function(n,r){var i=1===e.fontRowCount?e.fontSize:n[0].prop.lineSpacing,a={};return(0===v||v===e.fontRowCount-1)&&(i=(i+e.fontSize)/2,a.display="flex",v===e.fontRowCount-1&&(a.alignItems="flex-end")),"l"===t.prop.align||"just"===t.prop.align?a.justifyContent="flex-start":"r"===t.prop.align?a.justifyContent="flex-end":"dist"===t.prop.align?a.justifyContent="space-between":"ctr"===t.prop.align&&(a.justifyContent="center"),v+=1,Mv.default.createElement("div",{key:n[0].text+r.toString(),style:rm({whiteSpace:"nowrap",lineHeight:"".concat(i,"pt")},a)},n.map((function(e){var t;return null==(t=e.text)?void 0:t.split("").map((function(t,n){return Mv.default.createElement("pre",{style:im(rm({},l),{fontFamily:e.prop.font}),key:n},t)}))})),Mv.default.createElement("br",null))})))}))))}},{key:"render",value:function(){var e=this.props.presetType;return this[e]?this[e]():this.textNoShape()}}]),n}(Mv.default.Component),wy=function(){function e(){I(this,e),this.indexByLevel=new Map,this.startAtByLevel=new Map}return M(e,[{key:"get",value:function(e,t,n){var r=e.extraAttr.getNumber("level");if(this.indexByLevel.has(r)||(this.indexByLevel.set(r,0),this.startAtByLevel.set(r,-1)),t!==this.startAtByLevel.get(r))this.indexByLevel.set(r,0),this.startAtByLevel.set(r,t);else{var i=this.indexByLevel.get(r);n&&(i+=1,this.indexByLevel.set(r,i))}return this.indexByLevel.get(r)}},{key:"reset",value:function(){this.indexByLevel=new Map,this.startAtByLevel=new Map}}]),e}(),Sy=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n),(r=t.call(this,e)).buIndexCounter=new wy,r.paragraphBulletInfo=[],r.numCol=1;var i=r.props,a=i.txBodyXML,o=i.textBodyWrapResource,s=i.flipH,c=i.flipV,u=i.insideTable,l=i.totalPadding,h=i.height,d=i.width,f=i.right,p=i.left;r.bodyPrXML=a.childElement("a:bodyPr"),r.paragraphXMLs=a.elementsWithName("a:p");var v=r.bodyPrXML.childElementOptional("a:prstTxWarp");v&&(r.presetType=v.attr.getString("prst","textNoShape"));var m=r.bodyPrXML.extraAttr.getString("anchor","t"),g=r.bodyPrXML.extraAttr.getString("wrap","square");r.isTextWrap="square"===g,r.spcFirstLastPara=r.bodyPrXML.extraAttr.getBoolean("spcFirstLastPara",!1),r.anchorCtr=r.bodyPrXML.extraAttr.getBoolean("anchorCtr",!1),r.numCol=r.bodyPrXML.extraAttr.getNumber("numCol",1);var y,b=0,k=0;if(o){var w=o.prop;r.vert=w.vert,r.paddingLeft=w.lIns*om,r.paddingRight=w.rIns*om,b=w.tIns*om,k=w.bIns*om}else r.vert=mg(a),r.paddingLeft=r.bodyPrXML.extraAttr.getNumber("lIns",91440),r.paddingRight=r.bodyPrXML.extraAttr.getNumber("rIns",91440),b=r.bodyPrXML.extraAttr.getNumber("tIns",45720),k=r.bodyPrXML.extraAttr.getNumber("bIns",45720);return s!==c&&(y="scale(-1, 1)"),r.rectStyle=u?{position:"relative",left:0,top:0,width:lm(d),paddingTop:lm(b-l/2),paddingBottom:lm(k-l/2),height:"calc(100% - ".concat(lm(l),")"),transform:y}:{position:"absolute",left:lm(void 0===p?0:p),top:lm(void 0===f?0:f),width:lm(d),height:lm(h),transform:y},r.rectStyle=rm({display:"inline-flex",flexDirection:"column",alignItems:r.anchorCtr?"center":"flex-start",justifyContent:ng(m),zIndex:9999,paddingLeft:lm(r.paddingLeft),paddingTop:lm(b),paddingRight:lm(r.paddingRight),paddingBottom:lm(k),boxSizing:"border-box",whiteSpace:r.isTextWrap?"normal":"nowrap"},r.rectStyle),r.updateRectStyleByWrapResource(),r.generateParagraphBulletInfo(),r}return M(n,[{key:"updateRectStyleByWrapResource",value:function(){var e=this.props.textBodyWrapResource;if(void 0!==e){var t=e.prop.anchor;this.rectStyle=im(rm({},this.rectStyle),{justifyContent:ng(t)}),this.rectStyle=function(){var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hg.Horz,r=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0;switch(n){case hg.EaVert:return im(rm({},r),{writingMode:pg(n)});case hg.WordArtVert:case hg.WordArtVertRtl:return im(rm({},r),{writingMode:pg(n),textOrientation:"upright"});case hg.Vert:var a=vg(i,r,n),o=null!=(e=r.transform)?e:"";return im(rm(rm({},r),a),{position:"absolute",minHeight:i.insideTable?void 0:a.height,paddingLeft:r.paddingBottom,paddingTop:r.paddingLeft,paddingRight:r.paddingTop,paddingBottom:r.paddingRight,transform:"".concat(o," rotate(90deg)")});case hg.Vert270:var s=vg(i,r,n),c=null!=(t=r.transform)?t:"";return im(rm(rm({},r),s),{position:"absolute",minHeight:i.insideTable?void 0:s.height,paddingLeft:r.paddingTop,paddingTop:r.paddingRight,paddingRight:r.paddingBottom,paddingBottom:r.paddingLeft,transform:"".concat(c," rotate(-90deg)")});default:return r}}(this.vert,this.rectStyle,this.props)}}},{key:"generateParagraphBulletInfo",value:function(){var e=this.props.textBodyWrapResource;if(void 0!==e){var t=e.paragraphs.map((function(e){var t,n;return{autoNumber:null==(t=e.prop.bulletChar)?void 0:t.autoNumber,autoNumberType:null==(n=e.prop.bulletChar)?void 0:n.autoNumberType,level:e.prop.level,empty:0===e.lines.length}})),n=[0,0,0,0,0,0,0,0,0];this.paragraphBulletInfo=t.map((function(e,r){var i=e.level,a=e.autoNumberType;if(n=n.map((function(e,t){return t>i?0:t===i?a?e:0:e})),a){var o=e.autoNumber;if(r>0&&t[r-1].autoNumber!==o&&(n[i]=0),e.empty)return{order:r,count:t.length};var s=n[i];return n[i]=s+1,{number:s+(o||1),order:r,count:t.length}}return{order:r,count:t.length}}))}}},{key:"renderParagraph",value:function(e,t,n,r,i,a,o,s){var c=null==e?void 0:e.elements.find((function(e){return"a:r"===e.name})),u=this.props,l=u.slideContext,h=u.width,d=u.height,f=u.uuid,p=u.resourceType,v=u.withAnimation,m=u.textBodyWrapResource;return Ud.default.createElement(Ig,{key:"".concat(n),slideContext:l,isTextWrap:o,width:h,height:d,paragraphIndex:n,firstRangeXML:c,buIndexCounter:this.buIndexCounter,paragraphXML:e,bodyPrXML:t,uuid:f,round:0,spcFirstLastPara:r,isFirst:i,isLast:a,vert:this.vert,resourceType:p,paragraphWrapResource:s,textBodyWrapResource:m,withAnimation:!!v,bulletInfo:this.paragraphBulletInfo[n]})}},{key:"render",value:function(){var e=this,t=this.props,n=t.textBodyWrapResource,r=t.width;if(this.presetType&&this.presetType!==ly.textNoShape&&by.includes(this.presetType)&&n){var i=this.bodyPrXML.childElementOptional("a:prstTxWarp"),a=null==i?void 0:i.childElementOptional("a:avLst"),o=(null==a?void 0:a.elementsWithName("a:gd"))||[];return Ud.default.createElement("div",{style:im(rm({},this.rectStyle),{display:"flex",justifyContent:"center",alignItems:"center",padding:0}),className:"txBody"},Ud.default.createElement(ky,{presetType:this.presetType,shapeGuideList:o,textBodyWrapResource:n}))}var s,c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hg.Horz;return e!==hg.Horz?{maxHeight:"100%",width:void 0}:{}}(this.vert);return s=n?n.paragraphs.map((function(t,r){return e.renderParagraph(void 0,void 0,r,e.spcFirstLastPara,0===r,r===n.paragraphs.length-1,e.isTextWrap,t)})):this.paragraphXMLs.map((function(t,n){return e.renderParagraph(t,e.bodyPrXML,n,e.spcFirstLastPara,0===n,n===e.paragraphXMLs.length-1,e.isTextWrap)})),this.buIndexCounter.reset(),Ud.default.createElement("div",{className:"txBoby",style:this.rectStyle},Ud.default.createElement("ol",{style:rm({width:lm(r-this.paddingLeft-this.paddingRight),marginBlockEnd:0,marginBlockStart:0,paddingBlockStart:0,paddingBlockEnd:0,marginInlineEnd:0,marginInlineStart:0,paddingInlineStart:0,paddingInlineEnd:0,margin:0,padding:0,whiteSpace:this.isTextWrap?"normal":"nowrap",columnCount:1===this.numCol?void 0:this.numCol},c)},s))}}]),n}(Ud.default.Component),xy=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"renderCol",value:function(e,t,n,r,i,a){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,c=function(){var e;return(e=[]).concat.apply(e,arguments).reduce((function(e,t){return e+t}),0)},u=e.childElementOptional("a:tcPr");if(!u)return null;var l,h=u.extraAttr.getColor("".concat(t,"-").concat(n,"-fillColor"),Hm);l=h instanceof Ym?h.getGradientStyles():Zm(h);var d=u.extraAttr.getStringOptional("".concat(t,"-").concat(n,"-fontFamily")),f=u.extraAttr.getBoolean("".concat(t,"-").concat(n,"-isBold"),!1),p=u.extraAttr.getBoolean("".concat(t,"-").concat(n,"-isItalic"),!1),v=u.extraAttr.getString("".concat(t,"-").concat(n,"-bottomBorderStyle"),"none"),m=u.extraAttr.getNumber("".concat(t,"-").concat(n,"-bottomBorderWidth"),0),g=u.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-bottomBorderColor"),Hm),y=u.extraAttr.getString("".concat(t,"-").concat(n,"-topBorderStyle"),"none"),b=u.extraAttr.getNumber("".concat(t,"-").concat(n,"-topBorderWidth"),0),k=u.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-topBorderColor"),Hm),w=u.extraAttr.getString("".concat(t,"-").concat(n,"-leftBorderStyle"),"none"),S=u.extraAttr.getNumber("".concat(t,"-").concat(n,"-leftBorderWidth"),0),x=u.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-leftBorderColor"),Hm),C=u.extraAttr.getString("".concat(t,"-").concat(n,"-rightBorderStyle"),"none"),I=u.extraAttr.getNumber("".concat(t,"-").concat(n,"-rightBorderWidth"),0),P=u.extraAttr.getColorOptional("".concat(t,"-").concat(n,"-rightBorderColor"),Hm),M=e.childElementOptional("a:txBody");if(void 0===M)return null;var T=e.attr.getNumber("gridSpan",1),A=e.attr.getNumber("rowSpan",1),E=e.attr.getBoolean("hMerge",!1),O=e.attr.getBoolean("vMerge",!1),R=c(a.slice(n,n+T)),N="".concat(t,"-").concat(n),L=this.props,j=L.slideContext,D=L.uuid,F=L.shapeWrapResource;return E||O?null:Bd.default.createElement("td",{colSpan:T,rowSpan:A,style:{position:"relative",fontFamily:d&&d,fontWeight:f?500:400,fontStyle:p?"italic":"normal",borderBottomStyle:v,borderTopStyle:y,borderLeftStyle:w,borderRightStyle:C,borderBottomWidth:lm(m),borderTopWidth:lm(b),borderLeftWidth:lm(S),borderRightWidth:lm(I),borderBottomColor:Zm(g),borderTopColor:Zm(k),borderLeftColor:Zm(x),borderRightColor:Zm(P),width:lm(R),height:lm(i),background:l,boxSizing:"border-box",fontSize:0,lineHeight:0},key:"tc-".concat(t,"-").concat(n),className:"tc-".concat(t,"-").concat(n)},Bd.default.createElement(Sy,{slideContext:j,insideTable:!0,width:R,height:i,totalPadding:s,uuid:D,txBodyXML:M,resourceType:"slide",textBodyWrapResource:null==(o=null==F?void 0:F.textBodyMap)?void 0:o[N]}))}},{key:"render",value:function(){var e=this,t=this.props.graphXML.childElementOptional("a:graphic","a:graphicData","a:tbl"),n=t&&t.childElement("a:tblGrid"),r=n?n.elementsWithName("a:gridCol"):[],i=t?t.elementsWithName("a:tr"):[],a=i.length,o=0;if(a>0){var s=0;i.forEach((function(e,t){if(0===t){var n=0;e.elementsWithName("a:tc").forEach((function(e,r){var i=e.childElement("a:tcPr").extraAttr.getNumber("".concat(t,"-").concat(r,"-topBorderWidth"),0);n=Math.max(i,n)})),s+=n}var r=0;e.elementsWithName("a:tc").forEach((function(e,n){var i=e.childElement("a:tcPr").extraAttr.getNumber("".concat(t,"-").concat(n,"-bottomBorderWidth"),0);r=Math.max(i,r)})),s+=r})),o=s/a}var c=i.map((function(t,n){var i=t.attr.getNumber("h"),a=t.elementsWithName("a:tc").map((function(e,t){return r[t].attr.getNumber("w")})),s=t.elementsWithName("a:tc").map((function(t,s){var c=r[s].attr.getNumber("w");return e.renderCol(t,n,s,c,i,a,o)}));return Bd.default.createElement("tr",{key:"tr-"+n},s)}));return Bd.default.createElement("table",{style:{borderCollapse:"collapse"},cellSpacing:"0",cellPadding:"0"},Bd.default.createElement("tbody",null,c))}}]),n}(Bd.default.Component),Cy=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).url=r.getUrl(),r.imageLoadingMonitor=new Jg(e.logger).createMonitor(),r}return M(n,[{key:"getId",value:function(){var e=this.props.graphXML,t=e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getStringOptional("id");return t?"spId".concat(t):e.parent&&"mc:Choice"===e.parent.name?this.getResId():void 0}},{key:"getResId",value:function(){var e,t=null==(e=this.props.graphXML.parent)?void 0:e.parent;if(t){var n=t.childElementOptional("mc:Fallback","p:pic","p:blipFill","a:blip");return n?n.attr.getStringOptional("r:embed"):void 0}}},{key:"getUrl",value:function(){var e=this.props,t=e.slideContext,n=e.resourceType,r=this.getId();return r?t.resourceLoader.loadURL(n,r):void 0}},{key:"render",value:function(){if(!this.url)return null;var e=this.props,t=e.width,n=e.height;return Ev.default.createElement("img",{src:this.url,alt:"graph",style:{width:lm(t),height:lm(n)},ref:this.imageLoadingMonitor})}}]),n}(Ev.default.Component),Iy=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).url=r.getUrl(),r.imageLoadingMonitor=new Jg(e.logger).createMonitor(),r}return M(n,[{key:"getId",value:function(){return this.props.graphXML.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getString("id")}},{key:"getUrl",value:function(){var e=this.props,t=e.slideContext,n=e.resourceType,r=this.getId();return t.resourceLoader.loadURL(n,"spId".concat(r))}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height;return Ov.default.createElement("img",{src:this.url,alt:"diagram",style:{width:lm(t),height:lm(n)},ref:this.imageLoadingMonitor})}}]),n}(Ov.default.Component),Py=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"render",value:function(){return Rv.default.createElement("div",null)}}]),n}(Rv.default.PureComponent),My=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).url=r.getUrl(),r.imageLoadingMonitor=new Jg(e.logger).createMonitor(),r}return M(n,[{key:"getId",value:function(){return this.props.graphXML.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getString("id")}},{key:"getUrl",value:function(){var e=this.props,t=e.slideContext,n=e.resourceType,r=this.getId();return t.resourceLoader.loadURL(n,"spId".concat(r))}},{key:"render",value:function(){if(this.url){var e=this.props,t=e.width,n=e.height;return Nv.default.createElement("img",{src:this.url,alt:"oleGraph",style:{width:lm(t),height:lm(n)},ref:this.imageLoadingMonitor})}return Nv.default.createElement("div",null)}}]),n}(Nv.default.Component),Ty=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n);var i=(r=t.call(this,e)).props.graphXML;return r.uri=i.childElement("a:graphic","a:graphicData").attr.getStringOptional("uri"),r}return M(n,[{key:"subGraphClassWithURI",value:function(e){switch(e){case"http://schemas.openxmlformats.org/drawingml/2006/table":return xy;case"http://schemas.microsoft.com/office/drawing/2014/chartex":case"http://schemas.openxmlformats.org/drawingml/2006/chart":return Cy;case"http://schemas.openxmlformats.org/drawingml/2006/diagram":return Iy;case"http://schemas.openxmlformats.org/presentationml/2006/ole":return My;default:return console.debug("Unsupported graph",e),Py}}},{key:"render",value:function(){var e,t,n=this.props,r=n.shapeGroupTransform,i=n.width,a=n.height,o=this.subGraphClassWithURI(this.uri);r?(e=i*r.scaleX,t=a*r.scaleY):(e=i,t=a);var s=im(rm({},this.props),{height:t,width:e});return zd.default.createElement(o,rm({},s))}}]),n}(zd.default.Component),Ay=function(e){var t=e.startTime,n=e.endTime,r=e.duration;return t&&(r-=t),n&&(r-=n),r},Ey=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).state={total:Ay(e)},r}return M(n,[{key:"componentDidMount",value:function(){var e=this.props.protalId;this.controllerPortal=document.getElementById(e)}},{key:"onPlayClick",value:function(e){var t=this.props.onPlayClick;e.stopPropagation(),t()}},{key:"onPauseClick",value:function(e){var t=this.props.onPauseClick;e.stopPropagation(),t()}},{key:"onBarClick",value:function(e){var t=this.props,n=t.duration,r=t.startTime,i=t.endTime,a=t.onSeekClick;if(e.stopPropagation(),n){var o=this.props.duration;r&&(o-=r),i&&(o-=i);var s=e.nativeEvent.offsetX/e.currentTarget.clientWidth*o;r&&(s+=r),a(Math.floor(s))}}},{key:"computedCurrent",value:function(){var e=this.props.startTime,t=this.props.currentTime,n=this.state.total;return e&&(t>e?t-=e:t=0),t>n&&(t=n),t}},{key:"formatTime",value:function(e){var t="00:00";if(e){var n=Math.floor(e/60),r=String(n<0?0:n).padStart(2,"0"),i=Math.floor(e%60),a=String(i<0?0:i).padStart(2,"0");t="".concat(r,":").concat(a)}return t}},{key:"renderController",value:function(e){var t=this.props,n=t.display,r=t.style,i=t.controllerRef,a=t.resourceLoader,o=t.playing,s=this.state.total;return jv.default.createElement("div",{className:"ppt-event-source",style:rm({background:"#FFFFFF",borderRadius:50,height:50,width:300,display:n?"flex":"none",flexDirection:"row",alignItems:"center"},r),ref:i},jv.default.createElement("div",{className:"ppt-event-source",style:{marginLeft:15,marginRight:10,fontSize:0,height:20,display:o?"none":"block"},onClick:this.onPlayClick.bind(this)},jv.default.createElement("img",{style:{height:20},alt:"play",src:a.replaceProtocolByresourceScheme("https://convertcdn.netless.link/publicFiles/icon/play.png")})),jv.default.createElement("div",{className:"ppt-event-source",style:{marginLeft:15,marginRight:10,fontSize:0,height:20,display:o?"block":"none"},onClick:this.onPauseClick.bind(this)},jv.default.createElement("img",{style:{height:20},alt:"pause",src:a.replaceProtocolByresourceScheme("https://convertcdn.netless.link/publicFiles/icon/pause.png")})),jv.default.createElement("div",{style:{width:100},className:"timer"},jv.default.createElement("span",{className:"current"},this.formatTime(this.computedCurrent())),jv.default.createElement("span",null,"/"),jv.default.createElement("span",{className:"total"},this.formatTime(s))),jv.default.createElement("div",{className:"ppt-event-source",style:{flex:1,position:"relative",marginRight:10},onMouseDown:this.onBarClick.bind(this)},jv.default.createElement("div",{style:{background:"#D9D9D9",position:"relative",height:10,display:"flex"},className:"total"},jv.default.createElement("div",{style:{background:"#4F4F4F",top:0,left:0,height:10,flex:e},className:"played"}))))}},{key:"render",value:function(){var e=this.props,t=e.duration,n=e.endTime,r=e.currentTime,i=e.playing,a=e.onMediaEnd,o=this.state.total;n&&(t>0&&r+n>=t&&i&&a());var s=0;return t&&(s=this.computedCurrent()/o),this.controllerPortal?(0,Dv.createPortal)(this.renderController(s),this.controllerPortal):this.renderController(s)}}],[{key:"getDerivedStateFromProps",value:function(e){return{total:Ay(e)}}}]),n}(jv.default.Component),Oy=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n),(r=t.call(this,e)).videoIntervalId=void 0,r.lastAnimeState={stop:0,play:0},r.player=Lv.default.createRef(),r.controller=Lv.default.createRef(),e.mediaState?r.state={displayController:!1,playing:e.mediaState.playing,currentTime:e.mediaState.currentTime||e.startTimePerfix,duration:0,controllerPositionTop:0,controllerPositionLeft:0}:r.state={displayController:!1,playing:!1,currentTime:e.startTimePerfix||0,duration:0,controllerPositionTop:0,controllerPositionLeft:0};var i=r.state.playing,a=r.props,o=a.mediaSlideActionUserIds,s=a.userId;return i&&r.hasControl(o,s)&&r.syncPlayTimeLoop(),r}return M(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.targetID;null==window||window.addEventListener("message",(function(n){"_changeAudioState"===n.data.type&&n.data.targetID===t&&e.updateAnimation(n.data)}))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.props,n=t.disableAnimation,r=t.outsidePausing,i=t.mediaState,a=t.rtcClient,o=this.state.playing;!0!==n&&(r||!e.outsidePausing)?!r||e.outsidePausing?void 0===i||i.playing!==e.mediaState.playing||i.currentTime!==e.mediaState.currentTime?(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),void 0===i&&void 0!==e.mediaState?void 0===i&&void 0!==e.mediaState&&(this.player.current&&(this.pauseAudio(),this.player.current.currentTime=e.mediaState.currentTime,!0===e.mediaState.playing?this.playAudio():this.pauseAudio()),this.setState(e.mediaState)):void 0!==i&&void 0!==e.mediaState&&this.player.current&&(i.playing?Math.abs(e.mediaState.currentTime-this.player.current.currentTime)>1.5&&(this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing&&(null==a||a.setAudioMixingPosition(Math.floor(1e3*this.player.current.currentTime)))):this.player.current.currentTime=e.mediaState.currentTime,o&&!e.mediaState.playing?this.pauseAudio():!o&&e.mediaState.playing&&this.playAudio(),this.setState({playing:e.mediaState.playing,currentTime:e.mediaState.currentTime}))):o!==i.playing&&this.setState({playing:i.playing}):this.player.current&&this.playAudio():this.player.current&&this.pauseAudio()}},{key:"onMediaCanPlay",value:function(){var e=this.props,t=e.disableAnimation,n=e.mediaState,r=e.rtcClient;!0===t?this.pauseAudio():n&&n.playing&&(r&&!this.audioMixing||!0===this.player.current.paused&&(this.player.current.currentTime=n.currentTime,this.playAudio()))}},{key:"onMouseOver",value:function(e){var t=this.state.displayController,n=this.props.slideRef;if(!0!==t){var r=e.target.getBoundingClientRect(),i=r.x,a=r.y,o=r.height,s=n.current.getBoundingClientRect(),c=s.x,u=s.y,l=s.width,h=s.height,d=getComputedStyle(this.controller.current),f=l/parseFloat(getComputedStyle(n.current).width),p=0,v=0;null!==d&&null!==d.width&&(p=parseInt(d.width,10)*f),null!==d&&null!==d.height&&(v=parseInt(d.height,10)*f);var m=0,g=0;g=i<c?0:c+l<i+p?l-p:i-c,m=a+o-v<u?0:a+o>u+h?h-v:a+o-u-v,this.setState({displayController:!0,controllerPositionTop:m/f,controllerPositionLeft:g/f})}}},{key:"onMediaPlay",value:function(){var e=this.props,t=e.onMediaPlay,n=e.shapeId,r=this.state.currentTime;t&&t(n,"audio",r)}},{key:"onMediaPause",value:function(){var e=this.props,t=e.onMediaPause,n=e.shapeId,r=this.state.currentTime;this.stopSyncPlayTime(),t&&t(n,"audio",r)}},{key:"stopSyncPlayTime",value:function(){this.videoIntervalId&&clearInterval(this.videoIntervalId)}},{key:"syncPlayTime",value:function(e){if(this.player.current){var t=this.props,n=t.mediaRef,r=t.onMediaChange,i=t.shapeId,a=this.state.currentTime,o=n.startTime,s=n.endTime,c=e||a,u=this.player.current.duration;s&&(u-=s);var l=c;this.player.current&&c>=u&&(l=o||0),o&&l<o&&(l=o),r({playing:!0,currentTime:l},i)}}},{key:"syncPlayTimeLoop",value:function(e){var t=this;this.props.onMediaChange&&(this.syncPlayTime(e),this.videoIntervalId=window.setInterval((function(){t.syncPlayTime()}),1e3))}},{key:"pauseAudio",value:function(){var e=this;this.player.current&&(void 0!==this.props.rtcClient?this.stopMixAudio((function(){return e.player.current.pause()})):this.player.current.pause())}},{key:"stopMixAudio",value:function(e){var t=this,n=this.props,r=n.rtcClient,i=n.logger;r.stopAudioMixing((function(n,r){714===n?(null==i||i.error("rtc mixing error : ".concat(r)),console.error(" stop audio mixing error :",r)):(t.audioMixing=!1,e())}))}},{key:"playLocalAudio",value:function(){var e=this.player.current.play();if(void 0!==e){var t=this.props,n=t.onMediaPlayError,r=t.logger,i=t.shapeId;e.then((function(){})).catch((function(e){r?r.error("play audio exception: ".concat(e)):console.error(e),n&&n(i,"audio",e)}))}}},{key:"playAudio",value:function(){this.player.current&&(void 0!==this.props.rtcClient?this.mixAudio(this.player.current.currentTime,this.playLocalAudio.bind(this)):this.playLocalAudio())}},{key:"mixAudio",value:function(e,t){var n=this,r=this.props,i=r.rtcClient,a=r.audioURL,o=r.logger;this.state.playing?(null==i||i.setAudioMixingPosition(Math.floor(1e3*e)),t()):null==i||i.startAudioMixing(a,!0,!1,1,(function(r,a){714===r?(null==o||o.error("rtc mixing error : ".concat(a)),console.error("rtc mixing error :",a)):(null==i||i.setAudioMixingPosition(Math.floor(1e3*e)),n.audioMixing=!0,t())}))}},{key:"updateAnimation",value:function(e){if(this.player.current){var t=this.props,n=t.startTime,r=t.startTimePerfix,i=this.state.playing;1===e.play&&this.player.current.paused&&(this.player.current.currentTime=n?r+n:r,this.playAudio(),this.setState({playing:!0,currentTime:this.player.current.currentTime})),1===e.stop&&this.player.current&&i&&(this.pauseAudio(),this.setState({playing:!1}))}}},{key:"hasControl",value:function(e,t){var n=this.props.shapeId;return!(!e||void 0===t)&&e[n]===t}},{key:"UNSAFE_componentWillReceivePropseslintreact",value:function(){this.pauseAudio(),this.stopSyncPlayTime(),null==window||window.removeEventListener("_changeAudioState",(function(){}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.resourceLoader,r=t.width,i=t.height,a=t.rtcClient,o=t.audioURL,s=t.logger,c=t.controllerProtalId,u=t.mediaRef,l=this.state,h=l.controllerPositionTop,d=l.controllerPositionLeft,f=l.displayController,p=l.duration,v=l.playing,m=l.currentTime;return Lv.default.createElement("div",{style:{position:"relative"},onMouseLeave:function(){return e.setState({displayController:!1})}},Lv.default.createElement("img",{className:"ppt-event-source",alt:"audio",src:n.replaceProtocolByresourceScheme("https://convertcdn.netless.link/publicFiles/icon/audio.png"),style:{width:lm(r),height:lm(i)},onMouseOver:this.onMouseOver.bind(this)}),Lv.default.createElement("audio",{src:o,ref:this.player,muted:!!a,onPlay:this.onMediaPlay.bind(this),onPause:this.onMediaPause.bind(this),onLoadedMetadata:function(){return e.setState({duration:e.player.current.duration})},onTimeUpdate:function(){return e.setState({currentTime:e.player.current.currentTime})},onLoadedMetadataCapture:function(){"ios"===window.__platform&&e.onMediaCanPlay()},onCanPlay:function(){"ios"!==window.__platform&&e.onMediaCanPlay()},onError:function(e){var t;null!==e.target.error&&(t=e.target.error),void 0!==t?null==s||s.error("load media: ".concat(o," error, code: ").concat(t.code,", message: ").concat(t.message)):null==s||s.error("load media: ".concat(o," error without error message"))}}),Lv.default.createElement(Ey,{controllerRef:this.controller,protalId:c,style:{position:"absolute",top:h,left:d,zIndex:1},resourceLoader:n,mediaRef:this.player,display:f,playing:v,duration:p,currentTime:m,onPlayClick:function(){e.stopSyncPlayTime(),e.syncPlayTimeLoop()},onPauseClick:function(){var t=e.props,n=t.onMediaChange,r=t.shapeId,i=e.state.currentTime;e.stopSyncPlayTime(),e.pauseAudio(),n&&n({playing:!1,currentTime:i},r)},onSeekClick:function(t){e.stopSyncPlayTime(),e.syncPlayTimeLoop(t)},onMediaEnd:function(){e.stopSyncPlayTime(),e.pauseAudio(),e.setState({playing:!1})},endTime:u.endTime,startTime:u.startTime}))}}]),n}(Lv.default.Component),Ry=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"identification",value:function(){var e=this.props,t=e.slideIndex,n=e.spId;return"".concat(t,"-").concat(n,"-")}},{key:"injectAdjustValue",value:function(e,t){var n=e.childElementOptional("a:avLst");n&&n.elementsWithName("a:gd").forEach((function(e){var n=e.attr.getString("fmla"),r=new Tg(n).eval(t),i=e.attr.getString("name");t.setVariable(i,r)}))}},{key:"render",value:function(){var e,t=this.props,n=t.shapeXML,r=t.width,i=t.height,a=t.fillColor,o=t.borderStyle,s=t.children,c=n.childElementOptional("p:spPr","a:prstGeom"),u=n.childElementOptional("p:spPr","a:custGeom"),l=new Xg({w:r,h:i}),h="";if(c){var d=c.attr.getString("prst");this.injectAdjustValue(c,l),e=Kg(d)}else u?(e=u,h="a:"):e=Kg("rect");var f=(new qg).renderLumiaPath(e,l,h).map((function(e,t){return zv.default.createElement("path",{key:"path".concat(t),d:e.pathD,fill:Zm(a),height:lm(i),width:lm(r),stroke:Zm(o.color),strokeWidth:lm(o.width),strokeDasharray:o.strokeDashArray})}));return zv.default.createElement("svg",{style:{position:"absolute",width:lm(r),height:lm(i),overflow:"visible"}},zv.default.createElement("defs",null,zv.default.createElement("clipPath",{id:"clippath-".concat(this.identification())},f)),s,f)}}]),n}(zv.default.Component),Ny=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).spId="",r.opacity=1,r.imageLoadingMonitor=new Jg(e.logger).createMonitor(),r.svgLoadingMonitor=new Jg(e.logger).createMonitor(),r.spId=e.imageXML.extraAttr.getString("spId"),r.getAlphaModFix(),r}return M(n,[{key:"hasSoftEdge",get:function(){var e=this.props.imageXML.childElementOptional("p:spPr","a:effectLst","a:softEdge");return Boolean(e)}},{key:"hasBlipChild",get:function(){var e=this.props.imageXML.childElementOptional("p:blipFill","a:blip");return Boolean(null==e?void 0:e.elements.length)}},{key:"needSpUrl",get:function(){return this.hasSoftEdge||this.hasBlipChild}},{key:"getAlphaModFix",value:function(){var e=this.props.imageXML.childElement("p:blipFill"),t=new Gm(e).getAlphaModFix();t&&(this.opacity=t)}},{key:"identification",value:function(){var e=this.props.slideIndex;return"".concat(e,"-").concat(this.spId,"-")}},{key:"render",value:function(){var e=this.props,t=e.imageXML,n=e.width,r=e.height,i=e.spURL,a=e.imageURL,o=e.margin,s=e.uuid,c=e.slideIndex,u=e.borderStyle,l=t.childElementOptional("p:blipFill","a:stretch","a:fillRect"),h=(l?l.attr.getNumber("l",0)/sm:0)*n,d=(l?l.attr.getNumber("b",0)/sm:0)*r,f=(l?l.attr.getNumber("r",0)/sm:0)*n,p=(l?l.attr.getNumber("t",0)/sm:0)*r;if(void 0===t.childElementOptional("p:spPr",new Sm("a:prstGeom","a:custGeom"))){var v=t.childElementOptional("p:blipFill","a:srcRect"),m={top:0,left:0,right:0,bottom:0};return v&&(m.top=um(v.attr.getNumber("t",0)),m.left=um(v.attr.getNumber("l",0)),m.right=um(v.attr.getNumber("r",0)),m.bottom=um(v.attr.getNumber("b",0))),Fv.default.createElement("div",{style:{overflow:"hidden",height:"100%"}},Fv.default.createElement("img",{src:a,style:{width:lm(n),height:lm(r),position:"relative",top:"".concat(lm(r*-m.top)),left:"".concat(lm(n*-m.left))},alt:"",ref:this.imageLoadingMonitor}))}var g,y,b,k,w=this.needSpUrl?i:a,S=this.needSpUrl?1:this.opacity;return this.needSpUrl&&i?(g=n-o.left-o.right,y=r-o.top-o.bottom,b=void 0,k=void 0):(g=n-h-f,y=r-p-d,b=lm(-o.left+h),k=lm(-o.top+p)),Fv.default.createElement(Ry,{uuid:s,slideIndex:c,borderStyle:u,width:n-o.left-o.right,height:r-o.top-o.bottom,shapeXML:t,spId:this.spId},Fv.default.createElement(gy,{innerref:this.svgLoadingMonitor,preserveAspectRatio:"none",xlinkHref:w||a,href:w||a,x:b,y:k,width:g,height:y,clipPath:"url(#clippath-".concat(this.identification(),")"),opacity:S}))}}]),n}(Fv.default.Component),Ly=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n),(r=t.call(this,e)).videoIntervalId=void 0,r.lastAnimeState={stop:0,play:0},r.player=Bv.default.createRef(),r.controller=Bv.default.createRef(),r.imageLoadingMonitor=new Jg(e.logger).createMonitor(),e.mediaState?r.state={displayController:!1,playing:e.mediaState.playing,currentTime:e.mediaState.currentTime||e.startTimePerfix,duration:0,controllerPositionTop:0,controllerPositionLeft:0}:r.state={displayController:!1,playing:!1,currentTime:e.startTimePerfix||0,duration:0,controllerPositionTop:0,controllerPositionLeft:0};var i=r.state.playing,a=r.props,o=a.mediaSlideActionUserIds,s=a.userId;return i&&r.hasControl(o,s)&&r.syncPlayTimeLoop(),r}return M(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.targetID;null==window||window.addEventListener("message",(function(n){"_changeAudioState"===n.data.type&&n.data.targetID===t&&e.updateAnimation(n.data)}))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this.state.playing,n=this.props,r=n.disableAnimation,i=n.outsidePausing,a=n.mediaState,o=n.rtcClient;!0!==r&&(i||!e.outsidePausing)?!i||e.outsidePausing?void 0===a||a.playing!==e.mediaState.playing||a.currentTime!==e.mediaState.currentTime?void 0===a&&void 0!==e.mediaState?(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),void 0===a&&void 0!==e.mediaState&&(this.player.current&&(this.pauseVideo(),this.player.current.currentTime=e.mediaState.currentTime,!0===e.mediaState.playing?this.playVideo():this.pauseVideo()),this.setState(e.mediaState))):void 0!==a&&void 0!==e.mediaState&&(this.hasControl(e.mediaSlideActionUserIds,e.userId)||this.stopSyncPlayTime(),this.player.current&&(a.playing?Math.abs(e.mediaState.currentTime-this.player.current.currentTime)>1.5&&(this.player.current.currentTime=e.mediaState.currentTime,e.mediaState.playing&&(null==o||o.setAudioMixingPosition(Math.floor(1e3*this.player.current.currentTime)))):this.player.current.currentTime=e.mediaState.currentTime,t&&!e.mediaState.playing?this.pauseVideo():!t&&e.mediaState.playing&&this.playVideo(),this.setState({playing:e.mediaState.playing,currentTime:e.mediaState.currentTime}))):t!==a.playing&&this.setState({playing:a.playing}):this.player.current&&this.playVideo():this.player.current&&this.pauseVideo()}},{key:"componentWillUnmount",value:function(){this.pauseVideo(),this.stopSyncPlayTime(),null==window||window.removeEventListener("_changeAudioState",(function(){}))}},{key:"onMediaPause",value:function(){var e=this.state.currentTime,t=this.props,n=t.onMediaPause,r=t.shapeId;this.stopSyncPlayTime(),n&&n(r,"video",e)}},{key:"onMediaPlay",value:function(){var e=this.state.currentTime,t=this.props,n=t.onMediaPlay,r=t.shapeId;n&&n(r,"video",e)}},{key:"onMouseOver",value:function(e){var t=this.state.displayController,n=this.props.slideRef;if(!0!==t){var r=e.target.getBoundingClientRect(),i=r.x,a=r.y,o=r.height,s=n.current.getBoundingClientRect(),c=s.x,u=s.y,l=s.width,h=s.height,d=getComputedStyle(this.controller.current),f=l/parseFloat(getComputedStyle(n.current).width),p=0,v=0;null!==d&&null!==d.width&&(p=parseInt(d.width,10)*f),null!==d&&null!==d.height&&(v=parseInt(d.height,10)*f);var m=0,g=0;g=i<c?0:c+l<i+p?l-p:i-c,m=a+o-v<u?0:a+o>u+h?h-v:a+o-u-v,this.setState({displayController:!0,controllerPositionTop:m/f,controllerPositionLeft:g/f})}}},{key:"onMediaCanPlay",value:function(){var e=this.props,t=e.disableAnimation,n=e.mediaState,r=e.rtcClient;!0===t?this.pauseVideo():n&&n.playing&&(r&&!this.audioMixing||!0===this.player.current.paused&&(this.player.current.currentTime=n.currentTime,this.playVideo()))}},{key:"hasControl",value:function(e,t){var n=this.props.shapeId;return!(!e||void 0===t)&&e[n]===t}},{key:"stopSyncPlayTime",value:function(){this.videoIntervalId&&clearInterval(this.videoIntervalId)}},{key:"mixAudio",value:function(e,t){var n=this,r=this.state.playing,i=this.props,a=i.rtcClient,o=i.logger,s=i.videoURL;r?(null==a||a.setAudioMixingPosition(Math.floor(1e3*e)),t()):null==a||a.startAudioMixing(s,!0,!1,1,(function(r,i){714===r?(null==o||o.error("rtc mixing error : ".concat(i)),console.error("rtc mixing error :",i)):(null==a||a.setAudioMixingPosition(Math.floor(1e3*e)),n.audioMixing=!0,t())}))}},{key:"updateAnimation",value:function(e){if(this.player.current&&this.lastAnimeState){var t=this.state.playing,n=this.props,r=n.startTime,i=n.startTimePerfix;0===this.lastAnimeState.play&&1===e.play&&this.player.current&&(1===e.stop?t&&(this.pauseVideo(),this.setState({playing:!1})):t||(this.player.current.currentTime=r?i+r:i,this.playVideo(),this.setState({playing:!0}))),0===this.lastAnimeState.stop&&1===e.stop&&this.player.current&&t&&(this.pauseVideo(),this.setState({playing:!1}))}this.lastAnimeState=e}},{key:"syncPlayTime",value:function(e){if(this.player.current){var t=this.state.currentTime,n=this.props,r=n.mediaRef,i=n.onMediaChange,a=n.shapeId,o=r.startTime,s=r.endTime,c=e||t,u=this.player.current.duration;s&&(u-=s);var l=c;this.player.current&&c>=u&&(l=o||0),o&&l<=o&&(l=o),i({playing:!0,currentTime:l},a)}}},{key:"pauseVideo",value:function(){var e=this,t=this.props.rtcClient;this.player.current&&(void 0!==t?this.stopMixAudio((function(){return e.player.current.pause()})):this.player.current.pause())}},{key:"syncPlayTimeLoop",value:function(e){var t=this;this.props.onMediaChange&&(this.syncPlayTime(e),this.videoIntervalId=window.setInterval((function(){t.syncPlayTime()}),1e3))}},{key:"stopMixAudio",value:function(e){var t=this,n=this.props,r=n.rtcClient,i=n.logger;r.stopAudioMixing((function(n,r){714===n?(null==i||i.error("rtc mixing error : ".concat(r)),console.error(" stop audio mixing error :",r)):(t.audioMixing=!1,e())}))}},{key:"playLocalVideo",value:function(){var e=this.player.current.play();if(void 0!==e){var t=this.props,n=t.onMediaPlayError,r=t.logger,i=t.shapeId;e.then((function(){})).catch((function(e){r?r.error("play video exception: ".concat(e)):console.error(e),n&&n(i,"video",e)}))}}},{key:"playVideo",value:function(){this.player.current&&(void 0!==this.props.rtcClient?this.mixAudio(this.player.current.currentTime,this.playLocalVideo.bind(this)):this.playLocalVideo())}},{key:"render",value:function(){var e=this,t=this.props,n=t.mediaRef,r=t.videoURL,i=t.width,a=t.height,o=t.rtcClient,s=t.logger,c=t.controllerProtalId,u=t.resourceLoader,l=t.onMediaChange,h=t.shapeId,d=this.state,f=d.controllerPositionTop,p=d.controllerPositionLeft,v=d.displayController,m=d.playing,g=d.duration,y=d.currentTime,b=n.startTime?1e3*n.startTime:1e4,k="".concat(r,"?x-oss-process=video/snapshot,t_").concat(b,",m_fast,w_800,f_png,ar_auto");return Bv.default.createElement("div",{className:"ppt-event-source",style:{position:"relative",width:lm(i),height:lm(a)},onMouseLeave:function(){return e.setState({displayController:!1})}},Bv.default.createElement("img",{src:k,alt:"poster",style:{position:"absolute",zIndex:0,top:0,left:0,width:lm(i),height:lm(a)},ref:this.imageLoadingMonitor}),Bv.default.createElement("video",{className:"ppt-event-source","webkit-playsinline":"true",playsInline:!0,src:r,ref:this.player,muted:!!o,style:{position:"absolute",zIndex:1,top:0,left:0,width:lm(i),height:lm(a),objectFit:"fill"},poster:k,onPlay:this.onMediaPlay.bind(this),onPause:this.onMediaPause.bind(this),onLoadedMetadata:function(){return e.setState({duration:e.player.current.duration})},onTimeUpdate:function(){return e.setState({currentTime:e.player.current.currentTime})},onLoadedMetadataCapture:function(){"ios"===window.__platform&&e.onMediaCanPlay()},onCanPlay:function(){"ios"!==window.__platform&&e.onMediaCanPlay()},onError:function(e){var t;null!==e.target.error&&(t=e.target.error),void 0!==t?null==s||s.error("load media: ".concat(r," error,\n                                code: ").concat(t.code,", message: ").concat(t.message)):null==s||s.error("load media: ".concat(r," error without error message"))},onMouseOver:this.onMouseOver.bind(this),preload:"auto"}),Bv.default.createElement(Ey,{protalId:c,style:{position:"absolute",top:f,left:p,zIndex:2,backfaceVisibility:"hidden"},resourceLoader:u,controllerRef:this.controller,mediaRef:this.player,display:v,playing:m,duration:g,currentTime:y,onPlayClick:function(){e.stopSyncPlayTime(),e.syncPlayTimeLoop()},onPauseClick:function(){e.stopSyncPlayTime(),l&&l({playing:!1,currentTime:y},h)},onSeekClick:function(t){e.stopSyncPlayTime(),e.syncPlayTimeLoop(t)},onMediaEnd:function(){e.stopSyncPlayTime(),e.pauseVideo(),e.setState({playing:!1})},endTime:n.endTime,startTime:n.startTime}))}}]),n}(Bv.default.Component),jy=function(){function e(t){I(this,e),this.spTreeXML=t}return M(e,[{key:"indexBySpId",value:function(){var e,t={},n=0,r=A(this.spTreeXML.elements);try{for(r.s();!(e=r.n()).done;){var i=e.value.extraAttr.getStringOptional("spId");"string"==typeof i&&(t[i]=n,n+=1)}}catch(e){r.e(e)}finally{r.f()}return t}}]),e}(),Dy=function(e){y(n,e);var t=k(n);function n(e){var r,i;I(this,n),(r=t.call(this,e)).lumiaRef=Uv.default.createRef();var a=0,o=e.shapeGroupTransform,s=e.shapeXML;if("p:sp"===s.name){var c=s.childElementOptional("p:spPr","a:xfrm");if(c){var u=c.attr.getNumber("rot",0);a=Number(u)/cm}}var l=function(e){var t,n=e.childElementOptional("p:txBody","a:bodyPr");return null!=(t=null==n?void 0:n.attr.getStringOptional("vert"))?t:hg.Horz}(s),h=null!=(i=null==o?void 0:o.rotate)?i:0;return l===hg.EaVert&&a+h===270&&(r.vertTextType=!0),r}return M(n,[{key:"renderTextBody",value:function(e){var t,n,r=this.props,i=r.shapeWrapResource,a=r.slideContext,o=r.width,s=r.height,c=r.resourceType,u=r.flipH,l=r.flipV,h=r.uuid,d=r.withAnimation;return i&&!i.prop.specialShape&&(n=null==(t=i.textBodyMap)?void 0:t[0]),Uv.default.createElement(Sy,{slideContext:a,txBodyXML:e,width:o,height:s,resourceType:c,flipH:u,flipV:l,uuid:h,textBodyWrapResource:n,withAnimation:d})}},{key:"renderShape",value:function(e,t){var n,r,i=0,a=this.vertTextType,o=this.lumiaRef,s=this.props,c=s.shapeGroupTransform,u=s.width,l=s.height,h=s.fillColor,d=s.groupFillColor,f=s.borderStyle,p=s.slideIndex,v=s.uuid,m=s.resourceLoader,g=s.resourceType,y=s.logger;if("p:sp"===e.name){var b=e.childElementOptional("p:spPr","a:xfrm");if(b){var k=b.attr.getNumber("rot",0);i=Number(k)/cm}}if(c){var w=ag(i,c);n=u*w.scaleX,r=l*w.scaleY}else n=u,r=l;return Uv.default.createElement(yy,{vertTextType:a,ref:o,fillColor:h,groupFillColor:d,spId:e.extraAttr.getString("spId"),borderStyle:f,width:n,height:r,slideIndex:p,uuid:v,resourceLoader:m,resourceType:g,logger:y,shapeXML:e},t?this.renderTextBody(t):null)}},{key:"render",value:function(){var e=this.props.shapeXML,t=e.childElementOptional("p:txBody");return this.renderShape(e,t)}}]),n}(Uv.default.PureComponent);function Fy(e,t,n){return"".concat(n,"_").concat(t,"_").concat(e)}function zy(e,t,n,r){var i=hg.Horz,a=e.childElementOptional("p:txBody");a&&"p:txBody"===a.name&&(i=mg(a));var o={x:e.extraAttr.getNumber("x"),y:e.extraAttr.getNumber("y"),width:e.extraAttr.getNumber("width"),height:e.extraAttr.getNumber("height")},s=e.extraAttr.getBoolean("hidden"),c=e.extraAttr.getBoolean("flipV"),u=e.extraAttr.getBoolean("flipH"),l=e.extraAttr.getNumberOptional("rot");if(i===hg.EaVert&&162e5===l){l=0;var h=o,d=h.x,f=h.y,p=h.width,v=h.height;o=im(rm({},o),{x:d+(p-v)/2,y:f+(v-p)/2,width:v,height:p})}var m,g={color:e.extraAttr.getColor("borderColor"),width:e.extraAttr.getNumber("borderWidth"),type:e.extraAttr.getString("borderType"),strokeDashArray:e.extraAttr.getString("borderStrokeDashArray")};e.extraAttr.getOptional("fillColor")&&((m=e.extraAttr.getColor("fillColor"))instanceof _m&&m.setFillColor(r.fillColor));var y,b=e.childElementOptional("p:blipFill","a:srcRect");if(b){var k=um(b.attr.getNumber("l",0)),w=um(b.attr.getNumber("r",0)),S=um(b.attr.getNumber("t",0)),x=um(b.attr.getNumber("b",0)),C=1-k-w,I=1-S-x,P=o.width/C,M=o.height/I;y={width:P,height:M,margin:{left:P*k,top:M*S,right:P*w,bottom:M*x}}}var T,A=e.childElementOptional(new Sm("p:nvSpPr","p:nvPicPr"),"p:cNvPr","a:hlinkClick");if(A&&!(T=A.attr.getStringOptional("r:id"))){var E=null==A?void 0:A.attr.getStringOptional("action"),O=new URL(null!=E?E:"");if("//hlinkshowjump"===O.pathname){var R=O.searchParams.get("jump");["firstslide","previousslide","nextslide","lastslide","endshow","lastslideviewed"].includes(R)&&(T=function(e,t){if(!t)return 1;var n=t.slideIndex,r=t.slideCount,i=t.preSlideIndex,a=1;switch(e){case"firstslide":a=1;break;case"previousslide":a=n-1;break;case"endshow":case"lastslide":a=r;break;case"nextslide":a=n+1;break;case"lastslideviewed":a=i+1}return a<1&&(a=1),a>r&&(a=r),a}(R,t))}}return{rectangle:o,borderStyle:g,fillColor:m,tailor:y,flipV:c,flipH:u,rotate:l,parentGroupShapeId:n,hidden:s,hyperLinkDestination:T}}var By=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n),(r=t.call(this,e)).animeTarget=Vv.default.createRef(),r.shapeMap=new tg(zy),r.childrenRef=Vv.default.createRef(),r.eventSourceId=void 0,r.emptyClick=function(){},r.onClick=function(e){var t=r.props,n=t.onHyperLinkClick,i=t.onEventSourceClick;return void 0!==r.shapeWrapperParams.hyperLinkDestination?n?n(r.shapeWrapperParams.hyperLinkDestination,e):void 0:void 0!==r.eventSourceId&&i?i(r.eventSourceId):void 0},r.state={soundEffectUrl:null};var i=e.shapeXML,a=e.resourceType,o=e.shapeGroupTransform,s=e.onEventSourceClick;if(r.spId=i.extraAttr.getString("spId"),r.resourceType=a,r.player=Vv.default.createRef(),r.shapeWrapperParams=r.shapeMap.map(i,e.slideContext,o),void 0!==e.eventSourceId)r.eventSourceId=e.eventSourceId;else{var c=Fy(e.slideContext.uuid,e.slideContext.slideIndex,r.spId);e.interactiveSeqsKeys&&-1!==e.interactiveSeqsKeys.indexOf(c)&&void 0!==s&&(r.eventSourceId=c)}return r}return M(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.slideContext;null==window||window.addEventListener("message",(function(n){"_playSoundEffect"===n.data.type&&n.data.targetID===Fy(t.uuid,t.slideIndex,e.spId)&&e.playEffectSound(n.data.targetID,n.data.soundEffectId)}))}},{key:"getPositionAndSize",value:function(){var e,t,n,r,i=0,a=this.props,o=a.shapeXML,s=a.shapeGroupTransform;if("p:sp"===o.name||"p:pic"===o.name){var c=o.childElementOptional("p:spPr","a:xfrm");if(c){var u=c.attr.getNumber("rot",0);i=Number(u)/cm}}if(s){var l=this.shapeWrapperParams.rectangle,h=l.x,d=l.y,f=l.width,p=l.height,v=s.scaleX,m=s.scaleY,g=s.translateX,y=s.translateY;Math.abs(Math.cos(i/180*Math.PI))>=Math.abs(Math.sin(i/180*Math.PI))?(e=(h+g)*v,t=(d+y)*m,n=f*v,r=p*m):(e=(h+g+f/2)*v-f*m/2,t=(d+y+p/2)*m-p*v/2,n=f*m,r=p*v)}else e=this.shapeWrapperParams.rectangle.x,t=this.shapeWrapperParams.rectangle.y,n=this.shapeWrapperParams.rectangle.width,r=this.shapeWrapperParams.rectangle.height;return{left:lm(e),top:lm(t),width:lm(n),height:lm(r)}}},{key:"transform",value:function(e){var t=this.transformWithShapeParams(e,{translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0}),n=t.translateX,r=t.translateY,i=t.scaleX,a=t.scaleY,o=t.rotate,s=(e.rotate||0)+o;return i<0&&(s=-s),a<0&&(s=-s),"translate(".concat(lm(n),", ").concat(lm(r),") scale(").concat(i,",").concat(a,") rotate(").concat(hm(s),"deg)")}},{key:"transformWithShapeParams",value:function(e,t){var n=t.translateX,r=t.translateY,i=e.flipH?-t.scaleX:t.scaleX,a=e.flipV?-t.scaleY:t.scaleY,o=0;return t.rotate&&"number"==typeof t.rotate&&(o=t.rotate),{translateX:n,translateY:r,scaleX:i,scaleY:a,rotate:o}}},{key:"playEffectSound",value:function(e,t){if(void 0!==t){var n=this.props,r=n.resourceType,i=n.slideContext;if("slide"===r){var a=i.resourceLoader.loadURL(r,t);if(a){var o=document.getElementById("".concat(e));if(o){var s=document.createElement("audio");return s.id="".concat(e,"-").concat(t),s.onpause=function(){s.remove()},s.src=a,s.controls=!1,o.appendChild(s),s.play().then((function(){}),(function(){})),!0}}}}return!1}},{key:"renderShape",value:function(e){var t=e.tailor,n={left:0,right:0,top:0,bottom:0},r=e.rectangle;t&&(r=im(rm({},r),{width:t.width,height:t.height}),n=t.margin);var i=this.props,a=i.flipH,o=i.flipV,s=i.shapeGroupTransform,c=i.resourceType,u=!!a!==e.flipH,l=!!o!==e.flipV;return this.renderChildren({play:e.play,stop:e.stop,width:r.width,height:r.height,borderStyle:e.borderStyle,fillColor:e.fillColor,rotate:e.rotate,margin:n,shapeGroupTransform:s,flipH:u,flipV:l,resoureType:c})}},{key:"renderChildren",value:function(e){var t=this.props.children;if("function"==typeof t){var n=t(e);return n&&Vv.default.cloneElement(n,{ref:this.childrenRef})}return Vv.default.cloneElement(t,{ref:this.childrenRef})}},{key:"render",value:function(){var e,t,n=this.state.soundEffectUrl,r=this.getPositionAndSize(),i=r.left,a=r.top,o=r.height,s=r.width;!0===this.shapeWrapperParams.hidden&&(t="none");var c=null!=(e=this.shapeWrapperParams.hyperLinkDestination)?e:void 0!==this.eventSourceId,u="none"!==Zm(this.shapeWrapperParams.fillColor)?(0,Wv.default)(Zm(this.shapeWrapperParams.fillColor)):(0,Wv.default)("#FFFFFF00"),l=u.hsl().array(),h=this.props,d=h.slideContext,f=h.zIndex;return Vv.default.createElement("div",{className:"spId-".concat(this.spId," ").concat(c?" ppt-event-source":""),id:Fy(d.uuid,d.slideIndex,this.spId),ref:this.animeTarget,style:{position:"absolute",display:t,zIndex:f,left:i,top:a,width:s,height:o,transform:this.transform(this.shapeWrapperParams),opacity:1,backfaceVisibility:"hidden","--sp-fill-h":u&&l[0],"--sp-fill-s":u&&l[1]+"%","--sp-fill-l":u&&l[2]+"%","--sp-fill-a":u?u.alpha():0},onClick:c?this.onClick.bind(this,this.spId):this.emptyClick},n&&Vv.default.createElement("audio",{src:n,ref:this.player,controls:!1}),this.renderShape(this.shapeWrapperParams))}}]),n}(Vv.default.Component);function Uy(e,t,n,r){var i,a=e.childElementOptional("p:grpSpPr","a:xfrm"),o=0,s=0,c=0,u=0,l=1,h=1;e.extraAttr.getOptional("fillColor")&&((i=e.extraAttr.getColor("fillColor"))instanceof _m&&i.setFillColor(r.fillColor));var d=!1,f=!1,p=0,v={x:0,y:0,width:t?t.slideWidth:0,height:t?t.slideHeight:0},m=0;if(a){var g=e.childElementOptional("p:grpSpPr","a:xfrm","a:chExt"),y=e.childElementOptional("p:grpSpPr","a:xfrm","a:ext"),b=e.childElementOptional("p:grpSpPr","a:xfrm","a:chOff");c=g?g.attr.getNumber("cx"):0,u=g?g.attr.getNumber("cy"):0,l=0!==c&&y?y.attr.getNumber("cx")/c:1,l=Number.isNaN(l)?1:l,h=0!==c&&y?y.attr.getNumber("cy")/u:1,h=Number.isNaN(h)?1:h,o=b?-b.attr.getNumber("x"):0,s=b?-b.attr.getNumber("y"):0,p=(m=a.attr.getNumber("rot",0))/cm,d=a.attr.getBoolean("flipV",!1),f=a.attr.getBoolean("flipH",!1);var k=e.childElementOptional("p:grpSpPr","a:xfrm","a:off");v={x:k?k.attr.getNumber("x"):0,y:k?k.attr.getNumber("y"):0,width:y?y.attr.getNumber("cx"):0,height:y?y.attr.getNumber("cy"):0}}return{rectangle:v,borderStyle:{},opacity:1,tailor:void 0,flipV:d,flipH:f,transform:{translateX:o,translateY:s,scaleX:l,scaleY:h,rotate:p,fillColor:i},parentGroupShapeId:n,fillColor:i,rotate:m,hidden:e.extraAttr.getBooleanOptional("hidden")}}var Vy,Wy=function(e){y(n,e);var t=k(n);function n(e){var r;I(this,n),(r=t.call(this,e)).animeTarget=Fd.default.createRef(),r.eventSourceId=void 0,r.shapeWrappers=[],r.shapeMap=new tg(Uy),r.renderShape=function(e,t,n,i,a,o,s){var c=t.extraAttr.getString("spId"),u=c.replace("l","").replace("m",""),l=r.props,h=l.slideContext,d=l.interactiveSeqsKeys,f=l.onEventSourceClick,p=l.onHyperLinkClick,v=l.resourceType,m=l.uuid,g=l.wrapResource,y=l.animationManager,b=!1,k=t.childElementOptional(new Sm("p:nvSpPr","p:nvCxnSpPr"));if(k&&(b=!!k.childElementOptional("p:nvPr","p:ph")),"slide"===v||!b)return Fd.default.createElement(By,{key:"".concat(n),ref:function(e){return r.shapeWrappers.push(e)},shapeXML:t,slideContext:h,shapeGroupTransform:i,interactiveSeqsKeys:d,eventSourceId:r.eventSourceId,onEventSourceClick:f,onHyperLinkClick:p,zIndex:r.zIndex(e,t),resourceType:v,flipV:s,flipH:o},(function(e){return Fd.default.createElement(Dy,{uuid:m,width:e.width,fillColor:e.fillColor,slideContext:h,height:e.height,slideIndex:h.slideIndex,groupFillColor:a.fillColor,borderStyle:e.borderStyle,shapeGroupTransform:e.shapeGroupTransform,shapeXML:t,resourceLoader:h.resourceLoader,resourceType:v,shapeWrapResource:null==g?void 0:g.shapes[u],withAnimation:null==y?void 0:y.withTextAnimation(c),flipV:e.flipV,flipH:e.flipH})}))},r.renderPicture=function(e,t,n,i){var a=r.props,o=a.slideContext,s=a.interactiveSeqsKeys,c=a.onEventSourceClick,u=a.onHyperLinkClick,l=a.resourceType;return Fd.default.createElement(By,{key:"".concat(n),shapeXML:t,ref:function(e){return r.shapeWrappers.push(e)},slideContext:o,interactiveSeqsKeys:s,shapeGroupTransform:i,eventSourceId:r.eventSourceId,onEventSourceClick:c,onHyperLinkClick:u,zIndex:r.zIndex(e,t),resourceType:l},(function(e){return r.renderPictureContent(t,e,o.resourceLoader,i)}))},r.renderGraph=function(e,t,n,i){var a=t.extraAttr.getString("spId"),o=r.props,s=o.slideContext,c=o.interactiveSeqsKeys,u=o.onEventSourceClick,l=o.onHyperLinkClick,h=o.resourceType,d=o.uuid,f=o.wrapResource;return Fd.default.createElement(By,{key:"".concat(n),shapeXML:t,ref:function(e){return r.shapeWrappers.push(e)},slideContext:s,interactiveSeqsKeys:c,eventSourceId:r.eventSourceId,onEventSourceClick:u,onHyperLinkClick:l,zIndex:r.zIndex(e,t),resourceType:h,shapeGroupTransform:i},(function(e){return Fd.default.createElement(Ty,{uuid:d,slideContext:s,width:e.width,height:e.height,rotate:e.rotate,borderStyle:e.borderStyle,fillColor:e.fillColor,key:"".concat(n),shapeGroupTransform:e.shapeGroupTransform,graphXML:t,shapeWrapResource:null==f?void 0:f.shapes[a],resourceType:e.resoureType})}))},r.renderShapeGroup=function(e,t,i,a,o,s){var c=r.zIndex(e,t),u=r.props,l=u.uuid,h=u.slideRef,d=u.slideContext,f=u.interactiveSeqsKeys,p=u.resourceType,v=u.onEventSourceClick,m=u.onHyperLinkClick,g=u.meidaStates,y=u.disableAnimation,b=u.onMediaChange,k=u.onMediaPause,w=u.onMediaPlay,S=u.onMediaPlayError,x=u.mediaSlideActionUserIds,C=u.rtcClient,I=u.userId,P=u.wrapResource;return Fd.default.createElement(n,{key:"".concat(i),uuid:l,slideRef:h,slideContext:d,zIndex:c,shapeGroupXML:t,interactiveSeqsKeys:f,eventSourceId:r.eventSourceId,resourceType:p,onEventSourceClick:v,onHyperLinkClick:m,shapeGroupTransform:a,flipH:o,flipV:s,meidaStates:g,disableAnimation:y,onMediaChange:b,onMediaPlay:w,onMediaPause:k,onMediaPlayError:S,userId:I,mediaSlideActionUserIds:x,wrapResource:P,rtcClient:C})},r.state={soundEffectUrl:null};var i=r.props,a=i.shapeGroupXML,o=i.onEventSourceClick,s=a.extraAttr.getString("spId");r.shapeId=s;var c=Fy(e.slideContext.uuid,e.slideContext.slideIndex,s);return e.interactiveSeqsKeys&&-1!==e.interactiveSeqsKeys.indexOf(c)&&void 0!==o&&(r.eventSourceId=c),r.player=Fd.default.createRef(),r}return M(n,[{key:"componentDidMount",value:function(){var e=this,t=this.props.slideContext;null==window||window.addEventListener("message",(function(n){"_playSoundEffect"===n.data.type&&n.data.targetID===Fy(t.uuid,t.slideIndex,e.shapeId)&&e.playEffectSound(n.data.targetID,n.data.soundEffectId)}))}},{key:"componentDidCatch",value:function(e,t){var n=this.props.logger;n&&n.error("catch render error: ",e," stack: ",t.componentStack),this.setState({error:!0})}},{key:"transformWithShapeParams",value:function(e,t){var n=t.translateX,r=t.translateY,i=e.flipH?-t.scaleX:t.scaleX,a=e.flipV?-t.scaleY:t.scaleY,o=0;return t.rotate&&"number"==typeof t.rotate&&(o=t.rotate),{translateX:n,translateY:r,scaleX:i,scaleY:a,rotate:o}}},{key:"transform",value:function(e){var t=this.props.shapeGroupTransform,n={translateX:0,translateY:0,scaleX:1,scaleY:1,rotate:0};t&&(n.rotate=t.rotate+n.rotate);var r=this.transformWithShapeParams(e,n),i=r.translateX,a=r.translateY,o=r.scaleX,s=r.scaleY,c=r.rotate;return"translate(".concat(lm(i),", ").concat(lm(a),") scale(").concat(o,",").concat(s,") rotate(").concat(hm(c)+e.transform.rotate,"deg)")}},{key:"updateAnimation",value:function(e){var t;(null==(t=this.player)?void 0:t.current)&&(1===e.play&&0===e.stop?this.player.current.play().then((function(){}),(function(){})):0===e.play&&1===e.stop&&this.player.current.pause())}},{key:"playEffectSound",value:function(e,t){if(void 0!==t){var n=this.props,r=n.resourceType,i=n.slideContext;if("slide"===r){var a=i.resourceLoader.loadURL(r,t);if(a){var o=document.getElementById("".concat(e));if(o){var s=document.createElement("audio");return s.id="".concat(e,"-").concat(t),s.onpause=function(){s.remove()},s.src=a,s.controls=!1,o.appendChild(s),s.play().then((function(){}),(function(){})),!0}}}}return!1}},{key:"parseMediaRef",value:function(e,t){if(t){var n=this.props.resourceType,r=t.childElementOptional(new Sm("a:videoFile","a:audioFile"));if(r){var i="a:videoFile"===r.name?"video":"audio",a=r.attr.getString("r:link"),o=e.loadURL(n,a);if(o)return{resURL:o,mediaType:i};var s=t.childElementOptional("p:extLst","p:ext");if(s&&"{DAA4B4D4-6D71-4841-9C94-3DE7FCFB9230}"===s.attr.getString("uri")){var c=s.childElement("p14:media"),u=c.attr.getStringOptional("r:link"),l=c.attr.getStringOptional("r:embed"),h=u||l||"unknow";if(c.hasChildElementWithName("p14:trim")){var d=c.childElement("p14:trim"),f=d.attr.getNumberOptional("st"),p=d.attr.getNumberOptional("end");return f&&(f/=1e3),p&&(p/=1e3),{resURL:e.loadURL(n,h),mediaType:i,startTime:f,endTime:p}}return{resURL:e.loadURL(n,h),mediaType:i}}}}else;}},{key:"zIndex",value:function(e,t){var n=t.extraAttr.getStringOptional("spId");if("string"==typeof n){var r=new jy(e).indexBySpId();if(n in r)return r[n]}return 999}},{key:"renderPictureContent",value:function(e,t,n,r){var i=t.width,a=t.height,o=t.fillColor,s=t.borderStyle,c=t.margin,u=e.childElementOptional("p:nvPicPr","p:nvPr"),l=e.childElement("p:nvPicPr","p:cNvPr").attr.getString("id"),h=this.parseMediaRef(n,u),d=e.childElementOptional("p:blipFill","a:blip"),f=0,p=null==e?void 0:e.childElementOptional("p:spPr","a:xfrm");if(p){var v=p.attr.getNumber("rot",0);f=Number(v)/cm}var m,g,y=rm({},c);if(r){var b=ag(f,r),k=b.scaleX,w=b.scaleY;m=i*k,g=a*w,y.left*=k,y.right*=k,y.top*=w,y.bottom*=w}else m=i,g=a;var S=this.props,x=S.meidaStates,C=S.uuid,I=S.slideContext,P=S.logger,M=S.slideRef,T=S.pausing,A=S.disableAnimation,E=S.onMediaChange,O=S.onMediaPause,R=S.onMediaPlay,N=S.onMediaPlayError,L=S.userId,j=S.mediaSlideActionUserIds,D=S.rtcClient,F=S.resourceType,z=x?x[l]:void 0;if(h&&"video"===h.mediaType)return Fd.default.createElement(Ly,{width:m,uuid:C,controllerProtalId:"netless-media-controller-portal-".concat(I.uuid),logger:P,slideRef:M,startTimePerfix:h.startTime?h.startTime:0,outsidePausing:T,height:g,fillColor:o,borderStyle:s,videoURL:h.resURL,shapeId:l,targetID:Fy(I.uuid,I.slideIndex,l),mediaState:z,resourceLoader:n,disableAnimation:A,onMediaChange:E,onMediaPlay:R,onMediaPause:O,onMediaPlayError:N,userId:L,mediaSlideActionUserIds:j,rtcClient:D,mediaRef:h});if(h&&"audio"===h.mediaType)return Fd.default.createElement(Oy,{width:m,controllerProtalId:"netless-media-controller-portal-".concat(I.uuid),logger:P,slideRef:M,startTimePerfix:h.startTime?h.startTime:0,outsidePausing:T,height:g,borderStyle:s,uuid:C,audioURL:h.resURL,shapeId:l,targetID:Fy(I.uuid,I.slideIndex,l),mediaState:z,resourceLoader:n,disableAnimation:A,onMediaChange:E,onMediaPlay:R,onMediaPause:O,onMediaPlayError:N,userId:L,mediaSlideActionUserIds:j,rtcClient:D,mediaRef:h});if(d){var B=d.attr.getStringOptional("r:embed");if(void 0===B)return null;var U,V=n.loadURL(F,B);return l&&(U=n.loadURL(F,"spId".concat(l))),Fd.default.createElement(Ny,{width:m,uuid:I.uuid,logger:P,resourceType:F,resId:B,height:g,slideIndex:I.slideIndex,fillColor:o,borderStyle:s,imageURL:V,margin:y,imageXML:e,preload:I.preload,spURL:U})}return null}},{key:"renderShapeGroupContent",value:function(e){var t=this,n=this.props,r=n.shapeGroupXML,i=n.shapeGroupTransform,a=n.flipH,o=n.flipV,s=r.elementsWithName("p:sp"),c=r.elementsWithName("p:cxnSp"),u=r.elementsWithName("p:pic"),l=r.elementsWithName("p:graphicFrame"),h=r.elementsWithName("p:grpSp");r.elementsWithName("mc:AlternateContent").forEach((function(e){var t=e.childElementOptional("mc:Choice","p:graphicFrame");if(t)l.push(t);else{var n=e.childElementOptional("mc:Fallback","p:pic");n&&u.push(n)}}));var d=rm({},e.transform),f=i;f&&(d.rotate+=f.rotate,d.scaleX*=f.scaleX,d.scaleY*=f.scaleY);var p=!!a!==e.flipH,v=!!o!==e.flipV;return Fd.default.createElement(Fd.default.Fragment,null,s.map((function(n,i){return t.renderShape(r,n,i,d,e,p,v)})),c.map((function(n,i){return t.renderShape(r,n,i,d,e,p,v)})),u.map((function(e,n){return t.renderPicture(r,e,n,d)})),l.map((function(e,n){return t.renderGraph(r,e,n,d)})),h.map((function(e,n){return t.renderShapeGroup(r,e,n,d,p,v)})))}},{key:"render",value:function(){this.shapeWrappers=[];var e=this.state,t=e.error,n=e.soundEffectUrl;if(t)return Fd.default.createElement("div",{"data-reason":"render error"});var r,i,a,o,s=this.props,c=s.shapeGroupXML,u=s.slideContext,l=s.shapeGroupTransform,h=s.zIndex,d=this.shapeMap.map(c,u,l),f=c.extraAttr.getString("spId");return l?(r=lm((d.rectangle.x+l.translateX)*l.scaleX),i=lm((d.rectangle.y+l.translateY)*l.scaleY),a=lm(d.rectangle.width*l.scaleX),o=lm(d.rectangle.height*l.scaleY)):(r=lm(d.rectangle.x),i=lm(d.rectangle.y),a=lm(d.rectangle.width),o=lm(d.rectangle.height)),Fd.default.createElement("div",{ref:this.animeTarget,className:"spGoupId-"+f,id:Fy(u.uuid,u.slideIndex,f),style:{position:"absolute",left:r,top:i,transform:this.transform(d),width:a,height:o,zIndex:h,opacity:d.opacity}},n&&Fd.default.createElement("audio",{src:n,ref:this.player,controls:!1}),this.renderShapeGroupContent(d))}}]),n}(Fd.default.Component),Hy="-1",_y="sequenceIndexes",Gy="disableAutoPlay",Yy="playLastStep";!function(e){e[e.Normal=0]="Normal",e[e.Preview=1]="Preview"}(Vy||(Vy={}));var Xy=function(e){y(n,e);var t=k(n);function n(e){var r,i,a;I(this,n),(r=t.call(this,e)).eventHub=new Nd.default,r.isImageLoadFinished=!1,r.shapeGroupRef=Rd.default.createRef(),r.onHyperLinkClick=function(e,t){var n,i,a=r.props,o=a.data,s=a.stateAdapter,c=r.getTurnToSlide(e,t);if(c){var u=c.match(/slide(\S*)/);null!==u&&(null==(n=null==s?void 0:s.onPageJumpTo)||n.call(s,o.uuid,parseInt(u[1],10)))}"number"==typeof e&&(null==(i=null==s?void 0:s.onPageJumpTo)||i.call(s,o.uuid,e))},r.onEventSourceClick=function(e){r.mainAnimationManager.interactiveSeqs.get(e)&&r.onMasterEventSourceClick(e)},r.onMediaPlay=function(e,t,n){void 0!==window&&window.postMessage({shapeId:e,mediaType:t,action:"play"},"*");var i=r.props.callbacks;i&&i.onMediaPlay&&i.onMediaPlay(e,t)},r.onMediaPause=function(e,t,n){var i=r.props,a=i.userId,o=i.callbacks,s=r.state.mediaActionUserIds;void 0!==a&&void 0!==s&&void 0!==s[r.currentSlideKey]&&s[r.currentSlideKey][e]===a&&r.setMediaState({playing:!1,currentTime:n},e),void 0!==window&&window.postMessage({shapeId:e,mediaType:t,action:"pause"},"*"),o&&o.onMediaPause&&o.onMediaPause(e,t)},r.setMediaState=function(e,t){var n,i,a=r.props,s=a.pptState,c=a.userId,u=a.stateAdapter,l=a.data;if(void 0===s||void 0===s.mediaStates)n=o({},r.currentSlideKey,o({},t,e)),void 0!==c&&(i=o({},r.currentSlideKey,o({},t,c)));else{var h=s.mediaStates[r.currentSlideKey];if(void 0===h?h=o({},t,e):h[t]=e,void 0!==c){var d=r.state.mediaActionUserIds;i=void 0!==d?void 0!==d[r.currentSlideKey]?im(rm({},d),o({},r.currentSlideKey,im(rm({},d[r.currentSlideKey]),o({},t,c)))):im(rm({},d),o({},r.currentSlideKey,o({},t,c))):o({},r.currentSlideKey,o({},t,c))}n=im(rm({},s.mediaStates),o({},r.currentSlideKey,h))}u.setState(l.uuid,l.index,im(rm({},s),{mediaStates:n,mediaActionUserIds:i}))};var s=e.data;return r.preSlideIndex=null!=(a=null==(i=e.pptState)?void 0:i.preSlideIndex)?a:0,r.currentSlideKey="".concat(s.uuid,"-").concat(s.index),r.masterAnimationManager=s.animations.masterAnimationManager,r.layoutAnimationManager=s.animations.layoutAnimationManager,r.slideAnimationManager=s.animations.slideAnimationManager,r.mainAnimationManager=s.animations.mainAnimationManager,r.animationCount=s.animations.animationCount,r.initSlideStates(),r.masterInteractiveSeqsKeys=Array.from(r.masterAnimationManager.interactiveSeqs.keys()),r.layoutInteractiveSeqsKeys=Array.from(r.layoutAnimationManager.interactiveSeqs.keys()),r.slideInteractiveSeqsKeys=Array.from(r.slideAnimationManager.interactiveSeqs.keys()),r.slide=Rd.default.createRef(),r.isRenderMaster=e.data.layoutXML.childElement("p:sldLayout").attr.getBoolean("showMasterSp",!0),r.changeStep.bind(S(r)),$m.reset(r.eventHub),r}return M(n,[{key:"componentDidMount",value:function(){this.isImageLoadFinished=$m.endLoadTask("slideDidUpdate"),this.mainAnimationManager.animBoxes.forEach((function(e){return e.applyPreAnimation()}));var e=this.getMainStepsFromSequences();"clickEffect"!==this.mainAnimationManager.mainSeq.effectType&&1===e?(this.mainAnimationManager.mainSeq.seekIndex(0),this.mainAnimationManager.mainSeq.play()):e&&this.mainAnimationManager.mainSeq.seekIndex(e);var t=this.state[this.currentSlideKey],n=t.sequenceSteps,r=t.layoutSequenceSteps,i=t.masterSequenceSteps;this.mainAnimationManager.interactiveSeqs.forEach((function(e,t){n&&n[t]?e.seekIndex(n[t]):r&&r[t]?e.seekIndex(r[t]):i&&i[t]?e.seekIndex(i[t]):e.seekIndex(0)}))}},{key:"UNSAFE_componentWillReceiveProps",value:function(e){var t=this;if(void 0!==e.pptState){var n=this.props.pptState;if(this.setState(e.pptState),!n||!n[this.currentSlideKey])return this.playAnime(n,e.pptState,this.mainAnimationManager.mainSeq,Hy),void this.mainAnimationManager.interactiveSeqs.forEach((function(r,i){t.playAnime(n,e.pptState,r,i)}));if(this.mainAnimationManager.interactiveSeqs.forEach((function(r,i){t.playAnime(n,e.pptState,r,i)})),!e.pptState[this.currentSlideKey])return;this.playAnime(n,e.pptState,this.mainAnimationManager.mainSeq,Hy)}}},{key:"componentDidUpdate",value:function(e,t){var n=this,r=this.props.data;e.data.index!==r.index&&$m.endLoadTask("slideDidUpdate");var i=this.state[this.currentSlideKey];void 0!==t[this.currentSlideKey]&&void 0===i&&(this.resetAnimation(),this.mainAnimationManager.mainSeq.seekIndex(0),setTimeout((function(){"clickEffect"!==n.mainAnimationManager.mainSeq.effectType&&n.mainAnimationManager.mainSeq.play();var t=n.initSlideAnimationState();e.stateAdapter.setState(r.uuid,r.index,rm({},n.composeSlideStateIntoPPTState(t)))}),80))}},{key:"componentDidCatch",value:function(e){console.error("catched error: ",e);var t=this.props,n=t.data,r=t.userId;n.logger&&n.logger.error("catched ppt: ".concat(n.uuid,",\n                index: ").concat(n.index,", user: ").concat(r," render error : "),e)}},{key:"componentWillUnmount",value:function(){this.masterAnimationManager.triggerEvent.emit("onUnmount",{target:"master"}),this.layoutAnimationManager.triggerEvent.emit("onUnmount",{target:"layout"}),this.slideAnimationManager.triggerEvent.emit("onUnmount",{target:"slide"}),this.mainAnimationManager.triggerEvent.emit("onUnmount",{target:"slide"})}},{key:"onPageToNext",value:function(){var e=this.props.stateAdapter;return this.setDisableAutoPlay(!1),this.pauseAllAnimation(!0),e.onPageToNext?e.onPageToNext():void 0}},{key:"onPageToPrev",value:function(){var e=this.props.stateAdapter;return this.pauseAllAnimation(),e.onPageToPrev?e.onPageToPrev():void 0}},{key:"onMasterEventSourceClick",value:function(e){var t,n,r=this,i=this.mainAnimationManager.interactiveSeqs.get(e),a=this.state[this.currentSlideKey],s=this.props,c=s.stateAdapter,u=s.data,l=a.masterSequenceSteps,h=a.layoutSequenceSteps,d=a.sequenceSteps,f=l[e],p="masterSequenceSteps",v=l;(void 0===f&&(f=h[e],p="layoutSequenceSteps",v=h),void 0===f&&(f=d[e],p="sequenceSteps",v=d),void 0!==f)&&(n=void 0!==i&&e!==Hy&&(f>i.length||f===i.length&&!i.isPlaying)?0:f+1,c.setState(u.uuid,u.index,this.composeSlideStateIntoPPTState((o(t={},p,im(rm({},v),o({},e,n))),o(t,"hasChangeStep",!0),t))),0!==f&&0===n&&setTimeout((function(){var t;c.setState(u.uuid,u.index,r.composeSlideStateIntoPPTState((o(t={},p,im(rm({},v),o({},e,n+1))),o(t,"hasChangeStep",!0),t)))}),80))}},{key:"getTurnToSlide",value:function(e,t){var n=this.props.data.resourceLoader;if(t)return/m/.test(t)?n.resource.master[e]:/l/.test(t)?n.resource.layout[e]:n.resource.slide[e];var r=n.resource.master[e];return r||(r=n.resource.layout[e])||(r=n.resource.slide[e]),r}},{key:"getCurrentSequences",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=null!=t?t:this.state,i=r[this.currentSlideKey];if(!i)return[void 0,"masterSequenceSteps"];var a=i.sequenceSteps,o=i.layoutSequenceSteps,s=i.masterSequenceSteps;if("number"==typeof e){var c=this.animationCount,u=c.slide,l=c.layout,h=c.master;if(e<h||n&&e<=h)return[s,"masterSequenceSteps"];if(e<h+l||n&&e<=h+l)return[o,"layoutSequenceSteps"];if(e<h+l+u||n&&e<=h+l+u)return[a,"sequenceSteps"]}return void 0!==s[e]?[s,"masterSequenceSteps"]:void 0!==o[e]?[o,"layoutSequenceSteps"]:[a,"sequenceSteps"]}},{key:"getCurrentSequenceAnimationCount",value:function(e){return"sequenceSteps"===e?this.animationCount.slide:"layoutSequenceSteps"===e?this.animationCount.layout:"masterSequenceSteps"===e?this.animationCount.master:0}},{key:"getMainStepsFromSequences",value:function(e){var t=(null!=e?e:this.state)[this.currentSlideKey];if(t){var n=t.sequenceSteps,r=t.layoutSequenceSteps,i=t.masterSequenceSteps,a=0;return i&&i[Hy]&&i[Hy]>0&&(a+=i[Hy]),r&&r[Hy]&&r[Hy]>0&&(a+=r[Hy]),n&&n[Hy]&&n[Hy]>0&&(a+=n[Hy]),a}}},{key:"getSequencesByKey",value:function(e,t){var n=(null!=t?t:this.state)[this.currentSlideKey];if(!n)return[void 0,void 0];var r=n.sequenceSteps,i=n.layoutSequenceSteps,a=n.masterSequenceSteps;return r&&void 0!==r[e]?[r,"sequenceSteps"]:i&&void 0!==i[e]?[i,"layoutSequenceSteps"]:a&&void 0!==a[e]?[a,"masterSequenceSteps"]:[void 0,void 0]}},{key:"setDisableAutoPlay",value:function(e){var t=this.props,n=t.stateAdapter,r=t.data,i=this.state[this.currentSlideKey],a=i.masterSequenceSteps,o=i.layoutSequenceSteps,s=i.sequenceSteps;n.setState(r.uuid,r.index,this.composeSlideStateIntoPPTState({masterSequenceSteps:a,layoutSequenceSteps:o,sequenceSteps:s},e))}},{key:"pauseAllAnimation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.mainAnimationManager.mainSeq.pause(),e){var t=this.animationCount,n=t.slide,r=t.layout,i=t.master;this.mainAnimationManager.mainSeq.seekIndex(n+r+i)}var a=this.getMainStepsFromSequences();a&&this.mainAnimationManager.mainSeq.seekIndex(a),this.mainAnimationManager.interactiveSeqs.forEach((function(e){return e.pause()}))}},{key:"initSlideAnimationState",value:function(){var e=o({},Hy,0),t=o({},Hy,0),n=o({},Hy,0),r=!1,i=!1;return this.animationCount.master>0&&"clickEffect"!==this.masterAnimationManager.mainSeq.effectType&&(n[Hy]=1,r=!0),this.masterAnimationManager.interactiveSeqs.forEach((function(e,t){n[t]=0})),this.animationCount.layout>0&&"clickEffect"!==this.layoutAnimationManager.mainSeq.effectType&&!r&&(t[Hy]=1,i=!0),this.layoutAnimationManager.interactiveSeqs.forEach((function(e,n){t[n]=0})),this.animationCount.slide>0&&"clickEffect"!==this.slideAnimationManager.mainSeq.effectType&&!r&&!i&&(e[Hy]=1),this.slideAnimationManager.interactiveSeqs.forEach((function(t,n){e[n]=0})),{masterSequenceSteps:n,layoutSequenceSteps:t,sequenceSteps:e,hasChangeStep:!1}}},{key:"initSlideStates",value:function(){var e,t,n=this.initSlideAnimationState(),r=n.hasChangeStep,i=n.sequenceSteps,a=n.layoutSequenceSteps,o=n.masterSequenceSteps,s=this.props.pptState,c={};void 0!==s&&(c=s);var u=c[this.currentSlideKey];u&&(o=null!=(e=u.masterSequenceSteps)?e:o,a=null!=(t=u.layoutSequenceSteps)?t:a,i=u.sequenceSteps),this.state=rm({},this.composeSlideStateIntoPPTState({masterSequenceSteps:o,layoutSequenceSteps:a,sequenceSteps:i,hasChangeStep:r}))}},{key:"composeSlideStateIntoPPTState",value:function(e,t){var n,r,i,a=this.props,s=a.pptState,c=a.data;if(!this.state)return im(rm({},s),(o(n={},this.currentSlideKey,rm({},e)),o(n,"uuid",c.uuid),o(n,"pageIndex",c.index),n));var u=this.state[this.currentSlideKey];return im(rm({},s),void 0!==t?(o(r={},this.currentSlideKey,rm(rm({},u),e)),o(r,"uuid",c.uuid),o(r,"pageIndex",c.index),o(r,"disableAutoPlay",t),r):(o(i={},this.currentSlideKey,rm(rm({},u),e)),o(i,"uuid",c.uuid),o(i,"pageIndex",c.index),i))}},{key:"playAnime",value:function(e,t,n,r){var i,a,o;if(r===Hy)a=this.getMainStepsFromSequences(e),o=this.getMainStepsFromSequences(t);else{var s=h(this.getSequencesByKey(r,e),1)[0],c=h(this.getSequencesByKey(r,t),1)[0];s&&(a=s[r]),c&&(o=c[r])}if(a!==o)if(o){if(o!==a)if(-1===a)n.seekIndex((null==(i=this.slideAnimationManager.mainSeq)?void 0:i.length)||0);else if(o<=n.length&&o>=0){var u=o-(a||0);u>0?((n.index===o-2&&n.isPlaying||u>1)&&n.seekIndex(o-1),n.play()):u<0&&(n.pause(),n.seekIndex(o))}else o>n.length&&(n.pause(),n.seekIndex(n.length))}else n.pause(),n.seekIndex(0)}},{key:"resetAnimationSteps",value:function(){var e={},t={},n={};return this.masterAnimationManager.interactiveSeqs.forEach((function(e,t){n[t]=0})),n[Hy]=0,this.layoutAnimationManager.interactiveSeqs.forEach((function(e,n){t[n]=0})),t[Hy]=0,this.masterAnimationManager.interactiveSeqs.forEach((function(t,n){e[n]=0})),e[Hy]=0,{sequenceSteps:e,layoutSequenceSteps:t,masterSequenceSteps:n,hasChangeStep:!1}}},{key:"resetAnimation",value:function(){var e=this.props,t=e.stateAdapter,n=e.data,r=this.resetAnimationSteps(),i=im(rm({},this.state),o({},this.currentSlideKey,r));t.setState(n.uuid,n.index,i)}},{key:"resetCurrentSlideAnimation",value:function(){var e=this.props,t=e.stateAdapter,n=e.data,r=im(rm({},this.state),o({},this.currentSlideKey,void 0));t.setState(n.uuid,n.index,r)}},{key:"resetCurrentPPTAnimation",value:function(){var e=this,t=this.state,n=t.disableAutoPlay,r=t.pageIndex,i=t.playLastStep,a=t.progressIndex,o=t.uuid;if(t[this.currentSlideKey]){var s=this.props,c=s.data,u=s.stateAdapter,l={disableAutoPlay:n,pageIndex:r,playLastStep:i,progressIndex:a,uuid:o,preSlideIndex:s.pptState.preSlideIndex},h=Object.keys(this.state).filter((function(e){return e.includes(c.uuid)})).map((function(t){var n=e.state[t];return rm({key:t},n)})),d={};h.forEach((function(e){var t=e.key;d[t]=void 0})),l=rm(rm({},l),d),u.setState(c.uuid,c.index,l)}}},{key:"toNextPage",value:function(){var e=this.props.stateAdapter;e.onPageToNext&&e.onPageToNext()}},{key:"toPrevPage",value:function(){var e=this.props.stateAdapter;e.onPageToPrev&&e.onPageToPrev()}},{key:"changeStep",value:function(e){var t,n,r=this.props,i=r.stateAdapter,a=r.data,s=this.getMainStepsFromSequences(),c=h(this.getCurrentSequences(null!=s?s:1,void 0,e<0),2),u=c[0],l=c[1];if(void 0!==u&&void 0!==l){var d=u[Hy];if(void 0!==d&&0!==this.mainAnimationManager.mainSeq.length){d<0&&(this.masterAnimationManager.triggerEvent.emit("onEnd",{target:"slide"}),d=this.mainAnimationManager.mainSeq.length);var f=d+e;f<0?this.onPageToPrev():f>this.getCurrentSequenceAnimationCount(l)?this.onPageToNext():1===d&&0===f?i.setState(a.uuid,a.index,rm({},this.composeSlideStateIntoPPTState((o(t={},l,im(rm({},u),o({},Hy,f))),o(t,"hasChangeStep",!0),t),!0))):i.setState(a.uuid,a.index,rm({},this.composeSlideStateIntoPPTState((o(n={},l,im(rm({},u),o({},Hy,f))),o(n,"hasChangeStep",!0),n))))}else e>0?this.onPageToNext():e<0&&this.onPageToPrev()}}},{key:"renderMediaControllerPortal",value:function(e){return 0===this.props.renderMode?Rd.default.createElement("div",{id:"netless-media-controller-portal-".concat(e.uuid),style:{position:"absolute",zIndex:1e3}}):null}},{key:"render",value:function(){var e,t,n,r,i,a,o,s=this.props,c=s.disableAnimation,u=s.renderMode,l=s.className,h=s.data,d=s.pausing,f=s.userId,p=s.callbacks,v=s.pptState,m=h.slideXML.childElement("p:sld","p:cSld","p:spTree"),g=h.masterXML.childElement("p:sldMaster","p:cSld","p:spTree"),y=h.layoutXML.childElement("p:sldLayout","p:cSld","p:spTree"),b=h.slideXML.childElement("p:sld","p:cSld"),k={uuid:h.uuid,resourceLoader:h.resourceLoader,slideWidth:h.width,slideHeight:h.height,preSlideIndex:this.preSlideIndex,slideIndex:h.index+1,preload:h.preload,slideCount:h.slidesCount},w=c;void 0!==u&&1===u&&(w=!0);var S=null==(e=null==v?void 0:v.mediaStates)?void 0:e[this.currentSlideKey];return Rd.default.createElement(eg,{className:l,slideContext:k,slideRef:this.slide,cSld:b,resourceLoader:h.resourceLoader},this.renderMediaControllerPortal(h),this.isRenderMaster&&Rd.default.createElement(Wy,{uuid:h.uuid,logger:h.logger,slideRef:this.slide,slideContext:k,shapeGroupXML:g,resourceType:"master",disableAnimation:w,zIndex:0,wrapResource:null==(t=h.WrapResource)?void 0:t.master,ref:this.shapeGroupRef,pausing:d,userId:f,interactiveSeqsKeys:this.masterInteractiveSeqsKeys||[],onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:S,mediaSlideActionUserIds:null==(n=null==v?void 0:v.mediaActionUserIds)?void 0:n[this.currentSlideKey],onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:p?p.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:h.rtcClient,animationManager:this.masterAnimationManager}),Rd.default.createElement(Wy,{uuid:h.uuid,logger:h.logger,slideRef:this.slide,slideContext:k,shapeGroupXML:y,resourceType:"layout",disableAnimation:w,zIndex:1,wrapResource:null==(r=h.WrapResource)?void 0:r.layout,ref:this.shapeGroupRef,pausing:d,userId:f,interactiveSeqsKeys:this.layoutInteractiveSeqsKeys||[],onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:S,mediaSlideActionUserIds:null==(i=null==v?void 0:v.mediaActionUserIds)?void 0:i[this.currentSlideKey],onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:p?p.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:h.rtcClient,animationManager:this.layoutAnimationManager}),Rd.default.createElement(Wy,{uuid:h.uuid,ref:this.shapeGroupRef,shapeGroupXML:m,pausing:d,userId:f,logger:h.logger,slideRef:this.slide,slideContext:k,resourceType:"slide",interactiveSeqsKeys:this.slideInteractiveSeqsKeys||[],zIndex:2,onEventSourceClick:this.onEventSourceClick,onHyperLinkClick:this.onHyperLinkClick,meidaStates:S,mediaSlideActionUserIds:null==(a=null==v?void 0:v.mediaActionUserIds)?void 0:a[this.currentSlideKey],disableAnimation:w,onMediaChange:this.setMediaState,onMediaPlay:this.onMediaPlay,onMediaPlayError:p?p.onMediaPlayError:void 0,onMediaPause:this.onMediaPause,rtcClient:h.rtcClient,wrapResource:null==(o=h.WrapResource)?void 0:o.slide,animationManager:this.slideAnimationManager}))}}]),n}(Rd.default.Component);function qy(e,t){var n,r={},i={},a={},o=A(e.elements);try{for(o.s();!(n=o.n()).done;){var s=n.value,c=s.childElementOptional(new Sm("p:nvSpPr","p:nvCxnSpPr"));if(c){var u=c.childElement("p:cNvPr").attr.getStringOptional("id"),l=c.childElementOptional("p:nvPr","p:ph"),h=l&&l.attr.getStringOptional("idx"),d=l&&l.attr.getStringOptional("type");void 0!==u&&(r[u]=s),void 0!==h?i[h]=s:("title"===d||"ctrTitle"===d)&&(i[0]=s),"title"===d||"ctrTitle"===d?(a.title=s,a.ctrTitle=s):void 0!==d&&(a[d]=s)}}}catch(e){o.e(e)}finally{o.f()}return Object.freeze(t?{idIndex:Object.freeze(r),idxIndex:Object.freeze(i),typeIndex:Object.freeze(a),txStyle:Object.freeze(Qy(t))}:{idIndex:Object.freeze(r),idxIndex:Object.freeze(i),typeIndex:Object.freeze(a)})}function Qy(e){var t={},n=e.elementWithName("p:bodyStyle");n&&(t.body=n);var r=e.elementWithName("p:titleStyle");r&&(t.title=r,t.subTitle=r,t.ctrTitle=r);var i=e.elementWithName("p:otherStyle");return i&&(t.other=i),t}var Ky=function(){function e(t,n){I(this,e),this.resource=t,this.resourceScheme=n}return M(e,[{key:"loadURL",value:function(e,t){var n=this.resource[e]&&this.resource[e][t];return void 0===n||(n=this.replaceProtocolByresourceScheme(n)),n}},{key:"replaceProtocolByresourceScheme",value:function(e){var t=e;return this.resourceScheme&&(t=t.replace(/^[a-zA-z]+[^://]/,this.resourceScheme)),t}}]),e}();var Zy=function(e,t,n,r,i){var a,o=function(e,t,n,r){var i=n.bodyPrXMlList;return i||(i=n.bodyPrXMlList=Object.freeze(function(e,t,n){var r,i=[],a=ty(e.parentElement(new Sm("p:sp","p:graphicFrame")),t,n),o=a.allShape,s=a.hasPlaceHolder,c=A(o);try{for(c.s();!(r=c.n()).done;){var u=r.value.childElementOptional("p:txBody","a:bodyPr");u&&i.push(u)}}catch(e){c.e(e)}finally{c.f()}return{pPrXMLList:i,hasPlaceHolder:s}}(e,t,r))),i}(e,t,r,i),s=A(o.pPrXMLList);try{for(s.s();!(a=s.n()).done;){var c=a.value.attr.getOptional(n);if(void 0!==c)return c}}catch(e){s.e(e)}finally{s.f()}};var Jy=function(e,t,n,r,i){var a,o=A(tb(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.attr.getOptional(n);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}},$y=function(e,t){return function(n,r,i,a,o){var s,c=tb(n,r,a,o),u=c.pPrXMLList,l=c.hasPlaceHolder,h=A(u);try{for(h.s();!(s=h.n()).done;){var d=s.value.attr.getOptional(i);if(void 0!==d)return d}}catch(e){h.e(e)}finally{h.f()}return l?e:t}},eb=function(e,t,n,r,i){return tb(e,t,r,i).level};function tb(e,t,n,r){var i=n.pPrXMlList;return i||(i=n.pPrXMlList=Object.freeze(function(e,t,n){var r=[],i=e.parentElement(new Sm("p:sp","p:graphicFrame")),a=e.childElementOptional("a:pPr"),o=0;a&&(r.push(a),o=a.attr.getNumber("lvl",0));var s,c="a:lvl".concat(o+1,"pPr"),u=ty(i,t,n),l=u.allShape,h=u.placeHolderType,d=u.masterStyleXML,f=u.hasPlaceHolder,p=A(l);try{for(p.s();!(s=p.n()).done;){var v=s.value.childElementOptional("p:txBody","a:lstStyle",c);v&&r.push(v)}}catch(e){p.e(e)}finally{p.f()}if(d){var m=d.childElementOptional(c);m&&r.push(m)}return{pPrXMLList:r,placeHolderType:h,level:o,hasPlaceHolder:f}}(e,t,r))),i}var nb=function(e,t,n,r,i){var a,o=A(ab(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.attr.getOptional(n);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}},rb=function(e,t){var n=e.childElementOptional("a:rPr","a:highlight",g(Sm,Bm));if(n)return Xm(n,t)},ib=function(e,t,n,r,i){var a=nb(e,t,"sz",r,i),o=nb(e,t,"kern",r,i);return a||o};function ab(e,t,n,r){var i=n.rangeXMlList;return i||(i=n.rangeXMlList=Object.freeze(function(e,t,n){var r,i=e.elementWithName("a:rPr");r="a:p"===e.name?e:e.parentElement("a:p");var a=function(e,t,n){var r=[],i=e.parentElement(new Sm("p:sp","p:graphicFrame")),a=e.childElementOptional("a:pPr"),o=0;if(a){o=a.attr.getNumber("lvl",0);var s=a.childElementOptional("a:defRPr");s&&r.push(s)}var c,u="a:lvl".concat(o+1,"pPr"),l=ty(i,t,n),h=l.allShape,d=l.placeHolderType,f=l.masterStyleXML,p=l.hasPlaceHolder,v=A(h);try{for(v.s();!(c=v.n()).done;){var m=c.value,g=m.childElementOptional("p:txBody","a:lstStyle",u,"a:defRPr");g&&r.push(g);var y=m.childElementOptional("p:style");if(y){var b=Um(y,t);r.push(b.font.fontRef),b.font.xml&&r.push(b.font.xml)}}}catch(e){v.e(e)}finally{v.f()}if(f){var k=f.childElementOptional(u,"a:defRPr");k&&r.push(k)}return{pPrXMLList:r,placeHolderType:d,level:o,hasPlaceHolder:p}}(r,t,n),o=a.placeHolderType,s=a.pPrXMLList,c=a.level,u=a.hasPlaceHolder;return i?{placeHolderType:o,pPrXMLList:[e,i].concat(p(s)),level:c,hasPlaceHolder:u}:{placeHolderType:o,pPrXMLList:[e].concat(p(s)),level:c,hasPlaceHolder:u}}(e,t,r))),i}var ob=function(e,t,n,r,i){var a,o=A(ab(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=s.childElementOptional(g(Sm,zm));if(c)return(new Km).read(c,t);var u=s.childElementOptional(g(Sm,Bm));if(u)return Xm(u,t)}}catch(e){o.e(e)}finally{o.f()}},sb=function(e,t,n,r,i){var a,o=ab(e,t,r,i),s=[],c=A(o.pPrXMLList);try{for(c.s();!(a=c.n()).done;){var u=a.value,l=u.childElementOptional("a:latin"),h=u.childElementOptional("a:ea");if(l){var d=l.attr.getOptional("typeface");"string"==typeof d&&s.push(d)}if(h){var f=h.attr.getOptional("typeface");"string"==typeof f&&s.push(f)}}}catch(e){c.e(e)}finally{c.f()}s=(s=function(e){switch(e){case"title":case"ctrTitle":return!0;default:return!1}}(o.placeHolderType)?s.concat(Fm(Nm(t))):s.concat(Fm(Lm(t)))).filter((function(e){return""!==e}));var p=[],v=Nm(t),m=Lm(t);return s.forEach((function(e){switch(e){case"+mj-lt":p=v.latin?p.concat(v.latin):p;break;case"+mj-ea":p=v.ea?p.concat(v.ea):p;break;case"+mj-cs":p=v.cs?p.concat(v.cs):p;break;case"+mn-lt":p=m.latin?p.concat(m.latin):p;break;case"+mn-ea":p=m.ea?p.concat(m.ea):p;break;case"+mn-cs":p=v.cs?p.concat(v.cs):p;break;default:p.push(e)}})),p.forEach((function(e){Tm(e,t.userFonts).then((function(){}),(function(){}))})),p.join(",")},cb=function(e){var t=e.parentElement(new Sm("p:sp","p:graphicFrame")).childElementOptional(new Sm("p:nvSpPr","p:nvCxnSpPr"));return t&&t.childElementOptional("p:nvPr","p:ph")?"true":"false"},ub=function(e,t,n,r,i){var a,o=A(tb(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional(new Sm("a:buChar","a:buNone","a:buAutoNum","a:buBlip"));if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}},lb=function(e,t,n,r,i){var a,o=A(tb(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=a.value.childElementOptional("a:buClr");if(s)return Xm(s.childElement(g(Sm,Bm)),t)}}catch(e){o.e(e)}finally{o.f()}};function hb(e){var t=e.childElementOptional("a:lnSpc",new Sm("a:spcPct","a:spcPts"));if(t){var n=0,r=e.parentElementOptional("p:txBody");if(r){var i=r.childElementOptional("a:bodyPr","a:normAutofit");i&&(n=um(i.attr.getNumber("lnSpcReduction",0)))}switch(t.name){case"a:spcPct":return 1.2*um(t.attr.getString("val"))-n;case"a:spcPts":return"".concat(t.attr.getNumber("val")/100*(1-n),"pt");default:return}}}var db=function(e,t,n,r,i){var a,o=A(tb(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=hb(a.value);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}return 1},fb=function(e,t,n,r,i){var a,o=A(tb(e,t,r,i).pPrXMLList);try{for(o.s();!(a=o.n()).done;){var s=pb(a.value,n);if(void 0!==s)return s}}catch(e){o.e(e)}finally{o.f()}};function pb(e,t){var n=e.childElementOptional(t,new Sm("a:spcPct","a:spcPts"));if(n)switch(n.name){case"a:spcPct":return um(n.attr.getString("val"));case"a:spcPts":return"".concat(n.attr.getNumber("val")/100,"pt");default:return}}function vb(e,t,n){var r,i=A(ty(e,t,n).allShape);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.childElementOptional("p:spPr","a:xfrm","a:off");if(void 0!==o||void 0!==(o=a.childElementOptional("p:xfrm","a:off")))return o}}catch(e){i.e(e)}finally{i.f()}var s=gb(e,t,n);return s&&s.childElementOptional("a:off")}function mb(e,t,n){var r,i=A(ty(e,t,n).allShape);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.childElementOptional("p:spPr","a:xfrm","a:ext");if(void 0!==o||void 0!==(o=a.childElementOptional("p:xfrm","a:ext")))return o}}catch(e){i.e(e)}finally{i.f()}var s=gb(e,t,n);return s&&s.childElementOptional("a:ext")}function gb(e,t,n){var r;if("slide"===n){var i=e.childElementOptional("p:spPr","a:xfrm");if(i)return i;var a=null==(r=e.childElementOptional("p:nvPicPr","p:nvPr","p:ph"))?void 0:r.attr.getStringOptional("idx");if(a){var o=t.layoutIndex.idxIndex[a];if(o)return o.childElementOptional("p:spPr","a:xfrm");var s=t.masterIndex.idxIndex[a];return s?s.childElementOptional("p:spPr","a:xfrm"):void 0}}}var yb=["","styleName","wholeTbl","tcTxStyle","fontRef","minor","idx","scrgbClr","0","r","g","b","schemeClr","tx1","val","","tcStyle","tcBdr","left","ln","12700","w","sng","cmpd","solidFill","right","top","bottom","insideH","insideV"," 1 -  1","tblBg","fillRef","2","accent1","effectRef","1","dk1","lnRef","band1H","fill","alpha","40000","band1V","lastCol","on","firstCol","lastRow","firstRow","lt1"," 1 -  2","accent2"," 1 -  3","accent3"," 1 -  4","accent4"," 1 -  5","accent5"," 1 -  6","accent6"," 2 -  1","3","tint","50000","20000"," 2 -  2"," 2 -  3"," 2 -  4"," 2 -  5"," 2 -  6"," 1"," 1 -  1"," 1 -  2"," 1 -  3"," 1 -  4"," 1 -  5"," 1 -  6"," 2","band2V","50800","dbl","bg1"," 2 -  1"," 2 -  2"," 2 -  3"," 2 -  4"," 2 -  5"," 2 -  6"," 3","25400"," 3 -  1"," 3 -  2"," 3 -  3"," 3 -  4"," 3 -  5"," 3 -  6"," 1"," 1 -  1"," 1 -  2"," 1 -  3"," 1 -  4"," 1 -  5"," 1 -  6"," 2","prstClr","black","38100"," 2 -  1"," 2 -  2"," 2 -  3"," 2 -  4"," 2 -  5"," 2 -  6"," 3","seCell","swCell"," 3 -  1"," 3 -  2"," 3 -  3"," 3 -  4"," 3 -  5"," 3 -  6"," 4"," 4 -  1"," 4 -  2"," 4 -  3"," 4 -  4"," 4 -  5"," 4 -  6"," 1","60000"," 1 -  1","shade"," 1 -  2"," 1 -  3"," 1 -  4"," 1 -  5"," 1 -  6"," 2"," 2 -  1/ 2"," 2 -  3/ 4"," 2 -  5/ 6"],bb=[{4:{6:5,7:{9:8,10:8,11:8}},12:{14:13}},{19:{21:20,23:22,24:{12:{14:13}}}},{4:{6:5,7:{9:8,10:8,11:8}},12:{14:37}},{38:{6:36,12:{14:34}}},{6:33,12:{14:34}},{6:36,12:{14:34}},{14:42},{11:45},{38:{6:33,12:{14:34}}},{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},{24:{12:{14:34}}},{38:{6:33,12:{14:49}}},{38:{6:36,12:{14:51}}},{6:33,12:{14:51}},{6:36,12:{14:51}},{38:{6:33,12:{14:51}}},{24:{12:{14:51}}},{38:{6:36,12:{14:53}}},{6:33,12:{14:53}},{6:36,12:{14:53}},{38:{6:33,12:{14:53}}},{24:{12:{14:53}}},{38:{6:36,12:{14:55}}},{6:33,12:{14:55}},{6:36,12:{14:55}},{38:{6:33,12:{14:55}}},{24:{12:{14:55}}},{38:{6:36,12:{14:57}}},{6:33,12:{14:57}},{6:36,12:{14:57}},{38:{6:33,12:{14:57}}},{24:{12:{14:57}}},{38:{6:36,12:{14:59}}},{6:33,12:{14:59}},{6:36,12:{14:59}},{38:{6:33,12:{14:59}}},{24:{12:{14:59}}},{16:{40:{24:{12:{14:49,41:{14:64}}}}}},{3:{11:45},16:{17:{18:{38:{6:33,12:{14:49}}}}}},{3:{11:45},16:{17:{25:{38:{6:33,12:{14:49}}}}}},{3:{11:45},16:{17:{26:{38:{6:33,12:{14:49}}}}}},{3:{11:45},16:{17:{27:{38:{6:61,12:{14:49}}}}}},{4:{6:5,7:{9:8,10:8,11:8}},12:{14:49}},{38:{6:36,12:{14:34,62:{14:63}}}},{14:34},{38:{6:36,12:{14:51,62:{14:63}}}},{14:51},{38:{6:36,12:{14:53,62:{14:63}}}},{14:53},{38:{6:36,12:{14:55,62:{14:63}}}},{14:55},{38:{6:36,12:{14:57,62:{14:63}}}},{14:57},{38:{6:36,12:{14:59,62:{14:63}}}},{14:59},{16:{40:{24:{12:{14:13,41:{14:64}}}}}},{3:{11:45}},{16:{40:{24:{12:{14:34,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:34}}}},{16:{40:{24:{12:{14:51,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:51}}}},{16:{40:{24:{12:{14:53,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:53}}}},{16:{40:{24:{12:{14:55,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:55}}}},{16:{40:{24:{12:{14:57,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:57}}}},{16:{40:{24:{12:{14:59,41:{14:64}}}}}},{19:{21:20,23:22,24:{12:{14:59}}}},{38:{6:36,12:{14:13}}},{12:{14:13}},{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:81}},{6:36,12:{14:13}},{26:{19:{21:79,23:80,24:{12:{14:34}}}}},{26:{19:{21:79,23:80,24:{12:{14:51}}}}},{26:{19:{21:79,23:80,24:{12:{14:53}}}}},{26:{19:{21:79,23:80,24:{12:{14:55}}}}},{26:{19:{21:79,23:80,24:{12:{14:57}}}}},{26:{19:{21:79,23:80,24:{12:{14:59}}}}},{12:{14:34}},{12:{14:51}},{12:{14:53}},{12:{14:55}},{12:{14:57}},{12:{14:59}},{16:{40:{24:{12:{14:37,62:{14:64}}}}}},{3:{11:45},16:{17:{26:{19:{21:79,23:80,24:{12:{14:37}}}}},40:{24:{12:{14:49}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:37}}}}},{24:{12:{14:49}}},{19:{21:20,23:22,24:{12:{14:37}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:34}}}}},{40:{24:{12:{14:34,62:{14:64}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:51}}}}},{40:{24:{12:{14:51,62:{14:64}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:53}}}}},{40:{24:{12:{14:53,62:{14:64}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:55}}}}},{40:{24:{12:{14:55,62:{14:64}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:57}}}}},{40:{24:{12:{14:57,62:{14:64}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:49}},16:{40:{24:{12:{14:59}}}}},{40:{24:{12:{14:59,62:{14:64}}}}},{16:{40:{24:{12:{14:37,62:{14:42}}}}}},{4:{6:5,104:{14:105}},12:{14:37}},{18:{19:{21:20,23:22,24:{12:{14:49}}}},25:{19:{21:20,23:22,24:{12:{14:49}}}},26:{19:{21:20,23:22,24:{12:{14:49}}}},27:{19:{21:20,23:22,24:{12:{14:49}}}},28:{19:{21:20,23:22,24:{12:{14:49}}}},29:{19:{21:20,23:22,24:{12:{14:49}}}}},{24:{12:{14:37,62:{14:64}}}},{4:{6:5,104:{14:105}},11:45,12:{14:49}},{40:{24:{12:{14:37}}}},{26:{19:{21:106,23:22,24:{12:{14:49}}}}},{24:{12:{14:37}}},{27:{19:{21:106,23:22,24:{12:{14:49}}}}},{16:{40:{24:{12:{14:34,62:{14:42}}}}}},{24:{12:{14:34,62:{14:64}}}},{40:{24:{12:{14:34}}}},{16:{40:{24:{12:{14:51,62:{14:42}}}}}},{24:{12:{14:51,62:{14:64}}}},{40:{24:{12:{14:51}}}},{16:{40:{24:{12:{14:53,62:{14:42}}}}}},{24:{12:{14:53,62:{14:64}}}},{40:{24:{12:{14:53}}}},{16:{40:{24:{12:{14:55,62:{14:42}}}}}},{24:{12:{14:55,62:{14:64}}}},{40:{24:{12:{14:55}}}},{16:{40:{24:{12:{14:57,62:{14:42}}}}}},{24:{12:{14:57,62:{14:64}}}},{40:{24:{12:{14:57}}}},{16:{40:{24:{12:{14:59,62:{14:42}}}}}},{24:{12:{14:59,62:{14:64}}}},{40:{24:{12:{14:59}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},11:45,12:{14:37}}},{17:{26:{19:{21:89,23:22,24:{12:{14:37}}}},27:{19:{21:89,23:22,24:{12:{14:37}}}}},40:{24:{12:{14:49}}}},{14:37},{27:{19:{21:89,23:22,24:{12:{14:37}}}}},{3:{4:{6:5,7:{9:8,10:8,11:8}},12:{14:37}},16:{17:{26:{19:{21:89,23:22,24:{12:{14:37}}}},27:{19:{21:89,23:22,24:{12:{14:37}}}}},40:{24:{12:{14:49}}}}},{19:{21:89,23:22,24:{12:{14:37}}}},{40:{24:{12:{14:37,62:{14:64}}}}},{3:{11:45},16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:{24:{12:{14:37}}}}},{18:{19:{21:89,23:22,24:{12:{14:49}}}}},{24:{12:{14:37,62:{14:130}}}},{25:{19:{21:89,23:22,24:{12:{14:49}}}}},{26:{19:{21:89,23:22,24:{12:{14:49}}}}},{24:{12:{14:34,132:{14:130}}}},{24:{12:{14:51,132:{14:130}}}},{24:{12:{14:53,132:{14:130}}}},{24:{12:{14:55,132:{14:130}}}},{24:{12:{14:57,132:{14:130}}}},{24:{12:{14:59,132:{14:130}}}},{26:{19:{21:79,23:80,24:{12:{14:37}}}}}],kb={"{2D5ABB26-0587-4C30-8999-92F81FD0307C}":{1:0,2:{3:bb[0]}},"{5940675A-B579-460E-94D1-54222C63F5DA}":{1:15,2:{3:bb[0],16:{17:{18:bb[1],25:bb[1],26:bb[1],27:bb[1],28:bb[1],29:bb[1]}}}},"{3C2FFA5D-87B4-456A-9821-1D502468CF0F}":{1:30,2:{3:bb[2],16:{17:{18:bb[3],25:bb[3],26:bb[3],27:bb[3],28:bb[3],29:bb[3]}}},31:{32:bb[4],35:bb[5]},39:{16:{40:{24:{12:{14:34,41:bb[6]}}}}},43:{16:{17:{26:bb[3],27:bb[3]},40:{24:{12:{14:34,41:bb[6]}}}}},44:{3:bb[7],16:{17:{18:{38:bb[4]},25:bb[3],26:bb[3],27:bb[3],28:bb[3]}}},46:{3:bb[7],16:{17:{18:bb[3],25:{38:bb[4]},26:bb[3],27:bb[3],28:bb[3]}}},47:{3:bb[7],16:{17:{18:bb[3],25:bb[3],26:{38:bb[4]},27:{38:bb[4]}}}},48:{3:bb[9],16:{17:{18:bb[3],25:bb[3],26:bb[3],27:bb[11]},40:bb[10]}}},"{284E427A-3D55-4303-BF80-6455036E1DE7}":{1:50,2:{3:bb[2],16:{17:{18:bb[12],25:bb[12],26:bb[12],27:bb[12],28:bb[12],29:bb[12]}}},31:{32:bb[13],35:bb[14]},39:{16:{40:{24:{12:{14:51,41:bb[6]}}}}},43:{16:{17:{26:bb[12],27:bb[12]},40:{24:{12:{14:51,41:bb[6]}}}}},44:{3:bb[7],16:{17:{18:{38:bb[13]},25:bb[12],26:bb[12],27:bb[12],28:bb[12]}}},46:{3:bb[7],16:{17:{18:bb[12],25:{38:bb[13]},26:bb[12],27:bb[12],28:bb[12]}}},47:{3:bb[7],16:{17:{18:bb[12],25:bb[12],26:{38:bb[13]},27:{38:bb[13]}}}},48:{3:bb[9],16:{17:{18:bb[12],25:bb[12],26:bb[12],27:bb[11]},40:bb[16]}}},"{69C7853C-536D-4A76-A0AE-DD22124D55A5}":{1:52,2:{3:bb[2],16:{17:{18:bb[17],25:bb[17],26:bb[17],27:bb[17],28:bb[17],29:bb[17]}}},31:{32:bb[18],35:bb[19]},39:{16:{40:{24:{12:{14:53,41:bb[6]}}}}},43:{16:{17:{26:bb[17],27:bb[17]},40:{24:{12:{14:53,41:bb[6]}}}}},44:{3:bb[7],16:{17:{18:{38:bb[18]},25:bb[17],26:bb[17],27:bb[17],28:bb[17]}}},46:{3:bb[7],16:{17:{18:bb[17],25:{38:bb[18]},26:bb[17],27:bb[17],28:bb[17]}}},47:{3:bb[7],16:{17:{18:bb[17],25:bb[17],26:{38:bb[18]},27:{38:bb[18]}}}},48:{3:bb[9],16:{17:{18:bb[17],25:bb[17],26:bb[17],27:bb[11]},40:bb[21]}}},"{775DCB02-9BB8-47FD-8907-85C794F793BA}":{1:54,2:{3:bb[2],16:{17:{18:bb[22],25:bb[22],26:bb[22],27:bb[22],28:bb[22],29:bb[22]}}},31:{32:bb[23],35:bb[24]},39:{16:{40:{24:{12:{14:55,41:bb[6]}}}}},43:{16:{17:{26:bb[22],27:bb[22]},40:{24:{12:{14:55,41:bb[6]}}}}},44:{3:bb[7],16:{17:{18:{38:bb[23]},25:bb[22],26:bb[22],27:bb[22],28:bb[22]}}},46:{3:bb[7],16:{17:{18:bb[22],25:{38:bb[23]},26:bb[22],27:bb[22],28:bb[22]}}},47:{3:bb[7],16:{17:{18:bb[22],25:bb[22],26:{38:bb[23]},27:{38:bb[23]}}}},48:{3:bb[9],16:{17:{18:bb[22],25:bb[22],26:bb[22],27:bb[11]},40:bb[26]}}},"{35758FB7-9AC5-4552-8A53-C91805E547FA}":{1:56,2:{3:bb[2],16:{17:{18:bb[27],25:bb[27],26:bb[27],27:bb[27],28:bb[27],29:bb[27]}}},31:{32:bb[28],35:bb[29]},39:{16:{40:{24:{12:{14:57,41:bb[6]}}}}},43:{16:{17:{26:bb[27],27:bb[27]},40:{24:{12:{14:57,41:bb[6]}}}}},44:{3:bb[7],16:{17:{18:{38:bb[28]},25:bb[27],26:bb[27],27:bb[27],28:bb[27]}}},46:{3:bb[7],16:{17:{18:bb[27],25:{38:bb[28]},26:bb[27],27:bb[27],28:bb[27]}}},47:{3:bb[7],16:{17:{18:bb[27],25:bb[27],26:{38:bb[28]},27:{38:bb[28]}}}},48:{3:bb[9],16:{17:{18:bb[27],25:bb[27],26:bb[27],27:bb[11]},40:bb[31]}}},"{08FB837D-C827-4EFA-A057-4D05807E0F7C}":{1:58,2:{3:bb[2],16:{17:{18:bb[32],25:bb[32],26:bb[32],27:bb[32],28:bb[32],29:bb[32]}}},31:{32:bb[33],35:bb[34]},39:{16:{40:{24:{12:{14:59,41:bb[6]}}}}},43:{16:{17:{26:bb[32],27:bb[32]},40:{24:{12:{14:59,41:bb[6]}}}}},44:{3:bb[7],16:{17:{18:{38:bb[33]},25:bb[32],26:bb[32],27:bb[32],28:bb[32]}}},46:{3:bb[7],16:{17:{18:bb[32],25:{38:bb[33]},26:bb[32],27:bb[32],28:bb[32]}}},47:{3:bb[7],16:{17:{18:bb[32],25:bb[32],26:{38:bb[33]},27:{38:bb[33]}}}},48:{3:bb[9],16:{17:{18:bb[32],25:bb[32],26:bb[32],27:bb[11]},40:bb[36]}}},"{D113A9D2-9D6B-4929-AA2D-F23B5EE8CBE7}":{1:60,2:{3:bb[42],16:{17:{18:bb[43],25:bb[43],26:bb[43],27:bb[43]}}},31:{32:{6:61,12:bb[44]},35:{6:61,12:bb[44]}},39:bb[37],43:bb[37],44:{3:bb[7],16:{17:{18:bb[11]}}},46:{3:bb[7],16:{17:{25:bb[11]}}},47:{3:bb[7],16:{17:{26:bb[11]}}},48:{3:bb[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{18603FDC-E32A-4AB5-989C-0864C3EAD2B8}":{1:65,2:{3:bb[42],16:{17:{18:bb[45],25:bb[45],26:bb[45],27:bb[45]}}},31:{32:{6:61,12:bb[46]},35:{6:61,12:bb[46]}},39:bb[37],43:bb[37],44:{3:bb[7],16:{17:{18:bb[11]}}},46:{3:bb[7],16:{17:{25:bb[11]}}},47:{3:bb[7],16:{17:{26:bb[11]}}},48:{3:bb[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{306799F8-075E-4A3A-A7F6-7FBC6576F1A4}":{1:66,2:{3:bb[42],16:{17:{18:bb[47],25:bb[47],26:bb[47],27:bb[47]}}},31:{32:{6:61,12:bb[48]},35:{6:61,12:bb[48]}},39:bb[37],43:bb[37],44:{3:bb[7],16:{17:{18:bb[11]}}},46:{3:bb[7],16:{17:{25:bb[11]}}},47:{3:bb[7],16:{17:{26:bb[11]}}},48:{3:bb[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{E269D01E-BC32-4049-B463-5C60D7B0CCD2}":{1:67,2:{3:bb[42],16:{17:{18:bb[49],25:bb[49],26:bb[49],27:bb[49]}}},31:{32:{6:61,12:bb[50]},35:{6:61,12:bb[50]}},39:bb[37],43:bb[37],44:{3:bb[7],16:{17:{18:bb[11]}}},46:{3:bb[7],16:{17:{25:bb[11]}}},47:{3:bb[7],16:{17:{26:bb[11]}}},48:{3:bb[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{327F97BB-C833-4FB7-BDE5-3F7075034690}":{1:68,2:{3:bb[42],16:{17:{18:bb[51],25:bb[51],26:bb[51],27:bb[51]}}},31:{32:{6:61,12:bb[52]},35:{6:61,12:bb[52]}},39:bb[37],43:bb[37],44:{3:bb[7],16:{17:{18:bb[11]}}},46:{3:bb[7],16:{17:{25:bb[11]}}},47:{3:bb[7],16:{17:{26:bb[11]}}},48:{3:bb[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{638B1855-1B75-4FBE-930C-398BA8C253C6}":{1:69,2:{3:bb[42],16:{17:{18:bb[53],25:bb[53],26:bb[53],27:bb[53]}}},31:{32:{6:61,12:bb[54]},35:{6:61,12:bb[54]}},39:bb[37],43:bb[37],44:{3:bb[7],16:{17:{18:bb[11]}}},46:{3:bb[7],16:{17:{25:bb[11]}}},47:{3:bb[7],16:{17:{26:bb[11]}}},48:{3:bb[7],16:{17:{27:{38:{6:61,12:{14:49}}}}}}},"{9D7B26C5-4107-4FEC-AEDC-1716B250A1EF}":{1:70,2:{3:bb[0],16:{17:{26:bb[1],27:bb[1]}}},39:bb[55],43:bb[55],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:bb[1]}}},48:{3:bb[7],16:{17:{27:bb[1]}}}},"{3B4B98B0-60AC-42C2-AFA5-B58CD77FA1E5}":{1:71,2:{3:bb[0],16:{17:{26:{19:{21:20,23:22,24:{12:bb[44]}}},27:{19:{21:20,23:22,24:{12:bb[44]}}}}}},39:bb[57],43:bb[57],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:20,23:22,24:{12:bb[44]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:20,23:22,24:{12:bb[44]}}}}}}},"{0E3FDE45-AF77-4B5C-9715-49D594BDF05E}":{1:72,2:{3:bb[0],16:{17:{26:{19:{21:20,23:22,24:{12:bb[46]}}},27:{19:{21:20,23:22,24:{12:bb[46]}}}}}},39:bb[59],43:bb[59],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:20,23:22,24:{12:bb[46]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:20,23:22,24:{12:bb[46]}}}}}}},"{C083E6E3-FA7D-4D7B-A595-EF9225AFEA82}":{1:73,2:{3:bb[0],16:{17:{26:{19:{21:20,23:22,24:{12:bb[48]}}},27:{19:{21:20,23:22,24:{12:bb[48]}}}}}},39:bb[61],43:bb[61],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:20,23:22,24:{12:bb[48]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:20,23:22,24:{12:bb[48]}}}}}}},"{D27102A9-8310-4765-A935-A1911B00CA55}":{1:74,2:{3:bb[0],16:{17:{26:{19:{21:20,23:22,24:{12:bb[50]}}},27:{19:{21:20,23:22,24:{12:bb[50]}}}}}},39:bb[63],43:bb[63],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:20,23:22,24:{12:bb[50]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:20,23:22,24:{12:bb[50]}}}}}}},"{5FD0F851-EC5A-4D38-B0AD-8093EC10F338}":{1:75,2:{3:bb[0],16:{17:{26:{19:{21:20,23:22,24:{12:bb[52]}}},27:{19:{21:20,23:22,24:{12:bb[52]}}}}}},39:bb[65],43:bb[65],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:20,23:22,24:{12:bb[52]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:20,23:22,24:{12:bb[52]}}}}}}},"{68D230F3-CF80-4859-8CE7-A43EE81993B5}":{1:76,2:{3:bb[0],16:{17:{26:{19:{21:20,23:22,24:{12:bb[54]}}},27:{19:{21:20,23:22,24:{12:bb[54]}}}}}},39:bb[67],43:bb[67],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:20,23:22,24:{12:bb[54]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:20,23:22,24:{12:bb[54]}}}}}}},"{7E9639D4-E3E2-4D34-9284-5A2195B3D0D7}":{1:77,2:{3:bb[0],16:{17:{18:bb[69],25:bb[69],26:bb[69],27:bb[69]}}},39:{16:{17:{26:bb[69],27:bb[69]}}},43:{16:{17:{18:bb[69],25:bb[69]}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:bb[70]}}}}},48:{3:bb[71],16:{32:bb[72]}},78:{16:{17:{18:bb[69],25:bb[69]}}}},"{69012ECD-51FC-41F1-AA8D-1B2483CD663E}":{1:82,2:{3:bb[0],16:{17:{18:bb[3],25:bb[3],26:bb[3],27:bb[3]}}},39:{16:{17:{26:bb[3],27:bb[3]}}},43:{16:{17:{18:bb[3],25:bb[3]}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[44]}}}}}},48:{3:bb[71],16:{32:bb[5]}},78:{16:{17:{18:bb[3],25:bb[3]}}}},"{72833802-FEF1-4C79-8D5D-14CF1EAF98D9}":{1:83,2:{3:bb[0],16:{17:{18:bb[12],25:bb[12],26:bb[12],27:bb[12]}}},39:{16:{17:{26:bb[12],27:bb[12]}}},43:{16:{17:{18:bb[12],25:bb[12]}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[46]}}}}}},48:{3:bb[71],16:{32:bb[14]}},78:{16:{17:{18:bb[12],25:bb[12]}}}},"{F2DE63D5-997A-4646-A377-4702673A728D}":{1:84,2:{3:bb[0],16:{17:{18:bb[17],25:bb[17],26:bb[17],27:bb[17]}}},39:{16:{17:{26:bb[17],27:bb[17]}}},43:{16:{17:{18:bb[17],25:bb[17]}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[48]}}}}}},48:{3:bb[71],16:{32:bb[19]}},78:{16:{17:{18:bb[17],25:bb[17]}}}},"{17292A2E-F333-43FB-9621-5CBBE7FDCDCB}":{1:85,2:{3:bb[0],16:{17:{18:bb[22],25:bb[22],26:bb[22],27:bb[22]}}},39:{16:{17:{26:bb[22],27:bb[22]}}},43:{16:{17:{18:bb[22],25:bb[22]}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[50]}}}}}},48:{3:bb[71],16:{32:bb[24]}},78:{16:{17:{18:bb[22],25:bb[22]}}}},"{5A111915-BE36-4E01-A7E5-04B1672EAD32}":{1:86,2:{3:bb[0],16:{17:{18:bb[27],25:bb[27],26:bb[27],27:bb[27]}}},39:{16:{17:{26:bb[27],27:bb[27]}}},43:{16:{17:{18:bb[27],25:bb[27]}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[52]}}}}}},48:{3:bb[71],16:{32:bb[29]}},78:{16:{17:{18:bb[27],25:bb[27]}}}},"{912C8C85-51F0-491E-9774-3900AFEF0FD7}":{1:87,2:{3:bb[0],16:{17:{18:bb[32],25:bb[32],26:bb[32],27:bb[32]}}},39:{16:{17:{26:bb[32],27:bb[32]}}},43:{16:{17:{18:bb[32],25:bb[32]}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[54]}}}}}},48:{3:bb[71],16:{32:bb[34]}},78:{16:{17:{18:bb[32],25:bb[32]}}}},"{616DA210-FB5B-4158-B5E0-FEB733F419BA}":{1:88,2:{3:bb[0],16:{17:{18:bb[1],25:bb[1],26:bb[1],27:bb[1],28:bb[1],29:bb[1]}}},39:bb[55],43:bb[55],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:bb[70]}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:bb[70]}}}}}},"{BC89EF96-8CEA-46FF-86C4-4CE0E7609802}":{1:90,2:{3:bb[0],16:{17:{18:{19:{21:20,23:22,24:{12:bb[44]}}},25:{19:{21:20,23:22,24:{12:bb[44]}}},26:{19:{21:20,23:22,24:{12:bb[44]}}},27:{19:{21:20,23:22,24:{12:bb[44]}}},28:{19:{21:20,23:22,24:{12:bb[44]}}},29:{19:{21:20,23:22,24:{12:bb[44]}}}}}},39:bb[57],43:bb[57],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[44]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:bb[44]}}}}}}},"{5DA37D80-6434-44D0-A028-1B22A696006F}":{1:91,2:{3:bb[0],16:{17:{18:{19:{21:20,23:22,24:{12:bb[46]}}},25:{19:{21:20,23:22,24:{12:bb[46]}}},26:{19:{21:20,23:22,24:{12:bb[46]}}},27:{19:{21:20,23:22,24:{12:bb[46]}}},28:{19:{21:20,23:22,24:{12:bb[46]}}},29:{19:{21:20,23:22,24:{12:bb[46]}}}}}},39:bb[59],43:bb[59],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[46]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:bb[46]}}}}}}},"{8799B23B-EC83-4686-B30A-512413B5E67A}":{1:92,2:{3:bb[0],16:{17:{18:{19:{21:20,23:22,24:{12:bb[48]}}},25:{19:{21:20,23:22,24:{12:bb[48]}}},26:{19:{21:20,23:22,24:{12:bb[48]}}},27:{19:{21:20,23:22,24:{12:bb[48]}}},28:{19:{21:20,23:22,24:{12:bb[48]}}},29:{19:{21:20,23:22,24:{12:bb[48]}}}}}},39:bb[61],43:bb[61],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[48]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:bb[48]}}}}}}},"{ED083AE6-46FA-4A59-8FB0-9F97EB10719F}":{1:93,2:{3:bb[0],16:{17:{18:{19:{21:20,23:22,24:{12:bb[50]}}},25:{19:{21:20,23:22,24:{12:bb[50]}}},26:{19:{21:20,23:22,24:{12:bb[50]}}},27:{19:{21:20,23:22,24:{12:bb[50]}}},28:{19:{21:20,23:22,24:{12:bb[50]}}},29:{19:{21:20,23:22,24:{12:bb[50]}}}}}},39:bb[63],43:bb[63],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[50]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:bb[50]}}}}}}},"{BDBED569-4797-4DF1-A0F4-6AAB3CD982D8}":{1:94,2:{3:bb[0],16:{17:{18:{19:{21:20,23:22,24:{12:bb[52]}}},25:{19:{21:20,23:22,24:{12:bb[52]}}},26:{19:{21:20,23:22,24:{12:bb[52]}}},27:{19:{21:20,23:22,24:{12:bb[52]}}},28:{19:{21:20,23:22,24:{12:bb[52]}}},29:{19:{21:20,23:22,24:{12:bb[52]}}}}}},39:bb[65],43:bb[65],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[52]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:bb[52]}}}}}}},"{E8B1032C-EA38-4F05-BA0D-38AFFFC7BED3}":{1:95,2:{3:bb[0],16:{17:{18:{19:{21:20,23:22,24:{12:bb[54]}}},25:{19:{21:20,23:22,24:{12:bb[54]}}},26:{19:{21:20,23:22,24:{12:bb[54]}}},27:{19:{21:20,23:22,24:{12:bb[54]}}},28:{19:{21:20,23:22,24:{12:bb[54]}}},29:{19:{21:20,23:22,24:{12:bb[54]}}}}}},39:bb[67],43:bb[67],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[54]}}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:bb[54]}}}}}}},"{793D81CF-94F2-401A-BA57-92F5A7B2D0C5}":{1:96,2:{3:bb[2],16:{17:{18:bb[89],25:bb[89],26:bb[89],27:bb[89],28:bb[89]},40:bb[88]}},39:bb[85],43:bb[85],44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[88]}},48:{3:bb[9],16:bb[107]}},"{B301B821-A1FF-4177-AEE7-76D212191A09}":{1:97,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[44]}}},25:{19:{21:20,23:22,24:{12:bb[44]}}},26:{19:{21:20,23:22,24:{12:bb[44]}}},27:{19:{21:20,23:22,24:{12:bb[44]}}},28:{19:{21:20,23:22,24:{12:bb[44]}}}},40:bb[88]}},39:{16:bb[91]},43:{16:bb[91]},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[44]}}}},40:bb[88]}},48:{3:bb[9],16:{40:bb[10]}}},"{9DCAF9ED-07DC-4A11-8D7F-57B35C25682E}":{1:98,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[46]}}},25:{19:{21:20,23:22,24:{12:bb[46]}}},26:{19:{21:20,23:22,24:{12:bb[46]}}},27:{19:{21:20,23:22,24:{12:bb[46]}}},28:{19:{21:20,23:22,24:{12:bb[46]}}}},40:bb[88]}},39:{16:bb[93]},43:{16:bb[93]},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[46]}}}},40:bb[88]}},48:{3:bb[9],16:{40:bb[16]}}},"{1FECB4D8-DB02-4DC6-A0A2-4F2EBAE1DC90}":{1:99,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[48]}}},25:{19:{21:20,23:22,24:{12:bb[48]}}},26:{19:{21:20,23:22,24:{12:bb[48]}}},27:{19:{21:20,23:22,24:{12:bb[48]}}},28:{19:{21:20,23:22,24:{12:bb[48]}}}},40:bb[88]}},39:{16:bb[95]},43:{16:bb[95]},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[48]}}}},40:bb[88]}},48:{3:bb[9],16:{40:bb[21]}}},"{1E171933-4619-4E11-9A3F-F7608DF75F80}":{1:100,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[50]}}},25:{19:{21:20,23:22,24:{12:bb[50]}}},26:{19:{21:20,23:22,24:{12:bb[50]}}},27:{19:{21:20,23:22,24:{12:bb[50]}}},28:{19:{21:20,23:22,24:{12:bb[50]}}}},40:bb[88]}},39:{16:bb[97]},43:{16:bb[97]},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[50]}}}},40:bb[88]}},48:{3:bb[9],16:{40:bb[26]}}},"{FABFCF23-3B69-468F-B69F-88F6DE6A72F2}":{1:101,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[52]}}},25:{19:{21:20,23:22,24:{12:bb[52]}}},26:{19:{21:20,23:22,24:{12:bb[52]}}},27:{19:{21:20,23:22,24:{12:bb[52]}}},28:{19:{21:20,23:22,24:{12:bb[52]}}}},40:bb[88]}},39:{16:bb[99]},43:{16:bb[99]},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[52]}}}},40:bb[88]}},48:{3:bb[9],16:{40:bb[31]}}},"{10A1B5D5-9B99-4C35-A422-299274C87663}":{1:102,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[54]}}},25:{19:{21:20,23:22,24:{12:bb[54]}}},26:{19:{21:20,23:22,24:{12:bb[54]}}},27:{19:{21:20,23:22,24:{12:bb[54]}}},28:{19:{21:20,23:22,24:{12:bb[54]}}}},40:bb[88]}},39:{16:bb[101]},43:{16:bb[101]},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[54]}}}},40:bb[88]}},48:{3:bb[9],16:{40:bb[36]}}},"{073A0DAA-6AF3-43AB-8588-CEC1D06C72B9}":{1:103,2:{3:bb[103],16:{17:bb[104],40:bb[105]}},39:{16:{40:{24:{12:{14:37,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:37,62:bb[6]}}}}},44:{3:bb[106],16:bb[107]},46:{3:bb[106],16:bb[107]},47:{3:bb[106],16:{17:bb[108],40:bb[109]}},48:{3:bb[106],16:{17:bb[110],40:bb[109]}}},"{5C22544A-7EE6-4342-B048-85BDC9FD1C3A}":{1:107,2:{3:bb[103],16:{17:bb[104],40:bb[112]}},39:{16:{40:{24:{12:{14:34,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:34,62:bb[6]}}}}},44:{3:bb[106],16:{40:bb[10]}},46:{3:bb[106],16:{40:bb[10]}},47:{3:bb[106],16:{17:bb[108],40:bb[10]}},48:{3:bb[106],16:{17:bb[110],40:bb[10]}}},"{21E4AEA4-8DFA-4A89-87EB-49C32662AFE0}":{1:108,2:{3:bb[103],16:{17:bb[104],40:bb[115]}},39:{16:{40:{24:{12:{14:51,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:51,62:bb[6]}}}}},44:{3:bb[106],16:{40:bb[16]}},46:{3:bb[106],16:{40:bb[16]}},47:{3:bb[106],16:{17:bb[108],40:bb[16]}},48:{3:bb[106],16:{17:bb[110],40:bb[16]}}},"{F5AB1C69-6EDB-4FF4-983F-18BD219EF322}":{1:109,2:{3:bb[103],16:{17:bb[104],40:bb[118]}},39:{16:{40:{24:{12:{14:53,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:53,62:bb[6]}}}}},44:{3:bb[106],16:{40:bb[21]}},46:{3:bb[106],16:{40:bb[21]}},47:{3:bb[106],16:{17:bb[108],40:bb[21]}},48:{3:bb[106],16:{17:bb[110],40:bb[21]}}},"{00A15C55-8517-42AA-B614-E9B94910E393}":{1:110,2:{3:bb[103],16:{17:bb[104],40:bb[121]}},39:{16:{40:{24:{12:{14:55,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:55,62:bb[6]}}}}},44:{3:bb[106],16:{40:bb[26]}},46:{3:bb[106],16:{40:bb[26]}},47:{3:bb[106],16:{17:bb[108],40:bb[26]}},48:{3:bb[106],16:{17:bb[110],40:bb[26]}}},"{7DF18680-E054-41AD-8BC1-D1AEF772440D}":{1:111,2:{3:bb[103],16:{17:bb[104],40:bb[124]}},39:{16:{40:{24:{12:{14:57,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:57,62:bb[6]}}}}},44:{3:bb[106],16:{40:bb[31]}},46:{3:bb[106],16:{40:bb[31]}},47:{3:bb[106],16:{17:bb[108],40:bb[31]}},48:{3:bb[106],16:{17:bb[110],40:bb[31]}}},"{93296810-A885-4BE3-A3E7-6D5BEEA58F35}":{1:112,2:{3:bb[103],16:{17:bb[104],40:bb[127]}},39:{16:{40:{24:{12:{14:59,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:59,62:bb[6]}}}}},44:{3:bb[106],16:{40:bb[36]}},46:{3:bb[106],16:{40:bb[36]}},47:{3:bb[106],16:{17:bb[108],40:bb[36]}},48:{3:bb[106],16:{17:bb[110],40:bb[36]}}},"{8EC20E35-A176-4012-BC5E-935CFFF8708E}":{1:113,2:{3:{4:{6:5},12:bb[131]},16:{17:{26:{19:{21:89,23:22,24:{12:bb[131]}}},27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[88]}},39:bb[85],43:bb[85],44:{3:bb[9],16:bb[107]},46:{3:bb[9],16:bb[107]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[88]}},48:{3:bb[9],16:{17:{27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[109]}},114:bb[129],115:bb[129]},"{6E25E649-3F16-4E02-A733-19D2CDBF48F0}":{1:116,2:{3:bb[2],16:{17:{26:{19:{21:89,23:22,24:{12:bb[131]}}},27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[88]}},39:bb[85],43:bb[85],44:{3:bb[9],16:{40:bb[10]}},46:{3:bb[9],16:{40:bb[10]}},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[88]}},48:{3:bb[9],16:{17:{27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[10]}},114:bb[129],115:bb[129]},"{85BE263C-DBD7-4A20-BB59-AAB30ACAA65A}":{1:117,2:{3:bb[2],16:{17:{26:{19:{21:89,23:22,24:{12:bb[131]}}},27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[88]}},39:bb[85],43:bb[85],44:{3:bb[9],16:{40:bb[16]}},46:{3:bb[9],16:{40:bb[16]}},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[88]}},48:{3:bb[9],16:{17:{27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[16]}},114:bb[129],115:bb[129]},"{EB344D84-9AFB-497E-A393-DC336BA19D2E}":{1:118,2:{3:bb[2],16:{17:{26:{19:{21:89,23:22,24:{12:bb[131]}}},27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[88]}},39:bb[85],43:bb[85],44:{3:bb[9],16:{40:bb[21]}},46:{3:bb[9],16:{40:bb[21]}},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[88]}},48:{3:bb[9],16:{17:{27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[21]}},114:bb[129],115:bb[129]},"{EB9631B5-78F2-41C9-869B-9F39066F8104}":{1:119,2:{3:bb[2],16:{17:{26:{19:{21:89,23:22,24:{12:bb[131]}}},27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[88]}},39:bb[85],43:bb[85],44:{3:bb[9],16:{40:bb[26]}},46:{3:bb[9],16:{40:bb[26]}},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[88]}},48:{3:bb[9],16:{17:{27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[26]}},114:bb[129],115:bb[129]},"{74C1A8A3-306A-4EB7-A6B1-4F7E0EB9C5D6}":{1:120,2:{3:bb[2],16:{17:{26:{19:{21:89,23:22,24:{12:bb[131]}}},27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[88]}},39:bb[85],43:bb[85],44:{3:bb[9],16:{40:bb[31]}},46:{3:bb[9],16:{40:bb[31]}},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[88]}},48:{3:bb[9],16:{17:{27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[31]}},114:bb[129],115:bb[129]},"{2A488322-F2BA-4B5B-9748-0D474271808F}":{1:121,2:{3:bb[2],16:{17:{26:{19:{21:89,23:22,24:{12:bb[131]}}},27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[88]}},39:bb[85],43:bb[85],44:{3:bb[9],16:{40:bb[36]}},46:{3:bb[9],16:{40:bb[36]}},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[88]}},48:{3:bb[9],16:{17:{27:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[36]}},114:bb[129],115:bb[129]},"{D7AC3CCA-C797-4891-BE02-D94E43425B78}":{1:122,2:{3:bb[2],16:{17:{18:bb[89],25:bb[89],26:bb[89],27:bb[89],28:bb[89],29:bb[89]},40:bb[105]}},39:{16:{40:{24:{12:{14:37,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:37,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:89,23:22,24:{12:bb[131]}}}},40:bb[105]}},48:{3:bb[7],16:{40:bb[105]}}},"{69CF1AB2-1976-4502-BF36-3FF5EA218861}":{1:123,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[44]}}},25:{19:{21:20,23:22,24:{12:bb[44]}}},26:{19:{21:20,23:22,24:{12:bb[44]}}},27:{19:{21:20,23:22,24:{12:bb[44]}}},28:{19:{21:20,23:22,24:{12:bb[44]}}},29:{19:{21:20,23:22,24:{12:bb[44]}}}},40:bb[112]}},39:{16:{40:{24:{12:{14:34,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:34,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:89,23:22,24:{12:bb[44]}}}},40:bb[112]}},48:{3:bb[7],16:bb[91]}},"{8A107856-5554-42FB-B03E-39F5DBC370BA}":{1:124,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[46]}}},25:{19:{21:20,23:22,24:{12:bb[46]}}},26:{19:{21:20,23:22,24:{12:bb[46]}}},27:{19:{21:20,23:22,24:{12:bb[46]}}},28:{19:{21:20,23:22,24:{12:bb[46]}}},29:{19:{21:20,23:22,24:{12:bb[46]}}}},40:bb[115]}},39:{16:{40:{24:{12:{14:51,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:51,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:89,23:22,24:{12:bb[46]}}}},40:bb[115]}},48:{3:bb[7],16:bb[93]}},"{0505E3EF-67EA-436B-97B2-0124C06EBD24}":{1:125,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[48]}}},25:{19:{21:20,23:22,24:{12:bb[48]}}},26:{19:{21:20,23:22,24:{12:bb[48]}}},27:{19:{21:20,23:22,24:{12:bb[48]}}},28:{19:{21:20,23:22,24:{12:bb[48]}}},29:{19:{21:20,23:22,24:{12:bb[48]}}}},40:bb[118]}},39:{16:{40:{24:{12:{14:53,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:53,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:89,23:22,24:{12:bb[48]}}}},40:bb[118]}},48:{3:bb[7],16:bb[95]}},"{C4B1156A-380E-4F78-BDF5-A606A8083BF9}":{1:126,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[50]}}},25:{19:{21:20,23:22,24:{12:bb[50]}}},26:{19:{21:20,23:22,24:{12:bb[50]}}},27:{19:{21:20,23:22,24:{12:bb[50]}}},28:{19:{21:20,23:22,24:{12:bb[50]}}},29:{19:{21:20,23:22,24:{12:bb[50]}}}},40:bb[121]}},39:{16:{40:{24:{12:{14:55,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:55,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:89,23:22,24:{12:bb[50]}}}},40:bb[121]}},48:{3:bb[7],16:bb[97]}},"{22838BEF-8BB2-4498-84A7-C5851F593DF1}":{1:127,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[52]}}},25:{19:{21:20,23:22,24:{12:bb[52]}}},26:{19:{21:20,23:22,24:{12:bb[52]}}},27:{19:{21:20,23:22,24:{12:bb[52]}}},28:{19:{21:20,23:22,24:{12:bb[52]}}},29:{19:{21:20,23:22,24:{12:bb[52]}}}},40:bb[124]}},39:{16:{40:{24:{12:{14:57,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:57,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:89,23:22,24:{12:bb[52]}}}},40:bb[124]}},48:{3:bb[7],16:bb[99]}},"{16D9F66E-5EB9-4882-86FB-DCBF35E3C3E4}":{1:128,2:{3:bb[2],16:{17:{18:{19:{21:20,23:22,24:{12:bb[54]}}},25:{19:{21:20,23:22,24:{12:bb[54]}}},26:{19:{21:20,23:22,24:{12:bb[54]}}},27:{19:{21:20,23:22,24:{12:bb[54]}}},28:{19:{21:20,23:22,24:{12:bb[54]}}},29:{19:{21:20,23:22,24:{12:bb[54]}}}},40:bb[127]}},39:{16:{40:{24:{12:{14:59,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:59,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:89,23:22,24:{12:bb[54]}}}},40:bb[127]}},48:{3:bb[7],16:bb[101]}},"{E8034E78-7F5D-4C2E-B375-FC64B27BC917}":{1:129,2:{3:bb[42],16:{40:bb[105]}},39:{16:{40:{24:{12:{14:37,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:37,62:bb[6]}}}}},44:{3:bb[7],16:{17:bb[137],40:bb[138]}},46:{3:bb[7],16:{17:bb[139],40:bb[138]}},47:{3:bb[7],16:{17:bb[140],40:bb[138]}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:bb[109]}}},"{125E5076-3810-47DD-B79F-674D7AD40C01}":{1:131,2:{3:bb[42],16:{40:bb[10]}},39:{16:{40:bb[141]}},43:{16:{40:bb[141]}},44:{3:bb[7],16:{17:bb[137],40:bb[141]}},46:{3:bb[7],16:{17:bb[139],40:bb[141]}},47:{3:bb[7],16:{17:bb[140],40:{24:{12:{14:34,132:bb[6]}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:bb[109]}}},"{37CE84F3-28C3-443E-9E96-99CF82512B78}":{1:133,2:{3:bb[42],16:{40:bb[16]}},39:{16:{40:bb[142]}},43:{16:{40:bb[142]}},44:{3:bb[7],16:{17:bb[137],40:bb[142]}},46:{3:bb[7],16:{17:bb[139],40:bb[142]}},47:{3:bb[7],16:{17:bb[140],40:{24:{12:{14:51,132:bb[6]}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:bb[109]}}},"{D03447BB-5D67-496B-8E87-E561075AD55C}":{1:134,2:{3:bb[42],16:{40:bb[21]}},39:{16:{40:bb[143]}},43:{16:{40:bb[143]}},44:{3:bb[7],16:{17:bb[137],40:bb[143]}},46:{3:bb[7],16:{17:bb[139],40:bb[143]}},47:{3:bb[7],16:{17:bb[140],40:{24:{12:{14:53,132:bb[6]}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:bb[109]}}},"{E929F9F4-4A8F-4326-A1B4-22849713DDAB}":{1:135,2:{3:bb[42],16:{40:bb[26]}},39:{16:{40:bb[144]}},43:{16:{40:bb[144]}},44:{3:bb[7],16:{17:bb[137],40:bb[144]}},46:{3:bb[7],16:{17:bb[139],40:bb[144]}},47:{3:bb[7],16:{17:bb[140],40:{24:{12:{14:55,132:bb[6]}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:bb[109]}}},"{8FD4443E-F989-4FC4-A0C8-D5A2AF1F390B}":{1:136,2:{3:bb[42],16:{40:bb[31]}},39:{16:{40:bb[145]}},43:{16:{40:bb[145]}},44:{3:bb[7],16:{17:bb[137],40:bb[145]}},46:{3:bb[7],16:{17:bb[139],40:bb[145]}},47:{3:bb[7],16:{17:bb[140],40:{24:{12:{14:57,132:bb[6]}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:bb[109]}}},"{AF606853-7671-496A-8E4F-DF71F8EC918B}":{1:137,2:{3:bb[42],16:{40:bb[36]}},39:{16:{40:bb[146]}},43:{16:{40:bb[146]}},44:{3:bb[7],16:{17:bb[137],40:bb[146]}},46:{3:bb[7],16:{17:bb[139],40:bb[146]}},47:{3:bb[7],16:{17:bb[140],40:{24:{12:{14:59,132:bb[6]}}}}},48:{3:bb[7],16:{17:{27:{19:{21:89,23:22,24:{12:{14:49}}}}},40:bb[109]}}},"{5202B0CA-FC54-4496-8BCA-5EF66A818D29}":{1:138,2:{3:bb[2],16:{40:bb[105]}},39:{16:{40:{24:{12:{14:37,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:37,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[105]}},48:{3:bb[9],16:bb[107]}},"{0660B408-B3CF-4A94-85FC-2B1E0A45F4A2}":{1:139,2:{3:bb[2],16:bb[91]},39:{16:{40:{24:{12:{14:34,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:34,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[112]}},48:{3:bb[9],16:{40:bb[16]}}},"{91EBBBCC-DAD2-459C-BE2E-F6DE35CF9A28}":{1:140,2:{3:bb[2],16:bb[95]},39:{16:{40:{24:{12:{14:53,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:53,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[118]}},48:{3:bb[9],16:{40:bb[26]}}},"{46F890A9-2807-4EBB-B81D-B2AA78EC7F39}":{1:141,2:{3:bb[2],16:bb[99]},39:{16:{40:{24:{12:{14:57,62:bb[6]}}}}},43:{16:{40:{24:{12:{14:57,62:bb[6]}}}}},44:{3:bb[7]},46:{3:bb[7]},47:{3:bb[7],16:{17:{26:{19:{21:79,23:80,24:{12:bb[131]}}}},40:bb[124]}},48:{3:bb[9],16:{40:bb[36]}}}};function wb(e){var t=kb[e];return t?function e(t){var n={};return Object.keys(t).forEach((function(r){"object"==T(t[r])?n[yb[Number(r)]]=e(t[r]):n[yb[Number(r)]]=yb[t[r]]})),n}(t):void 0}var Sb=function(e,t,n,r,i){var a=function(e,t,n,r,i){var a=r.tableStyleXML;return a||(a=r.tableStyleXML=Object.freeze(function(e,t){var n=e.parentElement("a:tbl").childElementOptional("a:tblPr");if(n&&n.hasChildElementWithName("a:tableStyleId")){var r=wb(n.childElement("a:tableStyleId").text),i=n.attr.getBoolean("bandCol",!1),a=n.attr.getBoolean("bandRow",!1),o=n.attr.getBoolean("firstCol",!1),s=n.attr.getBoolean("firstRow",!1),c=n.attr.getBoolean("lastCol",!1),u=n.attr.getBoolean("lastRow",!1),l=n.attr.getBoolean("rtl",!1);return{tableStyle:r,bandCol:i,bandRow:a,firstCol:o,firstRow:s,lastCol:c,lastRow:u,rtl:l}}return{tableStyle:void 0,bandCol:!1,bandRow:!1,firstCol:!1,firstRow:!1,lastCol:!1,lastRow:!1,rtl:!1}}(e))),a}(e,0,0,r),o=n.split("-"),s=parseInt(o[0],10),c=parseInt(o[1],10),u=o[2],l=e.parentElement("a:tbl").childElementOptional("a:tblPr"),h=function(e,t,n,r){switch(n){case"isBold":case"isItalic":return;case"fillColor":var i=e.childElementOptional(g(Sm,zm));return i?(new Km).read(i,t):(new Km).read(r,t);case"fontFamily":case"fontColor":return;case"bottomBorderWidth":return new Pb(e,"a:lnB").getBorderWidth();case"bottomBorderColor":return new Pb(e,"a:lnB").getBorderColor(t);case"bottomBorderStyle":return new Pb(e,"a:lnB").getBorderType();case"bottomBorderStrokeDashArray":return new Pb(e,"a:lnB").getBorderStrokeDashArray();case"topBorderWidth":return new Pb(e,"a:lnT").getBorderWidth();case"topBorderColor":return new Pb(e,"a:lnT").getBorderColor(t);case"topBorderStyle":return new Pb(e,"a:lnT").getBorderType();case"topBorderStrokeDashArray":return new Pb(e,"a:lnT").getBorderStrokeDashArray();case"leftBorderWidth":return new Pb(e,"a:lnL").getBorderWidth();case"leftBorderColor":return new Pb(e,"a:lnL").getBorderColor(t);case"leftBorderStyle":return new Pb(e,"a:lnL").getBorderType();case"leftBorderStrokeDashArray":return new Pb(e,"a:lnL").getBorderStrokeDashArray();case"rightBorderWidth":return new Pb(e,"a:lnR").getBorderWidth();case"rightBorderColor":return new Pb(e,"a:lnR").getBorderColor(t);case"rightBorderStyle":return new Pb(e,"a:lnR").getBorderType();case"rightBorderStrokeDashArray":return new Pb(e,"a:lnR").getBorderStrokeDashArray();default:return}}(e,t,u,l);if(void 0!==h&&h!==Hm)return h;var d=a.tableStyle,f=a.bandRow,p=a.bandCol;if(d){var v=d.band1H,m=d.band2H,y=d.band1V,b=d.band2V,k=d.firstRow,w=d.firstCol,S=d.wholeTbl,x=(s+1)%2==1,C=(c+1)%2==1;return k&&0===s?xb(k,t,u,S,d):w&&0===s?xb(w,t,u,S,d):f?xb(k?x?m:v:x?v:m,t,u,S,d):p?xb(w?C?b:y:C?y:b,t,u,S,d):Cb(S,t,u,d)}};function xb(e,t,n,r,i){if(e){var a=Cb(e,t,n,i);return void 0===a?Cb(r,t,n,i):a}return Cb(r,t,n,i)}function Cb(e,t,n,r){var i,a,o,s,c,u,l,h,d,f,p,v;switch(n){case"isBold":var m=e&&(null==e?void 0:e.tcTxStyle);return m?null!=(i=m.b)?i:"off":"false";case"isItalic":var g=e&&(null==e?void 0:e.tcTxStyle);return g?null!=(a=g.i)?a:"off":"false";case"fillColor":var y=e&&(null==(c=null==(s=null==(o=e.tcStyle)?void 0:o.fill)?void 0:s.solidFill)?void 0:c.schemeClr);if(y)return qm(y,t);if(y=null==(l=null==(u=r.tblBg)?void 0:u.fillRef)?void 0:l.schemeClr){var b=Number(null==(d=null==(h=r.tblBg)?void 0:h.fillRef)?void 0:d.idx),k=t.theme.childElementOptional("a:theme","a:themeElements","a:fmtScheme","a:fillStyleLst");if(b&&k)return new Ym(null==k?void 0:k.elements[b],t,void 0,y.val)}return;case"fontFamily":var w=e&&(null==(f=e.tcTxStyle)?void 0:f.fontRef);return w?function(e,t){return"none"!==e?Fm(jm(Dm(t).childElement("a:".concat(e,"Font")))).filter((function(e){return!e.startsWith("+")&&""!==e})).map((function(e){return Tm(e,t.userFonts),e})):[]}(null!=(p=w.idx)?p:"none",t).join(","):void 0;case"fontColor":var S=e&&(null==(v=e.tcTxStyle)?void 0:v.schemeClr);return S?qm(S,t):void 0;case"bottomBorderWidth":return new Ib(e,"bottom").getBorderWidth();case"bottomBorderColor":return new Ib(e,"bottom").getBorderColor(t);case"bottomBorderStyle":return new Ib(e,"bottom").getBorderType();case"topBorderWidth":return new Ib(e,"top").getBorderWidth();case"topBorderColor":return new Ib(e,"top").getBorderColor(t);case"topBorderStyle":return new Ib(e,"top").getBorderType();case"leftBorderWidth":return new Ib(e,"left").getBorderWidth();case"leftBorderColor":return new Ib(e,"left").getBorderColor(t);case"leftBorderStyle":return new Ib(e,"left").getBorderType();case"rightBorderWidth":return new Ib(e,"right").getBorderWidth();case"rightBorderColor":return new Ib(e,"right").getBorderColor(t);case"rightBorderStyle":return new Ib(e,"right").getBorderType();default:return}}var Ib=function(){function e(t,n){I(this,e),this.tcStyle=t,this.lnKey=n}return M(e,[{key:"getBorderColor",value:function(e){var t,n,r,i,a,o=this.tcStyle&&(null==(a=null==(i=null==(r=null==(n=null==(t=this.tcStyle.tcStyle)?void 0:t.tcBdr)?void 0:n[this.lnKey])?void 0:r.ln)?void 0:i.solidFill)?void 0:a.schemeClr);if(o)return qm(o,e)}},{key:"getBorderWidth",value:function(){var e,t,n,r=this.tcStyle&&(null==(n=null==(t=null==(e=this.tcStyle.tcStyle)?void 0:e.tcBdr)?void 0:t[this.lnKey])?void 0:n.ln);if(r)return Number(r.w)}},{key:"getBorderType",value:function(){var e,t,n,r=this.tcStyle&&(null==(n=null==(t=null==(e=this.tcStyle.tcStyle)?void 0:e.tcBdr)?void 0:t[this.lnKey])?void 0:n.ln);if(r){var i=r.prstDash;if(i&&i.val)return i.val}return"solid"}}]),e}(),Pb=function(){function e(t,n){I(this,e),this.tcPrXMl=t,this.lnKey=n}return M(e,[{key:"getBorderColor",value:function(e){var t=this.tcPrXMl.childElementOptional(this.lnKey);if(t)return(new Km).read(t.childElement(g(Sm,zm)),e)}},{key:"getBorderWidth",value:function(){var e=this.tcPrXMl.childElementOptional(this.lnKey);if(e)return e.attr.getNumber("w",0)}},{key:"getBorderType",value:function(){var e=this.tcPrXMl.childElementOptional(this.lnKey);if(e){var t=e.childElementOptional("a:prstDash");if(t&&t.attr.has("val")){var n=t.attr.getStringOptional("val");return"dot"===n||"sysDot"===n?"dotted":"dash"===n||"sysDash"===n?"dashed":"solid"}}}},{key:"getBorderStrokeDashArray",value:function(){var e=this.getBorderWidth(),t=this.getBorderType();if(void 0!==e&&void 0!==t)switch(t){case"solid":return"0";case"dash":return"".concat(5*e);case"dashDot":return" ".concat(5*e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"dot":return"".concat(e,",  ").concat(5*e);case"lgDash":return"".concat(2*e,", ").concat(e);case"lgDashDot":return"".concat(10*e,", ").concat(5*e,", ").concat(e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"sysDash":return"".concat(5*e,", ").concat(2*e);case"sysDashDot":return"".concat(5*e,", ").concat(2*e,", ").concat(e,", ").concat(5*e);case"sysDashDotDot":return"".concat(5*e,", ").concat(2*e,", ").concat(e,", ").concat(5*e,", ").concat(e,", ").concat(5*e);case"sysDot":return"".concat(2*e,", ").concat(5*e);default:return"0"}}}]),e}();var Mb=function(e,t,n,r,i){var a=Rb(e,t,n,r,i);if(a.bgXML&&a.bgXML.hasChildElementWithName("p:bgRef")){var o=a.bgXML.childElement("p:bgRef").attr.getNumber("idx");return t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1]}return a.bgXML.childElementOptional("p:bgPr","a:blipFill")},Tb=function(e,t,n,r,i){var a=Rb(e,t,n,r,i);if(!a.bgXML||!a.bgXML.hasChildElementWithName("p:bgRef"))return Ab(a.bgXML.childElementOptional("p:bgPr","a:blipFill"));var o=a.bgXML.childElement("p:bgRef").attr.getNumber("idx"),s=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1];return"a:blipFill"===s.name?Ab(s):void 0};function Ab(e){if(e)return e.childElement("a:blip").attr.getStringOptional("r:embed")}var Eb=function(e,t,n,r,i){var a=Rb(e,t,n,r,i);return a.bgXML&&a.bgXML.hasChildElementWithName("p:bgRef")?"theme":a.resourceType},Ob=function(e,t,n,r,i){var a=Rb(e,t,n,r,i);if(a.bgXML&&a.bgXML.hasChildElementWithName("p:bgRef")){var o=a.bgXML.childElement("p:bgRef").attr.getNumber("idx"),s=t.theme.childElement("a:theme","a:themeElements","a:fmtScheme","a:bgFillStyleLst").elements[o-1e3-1];return new Km(a.bgXML.childElement("p:bgRef").childElementOptional("a:schemeClr")).read(s,t)}return(new Km).read(a.bgXML.childElement("p:bgPr",g(Sm,zm)),t)};function Rb(e,t,n,r,i){var a=r.bgXML;return a||(a=r.bgXML=Object.freeze(function(e,t){return e.hasChildElementWithName("p:bg")?{bgXML:e.childElement("p:bg"),resourceType:"slide"}:t.layout.childElementOptional("p:sldLayout","p:cSld","p:bg")?{bgXML:t.layout.childElement("p:sldLayout","p:cSld","p:bg"),resourceType:"layout"}:{bgXML:t.master.childElement("p:sldMaster","p:cSld","p:bg"),resourceType:"master"}}(e,t))),a}var Nb=new Hg;!function(e){e.bindAttributePicker("a:p","*",Jy),e.bindAttributePicker("a:p","indent",$y(-342900,0)),e.bindAttributePicker("a:p","marL",$y(342900,0)),e.bindAttributePicker("a:p","level",eb),e.bindAttributePicker("a:bodyPr","*",Zy),e.bindAttributePicker(["a:r","a:br","a:endParaRPr","a:fld"],"*",nb),e.bindAttributePicker(["a:r","a:br","a:endParaRPr","a:fld","a:p"],"sz",ib),e.bindAttributePicker(["a:r"],"highlight",rb),e.bindAttributePicker(["a:r","a:fld"],"color",ob),e.bindAttributePicker(["a:r","a:fld"],"fontType",sb),e.bindAttributePicker("a:p","placeHolderType",cb),e.bindChildPicker("a:p","bu",ub),e.bindAttributePicker("a:p","buClr",lb),e.bindAttributePicker("a:p","lineHeight",db),e.bindAttributePicker("a:p",["a:spcBef","a:spcAft"],fb)}(Nb),function(e){e.bindChildPicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"a:prstGeom",hy),e.bindChildPicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"a:custGeom",hy),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"fillColor",dy),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderWidth",py),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderType",vy),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderColor",fy),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:grpSp"],"borderStrokeDashArray",my),e.bindAttributePicker("p:sp","spId",(function(e,t,n,r,i){return sy(i)+e.childElement("p:nvSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:cxnSp","spId",(function(e,t,n,r,i){return sy(i)+e.childElement("p:nvCxnSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:pic","spId",(function(e,t,n,r,i){return sy(i)+e.childElement("p:nvPicPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:grpSp","spId",(function(e,t,n,r,i){return sy(i)+e.childElement("p:nvGrpSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:spTree","spId",(function(e,t,n,r,i){return sy(i)+e.childElement("p:nvGrpSpPr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:graphicFrame","spId",(function(e,t,n,r,i){return sy(i)+e.childElement("p:nvGraphicFramePr","p:cNvPr").attr.getOptional("id")})),e.bindAttributePicker("p:graphicFrame","borderWidth",(function(){return 0})),e.bindAttributePicker("p:graphicFrame","borderType",(function(){return"none"})),e.bindAttributePicker("p:graphicFrame","borderColor",(function(){return"black"})),e.bindAttributePicker("p:graphicFrame","borderStrokeDashArray",(function(){return"0"}))}(Nb),function(e){e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"x",(function(e,t,n,r,i){var a=vb(e,t,i);return a?a.attr.getOptional("x"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"y",(function(e,t,n,r,i){var a=vb(e,t,i);return a?a.attr.getOptional("y"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"width",(function(e,t,n,r,i){var a=mb(e,t,i);return a?a.attr.getOptional("cx"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"height",(function(e,t,n,r,i){var a=mb(e,t,i);return a?a.attr.getOptional("cy"):0})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"flipV",(function(e,t){var n=gb(e,t,"slide");return void 0===n?"false":n.attr.getOptional("flipV")?n.attr.getOptional("flipV"):"false"})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"flipH",(function(e,t){var n=gb(e,t,"slide");return void 0===n?"false":n.attr.getOptional("flipH")?n.attr.getOptional("flipH"):"false"})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp","p:graphicFrame"],"hidden",(function(e){var t=e.childElementOptional(new Sm("p:nvGraphicFramePr","p:nvSpPr","p:nvCxnSpPr","p:nvPicPr"),"p:cNvPr");return t?t.attr.get("hidden","false"):"false"})),e.bindAttributePicker(["p:sp","p:pic","p:cxnSp"],"rot",(function(e,t){var n=gb(e,t,"slide");return n?n.attr.getOptional("rot"):0}))}(Nb),function(e){e.bindAttributePicker("a:tcPr","*",Sb)}(Nb),function(e){e.bindChildPicker(["p:cSld"],"getBackgroundImageFill",Mb),e.bindAttributePicker(["p:cSld"],"backgroundResId",Tb),e.bindAttributePicker(["p:cSld"],"backgroundImageResourceType",Eb),e.bindAttributePicker(["p:cSld"],"backgroundColor",Ob)}(Nb);var Lb=function(){function e(t,n){I(this,e),this.slideXML=t,this.context=n,this.animations=[]}return M(e,[{key:"collect",value:function(){var e=this.slideXML.childElementOptional(new Sm("p:sld","p:sldMaster","p:sldLayout"),"p:timing","p:tnLst","p:par","p:cTn","p:childTnLst");if(e)for(var t=e.elementsWithName("p:seq"),n=0;n<t.length;++n){var r=t[n],i=r.childElement("p:cTn").attr.getString("nodeType","afterEffect");this.searchAndIndexParXMLs(r,i,[n],0,void 0)}return this.animations}},{key:"searchAndIndexParXMLs",value:function(e,t,n,r,i){var a=e.childElementOptional("p:cTn","p:childTnLst"),o=a?a.elementsWithName("p:par"):[],s=e.childElementOptional("p:cTn","p:stCondLst","p:cond"),c=i,u=0;if(s){u=s&&s.attr.getNumberOptional("delay")||0;var l=s.childElementOptional("p:tgtEl","p:spTgt");if(l&&(c=sy(this.context.resourceType)+l.attr.getString("spid"),this.context.shapeParamsIndex[c].hidden))return}if(0===o.length)this.handleLeafParXML(e,t,n,r,c);else for(var h=0;h<o.length;++h)this.searchAndIndexParXMLs(o[h],t,[].concat(p(n),[h]),r+u,c)}},{key:"handleLeafParXML",value:function(e,t,n,r,i){var a,o,s,c,u,l=e.childElementOptional("p:cTn","p:iterate"),h=null==(a=null==l?void 0:l.attr)?void 0:a.getStringOptional("type"),d=null==l?void 0:l.childElementOptional("p:tmPct");if(d&&(u=um(d.attr.getString("val"))),null==u){var f=null==l?void 0:l.childElementOptional("p:tmAbs");f&&(c=f.attr.getNumberOptional("val"))}var p=e.childElementOptional("p:cTn","p:childTnLst"),v=p&&p.element.childElementOptional("p:cBhvr","p:tgtEl","p:spTgt"),m=v?sy(this.context.resourceType)+v.attr.getString("spid"):"",g=null==v?void 0:v.childElementOptional("p:txEl","p:pRg"),y=null==(o=null==g?void 0:g.attr)?void 0:o.getNumberOptional("st"),b=null==(s=null==g?void 0:g.attr)?void 0:s.getNumberOptional("end"),k=!!(null==v?void 0:v.childElementOptional("p:bg")),w=null!=y&&null!=b?{start:y,end:b}:null;if(this.context.shapeParamsIndex[m]&&!this.context.shapeParamsIndex[m].hidden){var S=e.childElement("p:cTn"),x=e.childElementOptional("p:cTn","p:stCondLst","p:cond"),C=p?p.elements:[],I=Number.MIN_SAFE_INTEGER;C.forEach((function(e){var t=0,n=e.childElementOptional("p:cBhvr","p:cTn","p:stCondLst","p:cond");n&&(t=n.attr.getNumberOptional("delay")||0);var r=e.childElement("p:cBhvr","p:cTn").attr.getNumberOptional("dur");void 0===r&&(r=1),r+t>I&&(I=r+t)}));var P,M=S.childElementOptional("p:endCondLst");void 0!==M&&"onNext"===M.childElement("p:cond").attr.getStringOptional("evt")&&(P="onNext");var T=S.attr.get("repeatCount","none");"indefinite"!==T&&"none"!==T&&(0===(T/=1e3)&&(T="none"));var A=S.attr.getStringOptional("presetClass");A||(A="entr");var E=Object.freeze({eventSourceShapeId:i,spId:m,pRg:w,pBg:k,textAnimMode:h,textAnimIterateDelay:function(e){return null!=c?c:null!=u?u*e:0},sequenceType:t,animationXML:p,sequenceIndex:n[1],parallelIndex:n[3],isLoop:S.attr.has("repeatCount"),id:S.attr.getStringOptional("id")||"",presetClass:A,presetID:S.attr.getStringOptional("presetID")||"",presetSubtype:S.attr.getStringOptional("presetSubtype"),repeatCount:T,repeatEndCondition:P,nodeType:S.attr.getStringOptional("nodeType")||"afterEffect",delay:x&&x.attr.getNumberOptional("delay")||0,parentDelay:r,duration:I,autoRev:S.attr.getBoolean("autoRev",!1),soundEffectId:this.parseAnimeSoundEffect(e),dimAfter:this.parseDimAfter(e)});this.animations.push(E)}}},{key:"parseAnimeSoundEffect",value:function(e){var t=e.childElementOptional("p:cTn","p:subTnLst","p:audio");if(void 0!==t)return t.childElement("p:cMediaNode","p:tgtEl","p:sndTgt").attr.getString("r:embed")}},{key:"parseDimAfter",value:function(e){var t,n,r=e.childElementOptional("p:cTn","p:subTnLst","p:set","p:cBhvr");if(r){var i=r.childElementOptional("p:attrNameLst","p:attrName");return i&&String(i.text).includes("visibility")?"nextClick"===(null==(n=null==(t=r.childElementOptional("p:cTn"))?void 0:t.attr)?void 0:n.getStringOptional("masterRel"))?"next":"same":void 0}}}]),e}();function jb(e,t,n){var r=t.input,i=t.output;return(e-r)/(n.input-r)*(n.output-i)+i}var Db=function(){function e(t){I(this,e),this.behaviorNode=t.childElement("p:cBhvr"),this.timingNode=this.behaviorNode.childElement("p:cTn")}return M(e,[{key:"animeId",value:function(){var e;return String(null!=(e=this.timingNode.attr.getNumberOptional("id"))?e:Date.now())}},{key:"duration",value:function(){var e=this.timingNode.attr.getStringOptional("dur");return e?"indefinite"===e?1/0:parseInt(e,10):1}},{key:"delay",value:function(){var e=this.timingNode.childElementOptional("p:stCondLst","p:cond");return e?e.attr.getNumber("delay",0):0}},{key:"ease",value:function(){var e=function(e){if(!e)return Cf;var t=e.replace(/\s+/g,"").split(";").map((function(e){var t=h(e.split(","),2),n=t[0],r=t[1];return{input:parseFloat(n),output:parseFloat(r)}}));t[t.length-1].input<1&&t.push({input:1,output:1});var n=t.length-1,r=0,i=0;return function(e){if(e>=r)for(var a=i;a<n;a++){var o=t[a],s=t[a+1];if(e>=o.input&&e<=s.input)return i=a,r=e,jb(e,o,s)}else for(var c=i;c>=0;c--){var u=t[c],l=t[c+1];if(e>=u.input&&e<=l.input)return i=c,r=e,jb(e,u,l)}return i=0,r=0,e}}(this.timingNode.attr.getStringOptional("tmFilter")),t=this.timingNode.attr.getStringOptional("spd");if(t){var n=um(t);if(!Number.isNaN(n)&&1!==n&&0!==n)return n>0?function(t){return e(t/n)}:function(t){return 1-e(t/-n)}}return e}},{key:"reverse",value:function(){return Boolean(this.timingNode.attr.getBooleanOptional("autoRev"))}},{key:"rewind",value:function(){var e=this.timingNode.attr.getStringOptional("fill");return"transition"===e||"remove"===e}},{key:"repeat",value:function(){var e=this.timingNode.attr.get("repeatCount","");if(!e)return 1;if("indefinite"===e)return 1/0;var t=Number(e)/1e3;return Number.isNaN(t)?1:t}},{key:"attrNames",value:function(){var e=this.behaviorNode.childElementOptional("p:attrNameLst"),t=[];if(e){var n,r=A(e.elementsWithName("p:attrName"));try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.mapAttrName(i.text);a&&t.push(a)}}catch(e){r.e(e)}finally{r.f()}}return t}},{key:"mapAttrName",value:function(e){if("string"==typeof e){var t=e.toLowerCase();switch(t){case"ppt_x":case"ppt_y":case"ppt_w":case"ppt_h":case"xshear":case"yshear":case"fillcolor":return t;case"scalex":return"scaleX";case"scaley":return"scaleY";case"style.rotation":case"r":return"rotate";case"style.visibility":return"visible";case"style.opacity":return"opacity"}}}}]),e}();function Fb(e){var t,n,r,i,a=function(e){var t,n=[],r=A(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(""!==i)if(1===i.length)n.push(i);else{var a=i[0];/[a-zA-Z]/.test(a)?(n.push(a),n.push(i.substring(1))):n.push(i)}}}catch(e){r.e(e)}finally{r.f()}return n}(e.split(/,|\s/i)),o=[],s=A(a);try{for(s.s();!(i=s.n()).done;){var c=i.value;if(/^[a-zA-Z]$/.test(c)){if(void 0!==r)throw new Error("invalid path: lack of number");void 0!==t&&o.push({sign:t,points:n}),t=c,n=[]}else{var u=parseFloat(c);if(Number.isNaN(u))throw new Error("invalid path: unrecognized number ".concat(JSON.stringify(c)));void 0===r?r=u:(n.push({x:r,y:u}),r=void 0)}}}catch(e){s.e(e)}finally{s.f()}if(void 0!==r)throw new Error("invalid path: lack of number");return void 0!==t&&o.push({sign:t,points:n}),o}var zb=function(){function e(){I(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];if(0===n.length)throw new Error("expect 1 curve minimum");for(var i=[],a=0,o=0,s=n;o<s.length;o++){var c=s[o];i.push(c.rectangle),a+=c.length}this.curves=Object.freeze(n),this.length=a,this.rectangle=e.unionRectangles(i)}return M(e,[{key:"get",value:function(e){var t,n,r=0,i=0,a=A(this.curves);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(t=o,i=r,e<r+o.length)break;r+=o.length}}catch(e){a.e(e)}finally{a.f()}return t.get(e-i)}}],[{key:"unionRectangles",value:function(e){var t,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,i=Number.MAX_SAFE_INTEGER,a=Number.MIN_SAFE_INTEGER,o=A(e);try{for(o.s();!(t=o.n()).done;){var s=t.value;s.left<n&&(n=s.left),s.right>r&&(r=s.right),s.top<i&&(i=s.top),s.bottom>a&&(a=s.bottom)}}catch(e){o.e(e)}finally{o.f()}return Object.freeze({left:n,right:r,top:i,bottom:a})}}]),e}(),Bb=function(){function e(t,n){I(this,e),this.beginX=t.x,this.beginY=t.y,this.deltaX=n.x-t.x,this.deltaY=n.y-t.y,this.length=Math.sqrt(this.deltaX*this.deltaX+this.deltaY*this.deltaY),this.rectangle=Object.freeze({left:Math.min(t.x,n.x),right:Math.max(t.x,n.x),top:Math.min(t.y,n.y),bottom:Math.max(t.y,n.y)})}return M(e,[{key:"get",value:function(e){if(0===this.length)return{x:this.beginX,y:this.beginY};var t=e/this.length;return t=Math.max(0,t),t=Math.min(1,t),{x:this.beginX+t*this.deltaX,y:this.beginY+t*this.deltaY}}}]),e}(),Ub=function(){function e(t,n,r,i){I(this,e),this.bezier=new Hv.default([t,n,r,i]),this.length=this.bezier.length(),this.rectangle=this.createRectangle()}return M(e,[{key:"createRectangle",value:function(){var e=this.bezier.bbox();return Object.freeze({left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max})}},{key:"get",value:function(e){var t=e/this.length;return t=Math.max(0,t),t=Math.min(1,t),this.bezier.get(t)}}]),e}();function Vb(e){var t=e.controller,n=e.end,r=n.x-t.x,i=n.y-t.y;return{x:n.x+r,y:n.y+i}}function Wb(e,t,n){if(t.length!==n)throw new Error("invalid path: sign ".concat(e," should have ").concat(n," points (").concat(2*n," number)"))}function Hb(e){if(!e)throw new Error("invalid path: expect M")}var _b=function(e){var t=e.node,n=e.animation,r=e.animBox,i=new Db(t),a=function(e){var t,n,r,i,a=[],o=A(Fb(e));try{for(o.s();!(i=o.n()).done;){var s=i.value,c=s.sign,u=s.points;switch(c){case"M":Wb(c,u,1),t=u[0],n=u[0],r=void 0;break;case"L":Wb(c,u,1),Hb(n),a.push(new Bb(n,u[0])),n=u[0],r=void 0;break;case"Z":Wb(c,u,0),Hb(n),a.push(new Bb(n,t)),n=t,r=void 0;break;case"C":Wb(c,u,3),Hb(n),a.push(new Ub(n,u[0],u[1],u[2])),r={controller:u[1],end:u[2]},n=u[2];break;case"S":if(!r)throw new Error("invalid path: expect C or S before S");Wb(c,u,2),Hb(n);var l=Vb(r);a.push(new Ub(n,l,u[0],u[1])),r={controller:u[0],end:u[1]},n=u[1];break;case"Q":Wb(c,u,2),Hb(n),a.push(new Ub(n,u[0],u[1])),r={controller:u[0],end:u[1]},n=u[1];break;case"T":if(!r)throw new Error("invalid path: expect Q or T before T");Wb(c,u,1),Hb(n);var h=Vb(r);r={controller:h,end:u[0]},r={controller:h,end:u[0]},n=u[0];break;case"E":break;default:throw new Error("invalid path: unrecognized sign ".concat(JSON.stringify(c)))}}}catch(e){o.e(e)}finally{o.f()}return g(zb,a)}(t.attr.getString("path","M 0 0")),o=r.initState,s=o.ppt_x,c=o.ppt_y;return new vp({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:i.duration(),ease:i.ease(),repeat:i.repeat(),delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),transform:function(e){var t=a.get(e*a.length),n=t.x,r=t.y;return{ppt_x:(n||0)+s,ppt_y:(r||0)+c}}})},Gb=function(){function e(t){var n=t.context,r=t.animBox;I(this,e),this.context=n,this.animBox=r}return M(e,[{key:"parse",value:function(e,t){var n=null==e?void 0:e.childElementOptional(new Sm("p:strVal","p:fltVal","p:clrVal","p:intVal"));if(n)switch(n.name){case"p:fltVal":case"p:intVal":var r=parseFloat(n.attr.getString("val"));return cp(r)?r:void 0;case"p:clrVal":var i=Xm(n.childElement(g(Sm,Bm)),this.context.slideContext);if(i){var a=i.rgb().object(),o=a.r,s=a.g,c=a.b;return new lp({r:o,g:s,b:c,a:1})}return;default:return cp(this.animBox.initState[t])?new ap(n.attr.getString("val"),this.formulaScope):"visible"===t?"hidden"!==n.attr.getString("val"):n.attr.getString("val")}}},{key:"formulaScope",get:function(){return this._formulaScope?this._formulaScope:this._formulaScope=new ip(this.animBox)}}]),e}();function Yb(e,t){if(t){var n=t.childElementOptional(new Sm("p:rgb","p:hsl"));if(n)switch(n.name){case"p:rgb":return new lp({r:n.attr.getNumber("r"),g:n.attr.getNumber("g"),b:n.attr.getNumber("b"),a:1});case"p:hsl":return new lp({h:n.attr.getNumber("h")/cm,s:n.attr.getNumber("s")/sm*100,l:n.attr.getNumber("l")/sm*100,a:1})}else{var r=Xm(t.childElement(g(Sm,Bm)),e);if(r){var i=r.rgb().object(),a=i.r,o=i.g,s=i.b;return new lp({r:a,g:o,b:s,a:1})}}}}function Xb(e){var t=Number(e);if(!Number.isNaN(t))return hm(t)}function qb(e){if(e)return{scaleX:um(e.attr.getString("x")),scaleY:um(e.attr.getString("y"))}}var Qb=function(e){var t=e.node,n=e.animation,r=e.animBox,i=new Db(t),a=function(e){var t=/^playFrom\(([^)]+)\)$/.exec(e);return t?{name:"playFrom",value:parseFloat(t[1])}:e.includes("pause")?{name:"pause"}:{name:"stop"}}(t.attr.getString("cmd"));return new mp({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:1,delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),cmd:a})};function Kb(e,t,n){var r=e.node,i=e.context,a=e.animBox;var o=r.childElementOptional("p:tavLst");if(o){var s=new Gb({context:i,animBox:a}),c=o.elementsWithName("p:tav").map((function(e){var t=s.parse(e.childElement("p:val"),n);if(null!=t)return{val:t,progress:um(e.attr.getString("tm")),fmla:function(e){if(e){if(cp(a.initState[n]))return new ap(e,s.formulaScope);console.error("Expr ".concat(e," cannot work with targetKey ").concat(n))}}(e.attr.getStringOptional("fmla"))}})).filter((function(e){return Boolean(e)}));if(!(c.length<=0)){if("lin"!==t)return Zb(c,n,Jb);if(cp(c[0].val))return Zb(c,n,Vf);if(c[0].val instanceof lp)return Zb(c,n,gp)}}}function Zb(e,t,n){return function(r){for(var i=1;i<e.length;i++){var a=e[i-1],s=e[i];if(r>=a.progress&&r<=s.progress){var c=n(a.val,s.val,(r-a.progress)/(s.progress-a.progress));return o({},t,a.fmla?a.fmla.evaluate(c):c)}}var u=e[e.length-1],l=u.fmla,h=u.val;return o({},t,l?l.evaluate(h):h)}}function Jb(e,t,n){return n<1?e:t}var $b=function(){function e(t,n){I(this,e),this.node=t,this.animBox=n}return M(e,[{key:"parse",value:function(e,t){var n=this.node.attr.getStringOptional(e);if(n){var r=this.animBox.initState[t];if(r instanceof lp)try{return new lp(n)}catch(i){return}if(cp(r)){var i=Number(n);return cp(i)?i:("by"===e&&("ppt_x"===t||"ppt_y"===t)&&(n+="+#".concat(t)),new ap(n,this.formulaScope))}return"visible"===t?"hidden"!==n:void 0}}},{key:"formulaScope",get:function(){return this._formulaScope?this._formulaScope:this._formulaScope=new ip(this.animBox)}}]),e}(),ek=function(e){switch(e.node.name){case"p:animMotion":return _b(e);case"p:set":return function(e){var t,n=e.node,r=e.animation,i=e.context,a=e.animBox,o=new Db(n),s=o.attrNames(),c={},u=new Gb({context:i,animBox:a}),l=A(s);try{for(l.s();!(t=l.n()).done;){var h=t.value;switch(h){case"visible":var d=u.parse(n.childElementOptional("p:to"),"visible");null!=d&&(c.visible=d,a.preAnimation()||a.preAnimation({visible:!d}));break;case"opacity":case"xshear":case"yshear":var f=u.parse(n.childElementOptional("p:to"),h);null!=f&&(c[h]=f)}}}catch(e){l.e(e)}finally{l.f()}return new vp({animBox:a,effectType:r.nodeType,playerID:o.animeId(),eventSource:r.eventSourceShapeId,duration:o.duration(),delay:o.delay(),transform:pp((function(){var e={};for(var t in c)if(sp(c,t))switch(t){case"visible":e.visible=!c.visible;break;case"opacity":case"xshear":case"yshear":e[t]=a.currentState[t]}return e}),c)})}(e);case"p:animEffect":return function(e){var t=e.animBox,n=e.node,r=e.animation,i=n.attr.getStringOptional("transition");if(i){var a=new Db(n),o=0,s=1;return"out"===i&&(o=1,s=0),new vp({animBox:t,effectType:r.nodeType,playerID:a.animeId(),eventSource:r.eventSourceShapeId,duration:a.duration(),ease:a.ease(),repeat:a.repeat(),delay:a.delay(),reverse:a.reverse(),rewind:a.rewind(),by:!0,transform:fp({opacity:o},{opacity:s})})}}(e);case"p:anim":return function(e){var t=e.node,n=e.animation,r=e.animBox,i=new Db(t),a=t.attr.getString("calcmode","lin"),s=i.attrNames()[0];if(s){var c=new $b(t,r),u=!1,l=Kb(e,a,s);if(!l){var h=c.parse("from",s),d=c.parse("to",s);if(d||(u=!0,d=c.parse("by",s)),!d)return;l=pp((function(){return o({},s,null!=h?h:r.currentState[s])}),o({},s,d))}return new vp({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:i.duration(),ease:i.ease(),repeat:i.repeat(),delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),by:u,transform:l})}console.error("Missing attrName for p:anim",i.animeId())}(e);case"p:animClr":return function(e){var t=e.node,n=e.animation,r=e.animBox,i=e.context,a=new Db(t);if(a.attrNames().includes("fillcolor")){var o,s=!1;if((o=Yb(i.slideContext,t.childElementOptional("p:to")))||(s=!0,o=Yb(i.slideContext,t.childElementOptional("p:by"))),o){var c,u=o,l=Yb(i.slideContext,t.childElementOptional("p:from"));return new vp({animBox:r,effectType:n.nodeType,playerID:a.animeId(),eventSource:n.eventSourceShapeId,duration:a.duration(),ease:a.ease(),repeat:a.repeat(),delay:a.delay(),reverse:a.reverse(),rewind:a.rewind(),by:s,transform:function(e){l||(l=r.currentState.fillcolor,c=l.alpha());var t=hp(l,u,e);return{fillcolor:c>0?t.alpha(c):t}}})}}}(e);case"p:animRot":return function(e){var t=e.node,n=e.animation,r=e.context,i=e.animBox,a=new Db(t),o=!1,s=Xb(t.attr.getStringOptional("to"));if(null==s&&(o=!0,s=Xb(t.attr.getStringOptional("by"))),null==s){var c=new Gb({context:r,animBox:i}).parse(t.childElementOptional("p:by"),"rotate");cp(c)&&(s=hm(Number(c)))}if(null!=s){var u=s,l=Xb(t.attr.getStringOptional("from"));return new vp({animBox:i,effectType:n.nodeType,playerID:a.animeId(),eventSource:n.eventSourceShapeId,duration:a.duration(),ease:a.ease(),repeat:a.repeat(),delay:a.delay(),reverse:a.reverse(),rewind:a.rewind(),by:o,transform:pp((function(){var e;return{rotate:null!=l?l:o?0:null!=(e=i.currentState.rotate)?e:0}}),{rotate:u})})}}(e);case"p:animScale":return function(e){var t=e.node,n=e.animation,r=e.animBox,i=new Db(t),a=!1,o=qb(t.childElementOptional("p:to"));if(null==o&&(a=!0,o=qb(t.childElementOptional("p:by"))),null!=o){var s=o,c=qb(t.childElementOptional("p:from"));return new vp({animBox:r,effectType:n.nodeType,playerID:i.animeId(),eventSource:n.eventSourceShapeId,duration:i.duration(),ease:i.ease(),repeat:i.repeat(),delay:i.delay(),reverse:i.reverse(),rewind:i.rewind(),by:a,transform:pp((function(){var e,t;return null!=c?c:a?{scaleX:1,scaleY:1}:{scaleX:null!=(e=r.currentState.scaleX)?e:1,scaleY:null!=(t=r.currentState.scaleY)?t:1}}),s)})}}(e);case"p:cmd":return Qb(e);default:console.error("failed parsing ".concat(e.node.name," animation node"))}};function tk(e,t,n){return new vp({animBox:e,effectType:t,playerID:"Dim".concat(String(Date.now())),duration:1,delay:n,transform:pp((function(){return{visible:e.currentState.visible}}),{visible:!1})})}var nk=function(){function e(t,n){var r,i,a,o=this;I(this,e),this.animations=t,this.context=n,this.mainPlayerSeq=[],this.interactivePlayerSeqs=new Map,this.subNextPlayerAnimBoxes=new Map,this.textAnimSpIds=new Set,this.triggerEvent=new Sv,this.animBoxes=new Map,this.textCount=0,this.type=n.resourceType;for(var s=0;s<this.animations.length;s+=1){var c=this.animations[s],u=this.getAnimationSeq(c);if(u){var l=this.getAnimBox(c.spId,null==(r=c.pRg)?void 0:r.start),h=void 0;if("lt"!==c.textAnimMode&&"wd"!==c.textAnimMode||c.pBg){if((h=this.getAnimationPlayer(c,l))&&c.parentDelay>0){var d=c.parentDelay-u.reduce((function(e,t){return e+t.duration}),0);d>0&&(h=new Bf({players:[h],effectType:h.effectType,delay:d}))}}else this.textAnimSpIds.add(c.spId),h=this.getTextAnimationPlayer(c,l);if(h){h=this.joinSubSamePlayers(h,c,l);var f=this.getSubNextPlayerAnimBoxes(this.getSeqId(c));u.length>0&&h.effectType!==u[u.length-1].effectType&&this.squashLastSeqPlayers(u),"withEffect"!==h.effectType&&this.joinLastSubNextIntoPlayers(this.getSeqId(c),u),("withEffect"!==h.effectType||0===s)&&f.push([]),"next"===c.dimAfter&&f[f.length-1].push(l),u.push(h)}}}this.squashLastSeqPlayers(this.mainPlayerSeq),this.joinLastSubNextIntoPlayers("mainSeq",this.mainPlayerSeq),this.interactivePlayerSeqs.forEach((function(e,t){o.squashLastSeqPlayers(e),o.joinLastSubNextIntoPlayers(t,e)})),this.mainSeq=new Uf({playerID:"mainSeq",players:this.mainPlayerSeq,effectType:null!=(a=null==(i=this.mainPlayerSeq[0])?void 0:i.effectType)?a:"clickEffect"}),this.interactiveSeqs=new Map,this.interactivePlayerSeqs.forEach((function(e,t){var n,r;o.interactiveSeqs.set(t,new Uf({playerID:"interactiveSeq"+t,players:e,effectType:null!=(r=null==(n=e[0])?void 0:n.effectType)?r:"clickEffect"}))}))}return M(e,[{key:"withTextAnimation",value:function(e){return this.textAnimSpIds.has(e)}},{key:"end",value:function(){console.log("[animation manager]: end"),this.mainSeq.seek(this.mainSeq.duration+1)}},{key:"pause",value:function(){console.log("[animation manager]: pause");var e,t=A(this.mainSeq.players);try{for(t.s();!(e=t.n()).done;){e.value.pause()}}catch(e){t.e(e)}finally{t.f()}this.interactiveSeqs.forEach((function(e){var t,n=A(e.players);try{for(n.s();!(t=n.n()).done;){t.value.pause()}}catch(e){n.e(e)}finally{n.f()}}))}},{key:"reset",value:function(){var e=this;console.log("[animation manager]: reset"),this.mainSeq.reset(),this.interactiveSeqs.forEach((function(e){return e.reset()})),Lf.render((function(){e.animBoxes.forEach((function(e){return e.clearCache()}))}),!1,!1)}},{key:"logSeq",value:function(){var e="";function t(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n instanceof Uf?(e+="".concat(r,"seq ").concat(n.effectType,"\n"),n.players.forEach((function(e){return t(e,r+"  ")}))):n instanceof Jd?(e+="".concat(r,"par ").concat(n.effectType,"\n"),n.players.forEach((function(e){return t(e,r+"  ")}))):n instanceof Bf?(e+="".concat(r,"par2 ").concat(n.effectType,"\n"),n.players.forEach((function(e){return t(e,r+"  ")}))):e+="".concat(r).concat(n.playerID," ").concat(n.effectType,"\n")}e+="mainSeq\n",t(this.mainSeq,"  "),e+="interactiveSeqs\n",this.interactiveSeqs.forEach((function(e){return t(e,"  ")})),console.log(e)}},{key:"getPlayer",value:function(e,t){var n=t;n||(n=[this.mainSeq].concat(p(Array.from(this.interactiveSeqs.values()))));var r,i=A(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.playerID===e)return a;var o=a.players;if(o){var s=this.getPlayer(e,o);if(s)return s}}}catch(e){i.e(e)}finally{i.f()}}},{key:"getAnimationSeq",value:function(e){switch(e.sequenceType){case"mainSeq":return this.mainPlayerSeq;case"interactiveSeq":if(void 0!==e.eventSourceShapeId)return this.getInteractiveSeq(Fy(this.context.pptUUID,this.context.slideIndex,e.eventSourceShapeId));console.error("interactiveSeq animation ".concat(e.id," does not have eventSourceShapeId"),e);break;default:console.error('not support sequenceType: "'.concat(e.sequenceType,'"'),e)}}},{key:"getInteractiveSeq",value:function(e){var t=this.interactivePlayerSeqs.get(e);return t||(t=[],this.interactivePlayerSeqs.set(e,t)),t}},{key:"getTextScale",value:function(e){var t=1/0;return e.forEach((function(e){e.prop.size<t&&(t=e.prop.size)})),t>=12?1:t/12}},{key:"getTextRect",value:function(e,t){var n,r,i,a,o,s,c,u=0;if(e){var l,h=A(e.paragraphs);try{for(h.s();!(l=h.n()).done;){var d,f=A(l.value.lines);try{for(f.s();!(d=f.n()).done;){var p,v=d.value,m=this.getTextScale(v),g=A(v);try{for(g.s();!(p=g.n()).done;){var y=p.value;if(u<=t&&u+(null!=(r=null==(n=y.text)?void 0:n.length)?r:0)>t){var b=Number(y.prop.width)/m/(null!=(a=null==(i=y.text)?void 0:i.length)?a:1);return{height:null!=(o=y.prop.height)?o:y.prop.size,width:b,textScale:m}}u+=null!=(c=null==(s=y.text)?void 0:s.length)?c:0}}catch(e){g.e(e)}finally{g.f()}}}catch(e){f.e(e)}finally{f.f()}}}catch(e){h.e(e)}finally{h.f()}}}},{key:"getParagraphRect",value:function(e,t){var n=null==e?void 0:e.paragraphs[t],r=null==e?void 0:e.prop.width,i=null==n?void 0:n.lines.map((function(e){return Math.max.apply(Math,p(e.map((function(e){var t;return null!=(t=e.prop.height)?t:e.prop.size}))))})).reduce((function(e,t){return e+t}),0);if(r&&i)return{height:i,width:r,textScale:1}}},{key:"getTextWrapper",value:function(e){var t,n,r,i,a,o,s,c,u,l,h,d,f,p,v;return e.includes("m")?null==(a=null==(i=null==(r=null==(n=null==(t=this.context.wrapResource)?void 0:t.master)?void 0:n.shapes)?void 0:r[e.replace("m","")])?void 0:i.textBodyMap)?void 0:a[0]:e.includes("l")?null==(l=null==(u=null==(c=null==(s=null==(o=this.context.wrapResource)?void 0:o.layout)?void 0:s.shapes)?void 0:c[e.replace("l","")])?void 0:u.textBodyMap)?void 0:l[0]:null==(v=null==(p=null==(f=null==(d=null==(h=this.context.wrapResource)?void 0:h.slide)?void 0:d.shapes)?void 0:f[e])?void 0:p.textBodyMap)?void 0:v[0]}},{key:"getAnimBox",value:function(e,t,n){var r,i,a,o=e,s=null!=n,c=null!=t;c?(o+=",".concat(t),s&&(o+=",".concat(n))):s&&(o+=",,".concat(n));var u=this.animBoxes.get(o);if(!u){var l=this.context.shapeParamsIndex[e],h=bp;if(l.fillColor){var d=l.fillColor.rgb().object(),f=d.r,p=d.g,v=d.b,m=d.alpha;h=new lp({r:f,g:p,b:v,a:null!=m?m:1})}var g,y=Fy(this.context.pptUUID,this.context.slideIndex,e),b=l.rotate?hm(l.rotate):0;if(s||c){b=0;var k=this.getTextWrapper(e);s?(g=this.getTextRect(k,this.textCount),this.textCount+=1):c&&(g=this.getParagraphRect(k,t))}u=new kv({target:y,pIndex:g?t:void 0,tIndex:g?n:void 0,constants:{x:l.rectangle.x,y:l.rectangle.y,width:g?g.width*om:l.rectangle.width||1,height:g?g.height*om:l.rectangle.height||1,slideWidth:this.context.slideWidth/(null!=(r=null==g?void 0:g.textScale)?r:1),slideHeight:this.context.slideHeight/(null!=(i=null==g?void 0:g.textScale)?i:1),flipH:l.flipH,flipV:l.flipV},initState:{opacity:null!=(a=l.opacity)?a:1,fillcolor:h,rotate:b}}),this.animBoxes.set(o,u)}return u}},{key:"squashLastSeqPlayers",value:function(e,t){var n,r;if(!(e.length<=1)){var i=e[e.length-1].effectType;if("withEffect"===i){for(var a=e.length-1;a>0&&e[a].effectType===i;)a-=1;var o=e.splice(a,e.length-a);e.push(new Jd({players:o,effectType:null!=(r=null!=t?t:null==(n=o[0])?void 0:n.effectType)?r:"clickEffect"}))}}}},{key:"getAnimationPlayer",value:function(e,t){if(e.animationXML){var n,r=[],i=A(e.animationXML.elements);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=ek({node:a,animation:e,context:this.context,triggerEvent:this.triggerEvent,animBox:t});!o||(t.preAnimation()||t.preAnimation({}),r.push(o))}}catch(e){i.e(e)}finally{i.f()}if(!(r.length<=0)){if(e.soundEffectId){var s=function(e,t){if(e.soundEffectId)return new mp({animBox:t,effectType:e.nodeType,playerID:"SF".concat(String(Date.now())),eventSource:e.eventSourceShapeId,duration:1,delay:0,cmd:{name:"playSF",value:e.soundEffectId}})}(e,t);s&&r.push(s)}var c=function(e){return"number"==typeof e?e:"indefinite"===e?1/0:1}(e.repeatCount);return e.delay>0||c>1||e.autoRev?new Bf({playerID:"parr"+e.id,players:r,effectType:e.nodeType,delay:e.delay,repeat:c,reverse:Boolean(e.autoRev)}):r.length>1?new Jd({playerID:"par"+e.id,players:r,effectType:e.nodeType}):r[0]}}}},{key:"getTextAnimationPlayer",value:function(e,t){var n,r=this,i=function(e,t,n){var r,i,a,o,s,c,u,l,h,d,f,p,v,m=arguments.length>3&&void 0!==arguments[3]&&arguments[3],g=0;return(v=t.includes("m")?null==(o=null==(a=null==(i=null==(r=null==e?void 0:e.master)?void 0:r.shapes)?void 0:i[t.replace("m","")])?void 0:a.textBodyMap)?void 0:o[0]:t.includes("l")?null==(l=null==(u=null==(c=null==(s=null==e?void 0:e.layout)?void 0:s.shapes)?void 0:c[t.replace("l","")])?void 0:u.textBodyMap)?void 0:l[0]:null==(p=null==(f=null==(d=null==(h=null==e?void 0:e.slide)?void 0:h.shapes)?void 0:d[t])?void 0:f.textBodyMap)?void 0:p[0])&&(null==n?v.paragraphs:v.paragraphs.slice(n,n+1)).forEach((function(e){e.runs.forEach((function(e){e.text&&(m&&"en"===e.prop.language?g+=1:g+=e.text.length)}))})),g}(this.context.wrapResource,e.spId,null==(n=e.pRg)?void 0:n.start,"wd"===e.textAnimMode);if(0===i)return this.getAnimationPlayer(e,t);var a=Array(i).fill(0).map((function(t,n){var i,a=r.getAnimBox(e.spId,null==(i=e.pRg)?void 0:i.start,n),o=r.getAnimationPlayer(e,a);return o?new Bf({effectType:e.nodeType,delay:e.textAnimIterateDelay(o.duration-o.delay)*n,players:[o]}):null})).filter((function(e){return Boolean(e)}));return a.length<=1?a[0]:new Jd({effectType:e.nodeType,players:a})}},{key:"joinSubSamePlayers",value:function(e,t,n){return"mainSeq"!==t.sequenceType||"same"!==t.dimAfter?e:new Jd({players:[e,tk(n,"withEffect",e.duration+32)],effectType:e.effectType})}},{key:"joinLastSubNextIntoPlayers",value:function(e,t){var n=this.getSubNextPlayerAnimBoxes(e),r=t[t.length-1],i=n[n.length-2];if(r&&i&&!(i.length<=0)){var a,o=[r],s=A(i);try{for(s.s();!(a=s.n()).done;){var c=a.value;o.push(tk(c,"withEffect",r.delay))}}catch(e){s.e(e)}finally{s.f()}t[t.length-1]=new Jd({players:o,effectType:r.effectType})}}},{key:"getSubNextPlayerAnimBoxes",value:function(e){var t=this.subNextPlayerAnimBoxes.get(e);return t||(t=[],this.subNextPlayerAnimBoxes.set(e,t)),t}},{key:"getSeqId",value:function(e){return"interactiveSeq"===e.sequenceType&&void 0!==e.eventSourceShapeId?Fy(this.context.pptUUID,this.context.slideIndex,e.eventSourceShapeId):"mainSeq"}}]),e}();function rk(e,t){var n=new Lb(t.slideContext.master,im(rm({},t),{resourceType:"master",shapeParamsIndex:t.masterShapeParamsIndex})).collect(),r=new Lb(t.slideContext.layout,im(rm({},t),{resourceType:"layout",shapeParamsIndex:t.layoutShapeParamsIndex})).collect(),i=new Lb(e,im(rm({},t),{resourceType:"slide",shapeParamsIndex:t.slideShapeParamsIndex})).collect(),a=new nk(n,im(rm({},t),{resourceType:"master",shapeParamsIndex:t.masterShapeParamsIndex})),o=new nk(r,im(rm({},t),{resourceType:"layout",shapeParamsIndex:t.layoutShapeParamsIndex})),s=new nk(i,im(rm({},t),{resourceType:"slide",shapeParamsIndex:t.slideShapeParamsIndex})),c=new nk(n.concat.apply(n,p(r).concat(p(i))),im(rm({},t),{resourceType:"main",shapeParamsIndex:rm(rm(rm({},t.slideShapeParamsIndex),t.layoutShapeParamsIndex),t.masterShapeParamsIndex)})),u={slide:0,layout:0,master:0};return u.slide=s.mainSeq.length,u.layout=o.mainSeq.length,u.master=a.mainSeq.length,"clickEffect"!==s.mainSeq.effectType&&(u.layout>0?u.layout-=1:u.master>0&&(u.master-=1)),"clickEffect"!==o.mainSeq.effectType&&u.master>0&&(u.master-=1),[s,o,a].forEach((function(e){e.triggerEvent.on("onEnd",(function(e){var t=e.target;"slide"===t?(s.end(),c.end()):"layout"===t?o.end():"master"===t&&a.end()})),e.triggerEvent.on("onUnmount",(function(e){var t=e.target;"slide"===t?(s.reset(),c.reset()):"layout"===t?o.reset():"master"===t&&a.reset()}))})),{masterAnimationManager:a,layoutAnimationManager:o,slideAnimationManager:s,mainAnimationManager:c,animationCount:u,sequenceAnimesCounts:{get"-1"(){return s.mainSeq.length}}}}var ik="masterPartName",ak="layoutPartName";function ok(e,t){return sk.apply(this,arguments)}function sk(){return(sk=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Og("".concat(t,"/text/slide/slide").concat(n,".json"));case 2:return r=e.sent,i=r[ik].replace("/ppt/slideMasters/slideMaster","/text/master/master").replace(".xml",".json"),a=r[ak].replace("/ppt/slideLayouts/slideLayout","/text/layout/layout").replace(".xml",".json"),e.next=7,Og("".concat(t).concat(i));case 7:return o=e.sent,e.next=10,Og("".concat(t).concat(a));case 10:return s=e.sent,e.abrupt("return",{slide:r,master:o,layout:s});case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ck(e,t){return uk.apply(this,arguments)}function uk(){return(uk=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u,l,d,f,p,v,m,g=arguments;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=g.length>2&&void 0!==g[2]&&g[2],g.length>3?g[3]:void 0,i=g.length>4?g[4]:void 0,a=g.length>5?g[5]:void 0,o=g.length>6?g[6]:void 0,a&&a.info("Start load ppt ".concat(n," resource.")),s=t.replace(/\/$/i,""),o&&o.scheme&&(c=o.scheme,s=s.replace(/^[a-zA-z]+[^://]/,c)),u=new Yg(c),e.next=11,Promise.all([Og(s+"/info.json",a),Ag(s+"/pptxml/ppt.xml",a)]);case 11:return l=e.sent,d=h(l,2),f=d[0],p=d[1],e.next=17,u.loadLumiaPSD(r,a);case 17:return a&&a.info("load ppt ".concat(n," resource success")),v=(o||{}).useServerWrap,m=void 0===v||v,e.abrupt("return",(m&&Pm(s,n,f.fonts),new fk({uuid:n,url:s,width:f.width,height:f.height,slidesCount:f.totalPageSize,mainXMLContent:p,userFonts:i,preload:r,logger:a,resourceScheme:c,rtcClient:null==o?void 0:o.rtcClient,useServerWrap:m})));case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var lk,hk,dk,fk=function(){function e(t){I(this,e),this.url=t.url,this.uuid=t.uuid,this.width=t.width*am,this.height=t.height*am,this.slidesCount=t.slidesCount,this.userFonts=t.userFonts,this.preload=t.preload,this.logger=t.logger,this.resourceScheme=t.resourceScheme,this.mainXMLContent=t.mainXMLContent,this.rtcClient=t.rtcClient,this.useServerWrap=t.useServerWrap}var t,n,r;return M(e,[{key:"loadSlide",value:(r=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l,h,d,f,p,v,m,g,y,b,k,w,S,x,C,I,P,M,T=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(n=this.logger)||n.debug("begin load slide ".concat(t+1)),o=Nb.createPickers(),s=new wm("main",o).parse(this.mainXMLContent),!(t<0||t>=this.slidesCount)){e.next=4;break}throw new Error("index should be in 0 ~ ".concat(this.slidesCount-1));case 4:return c=t+1,e.next=7,this.fetchSlideInfo(c);case 7:return u=e.sent,l=u.slideXMLContent,h=u.slideRefXMLContent,d=u.layoutXMLContent,f=u.masterXMLContent,p=u.themeXMLContent,v=u.resource,m=u.wrapResource,!0===this.preload&&(null==(r=this.logger)||r.debug("begin preload slide ".concat(c+1)),this.prefetch(c+1).catch((function(e){var t;null==(t=T.logger)||t.debug("prefetch slide ".concat(c+1," error: "),e)})),null==(i=this.logger)||i.debug("preloaded slide ".concat(c+1))),g=new wm("layout",o).parse(d),y=qy(g.childElement("p:sldLayout","p:cSld","p:spTree")),b=new wm("master",o).parse(f),k=qy(b.childElement("p:sldMaster","p:cSld","p:spTree"),b.childElementOptional("p:sldMaster","p:txStyles")),w=new wm("theme",o).parse(p),S=new Ky(v,this.resourceScheme),x=new wm("slide",o).parse(l),C=new wm("slideRef",o).parse(h),I={},void 0!==C.element&&C.element.elements.forEach((function(e){I[e.attr.getString("Id")]=e.attr.getStringOptional("Target")})),P={slide:x,layout:g,layoutIndex:y,master:b,masterIndex:k,masterThemeColorMapping:b.childElement("p:sldMaster","p:clrMap").attr.attributes,theme:w,main:s,userFonts:this.userFonts},o.context=Object.freeze(P),M=rk(x,Object.freeze({pptUUID:this.uuid,slideIndex:c,slideContext:P,slideWidth:this.width,slideHeight:this.height,masterShapeParamsIndex:this.getShapeIndexMap(b.childElement("p:sldMaster","p:cSld","p:spTree")),layoutShapeParamsIndex:this.getShapeIndexMap(g.childElement("p:sldLayout","p:cSld","p:spTree")),slideShapeParamsIndex:this.getShapeIndexMap(x.childElement("p:sld","p:cSld","p:spTree")),wrapResource:m})),e.abrupt("return",(null==(a=this.logger)||a.debug("loaded slide ".concat(c)),this.slideIndex=t,Object.freeze({uuid:this.uuid,url:this.url,index:t,width:this.width,height:this.height,masterXML:b,masterIndex:k,layoutXML:g,layoutIndex:y,mainXML:s,themeXML:w,slideXML:x,slideRefIndex:I,resourceLoader:S,animations:M,slidesCount:this.slidesCount,preload:this.preload,logger:this.logger,rtcClient:this.rtcClient,WrapResource:m,preSlideIndex:this.preSlideIndex})));case 22:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"fetchSlideInfo",value:(n=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l,d;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[Ag("".concat(this.url,"/slide/slide").concat(t,".xml"),this.logger),Ag("".concat(this.url,"/slideRef/slideRef").concat(t,".xml"),this.logger).catch((function(e){return console.log("error ",e),""})),Ag("".concat(this.url,"/layout/layout").concat(t,".xml"),this.logger),Ag("".concat(this.url,"/master/master").concat(t,".xml"),this.logger),Ag("".concat(this.url,"/theme/theme").concat(t,".xml"),this.logger),Og("".concat(this.url,"/resources/resource").concat(t,".json"),this.logger)],e.next=3,Promise.all(n);case 3:if(r=e.sent,i=h(r,6),a=i[0],o=i[1],s=i[2],c=i[3],u=i[4],l=i[5],!this.useServerWrap){e.next=20;break}return e.prev=12,e.next=15,ok(this.url,t);case 15:d=e.sent,e.next=20;break;case 18:e.prev=18,e.t0=e.catch(12);case 20:return e.abrupt("return",{slideXMLContent:a,slideRefXMLContent:o,layoutXMLContent:s,masterXMLContent:c,themeXMLContent:u,resource:l,wrapResource:d});case 21:case"end":return e.stop()}}),e,this,[[12,18]])}))),function(e){return n.apply(this,arguments)})},{key:"prefetch",value:(t=l(regeneratorRuntime.mark((function e(t){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t>this.slidesCount)){e.next=3;break}return null==(n=this.logger)||n.debug("no slide need prefetch"),e.abrupt("return");case 3:return i=new Yg(this.resourceScheme),e.next=6,i.fetchPageResource(this.url,t);case 6:a=e.sent,i.prefetchPageResource(a).then((function(){}),(function(){})),null==(r=this.logger)||r.debug("prefetch slide ".concat(t," finish"));case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getShapeIndexMap",value:function(e){var t={},n=e.extraAttr.getString("spId"),r=Uy(e);return this.getShapeGroupIndexMap(e,t,n,r.transform),t}},{key:"getShapeGroupIndexMap",value:function(e,t,n,r){var i=this,a=e.elementsWithName("p:sp");this.getChildShapesIndexMap(a,t,n,r);var o=e.elementsWithName("p:cxnSp");this.getChildShapesIndexMap(o,t,n,r);var s=e.elementsWithName("p:pic");this.getChildShapesIndexMap(s,t,n,r);var c=e.elementsWithName("p:graphicFrame");this.getChildShapesIndexMap(c,t,n,r);var u=e.elementsWithName("p:grpSp");u.length>0&&u.forEach((function(e){var a=e.extraAttr.getString("spId"),o=Uy(e,void 0,n,r);i.getShapeGroupIndexMap(e,t,a,o.transform),t[a]=o}))}},{key:"getChildShapesIndexMap",value:function(e,t,n,r){e.forEach((function(e){var i=e.extraAttr.getString("spId"),a=zy(e,void 0,n,r);t[i]=a}))}}]),e}(),pk=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).state={disableJumpTo:!1},r}return M(n,[{key:"UNSAFE_componentWillMount",value:function(){var e=this.props.emitter;e.on("nextStep",this.onNextStepHandler,this),e.on("preStep",this.onPreStepHandler,this),e.on("nextPage",this.onNextPageHandler,this),e.on("prePage",this.onPrePageHandler,this),e.on("resetSlideAnimation",this.resetCurrentSlideAnimation,this),e.on("resetPPTAnimation",this.resetCurrentPPTAnimation,this),e.on("changePageTo",this.onClickJumpToHandler,this),e.on("displaySidebar",this.displaySidebar,this),e.on("hideSidebar",this.hideSidebar,this),e.on("displayNote",this.displayNote,this),e.on("hideNote",this.hideNote,this)}},{key:"componentWillUnmount",value:function(){this.props.emitter.removeAllListeners()}},{key:"onPrePageHandler",value:function(){var e=this.props,t=e.slideIndex,n=e.changeToPage;t>0&&n(t-1)}},{key:"onNextPageHandler",value:function(){var e=this.props,t=e.slideIndex,n=e.changeToPage;t<e.total-1&&n(t+1)}},{key:"onClickJumpToHandler",value:function(e){var t=this.props,n=t.total,r=t.changeToPage,i=(e||parseInt(this.inputRef.value,10))-1;return Number.isNaN(i)||i<0?(this.inputRef.value="1",void r(0)):i>n-1?(this.inputRef.value="".concat(n),void r(n-1)):(this.inputRef.value=(i+1).toString(),void r(i))}},{key:"onPreStepHandler",value:function(){(0,this.props.changeStep)(-1)}},{key:"onNextStepHandler",value:function(){(0,this.props.changeStep)(1)}},{key:"invalidJumpTo",value:function(){Number.isNaN(parseInt(this.inputRef.value,10))?this.setState({disableJumpTo:!0}):this.setState({disableJumpTo:!1})}},{key:"resetCurrentSlideAnimation",value:function(){(0,this.props.resetCurrentSlideAnimation)()}},{key:"resetCurrentPPTAnimation",value:function(){(0,this.props.resetCurrentPPTAnimation)()}},{key:"displaySidebar",value:function(){(0,this.props.changeIsExtendSidebar)(!0)}},{key:"hideSidebar",value:function(){(0,this.props.changeIsExtendSidebar)(!1)}},{key:"displayNote",value:function(){(0,this.props.changeIsShowNote)(!0)}},{key:"hideNote",value:function(){(0,this.props.changeIsShowNote)(!1)}},{key:"render",value:function(){var e=this,t=this.state.disableJumpTo,n=this.props,r=n.slideIndex,i=n.total,a=n.isExtendSidebar,o=n.isShowNote,s=n.international,c=n.disableSidebar,u=n.disableNote;return Xv.default.createElement("div",{className:"ppt-preview-beauty-scroll-bar ppt-preview-controls"},Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",disabled:0===r,onClick:function(){e.onPrePageHandler()}},s&&s.prePage||""),Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.onPreStepHandler()}},s&&s.preStep||""),Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.onNextStepHandler()}},s&&s.nextStep||""),Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",disabled:r===i-1,onClick:function(){e.onNextPageHandler()}},s&&s.nextPage||""),Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.resetCurrentSlideAnimation()}},s&&s.resetCurrentSlideAnimation||""),Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.resetCurrentPPTAnimation()}},s&&s.resetCurrentPPTAnimation||""),Xv.default.createElement("input",{className:"ppt-preview-controls-input",type:"text",onInput:function(){e.invalidJumpTo()},ref:function(t){e.inputRef=t}}),Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.onClickJumpToHandler()},disabled:t},s&&s.jumpTo||""),a?Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.hideSidebar()}},s&&s.hideSidebar||""):Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.displaySidebar()},disabled:c},s&&s.displaySidebar||""),o?Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.hideNote()}},s&&s.hideNote||""):Xv.default.createElement("button",{type:"button",className:"ppt-preview-controls-button",onClick:function(){e.displayNote()},disabled:u},s&&s.displayNote||""),Xv.default.createElement("p",{className:"ppt-preview-controls-page"},s&&s.pageNumber||"","",r+1," ","/",i))}}]),n}(Xv.default.Component),vk=function(e){y(n,e);var t=k(n);function n(e){return I(this,n),t.call(this,e)}return M(n,[{key:"render",value:function(){var e=this.props,t=e.isShow,n=e.noteList;return qv.default.createElement("div",{style:{width:"100%",height:"200px",overflow:"auto",position:"absolute",bottom:t?0:"-200px",transition:"1s",zIndex:"2",fontSize:"12px",padding:"12px",boxSizing:"border-box",fontFamily:""},className:"ppt-preview-beauty-scroll-bar ppt-preview-note"},n.map((function(e,t){var n,r={textAlign:rg(null!=(n=e.align)?n:"l"),marginLeft:e.marginLeft?"".concat(e.marginLeft,"px"):0,marginRight:e.marginRight?"".concat(e.marginRight,"px"):0,textIndent:e.indent?"".concat(e.indent,"px"):0};return qv.default.createElement("div",{key:t,style:r},e.buchar&&qv.default.createElement("span",null,parseInt(e.buchar,10)?e.buchar+".":e.buchar,""),!e.runs&&qv.default.createElement("br",null),e.runs&&e.runs.map((function(e,n){var r,i={letterSpacing:e.wordSpace?"".concat(e.wordSpace,"px"):0,verticalAlign:e.baseline?"".concat(e.baseline,"px"):0,textDecoration:e.underLine?ig(e.underLine):"none",strikeThrough:e.strikeThrough?"":"none",fontWeight:e.bold?"bolder":"normal",fontStyle:e.italic?"italic":"normal"},a=e.text?e.text:"";if(null==(r=e.text)?void 0:r.includes("\t")){for(var o=[],s=0;s<e.text.length;s+=1)"\t"===e.text[s]?o.push(qv.default.createElement("span",{key:"tab"+s},"\t")):o.push(qv.default.createElement("span",{key:"tab"+s,style:{fontFamily:""}},e.text[s]));return qv.default.createElement("pre",{key:a+t+n,style:{margin:"0",display:"inline"}},o)}return"sngStrike"===e.strikeThrough?qv.default.createElement("span",{key:a+t+n,style:i},qv.default.createElement("s",null,e.text)):"br"===e.runType?qv.default.createElement("br",null):"text"===e.runType?qv.default.createElement("span",{key:a+t+n,style:i},e.text):qv.default.createElement("span",{key:a+t+n})})))})))}}]),n}(qv.default.PureComponent),mk=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"clickHandler",value:function(e){(0,this.props.changeToPage)(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.isExtend,r=t.previewList,i={display:"flex",flexDirection:"column",justifyContent:"flex-start",position:"absolute",right:n?0:"-20%",width:"20%",overflow:"auto",transition:"1s",top:0,bottom:0,zIndex:"3",borderLeft:"1px solid #ccc",backgroundColor:"#eee"},a={display:"flex",flexDirection:"column",justifyContent:"space-around"};return Qv.default.createElement("div",{style:i,className:"ppt-preview-beauty-scroll-bar ppt-preview-sidebar"},r.map((function(t,n){return Qv.default.createElement("div",{className:"ppt-preview-sidebar-item ppt-event-source",key:t,style:a,onClick:function(){e.clickHandler(n)}},Qv.default.createElement("img",{className:"ppt-preview-sidebar-img",src:t,alt:"PPT"}),Qv.default.createElement("span",{className:"ppt-preview-sidebar-span"},n+1))})))}}]),n}(Qv.default.Component);!function(e){e.waiting="Waiting",e.converting="Converting",e.finished="Finished",e.fail="Fail"}(lk||(lk={})),function(e){e.packaging="Packaging",e.extracting="Extracting",e.generatingPreview="GeneratingPreview",e.mediaTranscode="MediaTranscode"}(hk||(hk={})),function(e){e.dynamic="dynamic",e.static="static"}(dk||(dk={}));var gk=function(e){y(a,e);var t,n,r,i=k(a);function a(e){var t,n,r;return I(this,a),(t=i.call(this,e)).previewList=[],t.PPTSliderList=[],t.stateAdapter={disableInteractive:!1,setState:(r=l(regeneratorRuntime.mark((function e(n,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.setState({globalPPTState:i});case 1:case"end":return e.stop()}}),e)}))),function(e,t,n){return r.apply(this,arguments)}),onPageToPrev:function(){var e=t.state.slideIndex;t.changePageTo(e-1).then((function(){}),(function(){}))},onPageToNext:function(){var e=t.state.slideIndex;t.changePageTo(e+1).then((function(){}),(function(){}))},onPageJumpTo:(n=l(regeneratorRuntime.mark((function e(n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.changePageTo(r-1).then((function(){}),(function(){}));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)}),setSlideStateAdapterCallbacks:function(e){}},t.clickSidebarHandler=function(e){t.changePageTo(e).then((function(){}),(function(){}))},t.clickControllerHandler=function(e){t.changePageTo(e).then((function(){}),(function(){}))},t.changeIsExtendSidebar=function(e){0!==t.previewList.length&&t.setState({isExtendingSidebar:e})},t.changeIsShowNote=function(e){0!==t.state.noteList.length&&t.setState({isShownNote:e})},t.resetCurrentSlideAnimation=function(){t.slideRef&&t.slideRef.resetCurrentSlideAnimation()},t.resetCurrentPPTAnimation=function(){t.slideRef&&t.slideRef.resetCurrentPPTAnimation()},t.state={slide:void 0,slideIndex:0,globalPPTState:void 0,isExtendingSidebar:!1,isShownNote:!1,noteList:[],isLoading:!0},t.isGotNodeList=!1,e.conversionResponse.status===lk.finished&&(t.uuid=e.conversionResponse.uuid,e.conversionResponse.progress.convertedFileList.forEach((function(e){t.PPTSliderList.push(im(rm({},e),{conversionFileUrl:e.conversionFileUrl.replace(/\d.slide/g,"")})),e.preview&&t.previewList.push(e.preview)})),t.total=t.PPTSliderList.length),t}return M(a,[{key:"UNSAFE_componentWillMount",value:(r=l(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.slideIndex,n=this.props,r=n.preloadProgress,i=n.userFonts,a=n.logger,o=this.PPTSliderList[t],e.next=3,ck(o.conversionFileUrl,this.uuid,!0,r,i,a,{scheme:"https",useServerWrap:!0});case 3:return this.ppt=e.sent,e.next=6,this.ppt.loadSlide(t);case 6:return s=e.sent,e.next=9,this.getNoteList();case 9:this.setState({slide:s,isLoading:!1});case 10:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"componentWillUnmount",value:function(){this.props.emitter.removeAllListeners()}},{key:"getNoteList",value:(n=l(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.state.slideIndex,n=this.PPTSliderList[t],e.prev=1,e.next=4,Og("".concat(n.conversionFileUrl.replace("pptx","https"),"notes/note").concat(t+1,".json"));case 4:r=e.sent,this.setState({noteList:r}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),this.setState({noteList:[]});case 11:this.isGotNodeList=!0;case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return n.apply(this,arguments)})},{key:"changePageTo",value:(t=l(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t<0||t>=this.total)){e.next=2;break}return e.abrupt("return");case 2:if(!this.state.isLoading){e.next=5;break}return e.abrupt("return");case 5:return this.setState({isLoading:!0}),e.next=8,this.ppt.loadSlide(t);case 8:return n=e.sent,this.setState({slide:n,slideIndex:t,isLoading:!1,isShownNote:!1}),e.next=12,this.getNoteList();case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"changeStep",value:function(e){this.state.isLoading||this.slideRef.changeStep(e)}},{key:"emitData",value:function(){var e=this;clearTimeout(this.emitSetTimeout),this.emitSetTimeout=setTimeout((function(){if(e.isGotNodeList){var t=e.total,n=e.state,r=n.slideIndex,i=n.isExtendingSidebar,a=n.isShownNote,o=n.noteList,s=e.props.emitter,c=!e.previewList.length,u=!o.length;s.emit("update",{index:r+1,total:t,disableNote:u,disableSidebar:c,isShowNote:a,isExtendSidebar:i})}}),500)}},{key:"render",value:function(){var e=this,t=this.total,n=this.PPTSliderList,r=this.state,i=r.globalPPTState,a=r.slide,o=r.slideIndex,s=r.isExtendingSidebar,c=r.isShownNote,u=r.noteList,l=r.isLoading,h=this.props,d=h.parentElement,f=h.config,p=h.emitter,v=!this.previewList.length,m=!u.length,g=n[0].width;this.emitData();var y=n[0].height+40,b={width:"".concat(g,"px"),height:"".concat(y,"px"),transform:""},k=Math.min(d.offsetWidth/g,d.offsetHeight/y);return d.style.width&&(b.transform="scale(".concat(k,", ").concat(k,")")),_v.default.createElement("div",{style:b,className:"ppt-preview-container"},_v.default.createElement(pk,{international:f&&f.international,isShowNote:c,emitter:p,disableNote:m,disableSidebar:v,isExtendSidebar:s,changeStep:function(t){e.changeStep(t)},changeIsShowNote:this.changeIsShowNote,changeIsExtendSidebar:this.changeIsExtendSidebar,total:t,resetCurrentSlideAnimation:this.resetCurrentSlideAnimation,resetCurrentPPTAnimation:this.resetCurrentPPTAnimation,changeToPage:this.clickControllerHandler,slideIndex:o}),_v.default.createElement("div",{style:{position:"relative",display:"inline-block",overflow:"hidden",width:"100%",fontSize:"0"},className:"ppt-preview-main-container"},_v.default.createElement("div",{style:{display:"inline-block"},className:"ppt-preview-slide-container"},!l&&a&&_v.default.createElement(Xy,{ref:function(t){e.slideRef=t},stateAdapter:this.stateAdapter,pptState:i,data:a,renderMode:Vy.Normal}),l&&_v.default.createElement("div",{style:b})),this.previewList.length>0&&_v.default.createElement(mk,{isExtend:s,previewList:this.previewList,changeToPage:this.clickSidebarHandler}),u.length>0&&_v.default.createElement(vk,{isShow:c,noteList:u})))}}]),a}(_v.default.Component);function yk(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0,a=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0;t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center";var c=null!=s?s:new Yv.default;return Gv.default.render(_v.default.createElement(gk,{conversionResponse:e,parentElement:t,preload:r,userFonts:i,logger:a,config:n,pptPrams:o,emitter:c}),t),c}var bk=X(n("q1tI")),kk=X(n("GBY4")),wk=X(n("A3Fa")),Sk=Object.defineProperty,xk=Object.getOwnPropertySymbols,Ck=Object.prototype.hasOwnProperty,Ik=Object.prototype.propertyIsEnumerable,Pk=function(e,t,n){return t in e?Sk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n};var Mk=new(function(){function e(){var t=this;I(this,e),this.libraryMap={},this.paddingMap={},this.freeInterrupters={},this.defineLibrary=function(e,n){if(e.libName in t.libraryMap)throw new Error("found duplicated library ".concat(JSON.stringify(e.libName)));n&&(t.freeInterrupters[e.libName]=n),t.libraryMap[e.libName]=Object.freeze(function(e,t){for(var n in t||(t={}))Ck.call(t,n)&&Pk(e,n,t[n]);if(xk){var r,i=A(xk(t));try{for(i.s();!(r=i.n()).done;){n=r.value;Ik.call(t,n)&&Pk(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e}({},e))},this.requireModules=function(e){return new Promise((function(n,r){var i=t.paddingMap[e];i||(i=t.paddingMap[e]=[]),i.push({resolve:n,reject:r})}))},this.loader=function(e,n,r){if(!n&&!r){var i=e;return t.createRequireFunction(i)}var a=e;t.handlePanddingNodes(a,n,r)};var n="__netlessJavaScriptLoader",r=window;if(void 0!==r[n])throw new Error("window.".concat(n," was override"));Object.defineProperty(r,n,{enumerable:!1,configurable:!1,writable:!1,value:this.loader})}return M(e,[{key:"handlePanddingNodes",value:function(e,t,n){var r=this.paddingMap[e];if(r){delete this.paddingMap[e];var i,a=A(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(n)o.reject(n);else try{o.resolve(this.handleModules(t))}catch(c){o.reject(c)}}}catch(e){a.e(e)}finally{a.f()}}else if(!n&&t){var s=function(e){var t=e.split("/");return t.pop(),t.join("/")}(e),c=this.freeInterrupters[s];c&&c(e,t)}else console.warn("find invalid async module ".concat(JSON.stringify(e)))}},{key:"createRequireFunction",value:function(e){var t=this.libraryMap[e];if(!t)throw new Error("undefined library ".concat(JSON.stringify(e)));return function(n){var r=t.dependencies,i=r&&r[n];if(!i)throw new Error("cannot find module ".concat(JSON.stringify(n)," of library ").concat(JSON.stringify(e)));return i}}},{key:"handleModules",value:function(e){for(var t in e){var n=e[t];"__esModule"in n||Object.defineProperty(n,"__esModule",{value:!0})}return Object.freeze(e)}}]),e}()),Tk=Mk.requireModules,Ak=Mk.defineLibrary;function Ek(e,t){for(var n=window.atob(e),r=new Uint8Array(n.length),i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return new Blob([r],t)}function Ok(e){return new Promise((function(t,n){try{var r=new FileReader;r.onload=function(e){var r,i=null==(r=e.target)?void 0:r.result;"string"==typeof i?t(i):n(new Error("blob load wrong type "+T(i)))},r.readAsDataURL(e)}catch(e){n(e)}}))}var Rk="modules";function Nk(e){return new Promise((function(t,n){e.onsuccess=function(){return t(e.result)},e.onerror=function(){if(e.error){var t=new Error(e.error.message);t.name=e.error.name,n(t)}else n(new Error("failed with null Error"))}}))}var Lk=function(){function e(t,n,r){I(this,e);var i=new URL(n),a=i.protocol,o=i.host,s=new Je({fetcher:window.fetch.bind(window),retryCount:e.retryCount,retryLoopsCount:0,configmap:{module:{useSSL:"https:"===a,hosts:{"*":o}}}});this.fetcher=s.fetch("module"),this.storeBase64=t,this.findPath=r}var t,n,r,i;return M(e,[{key:"findObjectURL",value:(i=l(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.readBlob(t);case 2:if(n=e.sent,e.t0=n,e.t0){e.next=10;break}return e.next=7,this.fetchBuffer(t);case 7:return n=e.sent,e.next=10,this.writeBlob(t,n);case 10:return e.abrupt("return",URL.createObjectURL(n,{oneTimeOnly:!0}));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"readBlob",value:(r=l(regeneratorRuntime.mark((function t(n){var r,i,a,o,s,c,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dbp;case 2:return r=t.sent.transaction([Rk],"readonly").objectStore(Rk).get(n),t.next=5,Nk(r);case 5:return"string"==typeof(i=t.sent)&&(a=i.split(/;base64,/im),o=h(a,2),s=o[0],c=o[1],u=s.replace(/^data:/im,""),i=Ek(c,{type:u})),t.abrupt("return",i);case 8:case"end":return t.stop()}}),t)}))),function(e){return r.apply(this,arguments)})},{key:"writeBlob",value:(n=l(regeneratorRuntime.mark((function t(n,r){var i,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i=r,t.t0=this.storeBase64,!t.t0){t.next=6;break}return t.next=5,Ok(i);case 5:i=t.sent;case 6:return t.next=8,e.dbp;case 8:return a=t.sent.transaction([Rk],"readwrite").objectStore(Rk).put(i,n),t.next=11,Nk(a);case 11:case"end":return t.stop()}}),t,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetchBuffer",value:(t=l(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="http://module"+this.findPath(t),e.next=3,this.fetcher(n,{method:"get",headers:{Accept:"application/javascript"}});case 3:if(200===(r=e.sent).status){e.next=6;break}throw new Error("failed to fetch ".concat(JSON.stringify(n)," with status ").concat(r.status));case 6:return e.next=8,r.blob();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}],[{key:"dbp",get:function(){if(!this._dbp){var e=indexedDB.open("__netlessJavaScriptCache",1);e.onupgradeneeded=function(e){e.target.result.createObjectStore(Rk)},this._dbp=Nk(e)}return this._dbp}}]),e}();Lk.retryCount=5;var jk=function(){function e(t){I(this,e),this.params=t,this.completeCallbacks=[]}var t,n;return M(e,[{key:"load",value:(n=l(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],void 0!==this.params.timeout&&t.push(this.startTimeout(this.params.timeout)),t.push(this.loadScript()),e.prev=2,e.next=5,Promise.race(t);case 5:e.prev=5,n=A(this.completeCallbacks);try{for(n.s();!(r=n.n()).done;)(0,r.value)()}catch(e){n.e(e)}finally{n.f()}return e.finish(5);case 9:case"end":return e.stop()}}),e,this,[[2,,5,9]])}))),function(){return n.apply(this,arguments)})},{key:"loadScript",value:(t=l(regeneratorRuntime.mark((function e(){var t,n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.params,n=t.origin,r=t.findPath,i=t.identifier,!(a=t.storage)){e.next=13;break}return e.prev=2,e.next=5,a.findObjectURL(i);case 5:o=e.sent,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.warn("read from storage failed: ".concat(e.t0.message)),o="".concat(n).concat(r(i));case 11:e.next=14;break;case 13:o="".concat(n).concat(r(i));case 14:return e.next=16,this.loadScriptWithURL(o);case 16:case"end":return e.stop()}}),e,this,[[2,8]])}))),function(){return t.apply(this,arguments)})},{key:"loadScriptWithURL",value:function(e){var t=this;return new Promise((function(n,r){var i=document.createElement("script");t.completeCallbacks.push((function(){i.onerror=null,i.onload=null,i.remove()})),i.charset="utf-8",i.src=e,i.onload=function(){n()},i.onerror=function(t){var n=t&&("load"===t.type?"missing":t.type);r(new Error("fetch ".concat(JSON.stringify(e)," failed: ").concat(n)))},document.head.appendChild(i)}))}},{key:"startTimeout",value:function(e){var t=this,n=null;return this.completeCallbacks.push((function(){null!==n&&(clearTimeout(n),n=null)})),new Promise((function(r,i){n=setTimeout((function(){n=null,i(new Error("fetch ".concat(t.params.identifier," timeout")))}),e)}))}}]),e}();var Dk,Fk,zk=function(){function e(t){var n=this;I(this,e),this.modulesMap={},this.taskPromises={},this.onInterruptFreeModules=function(e,t){n.modulesMap[e]||(n.modulesMap[e]=t)};var r={libName:t.libName,dependencies:t.dependencies};Ak(r,this.onInterruptFreeModules),this.origin=t.origin,this.findPath=t.findPath,this.timeout=t.timeout,this.storage=t.cache?new Lk(!!t.storeBase64,t.origin,t.findPath):void 0}var t;return M(e,[{key:"require",value:(t=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.modulesMap[t]){e.next=7;break}return void 0===(i=this.taskPromises[t])&&(i=this.taskPromises[t]=l(regeneratorRuntime.mark((function e(){var n,r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={identifier:t,origin:o.origin,findPath:o.findPath,timeout:o.timeout,storage:o.storage},e.next=4,Promise.all([Tk(t),new jk(n).load()]);case 4:return r=e.sent,i=h(r,1),a=i[0],e.abrupt("return",a);case 8:return e.prev=8,delete o.taskPromises[t],e.finish(8);case 11:case"end":return e.stop()}}),e,null,[[0,,8,11]])})))()),e.next=6,i;case 6:r=this.modulesMap[t]=e.sent;case 7:if(a=r[n]){e.next=10;break}throw new Error("can't find module ".concat(JSON.stringify(n)," from ").concat(t));case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})}]),e}(),Bk=function e(t){if("object"!=T(t)||null===t)return t;if(t.constructor===Object){var n={};for(var r in t)n[r]=e(t[r]);return Object.freeze(n)}if(Array.isArray(t)){for(var i=[],a=0;a<t.length;++a)i[a]=e(t[a]);return Object.freeze(i)}return t}(Q);(Fk=Dk||(Dk={})).DisableCache="disableCache",Fk.StoreAsBlob="storeAsBlob",Fk.StoreAsBase64="storeAsBase64";var Uk=Dk.StoreAsBase64,Vk=null;function Wk(e){if(void 0===Uk)throw new Error("cannot set async module load mode after joined or replay any room");Uk=e}function Hk(e){return _k.apply(this,arguments)}function _k(){return(_k=l(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Vk||(Vk=Gk(Uk),Uk=void 0),e.next=3,Promise.all([Vk.require(t,"white-model"),Vk.require(t,"white-render")]);case 3:return n=e.sent,e.abrupt("return",Object.freeze({WhiteModel:n[0],WhiteRender:n[1]}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gk(e){var t,n;switch(e){case Dk.DisableCache:t=!1,n=!1;break;case Dk.StoreAsBlob:t=!0,n=!1;break;case Dk.StoreAsBase64:t=!0,n=!0}return function(e){return new zk(e)}({libName:Bk.modules.identifier,timeout:12e4,cache:t,storeBase64:n,origin:Bk.modules.origin,findPath:function(e){return"/dynamic-libraries/".concat(e,".js")},dependencies:{akko:K,boundless:Rc,mobx:Md,"mobx-react":Td,react:bk.default,"netless-ppt":Ad,"url-parse":kk.default,"textarea-caret-ts":wk.default}})}!function(e){var t=document.createElement("style"),n=document.createTextNode(e);t.appendChild(n),document.head.appendChild(t)}(".netless-whiteboard div.highlight-box{border:1px solid;box-shadow:0 0 1px #fff,inset 0 0 1px #fff}.netless-whiteboard div.editor-box>*.cursor-nwse{cursor:nwse-resize}.netless-whiteboard div.editor-box>*.cursor-nesw{cursor:nesw-resize}.netless-whiteboard div.editor-box>*.cursor-ns{cursor:ns-resize}.netless-whiteboard div.editor-box>*.cursor-ew{cursor:ew-resize}.netless-whiteboard div.editor-box{pointer-events:none;border:1px solid;box-shadow:0 0 1px #fff,inset 0 0 1px #fff}.netless-whiteboard div.editor-box>.lock{pointer-events:none;position:absolute;width:22px;height:22px;top:-11px;left:-11px}.netless-whiteboard div.editor-box>div.operation-point-desktop{width:7px;height:7px;position:absolute;pointer-events:auto}.netless-whiteboard div.editor-box>div.operation-point-touch{width:33px;height:33px;position:absolute;pointer-events:auto;display:flex;align-items:center;justify-content:center}.netless-whiteboard div.editor-box>div.operation-point-touch>*{pointer-events:none;width:7px;height:7px}.netless-whiteboard div.editor-box>.operation-point-desktop.left-top{left:-4px;top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right-top{right:-4px;top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.left-bottom{left:-4px;bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right-bottom{right:-4px;bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.top{top:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.right{right:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.bottom{bottom:-4px}.netless-whiteboard div.editor-box>.operation-point-desktop.left{left:-4px}.netless-whiteboard div.editor-box>.operation-point-touch.left-top{left:-17px;top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right-top{right:-17px;top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.left-bottom{left:-17px;bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right-bottom{right:-17px;bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.top{top:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.right{right:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.bottom{bottom:-17px}.netless-whiteboard div.editor-box>.operation-point-touch.left{left:-17px}.netless-whiteboard div.editor-box-others{border:1px solid}.netless-whiteboard textarea{-webkit-appearance:none;-webkit-user-select:text;-moz-user-select:text;user-select:text;padding:0;margin:0;outline:none;border:none;resize:none;overflow:hidden}.netless-whiteboard .textarea-border{position:absolute;top:0;left:0;pointer-events:none;border-width:1px;border-style:dashed}.netless-whiteboard .textarea-border>*{position:absolute;pointer-events:auto}.netless-whiteboard .textarea-layout{position:absolute;top:0;left:0;pointer-events:none;border-width:1px;border-style:dashed;border-style:solid;border-color:#0000}.netless-whiteboard .textarea-layout>*{position:absolute;pointer-events:auto}.netless-whiteboard textarea.readonly-textarea{background:rgba(255,255,255,0)}.netless-whiteboard textarea.editable-textarea{background:rgba(255,255,255,0)}.netless-whiteboard textarea.my-textarea{pointer-events:auto}.netless-whiteboard div.float-bar{display:flex;flex-direction:row;align-items:center;background:#ffffff;border:1px solid #EFEFEF;box-shadow:0 6px 12px #0000001f;border-radius:4px}.netless-whiteboard div.float-bar div,.netless-whiteboard div.float-bar input{pointer-events:auto}.netless-whiteboard div.float-bar img{pointer-events:none}.netless-whiteboard div.float-bar .button{display:flex;justify-content:center;align-items:center;cursor:pointer;border:none}.netless-whiteboard div.float-bar .button:hover{background:#EEF0F6}.netless-whiteboard div.float-bar .button.disable{opacity:.5;cursor:not-allowed;background:transparent}.netless-whiteboard div.float-bar>.decorator{height:40px;display:flex;justify-content:center;align-items:center;cursor:pointer;border:none}.netless-whiteboard div.float-bar>.normal-button{width:40px;height:40px}.netless-whiteboard div.float-bar>.highlight-button{background:#EEF0F6}.netless-whiteboard div.float-bar img.font-size-icon{width:16px;height:16px;margin-left:12px}.netless-whiteboard div.float-bar>input.font-size-input::-webkit-outer-spin-button,.netless-whiteboard div.float-bar>input.font-size-input::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}.netless-whiteboard div.float-bar>input.middle:focus,.netless-whiteboard div.float-bar>input:focus{outline-width:0}.netless-whiteboard div.float-bar>input.font-size-input{-moz-appearance:textfield;width:29px;height:20px;margin-left:10px;font-size:12px;font-family:PingFang SC,Microsoft Yahei;font-weight:normal;color:#212324;line-height:14px;border-radius:2px;border:1px solid #e7e7e7;text-align:center}.netless-whiteboard div.float-bar div.font-size-buttons{display:flex;flex-direction:column;flex-wrap:none;justify-content:space-between;align-items:stretch;margin-left:5px;margin-right:7px}.netless-whiteboard div.float-bar div.font-size-buttons>div.arrow-button{display:flex;flex-direction:column;flex-wrap:none;justify-content:center;align-items:center;width:16px;height:8px}.netless-whiteboard div.float-bar div.font-size-buttons>div.arrow-button>img{width:6px;height:3px}.netless-whiteboard div.float-bar div.font-size-menu{position:absolute;display:flex;flex-direction:column;justify-content:center;align-items:stretch;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.font-size-menu>div.hover{background:#e7e7e7}.netless-whiteboard div.float-bar div.font-size-menu>div.cell{display:flex;flex-direction:row;justify-content:center;align-items:center;width:64px;height:24px}.netless-whiteboard div.float-bar div.font-size-menu>div.cell>span{padding-left:4px;padding-right:4px;font-size:12px;font-family:PingFang SC,Microsoft Yahei;font-weight:normal;color:#000}.netless-whiteboard div.float-bar div.font-size-menu>div.cell>.check{width:8px;height:8px}.netless-whiteboard div.float-bar div.font-colors-icon{position:relative;width:16px;height:16px}.netless-whiteboard div.float-bar div.font-colors-icon>img{position:absolute;top:0;left:0;width:16px;height:16px;z-index:1}.netless-whiteboard div.float-bar div.font-colors-icon>div.bar{position:absolute;left:2px;right:2px;top:12.5px;height:1.5px;z-index:2}.netless-whiteboard div.float-bar div.font-colors-menu{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:center;position:absolute;padding:8px;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-selected{border-color:#a7a7a7}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-not-selected{border-color:#fff}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-button{display:flex;justify-content:center;align-items:center;cursor:pointer;margin:4px;width:20px;height:20px;border-radius:50%;border-width:1px;border-style:solid}.netless-whiteboard div.float-bar div.font-colors-menu>div.font-color-button>.core{width:16px;height:16px;border-radius:50%;border:1px solid rgba(0,0,0,.12)}.netless-whiteboard div.float-bar div.image-layer-menu{display:flex;flex-wrap:wrap;flex-direction:row;justify-content:flex-start;align-items:center;position:absolute;padding:4px;background:#ffffff;box-shadow:0 3px 6px #0000001f;border-radius:2px}.netless-whiteboard div.float-bar div.image-layer-menu>.normal-button{width:32px;height:32px}.netless-whiteboard *{-webkit-user-select:none;-moz-user-select:none;user-select:none;pointer-events:none}.cursor-selector .ppt-event-source{cursor:pointer;pointer-events:auto;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.cursor-clicker .ppt-event-source{pointer-events:auto;-webkit-user-select:auto;-moz-user-select:auto;user-select:auto}.netless-whiteboard{text-align:start}.netless-whiteboard *{box-sizing:border-box}.netless-whiteboard *>svg{text-align:start}.netless-ppt-last-run:after{content:attr(data-last-word);margin-left:var(--data-last-word-indent);display:inline-block;width:0}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar{width:12px;height:6px}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar-track{border-radius:3px;background:rgba(0,0,0,.06);-webkit-box-shadow:inset 0 0 5px rgba(0,0,0,.08);box-shadow:inset 0 0 5px #00000014}.ppt-preview-beauty-scroll-bar::-webkit-scrollbar-thumb{border-radius:3px;background:rgba(0,0,0,.12);-webkit-box-shadow:inset 0 0 10px rgba(0,0,0,.2);box-shadow:inset 0 0 10px #0003}.ppt-preview-main-container{border:1px solid #222}.ppt-preview-show-note-svg{width:40px;height:40px}.ppt-preview-show-sidebar-svg{width:40px;height:40px}.ppt-preview-controls{height:40px;width:100%}.ppt-preview-controls-button{margin:0 2px}.ppt-preview-sidebar{border-left:1px solid #ccc;background-color:#eee}.ppt-preview-sidebar-item{margin:14px 14px 16px}.ppt-preview-sidebar-span{font-size:10pt;text-align:center}.ppt-preview-note{background-color:#eee}.ppt-preview-animation-svg{width:20px;height:20px}.ppt-preview-controls-page{float:right;line-height:16px;font-size:16px;padding:0;margin:0}\n");var Yk=X(n("0yMQ")),Xk=X(n("Fs82")),qk=X(n("q1tI")),Qk=X(n("0yMQ")),Kk=X(n("0yMQ")),Zk=function(){function e(t){I(this,e),this.onChanged=null,this.atoms=[],this.observers={},this.id=t}return M(e,[{key:"addObservedAtom",value:function(e,t){this.observers&&this.atoms&&(this.observers[e.identifier]=e,this.atoms.push(t))}},{key:"takeObservers",value:function(){var e=this.observers;return this.observers=null,e}},{key:"replay",value:function(){if(this.atoms){var e,t=A(this.atoms);try{for(t.s();!(e=t.n()).done;){e.value.reportObserved()}}catch(e){t.e(e)}finally{t.f()}}}},{key:"reportChanged",value:function(){if(this.atoms){var e=this.onChanged;this.atoms=null,this.observers=null,this.onChanged=null,null==e||e()}}}],[{key:"collectObservations",value:function(t,n){var r=new e("".concat(e.nextId));e.nextId+=1,e.hub=r;try{return t()}finally{e.hub=null;try{n(r)}catch(e){console.error(e)}}}},{key:"observedHub",value:function(){return e.hub}}]),e}();Zk.nextId=0;var Jk,$k,ew=function(){function e(t,n){I(this,e),this.atoms={},this.keysHubs={},this.iterationAtom=null,this.iterationHubs=null,this.identifier=t,this.debugName=n}return M(e,[{key:"releaseHubs",value:function(){for(var e in this.keysHubs)delete this.keysHubs[e];this.iterationHubs=null}},{key:"reportChanged",value:function(e,t,n){this.reportAtomChanged(e,n),this.disposeHubs(e)}},{key:"reportAtomChanged",value:function(e,t){var n=this.atoms[e];if(n&&n.reportChanged(),this.iterationAtom)switch(t){case ci.Removed:case ci.Inserted:this.iterationAtom.reportChanged()}n&&t===ci.Removed&&delete this.atoms[e]}},{key:"disposeHubs",value:function(e){for(var t in this.iterationHubs)this.iterationHubs[t].reportChanged();this.iterationHubs=null;var n=this.keysHubs[e];if(n){for(var r in n)n[r].reportChanged();delete this.keysHubs[e]}}},{key:"reportObservedIteration",value:function(){var e=this.iterationAtom;e||(e=this.iterationAtom=(0,Kk.createAtom)(this.debugName)),e.reportObserved();var t=Zk.observedHub();if(t){var n=this.iterationHubs;n||(n=this.iterationHubs={}),n[t.id]||(n[t.id]=t,t.addObservedAtom(this,e))}}},{key:"reportObservedKey",value:function(e){var t=this.atoms[e];t||(t=this.atoms[e]=(0,Kk.createAtom)(this.debugName)),t.reportObserved();var n=Zk.observedHub();if(n){var r=this.keysHubs[e];r||(r=this.keysHubs[e]={}),r[n.id]||(r[n.id]=n,n.addObservedAtom(this,t))}}}]),e}(),tw=function(){function e(){I(this,e),this.observers={}}return M(e,[{key:"addObserverHub",value:function(e){var t=e.takeObservers();for(var n in t)this.observers[n]=t[n]}},{key:"clean",value:function(){for(var e in this.observers)this.observers[e].releaseHubs()}}]),e}(),nw=function(){function e(){I(this,e)}return M(e,[{key:"observeUpdate",value:function(e){(0,Qk.runInAction)(e)}},{key:"create",value:function(e,t){return new ew(e,t)}},{key:"createObserverCollection",value:function(){return new tw}},{key:"collectObservations",value:function(e,t){return Zk.collectObservations(e,t)}}]),e}(),rw=function(){function e(){I(this,e),this.listenerNodes=[]}return M(e,[{key:"isOnline",get:function(){return navigator.onLine}},{key:"addListener",value:function(e){var t={origin:e,onOffline:function(){return e.onOffline()},onOnline:function(){return e.onOnline()}};this.listenerNodes.push(t),window.addEventListener("online",t.onOnline),window.addEventListener("offline",t.onOffline)}},{key:"removeListener",value:function(e){var t=this.listenerNodes.findIndex((function(t){return t.origin===e}));if(-1!==t){var n=h(this.listenerNodes.splice(t,1),1)[0];window.removeEventListener("online",n.onOnline),window.removeEventListener("offline",n.onOffline)}}}]),e}(),iw=X(n("cr+I")),aw=new Je({fetcher:window.fetch.bind(window),retryCount:2,retryLoopsCount:0,configmap:{api:{hosts:{"*":Bk.shuntApiHosts}},"ppt-api":{hosts:{"*":Bk.hosts.pptApi}}}}),ow=function(){function e(){I(this,e),this.map={}}return M(e,[{key:"values",value:function(e){return this.map[e]}},{key:"has",value:function(e,t){var n=this.map[e];return!!n&&-1!==n.indexOf(t)}},{key:"put",value:function(e,t){var n=this.map[e];n||(n=this.map[e]=[]),-1===n.indexOf(t)&&n.push(t)}},{key:"remove",value:function(e,t){if(e)if(t){var n=this.map[e];if(n){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.map[e])}}else delete this.map[e];else for(var i in this.map)delete this.map[i]}}]),e}(),sw=function(){function e(t){if(I(this,e),this.listeners=new ow,this.oncesListeners=new ow,t)for(var n in t){var r=t[n];r&&this.listeners.put(n,r)}}return M(e,[{key:"dispatch",value:function(e,t){var n=0;return n+=this.dispatchTo(e,this.listeners,t),n+=this.dispatchTo(e,this.oncesListeners,t),this.oncesListeners.remove(e),n}},{key:"dispatchTo",value:function(e,t,n){var r=t.values(e);if(r){var i,a=A(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;try{n(o)}catch(e){console.error(e)}}}catch(e){a.e(e)}finally{a.f()}return r.length}return 0}},{key:"on",value:function(e,t){this.listeners.put(e,t)}},{key:"once",value:function(e,t){this.oncesListeners.put(e,t)}},{key:"off",value:function(e,t){this.listeners.remove(e,t),this.oncesListeners.remove(e,t)}},{key:"forwardTo",value:function(e,t){var n=function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];t.dispatch(e,(function(e){return e.apply(void 0,r)}))};return this.on(e,n),n}}]),e}();($k=Jk||(Jk={})).Mac="mac",$k.Windows="windows";var cw=Object.freeze({delete:Object.freeze(["Backspace","Delete"]),lock:"Shift",undo:function(e,t){var n;switch(t){case Jk.Mac:return!("z"!==e.key||e.altKey||e.ctrlKey||e.shiftKey||!(null==(n=e.nativeEvent)?void 0:n.metaKey));case Jk.Windows:return"KeyDown"===e.kind&&"z"===e.key&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1}},redo:function(e,t){var n;switch(t){case Jk.Mac:return!("y"!==e.key||e.altKey||e.ctrlKey||e.shiftKey||!(null==(n=e.nativeEvent)?void 0:n.metaKey));case Jk.Windows:return"KeyDown"===e.kind&&"y"===e.key&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1}},copy:function(e,t){var n;switch(t){case Jk.Mac:return!("c"!==e.key||e.altKey||e.ctrlKey||e.shiftKey||!(null==(n=e.nativeEvent)?void 0:n.metaKey));case Jk.Windows:return"KeyDown"===e.kind&&"c"===e.key&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1}},paste:function(e,t){var n;switch(t){case Jk.Mac:return!("v"!==e.key||e.altKey||e.ctrlKey||e.shiftKey||!(null==(n=e.nativeEvent)?void 0:n.metaKey));case Jk.Windows:return"KeyDown"===e.kind&&"v"===e.key&&!e.altKey&&e.ctrlKey&&!e.shiftKey;default:return!1}}}),uw=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cw;I(this,e);var n=[];for(var r in t){var i=t[r];i&&n.push(Object.freeze({kind:r,checker:this.toHotKeyChecker(i)}))}this.nodes=Object.freeze(n)}return M(e,[{key:"checkHotKey",value:function(e){var t,n=this.getKeyboardKind(),r=A(this.nodes);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.checker(e,n))return i.kind}}catch(e){r.e(e)}finally{r.f()}}},{key:"getKeyboardKind",value:function(){return/^Mac/i.test(navigator.platform)?Jk.Mac:Jk.Windows}},{key:"toHotKeyChecker",value:function(e){var t=e;if("function"!=typeof t&&(t instanceof Array||(t=[t]),t instanceof Array)){var n=Object.freeze(t.map((function(e){var t=e;return"string"==typeof t&&(t={key:t,altKey:null,ctrlKey:null,shiftKey:null}),Object.freeze(H({},t))})));t=function(e){var t,r=A(n);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(!(i.key!==e.key||null!==i.altKey&&i.altKey!==e.altKey||null!==i.ctrlKey&&i.ctrlKey!==e.ctrlKey||null!==i.shiftKey&&i.shiftKey!==e.shiftKey))return!0}}catch(e){r.e(e)}finally{r.f()}return!1}}return t}}]),e}(),lw=X(n("0yMQ")),hw=X(n("0yMQ"));function dw(e,t){return(0,hw.isObservable)(e)?(0,hw.has)(e,t):t in e}function fw(e){return(0,hw.isObservable)(e)?(0,hw.keys)(e):Object.keys(e)}function pw(e,t){if(T(e)!=T(t))return!1;if("object"!=T(e)||null===e)return e===t;if(e.constructor!==t.constructor)return!1;if(e.constructor===Object){var n,r=A(fw(e));try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!dw(t,i))return!1;if(!pw(e[i],t[i]))return!1}}catch(e){r.e(e)}finally{r.f()}var a,o=A(fw(t));try{for(o.s();!(a=o.n()).done;){if(!dw(e,a.value))return!1}}catch(e){o.e(e)}finally{o.f()}return!0}if(e.constructor===Array){var s=e,c=t;if(s.length!==c.length)return!1;for(var u=0;u<s.length;++u)if(!pw(e[u],t[u]))return!1;return!0}return!0}var vw=function(){function e(t){var n=this,r=t.disableMaskKey,i=t.useMobXMode,a=t.propertyGetters,o=t.onStateChanged;I(this,e),this.didStateReady=!1,this.updatedState={},this.activeUpdateKey=null,this.updateState=function(){var e=n.updatedState;n._state=n.patchState(e),n.updatedState={},n.onStateChanged&&n.onStateChanged(e)},this.disableActiveCallback=r,this.useMobXMode=i,this.updateLimiter=new Be(0,this.updateState),this.onStateChanged=o,this.disposers=this.createAutoRun(a),(0,lw.makeObservable)(this,{activeUpdate:lw.action,patchState:lw.action})}return M(e,[{key:"state",get:function(){return this._state}},{key:"release",value:function(){var e,t=A(this.disposers);try{for(t.s();!(e=t.n()).done;){(0,e.value)()}}catch(e){t.e(e)}finally{t.f()}}},{key:"activeUpdate",value:function(e,t){try{this.activeUpdateKey=e;var n=t();return this._state=this.setState(e,n),this.onStateChanged&&!this.disableActiveCallback&&this.onStateChanged(o({},e,n)),n}finally{this.activeUpdateKey=null}}},{key:"createAutoRun",value:function(e){var t=this,n=[],r={fireImmediately:!0},i=function(i){var a=e[i];n.push((0,lw.reaction)((function(){return a()}),(function(e){if(t.didStateReady){var n=i in t.updatedState?t.updatedState[i]:t._state[i];t.activeUpdateKey!==i&&!pw(e,n)&&(t.updatedState[i]=e,t.updateLimiter.invoke())}else t.updatedState[i]=e}),r))};for(var a in e)i(a);return this._state=this.createState(this.updatedState),this.updatedState={},this.didStateReady=!0,n}},{key:"createState",value:function(e){return this.useMobXMode?(0,lw.observable)(e):Object.freeze(e)}},{key:"patchState",value:function(e){if(this.useMobXMode){for(var t in e)this._state[t]=e[t];return this._state}return Object.freeze(H(H({},this._state),e))}},{key:"setState",value:function(e,t){return this.useMobXMode?(this._state[e]=t,this._state):Object.freeze(_(H({},this._state),o({},e,t)))}}]),e}();function mw(e){switch(e){case KC.Desktop:case KC.Phone:case KC.Pad:case KC.TV:return 2.42;default:return 1}}function gw(e){return yw.apply(this,arguments)}function yw(){return(yw=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=3,r=null,i=null,a=0;case 2:if(!(a<n)){e.next=19;break}return e.prev=3,e.next=6,fetch(t);case 6:r=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),i=e.t0,e.abrupt("continue",16);case 13:if(200!==r.status){e.next=15;break}return e.abrupt("break",19);case 15:throw new Error("fetch ".concat(JSON.stringify(t)," failed with status ").concat(r.status));case 16:++a,e.next=2;break;case 19:if(!i){e.next=21;break}throw i;case 21:return e.next=23,r.blob();case 23:return o=e.sent,e.next=26,bw(o);case 26:return e.abrupt("return",e.sent);case 27:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}function bw(e){return kw.apply(this,arguments)}function kw(){return(kw=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.createImageBitmap?window.createImageBitmap(t):new Promise((function(e,n){var r=URL.createObjectURL(t),i=document.createElement("img");i.addEventListener("load",(function(){URL.revokeObjectURL(i.src),e(i)})),i.src=r})));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ww,Sw,xw,Cw,Iw=Object.freeze({x:8,y:18}),Pw=Object.freeze({width:26,height:26}),Mw=function(){function e(t){var n=this;I(this,e),this.cursors=Object.freeze([]),gw("https://sdk.netless.link/resource/mouse-cursor/easer-cursor.png").then((function(e){for(var t=[],r=0;r<1;++r)t[r]=null;for(var i=1;i<=36;++i)t[i]=n.createCursor(i,e);n.cursors=Object.freeze(t)})).catch((function(e){return t.error(e)}))}return M(e,[{key:"cursorStyle",value:function(e){var t=this.cursors[Math.min(Math.ceil(e),36)];if(t)return"url(".concat(t.url,") ").concat(t.centerX," ").concat(t.centerY,", auto")}},{key:"release",value:function(){var e,t=A(this.cursors);try{for(t.s();!(e=t.n()).done;){var n=e.value;n&&URL.revokeObjectURL(n.url)}}catch(e){t.e(e)}finally{t.f()}this.cursors=Object.freeze([])}},{key:"createCursor",value:function(e,t){var n=-e,r=-e,i=-Iw.x,a=-Iw.y,o=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER,c=Number.MIN_SAFE_INTEGER;Number.MIN_SAFE_INTEGER;o=Math.min(o,n),o=Math.min(o,i),s=Math.min(s,r),s=Math.min(s,a),c=Math.max(c,n)+2*e,c=Math.max(c,i)+2*Pw.width,Math.max(s,r);var u=-o,l=-s,h=c-o,d=Math.max(s,a)+2*Pw.height-s;i+=u,a+=l;var f=document.createElement("canvas"),p=f.getContext("2d");return f.width=h,f.height=d,p.fillStyle="rgba(216,216,216,146)",p.beginPath(),p.ellipse(u,l,e,e,0,0,2*Math.PI),p.fill(),p.drawImage(t,i,a),Object.freeze({centerX:u,centerY:l,url:f.toDataURL("mycanvas")})}}]),e}(),Tw=function(){function e(t){I(this,e),this.stackMap=new Map,this.stackIndexMap=new Map,this.index=0,this.textareaExtraStep=0,this.execute=t.execute,this.onCanUndoStepsUpdate=t.onCanUndoStepsUpdate,this.onCanRedoStepsUpdate=t.onCanRedoStepsUpdate}return M(e,[{key:"canUndoSteps",get:function(){return this.stack.length-this.index+this.textareaExtraStep}},{key:"canRedoSteps",get:function(){return this.index}},{key:"stack",get:function(){var e=this.stackMap.get(this.currentScenePath);return e||(e=[],this.stackMap.set(this.currentScenePath,e)),e}},{key:"commit",value:function(e){var t=this.stack,n=this.canUndoSteps,r=this.canRedoSteps;for(t.splice(0,this.index,is(e)),this.index=0;t.length>20;)t.pop();var i=this.canUndoSteps,a=this.canRedoSteps;i!==n&&this.onCanUndoStepsUpdate(i),a!==r&&this.onCanRedoStepsUpdate(a)}},{key:"undo",value:function(){var e=this.stack[this.index];e&&(this.index+=1,this.textareaExtraStep=0,this.execute(e.undo),this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps),this.stackIndexMap.set(this.currentScenePath,this.index))}},{key:"redo",value:function(){this.index>0&&(this.index-=1,this.textareaExtraStep=0,this.execute(this.stack[this.index].redo),this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps),this.stackIndexMap.set(this.currentScenePath,this.index))}},{key:"setCurrentScenePath",value:function(e){this.currentScenePath=e,this.index=this.stackIndexMap.get(this.currentScenePath)||0,this.textareaExtraStep=0,this.onCanUndoStepsUpdate(this.canUndoSteps),this.onCanRedoStepsUpdate(this.canRedoSteps)}},{key:"onTextareaUpdate",value:function(e){this.textareaExtraStep=e?1:0,this.onCanUndoStepsUpdate(this.canUndoSteps)}}]),e}(),Aw=function(){function e(){I(this,e),this.creators={}}return M(e,[{key:"addTextareaRectGetter",value:function(e,t){this.creators[e]=t}},{key:"removeTextareaRectGetter",value:function(e){delete this.creators[e]}},{key:"getTextareaSizeMap",value:function(e){var t={};for(var n in this.creators){var r=this.creators[n](e);r&&(t[n]=r)}return t}}]),e}(),Ew=X(n("0yMQ")),Ow=function(){function e(){var t=this;I(this,e),this.mainView=null,this._cameraState={centerX:0,centerY:0,scale:1,width:0,height:0},this.onSizeUpdated=function(e){(e.width!==t._cameraState.width||e.height!==t._cameraState.height)&&(t._cameraState=Object.freeze(H(H({},t._cameraState),e)))},this.onCameraUpdated=function(e){(e.centerX!==t._cameraState.centerX||e.centerY!==t._cameraState.centerY||e.scale!==t._cameraState.scale)&&(t._cameraState=Object.freeze(H(H({},t._cameraState),e)))},(0,Ew.makeObservable)(this,{_cameraState:Ew.observable,onSizeUpdated:Ew.action,onCameraUpdated:Ew.action})}return M(e,[{key:"cameraState",get:function(){return this._cameraState}},{key:"setupMainView",value:function(e){this.releaseMainView(),this.mainView=e,e.callbacks.on("onSizeUpdated",this.onSizeUpdated),e.callbacks.on("onCameraUpdated",this.onCameraUpdated)}},{key:"releaseMainView",value:function(){this.mainView&&(this.mainView.callbacks.off("onSizeUpdated",this.onSizeUpdated),this.mainView.callbacks.off("onCameraUpdated",this.onCameraUpdated),this.mainView=null)}},{key:"dispose",value:function(){this.releaseMainView()}}]),e}();function Rw(e){return new Nw(e)}!function(e){e.Dynamic="dynamic",e.Static="static"}(ww||(ww={})),function(e){e.Waiting="Waiting",e.Converting="Converting"}(Sw||(Sw={})),(Cw=xw||(xw={})).Extracting="Extracting",Cw.Packaging="Packaging",Cw.GeneratingPreview="GeneratingPreview",Cw.MediaTranscode="MediaTranscode";var Nw=function(){function e(t){I(this,e),this.pptPromise=null,this.uuid=t.uuid,this.region=t.region||Bk.defaultRegion,this.kind=t.kind,this.taskToken=t.taskToken,this.checkProgressInterval=t.checkProgressInterval||e.defaultCheckProgressInterval,this.checkProgressTimeout=t.checkProgressTimeout||e.defaultCheckProgressTimeout,this.callbacks=new sw(t.callbacks)}var t,n;return M(e,[{key:"checkUtilGet",value:function(){var e=this;return this.pptPromise||(this.pptPromise=this.getPPTResult(),this.pptPromise.then((function(t){e.callbacks.dispatch("onTaskSuccess",(function(e){return e(t)}))})).catch((function(t){e.callbacks.dispatch("onTaskFail",(function(e){return e(t)}))}))),this.pptPromise}},{key:"getPPTResult",value:(n=l(regeneratorRuntime.mark((function e(){var t,n,r,i,a=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=!1,n=Date.now(),r=regeneratorRuntime.mark((function e(){var r,i,o,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Date.now(),e.next=3,a.fetchProgress(a.uuid,a.kind,a.taskToken);case 3:i=e.sent,e.t0=i.status,e.next="Waiting"===e.t0||"Converting"===e.t0?7:"Finished"===e.t0?9:"Fail"===e.t0?10:11;break;case 7:return a.updateProgress(i),e.abrupt("break",11);case 9:return e.abrupt("return",{v:(t||a.updateProgress(i),a.toPPT(i))});case 10:throw new Error(i.failedReason);case 11:if(!((o=r+a.checkProgressInterval)>=n+a.checkProgressTimeout)){e.next=14;break}throw new Error("timeout");case 14:if(100===i.progress.convertedPercentage&&(t=!0),s=o-Date.now(),e.t1=s>0,!e.t1){e.next=20;break}return e.next=20,new Promise((function(e){return setTimeout(e,s)}));case 20:case"end":return e.stop()}}),e)}));case 2:return e.delegateYield(r(),"t0",3);case 3:if("object"!==T(i=e.t0)){e.next=6;break}return e.abrupt("return",i.v);case 6:e.next=2;break;case 8:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"updateProgress",value:function(e){var t=Object.freeze({status:e.status,currentStep:e.progress.currentStep,totalPageSize:e.progress.totalPageSize,convertedPageSize:e.progress.convertedPageSize,convertedPercentage:e.progress.convertedPercentage});this.callbacks.dispatch("onProgressUpdated",(function(e){return e(t)}))}},{key:"toPPT",value:function(e){for(var t=e.progress.convertedFileList,n=[],r=0,i=0,a=0;a<t.length;++a){var o=t[a],s={name:"".concat(a+1),ppt:{src:o.conversionFileUrl,previewURL:o.preview,width:o.width,height:o.height}};r=Math.max(r,o.width),i=Math.max(i,o.height),n.push(s)}return{uuid:this.uuid,kind:this.kind,width:r,height:i,scenes:n}}},{key:"fetchProgress",value:(t=l(regeneratorRuntime.mark((function t(n,r,i){var a,o,s,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a="http://ppt-api/v5/services/conversion/tasks/".concat(n),o=(0,iw.stringify)({type:r}),t.next=4,e.apiFetch(a+"?"+o,{method:"get",headers:{"content-type":"application/json",token:i,region:this.region}});case 4:if(200===(s=t.sent).status){t.next=10;break}return t.next=8,s.json();case 8:throw c=t.sent,new Error(c.error.title);case 10:return t.next=12,s.json();case 12:return t.abrupt("return",t.sent);case 13:case"end":return t.stop()}}),t,this)}))),function(e,n,r){return t.apply(this,arguments)})}]),e}();Nw.apiFetch=aw.fetch("api"),Nw.defaultCheckProgressInterval=1500,Nw.defaultCheckProgressTimeout=3e5;var Lw=X(n("cr+I")),jw=function(){function e(t){I(this,e),this.roomToken=t}var t,n,r,i;return M(e,[{key:"convert",value:(i=l(regeneratorRuntime.mark((function t(n){var r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.createPPTTask(n);case 2:return r=t.sent,t.next=5,this.checkUtilHasResult(r,n);case 5:return i=t.sent,t.abrupt("return",e.wrapPPTDescriptions(r,n.kind,i));case 7:case"end":return t.stop()}}),t,this)}))),function(e){return i.apply(this,arguments)})},{key:"createPPTTask",value:(r=l(regeneratorRuntime.mark((function t(n){var r,i,a,o,s,c,u,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.prefix+"/services/conversion/tasks",i=(0,Lw.stringify)({roomToken:this.roomToken}),t.next=4,fetch(r+"?"+i,{method:"post",headers:{"content-type":"application/json",Accept:"application/json"},body:JSON.stringify({sourceUrl:n.url,serviceType:e.convertPPTKindToServiceType(n.kind)})});case 4:if(200===(a=t.sent).status){t.next=13;break}return t.t0=Error,t.t1="failed to convert ".concat(JSON.stringify(n.url)," with status ").concat(a.status," message:"),t.next=10,a.text();case 10:throw t.t2=t.sent,t.t3=t.t1.concat.call(t.t1,t.t2),new t.t0(t.t3);case 13:return t.next=15,a.json();case 15:if(o=t.sent,s=o.msg,c=s.succeed,u=s.reason,l=s.taskUUID,c){t.next=22;break}throw new Error("create ppt task failed: "+u);case 22:return t.abrupt("return",l);case 23:case"end":return t.stop()}}),t,this)}))),function(e){return r.apply(this,arguments)})},{key:"checkUtilHasResult",value:(n=l(regeneratorRuntime.mark((function t(n,r){var i,a,o,s,c,u,l=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i=!1,a=Date.now(),o=r.checkProgressInterval||e.defaultCheckProgressInterval,s=r.checkProgressTimeout||e.defaultCheckProgressTimeout,c=regeneratorRuntime.mark((function e(){var t,c,u,h,d,f,p;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Date.now(),e.next=3,l.fetchProgress(n,r.kind);case 3:c=e.sent,e.t0=c.convertStatus,e.next="Finished"===e.t0?7:"Fail"===e.t0||"NotFound"===e.t0?8:9;break;case 7:return e.abrupt("return",{v:(r.onProgressUpdated&&!i&&r.onProgressUpdated(1),c.convertedFileList.map((function(e){return{width:e.width,height:e.height,src:c.prefix+e.conversionFileUrl}})))});case 8:throw new Error("failed to convert ".concat(JSON.stringify(r.url),": ").concat(c.reason));case 9:if(u=c.totalPageSize,h=c.convertedPercentage,d=0===u?0:h/100,!((f=t+o)>=a+s)){e.next=12;break}throw new Error("failed to convert ".concat(JSON.stringify(r.url),": timeout"));case 12:if(r.onProgressUpdated&&r.onProgressUpdated(d),1===d&&(i=!0),p=f-Date.now(),e.t1=p>0,!e.t1){e.next=18;break}return e.next=18,new Promise((function(e){return setTimeout(e,p)}));case 18:case"end":return e.stop()}}),e)}));case 2:return t.delegateYield(c(),"t0",3);case 3:if("object"!==T(u=t.t0)){t.next=6;break}return t.abrupt("return",u.v);case 6:t.next=2;break;case 8:case"end":return t.stop()}}),t)}))),function(e,t){return n.apply(this,arguments)})},{key:"fetchProgress",value:(t=l(regeneratorRuntime.mark((function t(n,r){var i,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i="".concat(e.prefix,"/services/conversion/tasks/").concat(n,"/progress"),a=(0,Lw.stringify)({roomToken:this.roomToken,serviceType:e.convertPPTKindToServiceType(r)}),t.next=4,fetch(i+"?"+a,{headers:{"content-type":"application/json",Accept:"application/json"}});case 4:if(200===(o=t.sent).status){t.next=7;break}throw new Error("failed to fetch progress of ".concat(JSON.stringify(i)));case 7:return t.next=9,o.json();case 9:return t.abrupt("return",t.sent.msg.task);case 10:case"end":return t.stop()}}),t,this)}))),function(e,n){return t.apply(this,arguments)})}],[{key:"wrapPPTDescriptions",value:function(e,t,n){for(var r=[],i=[],a=0,o=0,s=0;s<n.length;++s){var c=n[s],u=c.src,l=c.width,h=c.height;r[s]=u,i[s]={name:"".concat(s+1),ppt:{src:u,width:l,height:h}},a=l,o=h}return{uuid:e,kind:t,width:a,height:o,slideURLs:r,scenes:i}}},{key:"convertPPTKindToServiceType",value:function(e){switch(e){case ww.Dynamic:return"dynamic_conversion";case ww.Static:return"static_conversion";default:throw new Error("invalid kind ".concat(JSON.stringify(e)))}}}]),e}();jw.prefix="https://console-api.netless.link",jw.defaultCheckProgressInterval=1500,jw.defaultCheckProgressTimeout=3e5;var Dw=X(n("q1tI")),Fw=X(n("q1tI")),zw=X(n("/+6X")),Bw=X(n("0yMQ")),Uw=X(n("q1tI")),Vw=X(n("q1tI")),Ww=X(n("/+6X")),Hw={"arrow-down-disabled":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjRTdFN0U3IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjN0Q3RDdEIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsPSIjNUI5MDhFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-down":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDMgMy0zSDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-disabled":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjRTdFN0U3IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjN0Q3RDdEIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsPSIjNUI5MDhFIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","arrow-up":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNiIgaGVpZ2h0PSIzIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Im0zIDAgMyAzSDB6IiBmaWxsLXJ1bGU9ImV2ZW5vZGQiLz48L3N2Zz4=","bold-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",bold:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQuNSAySDhhMi41IDIuNSAwIDAgMSAwIDVINS41aDBtLTEgMGg0YTMgMyAwIDAgMSAwIDZoLTQgMG0wIDFWMiIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",check:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI4IiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIG9wYWNpdHk9Ii4wMSIgZD0iTTAgMGg4djhIMHoiLz48cGF0aCBkPSJNNy4xMjUgMS40ODRoLS41NDZhLjI0OS4yNDkgMCAwIDAtLjE5Ni4wOTZMMy4xNjIgNS42NiAxLjYxNyAzLjcwM2EuMjUuMjUgMCAwIDAtLjE5Ni0uMDk1SC44NzVhLjA2Mi4wNjIgMCAwIDAtLjA1LjFsMi4xNCAyLjcxMmEuMjUuMjUgMCAwIDAgLjM5NCAwbDMuODE1LTQuODM2YS4wNjIuMDYyIDAgMCAwLS4wNDktLjF6Ii8+PC9zdmc+",delete:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDZ2NmEyIDIgMCAwIDEtMiAySDZhMiAyIDAgMCAxLTItMlY2aDBtMS0yYTIgMiAwIDAgMSAyLTJoMmEyIDIgMCAwIDEgMiAyaDBNMyA0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",duplicate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiPjxwYXRoIGQ9Ik0xMSAySDZhMSAxIDAgMCAwLTEgMXY4YTEgMSAwIDAgMCAxIDFoNmExIDEgMCAwIDAgMS0xVjRoMGwtMi0yeiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PHBhdGggZD0iTTExIDJ2MWExIDEgMCAwIDAgMSAxaDFsLTItMnoiLz48cGF0aCBkPSJNOSAxNEg0YTEgMSAwIDAgMS0xLTFWNWgwIiBzdHJva2UtbGluZWNhcD0icm91bmQiLz48L2c+PC9zdmc+","easer-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANKSURBVHgB1VTdS5NhFD/7iuXa8KNw7SK/IjBYo13soqvEITENtj9AwZiCOCTvQrNWF9rFFPGLrC1iF10Oiy68mBSUF2KB4YabhKKyTfFCc+3Lzb2ds72LsfbxCkZ04Mf7Puc5z/k95+M5AP+R8OAvCW9nZ6cyHo8/SSaTc4RQKKQ+S0JyxFtbW6va39//ZjKZmMbGRkar1TJOp5MhYtwXwBkQkgMROnyXIcmGw+FgYrHY00JkQm4cqYPCaDQ6ZrFY7i4sLPxhMDg4SJ8hTOOWRCJ5jf8npyUiEgE6eGy1Wk12u72gIZHJZDLr4eHhVnl5+YdsslL5pH1+JBIx22y2h9PT01BKpFIpLC4ufhKJRFpcxhEM6fmlSMLh8P35+XlOJCTBYBC2t7dr8fdctv+iRHjI4HK5LAMDA8BVFAoFyOVyH/6KIKsxCtVIgC188+Dg4CV2GJxGpqamYHR09AHklEWQY5d6K/gg67HD3huNRrlKpYLNzU3gIsPDw8Dn84fa29s/4zIK6Rol8xIhSUMikXB2dXXV4AHo6en5KhaLFcvLy0VJent7QaPRzKrV6le4DCEi2UTCnGgE1dXVj3Q6XY1er08drKiosK2urnbjnrFQQxBJU1PTC3y4kyxJGHEMWe2dTUSNIcLZVXl0dAStra3BiYmJOTqgVCqfu91uull3LhlFjbZv6urqiCTIElHaEsC2dq4QqXRlZeUePsrUDFtfX/eZzebbqL+GuIFks1js32OHRtHu7u5H3FMiahFViPNQYuZRO8oQVzY2NibJocFgYAKBgLuzs/M66hsQKuzELx0dHak9rKe3paXlFurrERdZEiGUGARkcAFxmSJAJ/aRkRGGnOKwdPn9/rG9vT0HXaC5uZnxer3+vr4+HdpeRVxClBWLJFuZqhF7gAjL0PGz8fFxvcfjSY0WevVUv5mZmQDWyog1/I52PyBdlxgUqUu+qMSQznVtW1ubBlP3dmlpicnA5/N5+vv770C6bhS9lEu6eHnWFP45NioJS5xxRLdNsrenKH5CusNOWH1BEeTRMTnI6MgZpYYeYhhOmS5eEX0mMhELPktGoBd/zCWSUkTAOs4QZqZ8JsokS8Kp8KWICtlwdv5P5BchBHaEIRURoQAAAABJRU5ErkJggg==","easer-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAgrSURBVHgB7ZprTBRXFIDP7gIt8lQppTwE5V0KaAn6o1pqNGkDDTEmTUhsgKRp+gNJw68CFkLbVC2QkDS+gD8KJdWmARvbFBNNWpuIRGPFWBXQRMPDqIki+KLATs+ZnTvcvXtnX8w2beJJToaduTP3fHPOPffcOwC8kP+2WCDwIvahGFxTuN8KmNSZmULPNjLeqF9F8rdPkIEGEn+r+vjx46LQ0NA8/Dsader58+e/h4WFDWntFO7ot6fMFAt3JLWi2lCDpqamCux2+2+KROj82NhYGrXT2lu5Z/DP/deFByElA4Pv3LlTiHY/nJ6eVnbv3q1s2bJFyc7OVrZu3arU1dUp4+PjxPUQoT+g9tp9PkMFgpo9kxljHRoaWp2Xl3duYmIiurKyEvDoclNCQgIcPnxYPc7MzHwcGRnZhaft4Ag7O9fUbRhaITCie4lgcnNzT7qDIaHz27dvh+vXr0NEREQneqoCHKFnAR+8ZCaQGGq2CxcurCGYycnJZHcwTNAzUFFRoUJFRUV1IFQ5OKBsXB9uxSwgl0TQ3d29Yt26dccwoyVXV1d7hGEiQmGi2AzOUHx/hob4K2yuYS9G987s7OwPISEh7xPM6dOnwVfBsIMjR45AZmbmo5s3b76Xnp7+J55egMVxBSAZT0v1ED+76yn66dOnLQSzd+9ev2BIyFP0MjBco1JTU/sxfFeDazp3cYgZHmKqdoaGNISHh9fv378fSJcqlPV6e3sBJ+I/goOD34VFL0k95Y+HxPHCYGxmw5DQ2NuzZw8EBQVtunXr1jvgwUP+hhz/QDXMMCNVE8zx48dNg2FCz6QQjI2N/RA8VBFmANnu3btXihnpG8pM9fX1EAi5du0aeWkVOAMBCF7yN+R0z4yOjq6NiYlpp9CgdBtIwXpPH6vgDKWLt0CygtM6MDCwBuUYZSKaOCksAiVY9wFOBePgDOOytPAGSKzNVCCC2bBhw69YdK7ypgpYimzbtk2dl7CM+hFcveOUHDylbTFO1YdhFbByx44dA1QFUP0VSJj4+Hjo6+sDq9U6iEmHKvFZTedQ50GYbN15SITVlwNlZWUnLRZL8s6dOwMOQ9UCTtKTra2ttdppt9V2kMF5cbmsjxuM43bMNrmUzc6fP6+GQiDGDoOJi4ubwb4qm5ubafyIE6nLxGqTPEsGo1cBOGNX0TyDYafC0CyOaxcVziyh53Z2dkJycvLMvn37PmpoaBgFR4jxYSbWdVIgI89Iq4CjR48CZjlYv369+tssqI6ODsjPz4f+/v668vLycxrEHHfkYdwC8SB6mGEV8Cl64cuuri5oa2tTG+EyGjZu3AiXLl1qefDgwV8lJSUFZkDV1tZCcXExXLx4sbWoqKgPFj0zx8GI9ZwO5W4M6ekZYeqpaqbqmaSqqkpNpcPDw4dwzfM9nrLduHEjEs+X0XV/Sx96LnqE1kLtBQUF3eDwCO8dGQyzV5rl+JyuegfXI29jRotiRlKnpFghHMzKyjqotVXS0tLacKPjF3bdHxjSq1evduAkepAD+ZsDYlC8V5w8ZBVg+PPq2MGMlkInqE4joTf45MmT4YyMjAPcA+ltLSQlJX2BafxnX6HI29QeK44TOTk57mCYZ0QoJ8OBM4yB6dkNkwGlSygsLFQvYtYB3BTMxFL+M+0eFgZqp4mJiU2+QKGX1fGIk/QIrn0aYXGsyDxjmAyMhO2jhaCGoUbX1NSkLSwsPMJqV8Fspu6lIZS6OYhjiOLwdU7fQM1HfRPD7wS1obZ0j0xpb4726Z49ezaJf2/S7s9ATUGNR41BjdJseRnke3WGwhrRTS9pD1mOGoeG15BxOOfoxuCkp0Ih6NeaEaSZGlieJyiCoc1FgsGldokGk8nBvAKOrWIGQ5uPsm0tt0BWDiicAaGuGhkZ+YqMw9StGzU4OKhCnT179hNsswY1FTXdE5QEJhc1S3tGogazXLOBwQSBl3tzIhQPtAL1VQJCTcNx8y1vHIUghSKFZE9PT7H2dlM1b+Wgrr1y5Uq77J75+fnplpaWMg2ch4nlYEI5z7hdensDpI4hrYNErcMMXJ32koG4ztf3pultz83NjWG99Ra2WQ0OL2VjZjwgeufUqVOqV8+cOdPIwdBLSNJeHg8TAh5WqJ6EfSmgt7IMNRJ1JThiOlnrOAMHshprmMKdoGSCpb9s3B3SYLIFGIqICJB7xisYi+RvfiypXw40DWGdlJaWRmMd141hk8V2OWm7ieYTXhBc3+BgaZyqAISjOYxSMVvXsBTNlzdiNQDgRao2AtK3pjggpmrqbGpqSsLPIN/dv38/gaBwUjTshMHcvn27JyUlpRmc5xpPMD599LIYnLNyUKKndKjGxsakXbt2deMCLIE8IVvs0YRM1fjdu3d/wrXN5+BcnzEgvor2uN3rjzAYMp5lPEoQlE5fA0fWo8GfhlCbKVFQ1pKNIfzcOHH58mWqaimVUwJI0+6n59D4pIlzmdZPMPiZzXjDjX47Le5g0Uu8x2zgPqWyKpjVe7x3+AUbq9NYjQbgp2dsBud5o8TP7d5kHAWcQchQfoEmLgn8HjOiBIF7o5hI1x6CEbLNP3bdqYAF44JzyWLzcN1i8DcT/o3awbm8Fz3DAy2A62INwPV/E3wWdx5inmBHuwChCBD6R2JwHge80TIQRQLjt7e8DTkGZgfX8cUMZTDAteFDkveaIlzjX9ySQs8X18r2t2VHUURPKoICmDR+eCO9aSdmOIub3/w9RgpgUpiJhvraXpa6jZKHGEqyusw0GLFzX+5RhN/8kYnMSNMMfyH/V/kHST6OYVElTPAAAAAASUVORK5CYII=","font-colors-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-colors":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTQgMTEgNC05IDQgOU02IDdoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","font-size-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIgMmg4TTYgMnYxMm02LTZ2Nm0tMi02aDQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","font-size":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTIgMmg4TTYgMnYxMm02LTZ2Nm0tMi02aDQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","hand-grasp":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZD0iTTExLjcyIDE0LjM0NEg0Ljk3OGMtLjUxMyAwLS45MzEtLjQ3My0uOTMxLTEuMDU1IDAtLjQ0Mi0uMS0uNzQ0LS4zMzQtMS4wMUwuNDQ2IDguNzQxLjQ0NCA4Ljc0QTEuNzkgMS43OSAwIDAgMSAwIDcuNTU0VjQuODc4QzAgMy45OC42NDUgMy4yNSAxLjQzNyAzLjI1Yy4zOTQgMCAuNzU5LjE3NiAxLjAyOC40OTUuMDkyLjExLjE3LjIzMS4yMzIuMzYzVjIuMjAyYzAtLjg5OC42NDUtMS42MjggMS40MzctMS42MjguNTcgMCAxLjA1NC4zNjcgMS4yODcuOTEzLjA1OC0uMzYuMjEtLjY5Mi40NDMtLjk1NUExLjUwNiAxLjUwNiAwIDAgMSA3IDBhLjguOCAwIDAgMSAuMTc0LjAxNWMuNjMyLjA4IDEuMTQyLjU3OSAxLjM0MSAxLjI1LjItLjYyNi43My0xLjA3NCAxLjM1LTEuMDc0LjEgMCAuMTkzLjAxMy4yOC4wMjdsLjAxNS4wMDNjLjY2Mi4xNTYgMS4xNDMuODQzIDEuMTQzIDEuNjM1di4zM2MuMjQ0LS41MDQuNzE3LS44NDggMS4yNi0uODQ4LjM5NCAwIC43NTkuMTc2IDEuMDI4LjQ5NC4yNjQuMzEyLjQwOS43MjguNDA5IDEuMTd2Mi45NGMwIC4zNTItLjAzOC42ODYtLjExNC45OTNsLTEuMTM4IDUuMjEtLjAwMS4wMDRhMy41MyAzLjUzIDAgMCAwLS4wOTYuODQxdi4yOTljMCAuNTgyLS40MTcgMS4wNTUtLjkzIDEuMDU1eiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Im0xLjAyNCA4LjM5OSAzLjE1MiAzLjQxMi4wMDIuMDAyYy4zMi4zNjMuNDY4LjguNDY4IDEuMzc0IDAgLjI0OC4xODUuNDU3LjQwNC40NTdoNi41MDdjLjIxOCAwIC40MDMtLjIxLjQwMy0uNDU3VjEyLjljMC0uMzQuMDM3LS42NjIuMTEtLjk1OWwxLjA5OC01LjAyNlY2LjkxYTMuMzcgMy4zNyAwIDAgMCAuMDkzLS44MTJWMy4yNjJjMC0uNTg2LS4zOTEtMS4wNDUtLjg5MS0xLjA0NS0uNDkyIDAtLjg5MS40NTMtLjg5MSAxLjAxdi42NWgtLjgyVjIuMTU1YzAtLjQ5Ni0uMjk1LS45MjYtLjcwMS0xLjAyNS0uMDY2LS4wMS0uMTMtLjAyLS4xOTEtLjAyLS40OTEgMC0uODkxLjQ1My0uODkxIDEuMDF2MS43NTdoLS44MlYyLjE5YzAtLjY1MS0uNDA4LTEuMTktLjk0OC0xLjI1NEw3LjA5Ni45MzQgNy4wODUuOTMyYy0uMDI3LS4wMDYtLjA1LS4wMDYtLjA4My0uMDA2LS41ODEgMC0xLjA1NC41MzYtMS4wNTQgMS4xOTV2MS43NTZoLS44MlYyLjUyNGMwLS41ODYtLjM5Mi0xLjA0NC0uODkxLTEuMDQ0LS40OTIgMC0uODkyLjQ1My0uODkyIDEuMDF2NS41OTJsLS44Mi0uODcyVjUuMTA2YzAtLjU4Ni0uMzkxLTEuMDQ1LS44OS0xLjA0NS0uNDkzIDAtLjg5Mi40NTMtLjg5MiAxLjAxdjIuNTgzYzAgLjI3NC4xLjUzOC4yOC43NDV6IiBmaWxsPSIjRkZGIi8+PHBhdGggZD0iTTUuNTY2IDYuMDgydjQuNjM2YzAgLjE5LjIyMy4zNDQuNS4zNDQuMjc2IDAgLjUtLjE1NC41LS4zNDRWNi4wODJjMC0uMTktLjIyNC0uMzQ0LS41LS4zNDQtLjI3NyAwLS41LjE1NC0uNS4zNDR6bTIuMTggMHY0LjYzNmMwIC4xOS4yMjQuMzQ0LjUuMzQ0cy41LS4xNTQuNS0uMzQ0VjYuMDgyYzAtLjE5LS4yMjQtLjM0NC0uNS0uMzQ0cy0uNS4xNTQtLjUuMzQ0em0yLjE4IDB2NC42MzZjMCAuMTkuMjI0LjM0NC41LjM0NHMuNS0uMTU0LjUtLjM0NFY2LjA4MmMwLS4xOS0uMjI0LS4zNDQtLjUtLjM0NHMtLjUuMTU0LS41LjM0NHoiIGZpbGw9IiMwMDAiLz48L2c+PC9zdmc+","hand-loosen":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZD0iTTkuMTU0IDBBMS4yMjYgMS4yMjYgMCAwIDAgOC4xMS42MDdjLS4yMDguMzQ4LS4yOTUuNzY4LS4zNDUgMS4yMzItLjEuOTI5LS4wMjUgMi4wNTgtLjAxNCAzLjA0Ni4wMDcuNTEyLjAwNCAxLjA0MS0uMDAxIDEuNTQ3YTYzLjMxIDYzLjMxIDAgMCAxLS4zNS0uOXYtLjAwM2wtLjAwMS0uMDAxYy0uMzU5LS45MjYtLjY5Mi0xLjg3LTEuMTUtMi41NjItLjIzLS4zNDYtLjQ5Ni0uNjQtLjg1LS44MDctLjM1Ni0uMTY2LS43OTItLjE2NS0xLjIwNC4wMmwtLjAwMy4wMDEtLjAwNC4wMDJjLS40LjE4Ny0uNjUuNTYzLS43MjIuOTU4LS4wNzQuMzk0LS4wMTkuODEyLjA4MiAxLjI2Mi4yMDMuOS42MTMgMS45NC44OTIgMi45Ny4yMi44MTMuNDM0IDEuNjMyLjYxMyAyLjMyMmExMy44NTUgMTMuODU1IDAgMCAwLS44NzQtLjgxNmMtLjU0My0uNDYyLTEuMTQtLjg4OS0xLjc1Ny0xLjExOS0uNjE2LS4yMy0xLjMyMy0uMjQ0LTEuODQ1LjIxOGwtLjAwNC4wMDQtLjAwNC4wMDRjLS40MS4zODQtLjYxNC44Ni0uNTYgMS4zMjMuMDUzLjQ2NC4zMDcuODcxLjY0MiAxLjI5LjY2OS44MzYgMS43MiAxLjc1MSAyLjczNCAyLjk2OCAxLjEzNSAxLjM2MiAyLjM3MiAzLjUzOCAzLjI1MSA0LjY4MWwuMTE4LjE1M2g3LjcwNGwuMDg2LS4yNzRjLjE1LS40ODIuMzE4LTEuNDQyLjU4Ny0yLjY0Mi4yNjgtMS4yLjYyNy0yLjYxIDEuMTA0LTMuODQ3LjYzNS0xLjY0NiAxLjI4NS0zLjE5NCAxLjU3Ny00LjQyMy4xNDctLjYxNC4yMTQtMS4xNTEuMDk1LTEuNjI2YTEuMzA2IDEuMzA2IDAgMCAwLTEuMDQ4LS45NmMtLjQ2Ny0uMDg4LS45MS4xMi0xLjIyLjQzNC0uMzEuMzE2LS41NDYuNzM2LS43NjUgMS4yMDctLjE3LjM2NS0uMzI3Ljc2NS0uNDgxIDEuMTY2bC0uMDEtMS43MzRjLS4wMDQtMS4wMDcuMDU5LTIuMTM2LS4wMTctMy4wNDQtLjAzOC0uNDU1LS4xMDMtLjg1NS0uMjcyLTEuMTkxLS4xNjUtLjMyNy0uNTI0LS42LS45MjUtLjU4NWExLjE4IDEuMTggMCAwIDAtLjk2OS40NmMtLjIyMy4yODUtLjM1NC42MzYtLjQ1OSAxLjAyMy0uMjEuNzczLS4zMDIgMS43MDktLjQ0MyAyLjQ4bC0uMTk1IDEuMDkyYTQ1Ljg3NCA0NS44NzQgMCAwIDEtLjEzNi0xLjE4N2MtLjA5NC0uOTM3LS4xNi0yLjA1NS0uMzU2LTIuOTctLjA5Ny0uNDU3LS4yMjItLjg2Ni0uNDM1LTEuMTk5LS4yMTQtLjMzMi0uNTgyLS41OTctMS4wMS0uNTc5aC4wM0w5LjE1NSAweiIgZmlsbD0iIzAwMCIvPjxwYXRoIGQ9Ik05LjE1Ljc4NGguMDQ5Yy4xMzItLjAwNS4xOTUuMDMuMzE3LjIyLjEyMy4xOTIuMjQxLjUyOC4zMjkuOTM5LjE3NS44Mi4yNDUgMS45MjQuMzQyIDIuODg0LjIxMiAyLjEwOC41MTQgMy42MzUuNTE0IDMuNjM1bC43Ny0uMDEzcy4yODctMS43NjMuNTk4LTMuNDYzYy4xNS0uODIuMjQ3LTEuNzQ2LjQyOS0yLjQxNy4wOS0uMzM1LjIwNy0uNi4zMTktLjc0My4xMTItLjE0Mi4xNjktLjE3NC4zMTktLjE2M2wuMDMuMDAyLjAyOC0uMDAyYy4xMi0uMDA5LjExNi0uMDEuMi4xNTYuMDg0LjE2Ny4xNTcuNDk1LjE5MS45MDMuMDY4LjgxNS4wMSAxLjk0Mi4wMTUgMi45ODNsLjAxOSAzLjcwNS43NDUuMTY4Yy40NTUtLjk0OC44MTktMi4xMTIgMS4yMjEtMi45NzguMjAxLS40MzMuNDE1LS43ODcuNjEzLS45ODguMTk3LS4yLjMyMy0uMjUuNTE2LS4yMTNoLjAwNGwuMDA1LjAwMmMuMjk5LjA1MS4zNi4xMjcuNDI0LjM3OC4wNjMuMjUuMDM1LjY5Ny0uMDk3IDEuMjU0LS4yNjUgMS4xMTUtLjkwNyAyLjY2NC0xLjU0NiA0LjMyMi0uNTAyIDEuMy0uODY2IDIuNzQtMS4xMzggMy45NTctLjIyLjk4My0uMzg3IDEuODM0LS40OTkgMi4zMDRINy4xNDRjLS44MDItMS4wOS0xLjk5Ny0zLjE2LTMuMTU3LTQuNTUyLTEuMDYtMS4yNzEtMi4xMzYtMi4yMi0yLjcyNC0yLjk1Ni0uMjk0LS4zNjgtLjQ1LS42NzMtLjQ3Ni0uODktLjAyNS0uMjE1LjAyNi0uMzg2LjMxMi0uNjU2LjI3LS4yMzcuNTgyLS4yNDMgMS4wNDktLjA2OS40NjcuMTc1IDEuMDE4LjU1MiAxLjUyNC45ODJhMTUuODggMTUuODggMCAwIDEgMS44NDcgMS45MDRsLjY4Ny0uMzRzLS41MDQtMi4wMS0xLjAxLTMuODcyQzQuOTAzIDYuMDggNC40OTQgNS4wMyA0LjMxNCA0LjIzYy0uMDktLjQtLjExNi0uNzMzLS4wNzctLjk0Ny4wNC0uMjEzLjA5Ny0uMzAyLjI4My0uMzkuMjQ4LS4xMS4zODgtLjA5OC41NDctLjAyNC4xNTkuMDc0LjM0NC4yNTEuNTI5LjUzLjM2OC41NTcuNzEgMS40NzYgMS4wNzMgMi40MTJsLS4wMDItLjAwNGMuMzcuOTgzIDEuMDc4IDIuNzE0IDEuMDc4IDIuNzE0bC43NTUtLjEzN3MuMDU1LTEuOTEuMDM2LTMuNTA5Yy0uMDEyLTEuMDE4LS4wNzgtMi4xMzYuMDEtMi45NTIuMDQzLS40MDguMTMxLS43MzUuMjM4LS45MTUuMTA3LS4xNzkuMTctLjIyNS4zNjctLjIyNHoiIGZpbGw9IiNGRkYiLz48cGF0aCBkPSJNNy43MjMgMTAuOHY0LjY5MmMwIC4xOTIuMjIzLjM0OC41LjM0OC4yNzYgMCAuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjI0LS4zNDgtLjUtLjM0OC0uMjc3IDAtLjUuMTU2LS41LjM0OHptMi4yMDYgMHY0LjY5MmMwIC4xOTIuMjI0LjM0OC41LjM0OHMuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjI0LS4zNDgtLjUtLjM0OHMtLjUuMTU2LS41LjM0OHptMi4yMDYgMHY0LjY5MmMwIC4xOTIuMjI0LjM0OC41LjM0OC4yNzcgMCAuNS0uMTU2LjUtLjM0OFYxMC44YzAtLjE5Mi0uMjIzLS4zNDgtLjUtLjM0OC0uMjc2IDAtLjUuMTU2LS41LjM0OHoiIGZpbGw9IiMwMDAiLz48L2c+PC9zdmc+","italic-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjMzM4MUZGIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=",italic:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTcgMTQgOSAyTTUgMTRoNE03IDJoNCIgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L3N2Zz4=","laser-pointer-cursor":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGRlZnM+PGZpbHRlciB4PSItMTIwJSIgeT0iLTEyMCUiIHdpZHRoPSIzNDAlIiBoZWlnaHQ9IjM0MCUiIGZpbHRlclVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCIgaWQ9ImEiPjxmZUdhdXNzaWFuQmx1ciBzdGREZXZpYXRpb249IjQiIGluPSJTb3VyY2VHcmFwaGljIi8+PC9maWx0ZXI+PC9kZWZzPjxnIHRyYW5zZm9ybT0idHJhbnNsYXRlKDkgOSkiIGZpbGw9IiNGRjAxMDAiIGZpbGwtcnVsZT0iZXZlbm9kZCI+PGNpcmNsZSBmaWx0ZXI9InVybCgjYSkiIGN4PSI1IiBjeT0iNSIgcj0iNSIvPjxwYXRoIGQ9Ik01IDhhMyAzIDAgMSAwIDAtNiAzIDMgMCAwIDAgMCA2em0wLTEuNzE0YTEuMjg2IDEuMjg2IDAgMSAxIDAtMi41NzIgMS4yODYgMS4yODYgMCAwIDEgMCAyLjU3MnoiIGZpbGwtcnVsZT0ibm9uemVybyIvPjwvZz48L3N2Zz4=","layer-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzMzODFGRiIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+",layer:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0ibTE2IDEwLTYgNCA2IDQgNi00em0tNiA4IDYgNCA2LTQiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","line-through-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","line-through":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTQgOGg4bS0xLTNhMyAzIDAgMCAwLTMtM2gtLjkzOEEyLjY0IDIuNjQgMCAwIDAgNC41IDRhMi41NyAyLjU3IDAgMCAwIDEuMzQ0IDIuOTIybDQuMzEyIDIuMTU2QTIuNTcgMi41NyAwIDAgMSAxMS41IDEyYTIuNjQgMi42NCAwIDAgMS0yLjU2MiAySDdhMyAzIDAgMCAxLTMtM2gwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","lock-hover":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMCIgb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiIGZpbGw9IiM3RDdEN0QiLz48L2c+PC9zdmc+","lock-new-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0zYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDV2MyIgc3Ryb2tlPSIjNDQ0RTYwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+","lock-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSI+PHBhdGggZmlsbD0iIzAwMCIgb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiIGZpbGw9IiM1QjkwOEUiLz48L2c+PC9zdmc+",lock:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggb3BhY2l0eT0iLjAxIiBkPSJNMCAwaDE2djE2SDB6Ii8+PHBhdGggZD0iTTEzIDcuMjVoLTEuMDYzdi0zLjVhMiAyIDAgMCAwLTItMkg2LjA2M2EyIDIgMCAwIDAtMiAydjMuNUgzYS41LjUgMCAwIDAtLjUuNXY2YS41LjUgMCAwIDAgLjUuNWgxMGEuNS41IDAgMCAwIC41LS41di02YS41LjUgMCAwIDAtLjUtLjV6bS00LjU2MyAzLjcwM3YuODI4YS4xMjUuMTI1IDAgMCAxLS4xMjQuMTI1aC0uNjI2YS4xMjUuMTI1IDAgMCAxLS4xMjUtLjEyNXYtLjgyOEEuNzQ5Ljc0OSAwIDAgMSA4IDkuNTkzYS43NS43NSAwIDAgMSAuNDM4IDEuMzZ6bTIuMzc2LTMuNzAzSDUuMTg2di0zLjVjMC0uNDgzLjM5My0uODc1Ljg3NS0uODc1aDMuODc1Yy40ODMgMCAuODc2LjM5Mi44NzYuODc1djMuNXoiLz48L3N2Zz4=","pencil-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAaCAYAAACpSkzOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAJ2SURBVHgB7ZXPqxJRFMfvjI4F+cqkTcrjge9B+B+0LJQ27lq4ijZprly6DaF1COKPjYRrVy0CF/aof6Baa6ChOPkLFcdMm1+dM93RafzxZuptgnfgC3ecO+dzz497JOTKNsZMp9OAoihvZFku4xp/I5dsbL/fP221Wl/D4bCKwnWn0znDd+SSDE/N6ZBgMKjJBNuKzC4dHTgQ5PF4bququn7R7XZJPB4/kSTpHcBOiQlmJ6cMpCvAcdz5ZDJhF4tF1u12v4jFYkc8z683+f1+Uq1W38K+x/AogVQ7ETF4SnB+Ho1GTxKJxDFC2u32q1KpJPh8vvVGjHK5XM4xahv+tYgRcranJrNarfay2WwKoVBIRTUajW42m70P390EOYmFrOEGdhfECEMIwur1Og+p5VOp1CP47piCOB3EXBBJAIuLRcZi7zKsSaVSEbxe70N4FEEL0AyE6VuBZEJD2wmyAkHDmoxGIwGW36ljBP2gUEXf5/wXCDZBsVjky+XyUwpCyBL0k0ai7gNp3WUVUigUvgHoWSaTaRoi2YJojk1r52q1eh2JRJ5YgUB3Pc/n83WyXRPV/A1rWrtgSAZsQL6Q3ynTI1F2QdCMqXNQEGsDMqMgrMt6ChwCaXcGYdBFjA3InELkQxBCtkcEI4riHyPFCMnlcnEKMbYzQhRi0TCKa6A76XT6wWAweD8ejz8Oh8PPcEc+9Xq9D8lkMgLv74Hugo5ALmJzlumG4+IG6BZ1dJ06wtPqN14gmza2FYljD1SljrCTsAaYpjnZFP7CmpADEel/ai4qffLiqSUKFSlEP8xfgYwwlmzyr1KYHoUtgBU4Y9D/Y78AxCeE/aWoyrkAAAAASUVORK5CYII=","pencil-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAYISURBVHgB7ZpNSCtXFIBPEuvz+dMGpYUKD/sWFX+Qti6kK7Hqpm6e9q0rIoIUFUShPLV10VZx4+JZqa9v20LBhdq9fyBUCtKNPH8qYl2IOw3G38Rkek4y15y5uTOZJDOWggcOSSYzN/ebc+45554JwIM8iBCPyTEP+86T4vyMfsRN4b+nQTKIJp0vzuGvlpID7os8EQNEIBD4oKio6Bm9DwaDv/v9/n/076JgbtWUYPchwrW8qD7UnOvr6wFNkpubm+/wu7f0c7y6mrnlvQufxB0Iau7V1dX3BDA/P6/V1dVpzc3N2uLiIofK1c8VYHys/wRKBUN3/hGHqaysNOjc3FwMis6hc0FtLTHuvYLxCCZgci8uLn4wg5Gh6Fy8Jk+/NkcCAlAAuUkoW4g0B+d5tLS05O/r67O8eGxsDNra2uDy8nKsoKCAwCIQDxQa0yTxgrvCYXyTk5Ml+Orf2dlJeeHIyAigFSE/P38ELfUNqNdSkjgF5FF89jL1TU1NlQwODl5gZPujp6cHWltbUw7Koc7Pz8mkZpHPFeFrJuZeqLnoMoPoZqe0JjDP/IZgnyLUG/o8NDRkuo5Ua2pjY6MC4oFCFf1cA0oKzRSOp6enRfTaGh0d/QxBt+1CUVgnOTs7+xrHfQzGyOcKkK3QTJMnQffZ6e/v/xwttmsHqqmpKXbdycnJCxy7ABLh3FEgVZ6hZJhnFZoFFMF0d3c/w7v+dyookXBnZ2c/xvHfhriVcvXfdBRItsxjnOhYqjwjoAimq6vrCysoGofk+Ph4Esd/F/UdiFtJAGUd2DygTpp5dmBUUJ2dnc9VUALm8PDwJY7/BPU9VD8k3M4RC6kskxZMKigKIMLN9vf3p3H8DyWgfEhEOwOQD9IXOTz7EObbwsLC4YWFBRgeHrY9ECXYo6MjaGlpKWlsbPxkYGDgRW1tbSEWquVlZWXBzc3Nl1VVVa8hXiXc6ioqBqGaPDk7AACJTRZ3NS9lcUp86cJwoSQ7Pj4Op6enfxUXF3/V0NCQv7q6GsCvwrqGUG/01xAD4+VQTOxaSF43d5bBOisrGBJRCtXX17+/trb268rKSgASFgmz97KFkmo6OztWuVyPweiWGc4WRkhFRQVEIpHg8vJyQAIQVlLBROVxvBYQHsXnO8tk62ZcyN0wecLBwcEvYHSzEPscBqOLCRhLC4n9uqaA8UAWAcAKhtbQ3t7eTHl5+Y9gtAp3twhT056CDMQ7MRzIFTeTYKb1yYYVQFH9VdzsqNmYKpfTJBDX3Ixgdnd3XyHMT2AMALJlBBSPaMpNngrIsTyTCgaj288YDGakictrxizvKFNOjgSSBLS+vv6UYHDb7DgMVgsChjTEgCIKGG4ZU+EWkgNBzN1qamq+pAMTExPgFMzW1tZrhHkFyWE5KxgSszx0527RaDRmOSpRshEOU11dPQPG8CwHARHJlMnTSrwSRFIlfXt7m3V5ngJGuJtqzaQtZkFBVNJezN5ZAdmwjKo2k9tVtrcI3OXk4tPgcg7ChCDZ1URgMOu72Xa5VFHOkymQhWVU60YVmjN6wiC7k6p+S1syCACOwJBYFaexV+yhBekNPsMBO6KAEeE4BMaCU67RsoYhSbXgaT//ht709vZCaWmp6YkEbLFmVJWzas04+iBL7EKpm0J7duqu0B7+CTUpNJuyvb1NCfMj1CqI9wLKUOlOUMeG+gGFkHii4HizUF4z/KFUrPsJ8WbEIyx7nnZ0dDynME6BAuce09iFHo+GrnmGltltb2//E4wVAN82y7vOjKOZXSBhJdHNiT3TYWD8OY2PTUJkdd7MkJMnT5wZVQF2RFX6yBMUdzPMvvfqxz3sXHF+GNT9ANXit/10O1sgHkZvdQAOKvs9B5L7ARELGAAXLSTvM8QExTE+YbHe+HURhZp1aRyF4CJXClbbWwGketgkW9VsY+YaiBCVhfgE+XvxRwgZSM4jUVCDZFQ9pytmXR8hUTB2gnidx4XffVWydN0yQjwmx/jkAZJBrIBI5J7ZvQGZWUgVSuU/EqmOAzicKNMVu816DdRWUV1/7xAP8n+SfwF3Du3NF2sYhwAAAABJRU5ErkJggg==",rotate:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjUiIGhlaWdodD0iMjQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgc3Ryb2tlPSIjNDQ0RTYwIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEzIDZhNiA2IDAgMSAxLTMuNzA5IDEuMjgzIi8+PHBhdGggZD0ibTEzIDYgMS40MTQgMi40NUwxMyA2bDIuNDUtMS40MTQiLz48L2c+PC9zdmc+","selector-cursor":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAKeSURBVHgB3VTLi1JhFD86zlQ4ysxSXAy1GWYZzMxmYAhHagRB/QN8FLqPFq4FIQhXkS6kTQ4t2ilIKEWgSS0SmVpIm0BdaBJSaOP78XU+PXey6+saburAD+73uL/feX0H4H81GQdj7D7ilrCGFRonk3c6nXvhcJiFQiGWy+Xy/X7/WbPZ1K1KkBOsl0qlO36/n+3t7Q1hs9kYF+WC3W73MTpxc1lBmej7KuJaoVDInZ6eqsWXDw4OwGKxwPHx8Se1Wn1Wr9cjW1tbOTxi9D9bJCJHXEFslsvlR263+246nYZZptPpQK/Xg8lkSvZ6vbNGo5EgQRCLiSPhIqpoNHobo3keCARgkalUKjg5ORlGuL+/n8T6PVAqlefjYmKRdYQSsZ3P5z8aDAYVLGFarRbi8fhbhUKhx2VPEJGP3eEbfTrs4MUwr4EU49FYrVbweDy1SqXyipy95FaI7g8QXS6SyWReHx4e2ubVBc+HtTk6OjqvVqtvvF7vi0gkUiSByyyJ21BGwpswJ2Vmsxlw/0Kj0bxMJBJJl8vFPWkhGogLQoeyMhEJo2jGUzYRjcPh+Op0Oq2pVOoHkXE0SahF/w+E+3KYNEaX2pSyiSiKxeJTFPiGyyriO6FKEUgSESLp4ht4bzQaf4pFYrHYO/ysEXGNyJtjKRqM/zNNhFuf0B7vst3dXdjZ2Yn4fL4vRFwn8jaMGqYPU179LBEGf3bZcNNutwPOtScwKnCLPJ9KLMWEh7mNuIFdVsNXzbBNP+D6Ou1vwAqm8hqMWlmbzWYf4mz6HAwGzbjWwGgqrEklmucJT+UGCfG3wiPjueeNwGvB0zkAid7OMmF8CyOck/I6NJcR4KZYcM6J2vCbUGhvyQIA0gonzCEZkQud9Fcd9W/bL57cJu3lkjuNAAAAAElFTkSuQmCC","selector-cursor@2x":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADEAAAAxCAYAAABznEEcAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAZoSURBVHgB7VlLSCRXFL3ljNEhEXTGhMQJmOjCz8ZNVLKICz9xIYhCNi7UgINkGEk2En8hW5cBUQNxo05GAoKikuCAmvGzGMdPcCUGjDPxD/4Vv/3JvWW97luvq7ur+hMZ8MKlqrteNfe8e965970GuLVbC5kpJr53+hjHx9yY3TUxJgLMAQG4ITARfp5T4Mri4uL9q6urnxwOxz/oY5eXl1/Pzs7e195X2FX4jZsIhAK7gx5ps9m6nGj9/f3OtbU1pzAE0318fPwVjYHrrN7R3AjU/wpOBwA9Cmf/9ejoqDMtLU31iooKGdA+ATo4OMiXAEWAHhBAGEApXj4rPAik0vPt7e0vCgoKPH4gMzMTSktLIS8vD2JiYgABvcHMTZyennbHxsaOg3udOJmLzwqEYB0ZgRCZENm4u7e39yQuLq65srISZmZmvP5Ybm4u5OfnQ0lJyXWUCAgzNLS+vt6SnJz8WgvYwV5xSlcRgyVg3ha2Dkxzc3MvfZmVlQW+bGxsDBobGyE7O1u94uJPjIqKqklKSvrbbrfPnp+ff7e8vJwMnlSTKWfJjDKhywJo6wLp0YcZ+dyIUr7s4cOHLsrRlQwBTSBFuzc2NiZYhjjVAIyzZBqEwgCQv0OOM/gNzuiP/ijlDxBRjgClpqa6AF1cXDydmpoaLCws3JcAGYHyC4JMzoKaibKysvienp6FtrY2IA/WCFB5ebkqCHSvARo8Ozt7igIxwIJ2gJ+seFMnDoIyEUV+dHT0G3qWVUr5M043DdAB0m2IKZwAYpgZX+qkywR6NFbuR0iDxmAoZRUQKRxSLTMnJ8eIaqqSeVMnIYUOdu+sq6vrp4f+VCoYo8khZaNs01VRlERUu2/BrWAA7sl2Anink1Ao18JGjyY/PDx8hq1GZqgp5c2mp6chMjLy2b179x7hRzvoqeUUwXIzqq4O5nZsNUaEbIbLqPLTou/s7FTvT05OpsA9sXJG1AVsZDwjutqBIN6gUlWjxod8XRBNKXgsrqpqYZfwEqX9h8TExD7wbFm8LmzxHQ0QHSlXKZVSqFC/hkqlaKapTaGgCQTK7PHW1lb/wsLC86KiokkccoV+qV1tcE0pO7AWxmhTxBszDzqRr66ujqanp2cRpQLNBgUsCh8BwQ54bn5+/s+mpqa+4eHhfS1gb52vwuP0trPjhSZCBtLQ0NA3MDDQQIFYAUHBYhuvzjpVbJr1lZWVP3p7e19UVVXNgHumXYrI4uBx6Yqevz02b0FcRQ8CoBQF3dXVpQLZ3d39C7n+ora29vfJyclDYFnWgFyxK3cxhss/+KoT/N6DVkQpKypFGUCp3Ozo6HgSHx//GLW/BwHsg57zl5pzADajwLn52mPL1ZHPloMoRYPMFL6EhAR18e7s7MxVV1fPsAAp4Avteq7dC/c1+wKI4g+EfGzDM+EYHBw8RDrNiA2QL6upqVGvKJ2/gHu2L1nA5wwEB2YDfSYMO1x/px0cgEc2zBY+eo67u6H29vZ/wU2VC8l58JxKNjDOgojNEp08aFVfX++3l6JMEdDx8fEB0FNIBsDXBc8ArwuW1EkeI1RKdLWmCx+1DhkZGRvR0dFfSsHKxYtnW0iqvJAN9xNm6MR/QO5sfapUSkqKmqW5ubmfwVgyZdpw/vPZl2kUEAinBMSUStG+gwra0NDQSynQKyloIxnlewafjDFLJzLRBJqiFMnqyMgIbG5uDuD996Dnv8iAPOMAPmbcm5lVJwA/vZRMKZGZlpaWVtAvUL4GZMqE1fjRJrUd76LHoX+InlhcXPwZnWW2tra6jjrpiBM3UK/weQr6J+gfodMh9HtwncG7YLA3CMSsLmxx5WuDCt8B7vZeicInTjCWlpb6wc15mfey7oc9E8LElpVmMgb9AXoC+qcTExOPKRu4NlTHs6Q10GfhgfYOvRsJQZ76BWMKuDtaolQs+gfoH6Mn436gDg+e+5BKXUQx/C5Je/a+NpbeiQJPKgUdlNXx/BCBKxVdxW5Q0I3XBqFKRhU4KLtjYawi3csuTKdc4FnIXNvKUJkVEGRG20QZAAUpA5DbaYAQLmQzfzxyk/ffdnCD4NWVnGdE7kQBQvQHC5lVEDxgMaM29lkxGCNLKrDnIbFAMkFmBIaDkHstU41coGZ1TZD5UjReCGUAYbNgdNqoXZB/T67yYbFAMiGML3BhYeH8rb0t9h/zgcTBcTNGiQAAAABJRU5ErkJggg==","to-bottom-pressed":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-bottom":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDEwdjhtMCAwLTItMm0yIDIgMi0ybS00IDZoMTJtLTYtNGg2bS02LTRoNm0tNi00aDYiIHN0cm9rZT0iIzQ0NEU2MCIgZmlsbD0ibm9uZSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIi8+PC9zdmc+","to-top":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDIydi04bTAgMC0yIDJtMi0yIDIgMm0tNC02aDEybS02IDRoNm0tNiA0aDZtLTYgNGg2IiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","underline-active":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiMzMzgxRkYiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==",underline:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTEyIDJ2NWE0IDQgMCAxIDEtOCAwVjJoME0zIDE0aDEwIiBzdHJva2U9IiM0NDRFNjAiIGZpbGw9Im5vbmUiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==","unlock-new":"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiMzMzgxRkYiIGN4PSIxNiIgY3k9IjE3IiByPSIxIi8+PHJlY3Qgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIHg9IjExIiB5PSIxNCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjgiIHJ4PSIyIi8+PHBhdGggZD0iTTEzIDE0di0xYTMgMyAwIDAgMSA2IDB2MWgwbS0zIDN2MyIgc3Ryb2tlPSIjMzM4MUZGIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz48L2c+PC9zdmc+",unlock:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48Y2lyY2xlIGZpbGw9IiM0NDRFNjAiIGN4PSI4IiBjeT0iOSIgcj0iMSIvPjxyZWN0IHN0cm9rZT0iIzQ0NEU2MCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiB4PSIzIiB5PSI2IiB3aWR0aD0iMTAiIGhlaWdodD0iOCIgcng9IjIiLz48cGF0aCBkPSJtNS4yMDQgNC40NDcuMjYtLjk2NmEzIDMgMCAxIDEgNS43OTUgMS41NTNMMTEgNmgwTTggOXYzIiBzdHJva2U9IiM0NDRFNjAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvZz48L3N2Zz4="};function _w(e){return Hw[e]}var Gw=X(n("q1tI")),Yw=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).didUnmount=!1,r.onMouseDown=function(e){if(0===e.button){r.setState({isPressed:!0});document.body.addEventListener("mouseup",(function e(t){0===t.button&&(document.body.removeEventListener("mouseup",e),r.didUnmount||r.setState({isPressed:!1}))}))}},r.state={isHover:!1,isPressed:!1},r}return M(n,[{key:"componentWillUnmount",value:function(){this.didUnmount=!0}},{key:"render",value:function(){var e=this,t=this.props.className;t=void 0!==t?"button "+t:"button",this.props.disable&&(t+=" disable");var n=this.props.refObject;return Gw.createElement("div",{className:t,ref:n,onMouseEnter:function(){return e.setState({isHover:!0})},onMouseLeave:function(){return e.setState({isHover:!1})},onMouseDown:this.onMouseDown,onClick:this.props.onClick},this.props.children)}}]),n}(Gw.Component),Xw=X(n("q1tI")),qw=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).divRef=Xw.createRef(),r.onMouseDown=function(e){var t=r.divRef.current,i=e.target;t&&!n.isEventFiredOnElement(i,t)&&(0,r.props.onShouldBecomeHide)(i)},document.body.addEventListener("mousedown",r.onMouseDown),r}return M(n,[{key:"componentWillUnmount",value:function(){document.body.removeEventListener("mousedown",this.onMouseDown)}},{key:"render",value:function(){var e=_(H({},this.props),{ref:this.divRef});delete e.onShouldBecomeHide;var t=e.children;return Xw.createElement("div",H({},e),t)}}],[{key:"isEventFiredOnElement",value:function(e,t){for(var n=e;n;){if(n===t)return!0;n=n.parentElement}return!1}}]),n}(Xw.Component);function Qw(e){var t=Math.floor(e);return e>=t+.5&&(t+=1),t}var Kw=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).inputRef=Vw.createRef(),r.upArrowButton=Object.freeze({iconName:"arrow-up",isUp:!0,ref:Vw.createRef()}),r.downArrowButton=Object.freeze({iconName:"arrow-down",isUp:!1,ref:Vw.createRef()}),r.onFocusInput=function(){var e=r.inputRef.current;e&&(e.type="text",e.setSelectionRange(0,e.value.length),e.type="number",r.setState({isFocusInput:!0}))},r.onShouldBecomeHide=function(e){var t=r.inputRef.current,n=r.upArrowButton.ref.current,i=r.downArrowButton.ref.current;t&&n&&i&&!qw.isEventFiredOnElement(e,n)&&!qw.isEventFiredOnElement(e,i)&&r.commitFontSizeWithString(t.value)},r.onPressKeyInput=function(e){"Enter"===e.key&&r.commitFontSizeWithString(e.target.value)},r.state={overrideFontSize:void 0,hoverIndex:void 0,isFocusInput:!1},r}return M(n,[{key:"onSelectFontSize",value:function(e){this.commitFontSizeWithInt(e),this.setState({overrideFontSize:void 0,hoverIndex:void 0,isFocusInput:!1})}},{key:"getFontSize",value:function(){var e,t,n=A(this.props.components);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=Qw(r.currentScale*r.textSize);if(void 0===e)e=i;else if(e!==i){e=void 0;break}}}catch(e){n.e(e)}finally{n.f()}return e}},{key:"shouldUpdateFontSize",value:function(e){var t,n=A(this.props.components);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.currentScale*r.textSize!==e)return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"commitFontSizeWithString",value:function(e){var t,n=Number.parseFloat(e);Number.isNaN(n)||(n=Qw(n),n=Math.max(n,Kw.minFontSize),n=Math.min(n,Kw.maxFontSize),this.commitFontSizeWithInt(n),null==(t=this.inputRef.current)||t.blur(),this.setState({overrideFontSize:void 0,isFocusInput:!1,hoverIndex:void 0}))}},{key:"commitFontSizeWithInt",value:function(e){if(this.shouldUpdateFontSize(e)){var t=this.props,n=t.viewMovingState,r=t.delegate;n.maskHideFloatBarSometime(),r.updateTextareaFontSize(e)}}},{key:"renderMenu",value:function(e){var t=this,n=this.inputRef.current;if(!n)return null;var r,i=Kw,a=i.menuMargin,o=i.menuSize,s=o.width,c=o.height,u=this.props.isMenuToDown,l=n.offsetLeft+(n.offsetWidth-s)/2;return r=u?n.offsetTop+n.offsetHeight+a:n.offsetTop-a-c,Vw.createElement(qw,{className:"font-size-menu",style:{left:l,top:r,width:s,height:c},onMouseLeave:function(){return t.setState({hoverIndex:void 0})},onShouldBecomeHide:this.onShouldBecomeHide},this.renderFontSizeList(e))}},{key:"renderFontSizeList",value:function(e){for(var t=this,n=parseInt(e,10),r=Kw.fontSizeList,i=[],a=function(e){var a=r[e],o=null,s="cell";n===a&&(o=Vw.createElement("img",{className:"check",alt:"check",src:_w("check")}));var c=t.state.hoverIndex;e===c&&(s+=" hover"),i.push(Vw.createElement("div",{key:"".concat(e),className:s,onMouseEnter:function(){return t.setState({hoverIndex:e})},onClick:function(){return t.onSelectFontSize(a)}},o&&Vw.createElement("div",{className:"check"}),Vw.createElement("span",null,a),o))},o=0;o<r.length;++o)a(o);return i}},{key:"renderArrowButton",value:function(e,t){var n,r=this,i=Number.parseFloat(e),a=Kw.fontSizeList;if(!Number.isNaN(i))if(t.isUp)for(var o=0;o<a.length;++o){var s=a[o];if(s>i){n=s;break}}else for(var c=a.length-1;c>=0;--c){var u=a[c];if(u<i){n=u;break}}var l=t.iconName;return Vw.createElement(Yw,{className:"arrow-button",disable:void 0===n,refObject:t.ref,onClick:function(){void 0!==n&&(r.props.viewMovingState.maskHideFloatBarSometime(),r.commitFontSizeWithInt(n),r.setState({overrideFontSize:void 0,hoverIndex:void 0}))}},Vw.createElement("img",{alt:"icon",src:_w(l)}))}},{key:"render",value:function(){var e=this,t=this.state,n=t.overrideFontSize,r=t.isFocusInput,i=n;if(void 0===i){var a=this.getFontSize();i=void 0===a?"":"".concat(a)}return Vw.createElement(Vw.Fragment,{key:"font-size"},Vw.createElement("div",{className:"decorator"},Vw.createElement("img",{className:"font-size-icon",alt:"icon",src:_w(r?"font-size-active":"font-size")})),Vw.createElement("input",{className:"font-size-input",type:"number",value:i,ref:this.inputRef,onFocus:this.onFocusInput,onKeyUp:this.onPressKeyInput,onChange:function(t){return e.setState({overrideFontSize:t.target.value})}}),r&&this.renderMenu(i),Vw.createElement("div",{className:"decorator"},Vw.createElement("div",{className:"font-size-buttons"},this.renderArrowButton(i,this.upArrowButton),this.renderArrowButton(i,this.downArrowButton))))}}]),n}(Vw.Component);Kw.minFontSize=1,Kw.maxFontSize=999,Kw.fontSizeList=Object.freeze([12,14,18,24,36,48,64,80,144,288]),Kw.menuMargin=21,Kw.menuSize=Object.freeze({width:64,height:248}),Kw=q([Ww.observer],Kw);var Zw=X(n("/+6X")),Jw=X(n("q1tI"));function $w(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}var eS=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).onClickDisplayButton=function(){r.state.isDisplayMenu||r.setState({isDisplayMenu:!0})},r.state={isDisplayMenu:!1},r}return M(n,[{key:"onClickColorButton",value:function(e){var t=p(e);this.props.delegate.updateTextareaFormat({color:t}),this.setState({isDisplayMenu:!1})}},{key:"getSelectedColor",value:function(){var e,t=null,n=A(this.props.components);try{for(n.s();!(e=n.n()).done;){var r=e.value.format.color;if(t){if(!$w(t,r)){t=null;break}}else t=r}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"renderMenu",value:function(e){var t,n=this,r=this.props,i=r.isMenuToDown,a=r.colors,o=r.parentWidth,s=r.parentHeight,c=Math.ceil(a.length/eS.menuLineCellsCount),u=Math.min(a.length,eS.menuLineCellsCount)*eS.menuCellSize.width+2*eS.menuPadding,l=c*eS.menuCellSize.height+2*eS.menuPadding,h=eS.menuMargin,d=o-u;return t=i?s+h:-(h+l),Jw.createElement(qw,{className:"font-colors-menu",style:{left:d,top:t,width:u,height:l},onShouldBecomeHide:function(){return n.setState({isDisplayMenu:!1})}},this.renderColorButtons(e))}},{key:"renderColorButtons",value:function(e){for(var t=this,n=this.props.colors,r=[],i=function(i){var a=n[i],o="rgb(".concat(a[0],", ").concat(a[1],", ").concat(a[2],")"),s="font-color-button";e&&$w(e,a)?s+=" font-color-selected":s+=" font-color-not-selected",r.push(Jw.createElement("div",{key:"".concat(i),className:s,onClick:function(){return t.onClickColorButton(a)}},Jw.createElement("div",{className:"core",style:{backgroundColor:o}})))},a=0;a<n.length;++a)i(a);return r}},{key:"render",value:function(){var e=this.getSelectedColor(),t=e&&Jw.createElement("div",{className:"bar",style:{backgroundColor:"rgb(".concat(e[0],",").concat(e[1],",").concat(e[2],")")}}),n=this.state.isDisplayMenu,r=n?"font-colors-active":"font-colors";return Jw.createElement(Jw.Fragment,null,Jw.createElement(Yw,{className:"normal-button",onClick:this.onClickDisplayButton},Jw.createElement("div",{className:"font-colors-icon"},Jw.createElement("img",{alt:"icon",src:_w(r)}),t)),n&&this.renderMenu(e))}}]),n}(Jw.Component);eS.menuMargin=8,eS.menuPadding=8,eS.menuLineCellsCount=4,eS.menuCellSize=Object.freeze({width:28,height:28}),eS=q([Zw.observer],eS);var tS=X(n("q1tI")),nS=X(n("/+6X"));var rS=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).buttonRef=tS.createRef(),r.state={isDisplayMenu:!1},r}return M(n,[{key:"renderMenu",value:function(){var e=this,t=this.buttonRef.current;if(!t)return null;var n,r=rS.menuSize,i=r.width,a=r.height,o=rS.menuMargin,s=this.props,c=s.isMenuToDown,u=s.delegate,l=t.offsetLeft+(t.offsetWidth-i)/2;return n=c?t.offsetTop+t.offsetHeight+o:t.offsetTop-o-a,tS.createElement(qw,{className:"image-layer-menu",style:{left:l,top:n,width:i,height:a},onShouldBecomeHide:function(){return e.setState({isDisplayMenu:!1})}},tS.createElement(Yw,{key:"layer-unlock",className:"normal-button",onClick:function(){return u.moveSelectedComponentsToTop()}},tS.createElement("img",{alt:"icon",src:_w("to-top")})),tS.createElement(Yw,{key:"layer-lock",className:"normal-button",onClick:function(){return u.moveSelectedComponentsToBottom()}},tS.createElement("img",{alt:"icon",src:_w("to-bottom")})))}},{key:"render",value:function(){var e=this,t=this.state.isDisplayMenu,n=t?"layer-pressed":"layer";return tS.createElement(tS.Fragment,null,tS.createElement(Yw,{key:"layer",className:"normal-button ".concat(t?"highlight-button":""),refObject:this.buttonRef,onClick:function(){return e.setState({isDisplayMenu:!t})}},tS.createElement("img",{alt:"icon",src:_w(n)})),t&&this.renderMenu())}}]),n}(tS.Component);rS.menuMargin=21,rS.menuSize=Object.freeze({width:72,height:40}),rS=q([nS.observer],rS);var iS=Object.freeze({top:12,bottom:24,left:12,right:12}),aS=Object.freeze({top:1,bottom:1,left:1,right:1});function oS(e){var t=e.whiteModel,n=t.ImageShape,r=t.TextareaShape,i=[],a=e.components;if(0===a.length)return i;var o,s=0,c=0,u=!0,l=!0,h=!0,d=!0,f=!0,p=A(a);try{for(p.s();!(o=p.n()).done;){var v=o.value;if(ts(v,n))s+=1;else if(ts(v,r)){var m=v.format;m.bold||(l=!1),m.italic||(h=!1),m.underline||(d=!1),m.lineThrough||(f=!1),c+=1}v.locked||(u=!1)}}catch(e){p.e(e)}finally{p.f()}var g=40,y=40;return s===a.length?(i.push({width:g,height:y,node:function(){return sS(e)}}),i.push({width:g,height:y,node:function(){return function(e,t){var n=e.delegate,r=!t;return Uw.createElement(Yw,{key:"lock",className:"normal-button",onClick:function(){return n.lockImages(r)}},Uw.createElement("img",{alt:"lock",src:_w(t?"unlock-new":"lock-new")}))}(e,u)}}),u||i.push(function(e){var t=e.delegate;return{width:40,height:40,node:function(e,n,r,i,a,o){var s=n+i/2<=o/2;return tS.createElement(rS,{key:"image-layer-button",isMenuToDown:s,delegate:t})}}}(e)),i.push({width:g,height:y,node:function(){return function(e){var t=e.delegate;return Uw.createElement(Yw,{key:"duplicate",className:"normal-button",onClick:function(){return t.duplicate()}},Uw.createElement("img",{alt:"duplicate",src:_w("duplicate")}))}(e)}})):c===a.length&&(i.push({width:g,height:y,node:function(){return sS(e)}}),i.push({width:g,height:y,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return Uw.createElement(Yw,{key:"text-blob",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({bold:i})}},Uw.createElement("img",{alt:"text-blob",src:_w(t?"bold-active":"bold")}))}(e,l)}}),i.push({width:g,height:y,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return Uw.createElement(Yw,{key:"text-italic",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({italic:i})}},Uw.createElement("img",{alt:"text-italic",src:_w(t?"italic-active":"italic")}))}(e,h)}}),i.push({width:g,height:y,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return Uw.createElement(Yw,{key:"text-line-through",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({lineThrough:i})}},Uw.createElement("img",{alt:"text-line-through",src:_w(t?"line-through-active":"line-through")}))}(e,f)}}),i.push({width:g,height:y,node:function(){return function(e,t){var n=e.viewMovingState,r=e.delegate,i=!t;return Uw.createElement(Yw,{key:"text-underline",className:"normal-button",onClick:function(){n.maskHideFloatBarSometime(),r.updateTextareaFormat({underline:i})}},Uw.createElement("img",{alt:"text-underline",src:_w(t?"underline-active":"underline")}))}(e,d)}}),i.push(function(e){var t=e.viewMovingState,n=e.delegate,r=e.components;return{width:95,height:40,node:function(e,i,a,o,s,c){var u=i+o/2<=c/2;return Vw.createElement(Kw,{key:"font-size",delegate:n,viewMovingState:t,components:r,isMenuToDown:u})}}}(e)),i.push(function(e){var t=e.viewMovingState,n=e.delegate,r=e.components,i=e.colors;return{width:40,height:40,node:function(e,a,o,s,c,u){var l=a+s/2<=u/2;return Jw.createElement(eS,{key:"font-colors",delegate:n,viewMovingState:t,colors:i,components:r,parentWidth:o,parentHeight:s,isMenuToDown:l})}}}(e))),i}function sS(e){var t=e.delegate,n=e.isEditTextarea;return Uw.createElement(Yw,{key:"delete",className:"normal-button",onClick:function(){return t.delete()},disable:n},Uw.createElement("img",{alt:"delete",src:_w("delete")}))}var cS=X(n("0yMQ"));function uS(e,t){return Math.abs(e-t)<=.01}var lS,hS,dS=function(){function e(t){var n=this;I(this,e),this.latestCallMaskTimestamp=0,this.timer=null,this._shouldHideFloatBar=!1,this.onAfterMoving=function(){n._shouldHideFloatBar&&(n._shouldHideFloatBar=!1),n.timer=null},this.rectangle=t,(0,cS.makeObservable)(this,{_shouldHideFloatBar:cS.observable,setState:cS.action,release:cS.action})}return M(e,[{key:"shouldHideFloatBar",get:function(){return this._shouldHideFloatBar}},{key:"setState",value:function(t,n){var r=this,i=this.rectangle,a=!uS(i.originX,t.originX)||!uS(i.originY,t.originY),o=!uS(i.width,t.width)||!uS(i.height,t.height);(a||!n&&o)&&(!this._shouldHideFloatBar&&Date.now()>=this.latestCallMaskTimestamp+e.maskDuration&&(this._shouldHideFloatBar=!0),null!==this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){return(0,cS.runInAction)(r.onAfterMoving)}),e.cameraTouchInterval)),(a||o)&&(this.rectangle=t)}},{key:"maskHideFloatBarSometime",value:function(){this.latestCallMaskTimestamp=Date.now()}},{key:"release",value:function(){null!==this.timer&&(clearTimeout(this.timer),this.timer=null,this._shouldHideFloatBar=!1)}}]),e}();dS.cameraTouchInterval=300,dS.maskDuration=100,(hS=lS||(lS={}))[hS.Top=0]="Top",hS[hS.Bottom=1]="Bottom",hS[hS.Left=2]="Left",hS[hS.Right=3]="Right",hS[hS.Center=4]="Center";var fS=function(e){y(n,e);var t=k(n);function n(e){var r;return I(this,n),(r=t.call(this,e)).lockView=function(e){r.setState({lockedPosition:e})},r.state={lockedPosition:void 0},r.viewMovingState=new dS(e.rectangle),r}return M(n,[{key:"componentDidMount",value:function(){var e=this,t=!0;this.disposer=(0,Bw.autorun)((function(){e.viewMovingState.shouldHideFloatBar?t||(e.unlockView(),t=!0):t=!1}))}},{key:"componentDidUpdate",value:function(){var e=this.props.rectangle;this.viewMovingState.setState(e,this.isEditTextarea())}},{key:"componentWillUnmount",value:function(){var e;this.viewMovingState.release(),null==(e=this.disposer)||e.call(this)}},{key:"isEditTextarea",value:function(){var e,t=this.props,n=t.components,r=t.whiteModel.TextareaShape,i=A(n);try{for(i.s();!(e=i.n()).done;){var a=e.value;if(ts(a,r)&&void 0!==a.editedBy)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}},{key:"position",value:function(e,t,n){var r,i=e.originX,a=e.originY,o=i+e.width,s=a+e.height,c=aS.left+aS.right,u=aS.top+aS.bottom,l=0,h=A(n);try{for(h.s();!(r=h.n()).done;){var d=r.value,f=d.width,p=d.height;c+=f,l=Math.max(l,p)}}catch(e){h.e(e)}finally{h.f()}u+=l;var v=c+iS.left+iS.right,m=u+iS.top+iS.bottom,g=this.props.screenSize,y=g.width,b=g.height;return{left:i,right:o,top:a,bottom:s,position:a>=m?0:b-s>=m?1:i>=v?2:y-o>=v?3:4,boxWidth:c,boxHeight:u,width:v,height:m}}},{key:"centerXWithTopOrBottom",value:function(e,t){var n=Math.max(e.left,0),r=Math.min(e.right,t),i=e.width/2,a=(n+r)/2;return a-i<0?a=i:a+i>t&&(a=t-i),a}},{key:"unlockView",value:function(){this.setState({lockedPosition:void 0})}},{key:"render",value:function(){var e=this,t=this.props,n=t.whiteModel,r=t.components,i=t.screenSize,a=t.rectangle,o=t.cnode,s=t.room;if(!s||this.viewMovingState.shouldHideFloatBar)return null;var c=this.state.lockedPosition,u=oS({viewMovingState:this.viewMovingState,isEditTextarea:this.isEditTextarea(),whiteModel:n,components:r,delegate:s.floatBarDelegate,colors:s.floatBarOptions.colors});if(u.length<=0)return null;var l,h,d=c||this.position(a,s,u),f=i.width,p=i.height;switch(d.position){case 0:l=this.centerXWithTopOrBottom(d,f),h=d.top-d.height/2;break;case 1:l=this.centerXWithTopOrBottom(d,f),h=d.bottom+d.height/2;break;case 2:l=d.left-d.width/2,h=Math.max(d.top,0)+d.height/2;break;case 3:l=d.right+d.width/2,h=Math.max(d.top,0)+d.height/2;break;case 4:l=(Math.max(d.left,0)+Math.min(d.right,f))/2,h=Math.max(d.top,0)+d.height/2}var v,m=l-d.width/2,g=h-d.height/2,y="translate(".concat(m,"px,").concat(g,"px)"),b=[],k=m,w=A(u);try{for(w.s();!(v=w.n()).done;){var S=v.value,x=S.width,C=(0,S.node)(k,g,d.boxWidth,d.boxHeight,f,p);b.push(C),k+=x}}catch(e){w.e(e)}finally{w.f()}return Fw.createElement(El,{context:o,className:"float-bar",onMouseEnter:function(){return e.lockView(d)},style:{WebkitTransform:y,transform:y,width:d.boxWidth,height:d.boxHeight,padding:0,marginLeft:iS.left,marginRight:iS.right,marginTop:iS.top,marginBottom:iS.bottom}},b)}}],[{key:"willInterruptEvent",value:function(){return!0}}]),n}(Fw.Component);function pS(e){return function(){return e}}function vS(){return mS(1)}function mS(e){return function(t,n){var r=t.width/n.width,i=t.height/n.height,a=Math.max(r,i)*e;return Number.isNaN(a)?1:a}}function gS(){return kS(1,0)}function yS(e){return kS(1,e)}function bS(e){return kS(e,0)}function kS(e,t){return function(n,r){var i=n.width/(r.width+2*t),a=n.height/(r.height+2*t),o=Math.min(i,a)*e;return Number.isNaN(o)||o===1/0?0:o}}fS=q([zw.observer],fS);var wS,SS,xS,CS,IS=function(){function e(t,n){I(this,e),this._cameraBound=n,this.cameraman=t.bindCameraman(this.toCameraBorder(n),"device")}return M(e,[{key:"cameraBound",get:function(){return this._cameraBound}},{key:"setScreenSize",value:function(e){(!this.screenSize||this.screenSize.width!==e.width||this.screenSize.height!==e.height)&&(this.screenSize=e,this.setCameraBound({maxContentMode:this.maxContentMode,minContentMode:this.minContentMode}))}},{key:"setCameraBound",value:function(e){this._cameraBound=e,this.cameraman.setCameraBorder(this.toCameraBorder(e))}},{key:"toCameraBorder",value:function(e){var t=e.damping,n=e.centerX,r=e.centerY,i=e.width,a=e.height,o=this.boundSize(i,a);this.maxContentMode=e.maxContentMode,this.minContentMode=e.minContentMode;var s=1/0,c=0;return this.screenSize&&(this.maxContentMode&&(s=this.maxContentMode(this.screenSize,o)),this.minContentMode&&(c=this.minContentMode(this.screenSize,o))),function(e){for(var t in e)void 0===e[t]&&delete e[t];return e}({damping:t,centerX:n,centerY:r,width:i,height:a,maxScale:s,minScale:c})}},{key:"boundSize",value:function(e,t){return this.cameraman?{width:void 0===e?this.cameraman.cameraBorder.width:e,height:void 0===t?this.cameraman.cameraBorder.height:t}:{width:void 0===e?1/0:e,height:void 0===t?1/0:t}}}]),e}();!function(e){e.Triangle="triangle",e.Rhombus="rhombus",e.Pentagram="pentagram",e.SpeechBalloon="speechBalloon"}(wS||(wS={})),(xS=SS||(SS={})).selector="selector",xS.clicker="clicker",xS.laserPointer="laserPointer",xS.pencil="pencil",xS.rectangle="rectangle",xS.ellipse="ellipse",xS.shape="shape",xS.eraser="eraser",xS.text="text",xS.straight="straight",xS.arrow="arrow",xS.hand="hand",function(e){e.None="none",e.Dir="dir",e.Page="page",e.Conflict="conflict"}(CS||(CS={}));var PS=function(){function e(){I(this,e),this.listeners={},this.eventsMergers={},this.waitingNodes=[]}return M(e,[{key:"dispatchEvent",value:function(e,t,n){var r=this.listeners[e.event];if(r){var i,a=A(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(!n||o.isAfterCommit===t)try{o.invoke(e)}catch(e){console.error(e)}}}catch(e){a.e(e)}finally{a.f()}}var s=this.waitingNodes.findIndex((function(t){return!!t.filter(e)&&(t.resolve(e),!0)}));-1!==s&&this.waitingNodes.splice(s,1)}},{key:"addMagixEventsListener",value:function(e,t,n,r){var i=function(e,t){var n=[],r=new Be(t,(function(){n.length>0&&e(n.splice(0,n.length))}));function i(e){n.push(e),r.invoke()}return Object.defineProperty(i,"proxyListener",{writable:!1,value:e}),i}(t,n),a=this.eventsMergers[e];a||(a=[],this.eventsMergers[e]=a),a.push(i),this.addMagixEventListener(e,i,r)}},{key:"addMagixEventListener",value:function(e,t,n){var r=this.listeners[e];r||(r=[],this.listeners[e]=r),r.push({invoke:t,isAfterCommit:n})}},{key:"removeMagixEventListener",value:function(e,t){if(t){var n=this.removeFromEventMerges(e,t);n?this.removeFromListeners(e,n):this.removeFromListeners(e,t)}else delete this.listeners[e],delete this.eventsMergers[e]}},{key:"removeFromEventMerges",value:function(e,t){var n=this.eventsMergers[e];if(n){for(var r=-1,i=0;i<n.length;++i)if(n[i].proxyListener===t){r=i;break}if(-1!==r){var a=n[r];return n.splice(r,1),0===n.length&&delete this.eventsMergers[e],a}}}},{key:"removeFromListeners",value:function(e,t){var n=this.listeners[e];if(n){var r=n.findIndex((function(e){return e.invoke===t}));-1!==r&&(n.splice(r,1),0===n.length&&delete this.listeners[e])}}},{key:"waitMagixEvent",value:function(e){var t=this;return new Promise((function(n){t.waitingNodes.push({resolve:n,filter:e})}))}}]),e}(),MS=new(function(){function e(){I(this,e)}return M(e,[{key:"parse",value:function(e){var t=e.split("/");if(""!==t[0])throw new Error("path ".concat(JSON.stringify(e),' should start with "/"'));""===t[t.length-1]&&t.pop();for(var n=[],r=1;r<t.length;++r)n.push(t[r].trim());return n}},{key:"stringify",value:function(e){return"/".concat(e.join("/"))}}]),e}()),TS=X(n("q1tI")),AS=TS.createContext(void 0),ES=TS.createContext(void 0),OS=TS.createContext(void 0);function RS(e,t){var n=e.Provider;return function(e){var r=e.children;return TS.createElement(n,{value:t},r)}}var NS=AS.Consumer,LS=ES.Consumer,jS=OS.Consumer;function DS(e){return new FS(e)}var FS=function(){function e(t){I(this,e),this.cacheContextMap={},this.manager=null,this.plugins=this.copyAndFreezePlugins(t)}return M(e,[{key:"copyAndFreezePlugins",value:function(e){var t={};for(var n in e){var r=e[n];if(void 0!==r.kind&&n!==r.kind)throw new Error("plugin's kind ".concat(JSON.stringify(r.kind)," is not equals key ").concat(JSON.stringify(n)));var i=r.defaultAttributes;"object"==T(i)&&null!==i&&(i=Object.freeze(H({},i))),t[n]=Object.freeze({kind:n,render:r.render,defaultAttributes:i,hitTest:r.hitTest,willInterruptEvent:r.willInterruptEvent})}return Object.freeze(t)}},{key:"setPluginContext",value:function(e,t){this.manager?this.manager.setPluginContext(e,t):this.cacheContextMap&&e in this.plugins&&(this.cacheContextMap[e]=t)}},{key:"getPluginContext",value:function(e){return this.manager?this.manager.getPluginContext(e):this.cacheContextMap?this.cacheContextMap[e]:void 0}},{key:"setPluginManager",value:function(e){if(this.cacheContextMap){for(var t in this.cacheContextMap)e.setPluginContext(t,this.cacheContextMap[t]);this.cacheContextMap=null}else if(this.manager)for(var n in this.plugins){var r=this.manager.getPluginContext(n);e.setPluginContext(n,r)}this.manager=e}}]),e}(),zS=X(n("0yMQ")),BS=function(){function e(t){I(this,e),this.enableCallbackUpdate=!0,this.disposer=null,this.copiedAttributes=null,this.kind=t.kind,this._displayer=t.displayer,this._callbacks=new sw,this.onAttributesUpdate&&this._callbacks.on("onAttributesUpdate",this.onAttributesUpdate.bind(this)),this.onDestroy&&this._callbacks.on("onDestroy",this.onDestroy.bind(this)),this.autorunAttributesUpdate(),(0,zS.makeObservable)(this,{attributes:zS.computed})}return M(e,[{key:"autorunAttributesUpdate",value:function(){var e=this;if(!this._displayer.useMobXState){var t=!1;this.disposer=(0,zS.autorun)((function(){e._displayer.applianceManager.hasInvisibilePluginKind(e.kind)&&(e.copiedAttributes=is(e.attributes),t&&e.enableCallbackUpdate&&e._callbacks.dispatch("onAttributesUpdate",(function(t){return t(e.copiedAttributes)})),t=!0)}))}}},{key:"displayer",get:function(){return this._displayer}},{key:"callbacks",get:function(){return this._callbacks}},{key:"attributes",get:function(){var e;if(this._displayer.useMobXState)e=this._displayer.applianceManager.getAttributesWithInvisiblePlugin(this.kind);else{if(!this.copiedAttributes)throw new Error('invisible plugin "'.concat(this.kind,'" not exits'));e=this.copiedAttributes}return e}},{key:"getAttributesValue",value:function(e){return this._displayer.applianceManager.getAttributesWithInvisiblePlugin(this.kind,e)}},{key:"setAttributes",value:function(e){var t=this;if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var n=this._displayer,r=n.applianceManager,i=n.parametersFilter,a=i?i.filter(e):e;r.updateAttributesInvisiblePlugin(this.kind,a)}finally{Promise.resolve((function(){t.enableCallbackUpdate=!0}))}}},{key:"updateAttributes",value:function(e,t){var n=this;if(this.isEnableUpdateAttributes())try{this.enableCallbackUpdate=!1;var r=this._displayer,i=r.applianceManager,a=r.parametersFilter,o=a?a.filter(t):t;i.updateAttributesInvisiblePluginWithKeys(this.kind,e,o)}finally{Promise.resolve((function(){n.enableCallbackUpdate=!0}))}}},{key:"destroy",value:function(){var e=this;try{this.enableCallbackUpdate=!1,this._displayer.applianceManager.removeInvisiblePlugin(this.kind)}finally{Promise.resolve((function(){e.enableCallbackUpdate=!0}))}}},{key:"_dispose",value:function(e){this.disposer&&(this.disposer(),this.disposer=null),e&&this.enableCallbackUpdate&&this._callbacks.dispatch("onDestroy",(function(e){return e()}))}},{key:"isEnableUpdateAttributes",value:function(){if(this._displayer instanceof dC)return this._displayer.isRoomEnableModify();throw new Error("cannot update attributes when displayer is player")}}]),e}(),US=function(){function e(t,n,r){I(this,e),this.pluginClasses={},this.plugins={},this.paddingCreators={},this.disposer=null,this._isWatching=!1,this.logger=t,this.displayer=n,this.pluginClasses=this.createPluginClasses(r)}return M(e,[{key:"createPluginClasses",value:function(e){var t,n={},r=A(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(i.kind in n)throw new Error("duplicated kind from invisible plugin ".concat(JSON.stringify(i.kind)));n[i.kind]=i}}catch(e){r.e(e)}finally{r.f()}return Object.freeze(n)}},{key:"isWatching",get:function(){return this._isWatching},set:function(e){var t=this;this._isWatching!==e&&(this._isWatching=e,e&&!this.disposer?this.disposer=(0,zS.autorun)((function(){for(var e in t.pluginClasses)t.refreshPlugin(t.pluginClasses[e])})):!e&&this.disposer&&(this.disposer(),this.disposer=null))}},{key:"get",value:function(e){return this.plugins[e]||null}},{key:"create",value:function(e,t){var n=this;return new Promise((function(r,i){var a=e.kind,o=n.displayer.applianceManager;try{if(n.addPaddingCreator(a,r),e!==n.pluginClasses[a])throw new Error("unregister invisible plugin class");o.putInvisiblePlugin(a,t)}catch(e){i(e),n.removePaddingCreator(a,r)}}))}},{key:"dispose",value:function(){this.disposer&&(this.disposer(),this.disposer=null);for(var e in this.plugins){try{this.plugins[e]._dispose(!1)}catch(e){this.logger.error(e)}delete this.plugins[e]}}},{key:"refreshPlugin",value:function(e){var t=this.displayer.applianceManager,n=e.kind;if(t.hasInvisibilePluginKind(n)){if(!this.plugins[n]){var r={kind:n,displayer:this.displayer},i=e,a=this.plugins[n]=new i(r);if(e.onCreate)try{e.onCreate(a)}catch(e){this.logger.error(e)}}var o=this.paddingCreators[n];if(o){delete this.paddingCreators[n];var s,c=A(o);try{for(c.s();!(s=c.n()).done;){(0,s.value)(this.plugins[n])}}catch(e){c.e(e)}finally{c.f()}}}else{var u=this.plugins[n];if(u){delete this.plugins[n];try{u._dispose(!0)}catch(i){this.logger.error(i)}if(e.onDestroy)try{e.onDestroy(u)}catch(i){this.logger.error(i)}}}}},{key:"addPaddingCreator",value:function(e,t){var n=this.paddingCreators[e];n||(n=this.paddingCreators[e]=[]),n.push(t)}},{key:"removePaddingCreator",value:function(e,t){var n=this.paddingCreators[e];if(n){var r=n.indexOf(t);-1!==r&&(n.splice(r,1),0===n.length&&delete this.paddingCreators[e])}}}]),e}();function VS(e,t){var n=H({},e),r=!1;for(var i in t){var a=t[i];e[i]!==a&&(n[i]=a,r=!0)}return r?n:null}var WS,HS,_S=function(){function e(t){I(this,e),this._state=Object.freeze(H({},t))}return M(e,[{key:"state",get:function(){return this._state}},{key:"putState",value:function(e){var t=VS(this._state,e),n=!1;if(t){var r=this._state;this._state=Object.freeze(t),this.onStateUpdate(e,r),n=!0}return n}}]),e}(),GS=X(n("i8i4")),YS=X(n("q1tI")),XS=X(n("0yMQ")),qS=X(n("q1tI")),QS=function(){function e(){I(this,e)}return M(e,[{key:"createCursor",value:function(){return{x:14,y:14,width:28,height:28,reactNode:qS.createElement(KS,null)}}}]),e}(),KS=function(){return qS.createElement("img",{alt:"laser",src:"https://sdk.netless.link/resource/mouse-cursor/laser-pointer-cursor.svg"})};!function(e){e.SVG="svg",e.Canvas="canvas"}(WS||(WS={})),function(e){e.Freedom="freedom",e.Follower="follower",e.Broadcaster="broadcaster"}(HS||(HS={}));var ZS=X(n("0yMQ")),JS=X(n("q1tI")),$S=function(e){y(n,e);var t=k(n);function n(){var e;return I(this,n),(e=t.apply(this,arguments)).onRef=function(t){var n=e.props.payload;if(!e._divElement&&t)e._divElement=t,n.onCursorComponentChanged(S(e));else if(e._divElement&&!t)try{n.onCursorComponentChanged(null)}finally{e._divElement=t}},e}return M(n,[{key:"divElement",get:function(){return this._divElement}},{key:"render",value:function(){var e=this.props,t=e.cnode,n=e.size,r=e.payload;return JS.createElement(El,{context:t,onRef:this.onRef,style:n},r.reactNode)}}]),n}(JS.Component);$S.isVisible=!1;var ex=function(){function e(t){var n=this;I(this,e),this.reactNode=null,this.onCursorComponentChanged=function(e){n.cursorComponent=e,e?n.adapter.onAddedCursor&&n.adapter.onAddedCursor(n):n.adapter.onRemovedCursor&&n.adapter.onRemovedCursor(n)},this.onComponentMoved=function(){if(n.adapter.onMovingCursor){var e=n.component.originX+n._x+n.screen.width/2,t=n.component.originY+n._y+n.screen.height/2;n.adapter.onMovingCursor(n,e,t)}},this.idPrefix=t.idPrefix,this.applianceManager=t.applianceManager,this.adapter=t.adapter,this.screen=t.screen,this.memberId=t.memberId;var r=this.adapter.createCursor(this.memberId);this._x=r.x,this._y=r.y,this._width=r.width,this._height=r.height,this.reactNode=r.reactNode||null,this.cursorDefinition=xd({name:"Cursor"}),t.engine.bind(this.cursorDefinition)($S),this.component=this.screen.scene.addComponent({id:this.idPrefix+this.memberId,definition:this.cursorDefinition,originX:t.point.x-this._x,originY:t.point.y-this._y,width:r.width,height:r.height,orderIndex:this.memberId,absoluteCoordinates:!0,payload:{reactNode:this.reactNode,onCursorComponentChanged:this.onCursorComponentChanged}}),this.adapter.onMovingCursor&&this.component.addRectangleUpdatedListener(this.onComponentMoved)}return M(e,[{key:"cursorMember",get:function(){return this._cursorMember}},{key:"setCursorMember",value:function(e){var t;this._cursorMember&&!pw(this._cursorMember,e)&&(this._cursorMember=e,null==(t=this.onCursorMemberChanged)||t.call(this,this._cursorMember))}},{key:"remove",value:function(){this.screen.scene.removeComponent(this.component),this.adapter.onMovingCursor&&this.component.removeRectangleUpdatedListener(this.onComponentMoved)}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"divElement",get:function(){if(!this.cursorComponent)throw new Error("cursor isn't added");return this.cursorComponent.divElement}},{key:"setReactNode",value:function(e){this.reactNode=e,this.component.payload={reactNode:e,onCursorComponentChanged:this.onCursorComponentChanged}}},{key:"setCursorDescription",value:function(e){var t=H({x:this._x,y:this._y,width:this._width,height:this._height},e),n=this._x-t.x,r=this._y-t.y;this.component.setRectangle(this.component.originX+n,this.component.originY+r,t.width,t.height),this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height}}]),e}(),tx=function(){function e(t){var n=this;I(this,e),this.didMouseCursorMoved=!1,this.inactivityTimer=null,this.shouldAppearNextFrame=!0,this.cursor=null,this.disposer=null,this.refreshState=function(){var e=n.getCursorState(n.memberId),t=n.applianceManager.getViewState(n.memberId);e&&t&&n.willShow(n.applianceManager,e)?n.cursor?n.refreshCursorVisibleState(e,t,n.cursor):n.cursor=n.createCursor(e):n.cursor&&(n.removeCursor(n.cursor),n.cursor=null)},this.applianceManager=t.applianceManager,this.screen=t.screen,this.engine=t.engine,this.idPrefix=t.idPrefix,this.memberId=t.memberId,this.adapter=t.adapter,this.willShow=t.willShow,this.isFollowerFixedOnScreen=t.isFollowerFixedOnScreen,this.refreshAutorun(),this.refreshIsVisible()}return M(e,[{key:"isVisible",get:function(){return this.isCursorInScene&&this.isKeepVisible}},{key:"getCursorState",value:function(e){if(this.applianceManager.getCursorState)return this.applianceManager.getCursorState(e);var t,n,r=A(this.applianceManager.getMemberDisplayers());try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.memberId===e){t={deviceType:i.deviceType,isPressed:i.isPressed,isActivity:i.isActivity,isCursorInScene:i.isCursorInScene,currentApplianceName:i.currentApplianceName,color:i.color,cursorX:i.cursorX,cursorY:i.cursorY};break}}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"refreshCursorVisibleState",value:function(e,t,n){this.setPositionProperties(e,t),this.setVisibleProperties(e),this.refreshComponentPosition(),n.setCursorMember({appliance:e.currentApplianceName,color:e.color,information:this.applianceManager.getInformationWithMemberId(this.memberId)})}},{key:"createCursor",value:function(e){return this.isCursorInScene=e.isCursorInScene,this.isPressed=e.isPressed,this.isActivity=e.isActivity,this.isKeepVisible=e.isActivity,this.cursorX=e.cursorX,this.cursorY=e.cursorY,this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY,new ex({idPrefix:this.idPrefix,memberId:this.memberId,applianceManager:this.applianceManager,screen:this.screen,engine:this.engine,adapter:this.adapter,point:this.getCurrentComponentPosition()})}},{key:"removeCursor",value:function(e){this.cleanInactivityDelayer(),e.remove()}},{key:"updateScreenSize",value:function(){this.refreshComponentPosition()}},{key:"refreshAutorun",value:function(){this.disposer&&this.disposer(),this.disposer=(0,ZS.autorun)(this.refreshState)}},{key:"dispose",value:function(){this.disposer&&(this.disposer(),this.disposer=null),this.cursor&&(this.removeCursor(this.cursor),this.cursor=null)}},{key:"setPositionProperties",value:function(e,t){if(this.mode=t.mode,this.originX=t.originX,this.originY=t.originY,this.cursorX=e.cursorX,this.cursorY=e.cursorY,this.width=t.width,this.height=t.height,this.didMouseCursorMoved)this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY;else{var n=0===this.width?1:this.screen.width/this.width,r=0===this.height?1:this.screen.height/this.height,i=(this.cursorX-this.latestCheckedCursorX)*this.width*n,a=(this.cursorY-this.latestCheckedCursorY)*this.height*r;i*i+a*a>=16&&(this.didMouseCursorMoved=!0,this.latestCheckedCursorX=this.cursorX,this.latestCheckedCursorY=this.cursorY)}}},{key:"setVisibleProperties",value:function(e){var t=this.isActivity;this.isCursorInScene=e.isCursorInScene,this.isPressed=e.isPressed,this.isActivity=e.isActivity,t&&!this.isActivity?(this.delayInactivity(),this.checkMouseCursorMoved()):!t&&this.isActivity?(this.cleanInactivityDelayer(),this.isKeepVisible=!0):!this.isActivity&&this.checkMouseCursorMoved()&&this.delayInactivity(),this.refreshIsVisible()}},{key:"refreshComponentPosition",value:function(){var e;if(this.isVisible){var t=this.getCurrentComponentPosition(),n=this.getNextAnimationMode();null==(e=this.cursor)||e.component.moveTo(t.x-this.cursor.x,t.y-this.cursor.y,n)}}},{key:"getNextAnimationMode",value:function(){return this.shouldAppearNextFrame?(this.shouldAppearNextFrame=!1,bd.Immediately):this.isPressed?bd.Immediately:bd.Continuous}},{key:"getCurrentComponentPosition",value:function(){var e,t;if(this.isFollowerFixedOnScreen(this.applianceManager)&&this.mode!==HS.Freedom){var n=0===this.width?1:this.screen.width/this.width,r=0===this.height?1:this.screen.height/this.height,i=Math.min(n,r),a=(this.screen.width-i*this.width)/2,o=(this.screen.height-i*this.height)/2;e=this.cursorX*this.width*i+a-this.screen.width/2,t=this.cursorY*this.height*i+o-this.screen.height/2}else{var s=this.screen.camera,c=s.centerX,u=s.centerY,l=s.scale;e=((e=this.cursorX*this.width+this.originX)-c)*l,t=((t=this.cursorY*this.height+this.originY)-u)*l}return{x:e,y:t}}},{key:"checkMouseCursorMoved",value:function(){return!!this.didMouseCursorMoved&&(this.didMouseCursorMoved=!1,!0)}},{key:"cleanInactivityDelayer",value:function(){null!==this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null)}},{key:"delayInactivity",value:function(){var e=this;null!==this.inactivityTimer&&(clearTimeout(this.inactivityTimer),this.inactivityTimer=null),this.isActivity||(this.isKeepVisible=!0,this.refreshIsVisible(),this.inactivityTimer=setTimeout((function(){e.isKeepVisible=!1,e.inactivityTimer=null,e.refreshIsVisible()}),5600))}},{key:"refreshIsVisible",value:function(){var e,t=this.isVisible;t||(this.shouldAppearNextFrame=!0),null==(e=this.cursor)||e.component.setVisible(this.engine,t)}}]),e}(),nx=function(){function e(t){var n=this;I(this,e),this.laserPointerCursorAdapter=new QS,this.nodes={},this._isHidden=!1,this.onAddedMember=function(e,t){var r,i=new tx({memberId:t,idPrefix:"laser-pointer-",adapter:n.laserPointerCursorAdapter,applianceManager:e,engine:n.engine,screen:n.screen,isFollowerFixedOnScreen:n.isFollowerFixedOnScreen,willShow:function(e,r){return r.currentApplianceName===SS.laserPointer&&(!n.willHideObserver||t!==n.observerId)}});n.cursorAdapter&&(r=new tx({memberId:t,idPrefix:"cursor-",adapter:n.cursorAdapter,applianceManager:e,engine:n.engine,screen:n.screen,isFollowerFixedOnScreen:n.isFollowerFixedOnScreen,willShow:function(e,r){return r.currentApplianceName!==SS.laserPointer&&(!n.willHideObserver||t!==n.observerId)}})),n.nodes[t]={laserPointer:i,cursor:r}},this.onRemovedMember=function(e,t){var r,i=n.nodes[t];i&&(delete n.nodes[t],i.laserPointer.dispose(),null==(r=i.cursor)||r.dispose())},this.onRefreshed=function(){var e;for(var t in n.nodes){var r=n.nodes[t];r.laserPointer.refreshAutorun(),null==(e=r.cursor)||e.refreshAutorun()}},this.isFollowerFixedOnScreen=function(e){var t=e.getViewState(n.observerId);return!!t&&(t.mode===HS.Broadcaster||t.mode===HS.Follower)},this.screen=t.screen,this.members=t.members,this.engine=this.getMouseCursorEngine(t.appVersion,t.engine),this.willHideObserver=t.willHideObserver,this.observerId=t.observerId,this.cursorAdapter=t.adapter,this._isHidden=t.isHidden,this.members.forEach(this.onAddedMember),this.members.callbacks.on("onAdded",this.onAddedMember),this.members.callbacks.on("onRemoved",this.onRemovedMember),this.members.callbacks.on("onRefreshed",this.onRefreshed),(0,XS.makeObservable)(this,{observerId:XS.observable,_isHidden:XS.observable,setHidden:XS.action,updateObserverId:XS.action})}return M(e,[{key:"isHidden",get:function(){return this._isHidden}},{key:"setHidden",value:function(e){this._isHidden!==e&&(this._isHidden=e)}},{key:"updateObserverId",value:function(e){this.observerId=e}},{key:"updateScreenSize",value:function(){var e;for(var t in this.nodes){var n=this.nodes[t];n.laserPointer.updateScreenSize(),null==(e=n.cursor)||e.updateScreenSize()}}},{key:"release",value:function(){var e;for(var t in this.members.callbacks.off("onAdded",this.onAddedMember),this.members.callbacks.off("onRemoved",this.onRemovedMember),this.members.callbacks.off("onRefreshed",this.onRefreshed),this.nodes){var n=this.nodes[t];n.laserPointer.dispose(),null==(e=n.cursor)||e.dispose(),delete this.nodes[t]}}},{key:"getMouseCursorEngine",value:function(e,t){if(t)return t;switch(e){case"2.0.0":return this.screen.scene.getEngineWithLegacyLayout(4);case"2.1.0":return this.screen.scene.getEngineWithLegacyLayout(5);default:throw new Error("invalid app version "+e)}}}]),e}();function rx(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.toDataURL("screenshot")}var ix,ax=function(){function e(t,n,r,i,a,o){var s,c=this;I(this,e),this._maskScreenObserverId=!0,this.onScreenSizeUpdated=function(e){c.cameraBoundState.setScreenSize(e),c.cursors&&c.cursors.updateScreenSize(),c.render.refreshSceneComponents(),c._onScreenSizeUpdated&&c._onScreenSizeUpdated(e)},this.updateCursorClassBySelector=function(e){if(c.applianceManager){var t=c.applianceManager.getMemberState();t&&t.currentApplianceName===SS.selector&&c.updateCursorClass(e)}};var u=r.modules,l=u.WhiteRender.WhiteboardRender;this.engines=r.engines,this.modules=r.modules,this.pluginManager=r.pluginManager,this.applianceManager=r.applianceManager,this.members=r.members,this.dynamicPpt=r.dynamicPpt,this.bezierCurvePainter=r.bezierCurvePainter,this.view=t,this._isCursorsHidden=a,this.observerId=n.observerId;var h=this.applianceManager.getViewState(),d=this.createScene(i.boundless,i.logger,i.renderEngine,u),f=Object.freeze(_(H({},n),{observerId:this.screenObserverId(n),deviceType:i.boundless.deviceType,dynamicPpt:this.dynamicPpt,disalbeImageHit:!1,disableOthersSelectingBox:!1,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,fontFamily:i.fontFamily,convertIdToUrl:i.urlInterrupter,updateTextarea:i.onTextareaUpdate,updateCursorClass:this.updateCursorClassBySelector,floatBarClass:i.floatBarClass,textareaHub:i.textareaHub}));if(this.screen=d.createScreen({className:"netless-whiteboard",context:f,engines:null==(s=this.engines)?void 0:s.enginesList,autoResize:i.autoResize,eventInterrupter:i.eventInterrupter,wrappedComponents:i.wrappedComponents,onRenderDuration:function(e){return c.view.fireRenderDuration(e)}}),this.onCatchErrorWhenRender=i.onCatchErrorWhenRender,this._onScreenSizeUpdated=i.onScreenSizeUpdated,i.onCatchErrorWhenRender&&this.screen.addRenderErrorCatchedListener(i.onCatchErrorWhenRender),this.screen.addSizeUpdatedListener(this.onScreenSizeUpdated),o){var p=o.cameraBoundState;this.cameraBoundState=new IS(this.screen,p.cameraBound),this.cameraBoundState.cameraman.disableBoundlessEvent=p.cameraman.disableBoundlessEvent,this.cameraBoundState.cameraman.disableCameraTransform=p.cameraman.disableCameraTransform,this.cameraBoundState.cameraman.handToolKey=p.cameraman.handToolKey}else this.cameraBoundState=new IS(this.screen,i.cameraBound),this.cameraBoundState.cameraman.disableBoundlessEvent=i.disableOperations,this.cameraBoundState.cameraman.handToolKey=i.handToolKey;this.cameraBoundState.cameraman.adaptRectangle({originX:h.originX,originY:h.originY,width:h.width,height:h.height,adapterMode:pd.Centering,animationMode:bd.Immediately}),this.render=new l(this.screen,this.pluginManager,this.applianceManager,this.engines),this.setupViewContextState(t.state),setTimeout((function(){var e;c.cursors=new nx({appVersion:r.appVersion,members:c.members,screen:c.screen,engine:null==(e=c.engines)?void 0:e.engines.mouseCurosrEngine,observerId:c.observerId,isHidden:c._isCursorsHidden,willHideObserver:i.willHideSelfCursor,adapter:i.cursorAdapter})}),0)}var t,n;return M(e,[{key:"isCursorsHidden",get:function(){return this._isCursorsHidden},set:function(e){this._isCursorsHidden!==e&&(this._isCursorsHidden=e,this.cursors&&this.cursors.setHidden(this._isCursorsHidden))}},{key:"maskFloatBar",get:function(){return this.render.maskFloatBar},set:function(e){this.render.maskFloatBar=e}},{key:"updateState",value:function(e){"cameraBound"in e&&this.cameraBoundState.setCameraBound(e.cameraBound),this.syncCameraMoving(e.cameraMoving),"disableCameraTransform"in e&&(this.cameraman.disableCameraTransform=e.disableCameraTransform),"handToolActive"in e&&(this.cameraman.handToolActive=e.handToolActive),"handToolKey"in e&&(this.cameraman.handToolKey=e.handToolKey),"divElement"in e&&(this.screen.divElement=e.divElement)}},{key:"syncCameraMoving",value:function(e){if(e){var t=e.camera,n=e.toContaint;if(t){var r=t.animationMode||bd.Continuous;this.cameraman.transformCamera(_(H({},t),{animationMode:r}))}else if(n){var i=n.animationMode||bd.Continuous;this.cameraman.adaptRectangle(_(H({},n),{animationMode:i,adapterMode:pd.Centering}))}}}},{key:"setupViewContextState",value:function(e){this.cameraBoundState.setCameraBound(e.cameraBound),this.syncCameraMoving(e.cameraMoving),this.cameraman.transformCamera(_(H({},e.cameraMoving),{animationMode:bd.Immediately})),this.cameraman.disableCameraTransform=e.disableCameraTransform,this.cameraman.handToolActive=e.handToolActive,this.cameraman.handToolKey=e.handToolKey,this.screen.divElement=e.divElement}},{key:"createScene",value:function(e,t,n,r){var i=r.WhiteRender;if(i.createLayoutDescriptions){var a=i.createLayoutDescriptions(n);return e.createSceneWithLegacyLayoutDescriptions(a,t)}return e.createScene(t)}},{key:"scenePath",get:function(){return"/"+this.applianceManager.getCurrentScenePath().join("/")}},{key:"foucsScenePath",get:function(){return this.render.foucsScenePath},set:function(e){this.render.foucsScenePath=e}},{key:"cameraman",get:function(){return this.cameraBoundState.cameraman}},{key:"maskScreenObserverId",get:function(){return this._maskScreenObserverId},set:function(e){this._maskScreenObserverId!==e&&(this._maskScreenObserverId=e,this.screen.context=Object.freeze(_(H({},this.screen.context),{observerId:e?hn:this.observerId})))}},{key:"setCommonScreenContext",value:function(e){var t,n=this.observerId,r=e.observerId;this.screen.context=Object.freeze(_(H(H({},this.screen.context),e),{observerId:this.screenObserverId(e)})),n!==r&&(this.observerId=r,null==(t=this.cursors)||t.updateObserverId(r))}},{key:"setCameraBound",value:function(e){this.cameraBoundState.setCameraBound(e)}},{key:"resizeScreen",value:function(){this.screen.resize()}},{key:"refreshRender",value:function(){this.render.refreshSceneComponents()}},{key:"fireReloadLibrary",value:function(){this.render.rebuildSceneRender&&this.render.rebuildSceneRender()}},{key:"refreshCameraToFocus",value:function(){var e=this.applianceManager.getViewState(),t={originX:e.originX,originY:e.originY,width:e.width,height:e.height};this.screen.adaptRectangle(_(H({},t),{animationMode:bd.Continuous,adapterMode:pd.Centering}))}},{key:"getTargetsMap",value:function(e,t){var n,r=e.component,i=e.engine,a=this.modules.WhiteModel.ApplianceComponent;return ts(r.payload,a)&&(n=this.render.getTargetsMap?this.render.getTargetsMap(r,t):this.render.findTargetsMap(r.id,i.orderIndex,t)),n}},{key:"cleanScreen",value:function(){var e;null==(e=this.render)||e.clean()}},{key:"release",value:function(){var e;this.onCatchErrorWhenRender&&this.screen.removeRenderErrorCatchedListener(this.onCatchErrorWhenRender),this.screen.removeSizeUpdatedListener(this.onScreenSizeUpdated),null==(e=this.cursors)||e.release(),this.render.release(),this.cameraBoundState.cameraman.release()}},{key:"scenePreview",value:function(e,t,n,r){var i=this.modules.WhiteRender,a=i.screenshot,o=i.EnginesHub;if(a){this.screenshotEngines||(this.screenshotEngines=o&&new o("svg"));var s=MS.parse(e),c=this.screen,u=n,l=r;u="number"!=typeof u?t.clientWidth:u,l="number"!=typeof l?t.clientHeight:l;var h=1;0!==c.width&&0!==c.height&&(h=Math.min(u/c.width,l/c.height)*c.camera.scale);var d={centerX:c.camera.centerX,centerY:c.camera.centerY,scale:h},f=a({applianceManager:this.applianceManager,engines:this.screenshotEngines,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,width:u,height:l,path:s,camera:d});if(!(0,YS.isValidElement)(f))throw new Error("scene preview must render ReactElement");GS.render(f,t)}}},{key:"fillSceneSnapshot",value:function(e,t,n,r){var i=this.modules.WhiteRender,a=i.screenshot,o=i.EnginesHub;if(a){this.screenshotEngines||(this.screenshotEngines=o&&new o("svg"));var s=MS.parse(e),c=a({applianceManager:this.applianceManager,engines:this.screenshotEngines,pluginManager:this.pluginManager,bezierCurvePainter:this.bezierCurvePainter,width:n,height:r,path:s});if(!(0,YS.isValidElement)(c))throw new Error("scene preview must render ReactElement");GS.render(c,t)}}},{key:"generateScreenshot",value:(n=l(regeneratorRuntime.mark((function e(t,n,r){var i,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t?(a=MS.parse(t),i=this.applianceManager.scenes.getScene(a)):i=this.applianceManager.scene,i){e.next=3;break}throw new Error("cannot find scene with path ".concat(JSON.stringify(t)));case 3:if(!(o=this.findBackgroundImage(i))){e.next=10;break}return e.next=7,this.generateImage(o,n,r);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=rx(1,1);case 11:return e.abrupt("return",e.t0);case 12:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"findBackgroundImage",value:function(e){for(var t=this.modules.WhiteModel.BackgroundImage,n=0;n<e.componentsLength;++n){var r=e.componentAt(n);if(ts(r,t))return r}return null}},{key:"generateImage",value:(t=l(regeneratorRuntime.mark((function e(t,n,r){var i,a,o,s,c,u,l,h,d,f,p,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=document.createElement("canvas"),o=r,void 0===(a=n)&&(a=t.width),void 0===o&&(o=t.height),i.width=a,i.height=o,!(s=t.previewURL)&&/^https?:\/\//im.test(t.src)&&(s=t.src),!s){e.next=14;break}return e.next=6,gw(s);case 6:c=e.sent,u=i.getContext("2d"),l=Math.min(a/t.width,o/t.height),h=t.width*l,d=t.height*l,f=(a-h)/2,p=(o-d)/2,u.drawImage(c,f,p,h,d);case 14:return e.next=16,new Promise((function(e){return i.toBlob(e)}));case 16:return v=e.sent,e.abrupt("return",URL.createObjectURL(v));case 18:case"end":return e.stop()}}),e)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"updateCursorClass",value:function(e){this.screen.className=null!==e?"netless-whiteboard "+e:"netless-whiteboard"}},{key:"updateCursorStyle",value:function(e){this.screen.style=null===e?void 0:{cursor:e}}},{key:"screenObserverId",value:function(e){var t=e.observerId;return this._maskScreenObserverId?hn:t}}]),e}();!function(e){e[e.Writable=0]="Writable",e[e.FollowSceneAndCamera=1]="FollowSceneAndCamera",e[e.FollowScene=2]="FollowScene",e[e.Freedom=3]="Freedom"}(ix||(ix={}));var ox=function(e){y(n,e);var t=k(n);function n(e,r,i,a,o,s,c){var u;return I(this,n),(u=t.call(this,o)).extraWrappedComponents=Object.freeze([]),u.didRelease=!1,u.wannaFocusScenePath=void 0,u._mode=3,u.onSizeUpdated=function(e){var t=e.width,n=e.height;u._size=Object.freeze({width:t,height:n}),u._callbacks.dispatch("onSizeUpdated",(function(e){return e(u._size)}))},u.onCameraUpdated=function(e){u._camera=Object.freeze({centerX:e.centerX,centerY:e.centerY,scale:e.scale}),"string"==typeof e.operatorId&&u._callbacks.dispatch("onCameraUpdatedByDevice",(function(e){return e(u._camera)})),u._callbacks.dispatch("onCameraUpdated",(function(e){return e(u._camera)}))},u.onBoundlessEvent=function(e){u.delegate.onBoundlessEvent(e)},u.onHandToolActive=function(e){u._callbacks.dispatch("onHandToolActive",(function(t){return t(e)}))},u.onCameraTransformation=function(e){u._callbacks.dispatch("onCameraTransform",(function(t){return t(e)}))},u.id=e,u.commonScreenContext=r,u.params=i,u.node=new ax(S(u),r,a,i,u.shouldHideCursors(a)),u.node.maskFloatBar=!1,u.latestScenePath=u.node.scenePath,u.delegate=s,u._callbacks=new sw(c),u.registerScreenAndCameraman(u.node.screen,u.node.cameraman),u}return M(n,[{key:"scenePath",get:function(){return this.latestScenePath}},{key:"focusScenePath",get:function(){return this.wannaFocusScenePath},set:function(e){var t=this;this.wannaFocusScenePath!==e&&(this.wannaFocusScenePath=e,this.shouldFollowScene(this._mode)||this.watchScenePathUpdate((function(){t.node.foucsScenePath=e})))}},{key:"disableCameraTransform",get:function(){return this.state.disableCameraTransform},set:function(e){this.putState({disableCameraTransform:e})}},{key:"callbacks",get:function(){return this._callbacks}},{key:"mode",get:function(){return this._mode},set:function(e){var t=this;this.assertNotRelease(),this._mode!==e&&this.watchScenePathUpdate((function(){0===t._mode&&t.delegate.onIsWriterChanged(!1),t.shouldFollowCamera(e)&&!t.shouldFollowCamera(t._mode)&&t.node.refreshCameraToFocus(),t.shouldFollowScene(e)&&!t.shouldFollowScene(t._mode)?t.node.foucsScenePath=void 0:!t.shouldFollowScene(e)&&t.shouldFollowScene(t._mode)&&(t.node.foucsScenePath=t.wannaFocusScenePath),t.node.maskScreenObserverId=t.shouldMaskScreenObserverId(e),0===e?(t.node.maskFloatBar=!1,t.delegate.onIsWriterChanged(!0)):t.node.maskFloatBar=!0,t._mode=e}))}},{key:"wrappedComponents",get:function(){return this.extraWrappedComponents},set:function(e){this.extraWrappedComponents=Object.freeze(p(e)),this.node.screen.wrappedComponents=[].concat(p(e),p(this.params.wrappedComponents))}},{key:"fireReloadLibrary",value:function(){this.node.fireReloadLibrary()}},{key:"shouldMaskScreenObserverId",value:function(e){return 0!==e}},{key:"shouldFollowCamera",value:function(e){switch(e){case 0:case 1:return!0;default:return!1}}},{key:"shouldHideCursors",value:function(e){var t="/"+e.applianceManager.getCurrentScenePath().join("/");return!(!this.wannaFocusScenePath||this.shouldFollowScene(this._mode)||t===this.wannaFocusScenePath)}},{key:"shouldFollowScene",value:function(e){switch(e){case 0:case 1:case 2:return!0;default:return!1}}},{key:"camera",get:function(){return this._camera}},{key:"size",get:function(){return this._size}},{key:"screen",get:function(){return this.node.screen}},{key:"cameraman",get:function(){return this.node.cameraman}},{key:"divElement",get:function(){return this.state.divElement},set:function(e){this.putState({divElement:e})}},{key:"getTargetsMap",value:function(e,t){return this.node.getTargetsMap(e,t)}},{key:"cancelCurrentContinuityEvent",value:function(){this.cameraman.cancelCurrentContinuityEvent()}},{key:"setCommonScreenContext",value:function(e){this.assertNotRelease(),this.commonScreenContext=e,this.node.setCommonScreenContext(e)}},{key:"updateContext",value:function(e){var t=this,n=this.node.maskFloatBar;this.assertNotRelease(),this.node.cleanScreen(),this.node.release(),this.unregisterScreenAndCameraman(this.node.screen,this.node.cameraman),this.node=new ax(this,this.commonScreenContext,e,this.handleUpdatedParams(this.params),this.shouldHideCursors(e),this.node),this.node.maskFloatBar=n,this.shouldFollowScene(this._mode)&&this.watchScenePathUpdate((function(){return t.node.foucsScenePath=t.wannaFocusScenePath})),this.registerScreenAndCameraman(this.node.screen,this.node.cameraman)}},{key:"handleUpdatedParams",value:function(e){return 0===this.extraWrappedComponents.length?e:_(H({},e),{wrappedComponents:[].concat(p(this.extraWrappedComponents),p(e.wrappedComponents))})}},{key:"setCameraBound",value:function(e){this.putState({cameraBound:e})}},{key:"moveCamera",value:function(e){this.putState({cameraMoving:{camera:e}})}},{key:"moveCameraToContain",value:function(e){this.putState({cameraMoving:{toContaint:e}})}},{key:"updateDisableBoundlessEvent",value:function(e){this.node.cameraman.disableBoundlessEvent=e}},{key:"updateCursorClass",value:function(e){this.node.updateCursorClass(e)}},{key:"updateCursorStyle",value:function(e){this.node.updateCursorStyle(e)}},{key:"resizeScreen",value:function(){this.node.resizeScreen()}},{key:"refreshRender",value:function(){var e=this;this.watchScenePathUpdate((function(){return e.node.refreshRender()}))}},{key:"scenePreview",value:function(e,t,n,r){return this.node.scenePreview(e,t,n,r)}},{key:"generateScreenshot",value:function(e,t,n){return this.node.generateScreenshot(e,t,n)}},{key:"fillSceneSnapshot",value:function(e,t,n,r){this.node.fillSceneSnapshot(e,t,n,r)}},{key:"convertToPointInWorld",value:function(e){var t=e.x,n=e.y;return this.node.screen.convertPointToScene(t,n)}},{key:"fireRenderDuration",value:function(e){this._callbacks.dispatch("onRenderDuration",(function(t){return t(e)}))}},{key:"release",value:function(){this.assertNotRelease(),this.node.release(),this.unregisterScreenAndCameraman(this.node.screen,this.node.cameraman),this.didRelease=!0,this.delegate.onRelease()}},{key:"onStateUpdate",value:function(e){this.node.updateState(e)}},{key:"registerScreenAndCameraman",value:function(e,t){var n=this,r=e.width,i=e.height,a=e.camera;(!this._size||this._size.width!==r||this._size.height!==i)&&(this._size=Object.freeze({width:r,height:i}),this._callbacks.dispatch("onSizeUpdated",(function(e){return e(n._size)}))),(!this._camera||!pw(this._camera,a))&&(this._camera=Object.freeze(H({},a)),this._callbacks.dispatch("onCameraUpdated",(function(e){return e(n._camera)}))),e.addSizeUpdatedListener(this.onSizeUpdated),e.addCameraUpdatedListener(this.onCameraUpdated),t.addBoundlessEventListener(this.onBoundlessEvent),t.addHandToolActiveListener(this.onHandToolActive),t.addCameraTransformationListener(this.onCameraTransformation)}},{key:"unregisterScreenAndCameraman",value:function(e,t){e.removeSizeUpdatedListener(this.onSizeUpdated),e.removeCameraUpdatedListener(this.onCameraUpdated),t.removeBoundlessEventListener(this.onBoundlessEvent),t.removeHandToolActiveListener(this.onHandToolActive),t.removeCameraTransformationListener(this.onCameraTransformation)}},{key:"assertNotRelease",value:function(){if(this.didRelease)throw new Error("view did release")}},{key:"watchScenePathUpdate",value:function(e){try{return e()}finally{var t=this.latestScenePath,n=this.node.scenePath;this.wannaFocusScenePath&&!this.shouldFollowScene(this._mode)&&n!==this.wannaFocusScenePath?this.node.isCursorsHidden=!0:this.node.isCursorsHidden=!1,t!==n&&(this.latestScenePath=n,this._callbacks.dispatch("onScenePathUpdated",(function(e){return e(n)})))}}}]),n}(_S),sx=function(e){y(n,e);var t=k(n);function n(e,r,i){var a;return I(this,n),(a=t.call(this,r)).viewsMap={},a.previousViewId=0,a.writer=null,a.params=e,a.context=Object.freeze(H({},i)),a._dynamicPpt=i.dynamicPpt,a._callbacks=new sw,a.commonScreenContext=Object.freeze({observerId:r.observerId,forcePPTLandscape:r.forcePPTLandscape,disalbeImageHit:r.disalbeImageHit,disableOthersSelectingBox:r.disableOthersSelectingBox}),a}return M(n,[{key:"writableView",get:function(){return this.writer}},{key:"dynamicPpt",get:function(){return this._dynamicPpt}},{key:"callbacks",get:function(){return this._callbacks}},{key:"onStateUpdate",value:function(e,t){var n,r;if("observerId"in e&&this.updateCommonScreenContext("observerId",e.observerId),"forcePPTLandscape"in e&&this.updateCommonScreenContext("forcePPTLandscape",e.forcePPTLandscape),"disalbeImageHit"in e&&this.updateCommonScreenContext("disalbeImageHit",e.disalbeImageHit),"disableOthersSelectingBox"in e&&this.updateCommonScreenContext("disableOthersSelectingBox",e.disableOthersSelectingBox),"disableBoundlessEvent"in e&&this.forEach((function(t){return t.updateDisableBoundlessEvent(e.disableBoundlessEvent)})),"cursorClass"in e&&(null==(n=this.writer)||n.updateCursorClass(e.cursorClass)),"cursorStyle"in e&&(null==(r=this.writer)||r.updateCursorStyle(e.cursorStyle)),"playerState"in e){var i=e.playerState,a=this.context.pluginManager;a.setPlayerState?a.setPlayerState(i):void 0!==i.isPlaying&&a.setPlayingState(i.isPlaying)}}},{key:"setupViewContext",value:function(e){e.updateDisableBoundlessEvent(this.state.disableBoundlessEvent),e.updateCursorClass(this.state.cursorClass),e.updateCursorClass(this.state.cursorStyle)}},{key:"updateCommonScreenContext",value:function(e,t){for(var n in this.commonScreenContext=Object.freeze(_(H({},this.commonScreenContext),o({},e,t))),this.viewsMap)this.viewsMap[n].setCommonScreenContext(this.commonScreenContext)}},{key:"forEach",value:function(e){for(var t in this.viewsMap)e(this.viewsMap[t])}},{key:"createView",value:function(e,t){var n=this,r="".concat(this.previousViewId+=1),i=Object.freeze({onIsWriterChanged:function(e){return n.changeViewIsWriter(a,e)},onRelease:function(){return n.releaseView(a)},onBoundlessEvent:function(e){n._callbacks.dispatch("onBoundlessEvent",(function(t){return t(a,e)}))}}),a=new ox(r,this.commonScreenContext,this.params,this.context,e,i,t);return this.viewsMap[a.id]=a,this.setupViewContext(a),this._callbacks.dispatch("onCreatedView",(function(e){return e(a)})),a}},{key:"updateContext",value:function(e){var t=this;for(var n in this.viewsMap){var r=this.viewsMap[n];r.updateContext(e),this.setupViewContext(r)}this._dynamicPpt=e.dynamicPpt,this.writer&&this._callbacks.dispatch("onWritableScreenChanged",(function(e){return e(t.writer)}))}},{key:"fireReloadLibrary",value:function(){var e,t;for(var n in null==(t=(e=this.context.pluginManager).refreshPluginInstances)||t.call(e),this.viewsMap)this.viewsMap[n].fireReloadLibrary()}},{key:"changeViewIsWriter",value:function(e,t){if(t){if(this.writer&&this.writer!==e)throw new Error("there is another view who's mode is Writable. it should be singleton");this.writer=e,this.writer.updateCursorClass(this.state.cursorClass),this.writer.updateCursorStyle(this.state.cursorStyle),this._callbacks.dispatch("onWritableViewChanged",(function(t){return t(e)})),this._callbacks.dispatch("onWritableScreenChanged",(function(t){return t(e)}))}else this.writer===e&&(this.writer.updateCursorClass(null),this.writer.updateCursorStyle(null),this.writer=null,this._callbacks.dispatch("onWritableViewChanged",(function(e){return e(null)})),this._callbacks.dispatch("onWritableScreenChanged",(function(e){return e(null)})))}},{key:"releaseView",value:function(e){delete this.viewsMap[e.id],this.writer===e&&(this.writer=null),this._callbacks.dispatch("onReleasedView",(function(t){return t(e)}))}}]),n}(_S),cx=function(){function e(t){I(this,e),this.viewsHub=t}return M(e,[{key:"writableView",get:function(){return this.viewsHub.writableView}},{key:"createView",value:function(e){return this.viewsHub.createView({cameraBound:{},handToolActive:!1,divElement:null,disableCameraTransform:!1},e)}},{key:"forEach",value:function(e){this.viewsHub.forEach(e)}}]),e}(),ux=function(){function e(t){I(this,e),this._owner=void 0,this._state=Object.freeze(H({},t))}return M(e,[{key:"owner",get:function(){return this._owner}},{key:"state",get:function(){return this._state||this._owner.state}},{key:"putState",value:function(e){var t;if(this._state){var n=VS(this._state,e);n&&(this._state=Object.freeze(n)),t=!!n}else t=this._owner.putState(e);return t}},{key:"updateOwner",value:function(e){this._owner=e,this._state=null}}]),e}(),lx=X(n("0yMQ")),hx=function(){function e(t){var n=this;I(this,e),this._callbacks=new sw,this.set={},this.autoUpdateMembers=function(){var e,t=n.applianceManager,r={},i=A(n.getMemberIds(t));try{for(i.s();!(e=i.n()).done;){var a=e.value;a in n.set?delete n.set[a]:n.dispatchEvent("onAdded",t,a),r[a]=a}}catch(e){i.e(e)}finally{i.f()}for(var o in n.set){var s=n.set[o];n.dispatchEvent("onRemoved",t,s)}n.set=r},this.applianceManager=t,this.disposer=(0,lx.autorun)(this.autoUpdateMembers),(0,lx.makeObservable)(this,{refresh:lx.action})}return M(e,[{key:"callbacks",get:function(){return this._callbacks}},{key:"forEach",value:function(e){for(var t in this.set)e(this.applianceManager,this.set[t])}},{key:"refresh",value:function(){var e=this.applianceManager;this.disposer(),this.disposer=(0,lx.autorun)(this.autoUpdateMembers),this._callbacks.dispatch("onRefreshed",(function(t){return t(e)}))}},{key:"createMapper",value:function(e){return new dx(this,e)}},{key:"dispose",value:function(){this.disposer()}},{key:"dispatchEvent",value:function(e,t,n){var r=this;setTimeout((function(){r._callbacks.dispatch(e,(function(e){return(0,lx.runInAction)((function(){e(t,n)}))}))}),0)}},{key:"getMemberIds",value:function(e){if(e.getMemberIds)return e.getMemberIds();var t,n=[],r=A(e.getMemberDisplayers());try{for(r.s();!(t=r.n()).done;){var i=t.value.memberId;n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}}]),e}(),dx=function(){function e(t,n){var r=this;I(this,e),this._nodes=[],this.memberIds={},this.onAdded=function(e,t){t in r.memberIds||(r.memberIds[t]=!0,r._nodes.push(new fx(e,t,r.mapper)))},this.onRemoved=function(e,t){var n=r._nodes.findIndex((function(e){return e.memberId===t}));-1!==n&&(r._nodes.splice(n,1),delete r.memberIds[t])},this.onRefreshed=function(){r._nodes.splice(0,r._nodes.length),r.memberIds={},r.members.forEach((function(e,t){r.memberIds[t]=!0,r._nodes.push(new fx(e,t,r.mapper))}))},this.members=t,this.mapper=n,this.members.forEach((function(e,t){r.memberIds[t]=!0,r._nodes.push(new fx(e,t,n))})),this.members.callbacks.on("onAdded",this.onAdded),this.members.callbacks.on("onRemoved",this.onRemoved),this.members.callbacks.on("onRefreshed",this.onRefreshed),(0,lx.makeObservable)(this,{_nodes:lx.observable,targets:lx.computed})}return M(e,[{key:"targets",get:function(){var e,t=[],n=A(this._nodes);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r.target)}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"dispose",value:function(){this.members.callbacks.off("onAdded",this.onAdded),this.members.callbacks.off("onRemoved",this.onRemoved),this.members.callbacks.off("onRefreshed",this.onRefreshed)}}]),e}(),fx=function(){function e(t,n,r){I(this,e),this.applianceManager=t,this.memberId=n,this.mapper=r,(0,lx.makeObservable)(this,{target:lx.computed})}return M(e,[{key:"target",get:function(){return this.mapper(this.applianceManager,this.memberId)}}]),e}();function px(e){return"object"==T(e)&&null!==e}var vx,mx,gx=function(){function e(t){var n=this,r=t.logger,i=t.region,a=t.boundless,o=t.useMobXState,s=t.preloadDynamicPPT,c=t.userFonts,u=t.pptHandler,h=t.globalStateUpdater,d=t.screenType,f=t.cameraBound,v=t.renderEngine,m=t.autoResize,g=t.plugins,y=t.wrappedComponents,b=t.floatBarClass,k=t.useMultiViews,w=t.willHideSelfCursor,S=t.disableCameraTransform,x=t.memberStateStorage,C=t.onlyCallbackRemoteStateModify,P=t.invisiblePlugins,M=t.handToolKey,T=t.fontFamily,A=t.disableOperations,E=t.disableOthersSelectingBox,O=t.cursorAdapter,R=t.eraserRadiusCursor,N=t.textareaHub,L=t.eventInterrupter,j=t.callbacks,D=t.urlInterrupter,F=t.onTextareaUpdate,z=t.userPayload,B=t.pptParams;I(this,e),this.magixEventsManager=new PS,this.preloadDynamicPPT=!1,this.mainViewProxy=null,this.membersMapper=null,this.context=null,this._views=null,this.libraryNodeFetcher=function(){var e=l(regeneratorRuntime.mark((function e(t){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r="".concat(Bk.modules.identifier,"/").concat(t.libIdentifier),e.next=3,Hk(r);case 3:return i=e.sent,a=i.WhiteModel.default,e.abrupt("return",(n.logger.info("load modules ",r),Object.freeze({modules:i,libraryClass:a,appVersion:t.appVersion})));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.covertMemberDisplayerToMember=function(e,t){var r=n.getMemberInformation(e,t),i=r?r.session:"",a=r&&r.payload,o=n.memberState(t);return o||(o=n.getDefaultMemberState()),{memberId:t,memberState:o,session:i,payload:is(a)}},this.logger=r,this.region=i,this.useMobXState=o,this.textareaHub=N,this.boundless=a,this.screenType=d,this.eraserRadiusCursor=R,this.pluginOperator=this.createPluginOperator(),this.plugins=g,this.autoResize=m,this.cameraObserver=new Ow,this.wrappedComponents=Object.freeze(p(y)),this.onlyCallbackRemoteStateModify=C,this.invisiblePluginNode=new US(r,this,P),this.callbacks=new sw(j),this.preloadDynamicPPT=s,this.viewsParams=Object.freeze({logger:r,renderEngine:v,boundless:a,cameraBound:f,fontFamily:T,cursorAdapter:O,autoResize:m,floatBarClass:b,memberStateStorage:x,wrappedComponents:this.createWrappedComponents(),disableOperations:A,disableOthersSelectingBox:E,willHideSelfCursor:w,handToolKey:M,eventInterrupter:L,urlInterrupter:D,onTextareaUpdate:F,textareaHub:N,userPayload:z,pptParams:B,onScreenSizeUpdated:function(e){return n.onScreenSizeUpdated(e)}}),this.dynamicPptParams={globalStateUpdater:h,observerId:hn,userFonts:c,preload:s,pptHandler:u,logger:r,pptParams:B,userPayload:z,pptAssetsOrigin:"https://convertcdn.netless.link/dynamicConvert",onPPTLoadProgress:function(e,t){return n.callbacks.dispatch("onPPTLoadProgress",(function(n){return n(e,t)}))},onPPTMediaPause:function(e,t){return n.callbacks.dispatch("onPPTMediaPause",(function(n){return n(e,t)}))},onPPTMediaPlay:function(e,t){return n.callbacks.dispatch("onPPTMediaPlay",(function(n){return n(e,t)}))}},this.viewsHubProxy=new ux({observerId:hn,forcePPTLandscape:!1,disalbeImageHit:!1,disableBoundlessEvent:!0,disableOthersSelectingBox:!1,cursorClass:null,cursorStyle:null,playerState:Object.freeze({isPlaying:!0,timestamp:0,playbackSpeed:1})}),k||(this.mainViewProxy=new ux({cameraBound:f,handToolActive:!1,divElement:null,disableCameraTransform:!!S}))}var t;return M(e,[{key:"enableWriteNow",get:function(){return!1}},{key:"deviceType",get:function(){return this.boundless.deviceType}},{key:"observerId",get:function(){return this.viewsHubProxy.state.observerId}},{key:"version",get:function(){return Bk.sdkVersion}},{key:"viewsHub",get:function(){return this.viewsHubProxy.owner}},{key:"useMultiViews",get:function(){return!this.mainViewProxy}},{key:"mainView",get:function(){return this.assertMainViewProxy().owner}},{key:"members",get:function(){return this._members}},{key:"memberStateStorage",get:function(){return this.viewsParams.memberStateStorage}},{key:"onScreenSizeUpdated",value:function(e){}},{key:"createWrappedComponents",value:function(){return[].concat(p(this.wrappedComponents),[RS(AS,this)])}},{key:"createPluginOperator",value:function(){return Object.freeze({remove:function(){throw new Error("it is not a writable room")},update:function(){throw new Error("it is not a writable room")},getPlugin:function(){throw new Error("it is not a writable room")}})}},{key:"scalePptToFit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:bd.Continuous,t=this.state.sceneState.scenes[this.state.sceneState.index];t.ppt&&this.moveCameraToContain({originX:-t.ppt.width/2,originY:-t.ppt.height/2,width:t.ppt.width,height:t.ppt.height,animationMode:e})}},{key:"scenePathType",value:function(e){var t=e.replace(/\/$/g,"").split("/");t.shift();var n=this.applianceManager.scenes.findSceneOrGroup(t),r=this.context.modules.WhiteModel.SceneNode;if(n&&ts(n,r))return CS.Page;if(n)return CS.Dir;for(;t.length>1;){t.pop();var i=this.applianceManager.scenes.findSceneOrGroup(t);if(i&&ts(i,r))return CS.Conflict}return CS.None}},{key:"entireScenes",value:function(){var e,t=this.applianceManager,n={},r=A(is(t.getAllScenePaths()));try{for(r.s();!(e=r.n()).done;){var i=e.value,a=is(t.getScene(i)),o=i.slice(0,-1),s="".concat("/").concat(o.join("/"));n[s]=n[s]||[],a&&n[s].push(a)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"refreshViewSize",value:function(){var e;this.autoResize||null==(e=this.viewsHubProxy.owner)||e.forEach((function(e){return e.resizeScreen()}))}},{key:"getCurrentSceneState",value:function(){for(var e=this.applianceManager,t=is(e.getCurrentScenePath()),n=MS.stringify(t),r=t.pop(),i=e.getSceneNames(t),a=MS.stringify(t),o=[],s=Number.NaN,c=0;c<i.length;++c){var u=i[c],l=e.getScene([].concat(p(t),[u]));(null==l?void 0:l.name)===r&&(s=c),o[c]=is(l)}return{sceneName:r,scenePath:n,contextPath:a,scenes:o,index:s}}},{key:"assignAttributes",value:function(e,t){if(this.context){var n=t;if(void 0===n||px(n)){var r=this.context.pluginManager.findPlugin(e);r&&px(r.defaultAttributes)&&(n=H(H({},r.defaultAttributes),n))}return n}}},{key:"hasLibraryNode",get:function(){return!!this.context}},{key:"getDefaultMemberState",value:function(){return{currentApplianceName:SS.pencil,strokeColor:[0,0,0],strokeWidth:4,textSize:16,bold:!1,italic:!1,underline:!1,lineThrough:!1}}},{key:"bezierCurvePainter",get:function(){return this.context?this.context.bezierCurvePainter:null}},{key:"getCursorStyleWithRadius",value:function(e){return 0===e?void 0:this.eraserRadiusCursor.cursorStyle(e)}},{key:"putPlayerState",value:function(e){var t=Object.freeze(H(H({},this.viewsHubProxy.state.playerState),e));this.viewsHubProxy.putState({playerState:t})}},{key:"updateLibraryNode",value:function(e){var t;this._members=new hx(this.applianceManager),this.membersMapper=null!=(t=this.membersMapper)?t:this._members.createMapper(this.covertMemberDisplayerToMember);var n=e.modules,r=n.WhiteRender,i=r.createDynamicPpt,a=r.EnginesHub,o=r.BezierCurvePainter,s=this.createPluginManager(n,this.pluginOperator,this.plugins),c=this.createBezierCurvePainter(o),u=i(_(H({},this.dynamicPptParams),{observerId:this.viewsHubProxy.state.observerId})),l=Object.freeze({appVersion:e.appVersion,applianceManager:this.applianceManager,members:this._members,pluginManager:s,dynamicPpt:u,bezierCurvePainter:c,engines:a&&new a(this.viewsParams.renderEngine),modules:n});if(this.viewsHubProxy.owner)this.viewsHubProxy.owner.updateContext(l);else{var h=this.viewsHubProxy.state,d=new sx(this.viewsParams,h,l);if(this.viewsHubProxy.updateOwner(d),this._views=new cx(d),this.mainViewProxy){var f=this.mainViewProxy.state,p=d.createView(f);p.mode=ix.Writable,this.mainViewProxy.updateOwner(p),this.cameraObserver.setupMainView(p),p.callbacks.forwardTo("onHandToolActive",this.callbacks),p.callbacks.forwardTo("onRenderDuration",this.callbacks)}}this.context=Object.freeze({modules:n,pluginManager:s,bezierCurvePainter:c}),this.refreshViewSize()}},{key:"createPluginManager",value:function(e,t,n){var r=new(0,e.WhiteRender.PluginManager)(n?n.plugins:{},t);return n&&n.setPluginManager(r),r}},{key:"createBezierCurvePainter",value:function(e){var t=null;if(e){var n=e;this.disablePencilWrittingLimitFrequency||(n=function(e){var t;return"getRectangle"in e.prototype?((t=function(e){y(r,e);var n=k(r);function r(){var e;return I(this,r),(e=n.apply(this,arguments)).cacheSegments={},e.cacheIdentifiers=[],e.isWrapped=!0,e}return M(r,[{key:"getPrecisionSegments",value:function(e){var t=c(C(r.prototype),"getPrecisionSegments",this).call(this,e);return t||(t=this.cacheSegments[e]||null),t}},{key:"completePainting",value:function(e){var t,n,i=c(C(r.prototype),"completePainting",this).call(this);i&&(e?(t=e.originX,n=e.originY):(t=i.left,n=i.top),this.cachePrecisionSegments(i.identifier,{points:i.points,beginIndex:i.beginIndex,left:t,top:n}));return i}},{key:"fireRemoveComponent",value:function(e){delete this.cacheSegments[e],c(C(r.prototype),"fireRemoveComponent",this).call(this,e)}},{key:"cachePrecisionSegments",value:function(e,n){if(!this.cacheSegments[e]){this.cacheSegments[e]=n,this.cacheIdentifiers.push(e);var r=t.maxCacheCount;if(this.cacheIdentifiers.length>r){var i=this.cacheIdentifiers.shift();delete this.cacheSegments[i]}}}}]),r}(e)).maxCacheCount=3,t):e}(e)),t=new n([.1,.3,.5,.7,.9,1])}return t}},{key:"refreshRender",value:function(){var e;null==(e=this.viewsHubProxy.owner)||e.forEach((function(e){return e.refreshRender()}))}},{key:"disableOthersSelectingBox",get:function(){return this.viewsHubProxy.state.disableOthersSelectingBox},set:function(e){this.viewsHubProxy.putState({disableOthersSelectingBox:e})}},{key:"views",get:function(){if(this.mainViewProxy)throw new Error("you can only read views when useMultiViews is true");if(!this._views)throw new Error("views is not ready");return this._views}},{key:"dispose",value:function(){var e,t,n;null==(e=this.viewsHubProxy.owner)||e.forEach((function(e){return e.release()})),this.eraserRadiusCursor.release(),this.invisiblePluginNode.dispose(),this.cameraObserver.dispose(),null==(t=this.membersMapper)||t.dispose(),this._members.dispose(),null==(n=this.memberStateStorage)||n.dispose()}},{key:"setObserverId",value:function(e){var t;(null==(t=this.viewsHubProxy.owner)?void 0:t.putState({observerId:e}))&&this.dynamicPpt.updateObserverId&&this.dynamicPpt.updateObserverId(e)}},{key:"dynamicPpt",get:function(){return this.viewsHubProxy.owner.dynamicPpt}},{key:"fetchNextPptSlideIfNeeded",value:function(e){var t;if(this.preloadDynamicPPT&&e.index+1<e.scenes.length){var n=null==(t=e.scenes[e.index+1].ppt)?void 0:t.src;this.dynamicPpt.getPptSildeDefinition(n||"")}}},{key:"getRoomMembers",value:function(){return this.membersMapper.targets}},{key:"getInvisiblePlugin",value:function(e){return this.invisiblePluginNode.get(e)}},{key:"dispatchMagixEventWithObject",value:function(e,t,n){var r=e;ke(r.payload)&&(r=_(H({},r),{payload:r.payload.primitiveBuffer})),this.magixEventsManager.dispatchEvent(r,t,n)}},{key:"addMagixEventListener",value:function(e,t,n){var r=this.standardizeOptions(n),i=!!r.fireSelfEventAfterCommit,a=r.fireInterval;void 0===a?this.magixEventsManager.addMagixEventListener(e,t,i):(a<500&&(this.logger.warn("fireInterval ".concat(a,"ms of event ").concat(JSON.stringify(e)," can't less than ").concat(500,"ms, it's will be reset as ").concat(500,"ms")),a=500),this.magixEventsManager.addMagixEventsListener(e,t,a,i))}},{key:"standardizeOptions",value:function(e){return void 0===e?{}:"number"==typeof e?{fireInterval:e}:e}},{key:"removeMagixEventListener",value:function(e,t){this.magixEventsManager.removeMagixEventListener(e,t)}},{key:"waitMagixEvent",value:function(e){return this.magixEventsManager.waitMagixEvent(e)}},{key:"memberState",value:function(e){return is(this.applianceManager.getMemberState(e))}},{key:"getMemberInformation",value:function(e,t){if(e.getMemberInformation)return e.getMemberInformation(t);var n,r=A(e.getMemberDisplayers());try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.memberId===t)return i.information}}catch(e){r.e(e)}finally{r.f()}}},{key:"assertMainViewProxy",value:function(){var e=this.mainViewProxy;if(!e)throw new Error("can not use these methods or properties. you should pass useMultiViews: false");return e}},{key:"scenePreview",value:function(e,t,n,r){var i=this.assertMainViewProxy().owner;i&&i.scenePreview(e,t,n,r)}},{key:"generateScreenshot",value:(t=l(regeneratorRuntime.mark((function e(t,n,r){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.assertMainViewProxy().owner.generateScreenshot(t,n,r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"fillSceneSnapshot",value:function(e,t,n,r){var i;null==(i=this.assertMainViewProxy().owner)||i.fillSceneSnapshot(e,t,n,r)}},{key:"convertToPointInWorld",value:function(e){var t=this.assertMainViewProxy().owner;return t?t.convertToPointInWorld(e):{x:e.x,y:e.y}}},{key:"handToolActive",get:function(){return this.assertMainViewProxy().state.handToolActive},set:function(e){this.assertMainViewProxy().putState({handToolActive:e})&&this.onlyCallbackRemoteStateModify&&this.callbacks.dispatch("onHandToolActive",(function(t){return t(e)}))}},{key:"handToolKey",get:function(){return this.assertMainViewProxy().state.handToolKey}},{key:"disableCameraTransform",get:function(){return this.assertMainViewProxy().state.disableCameraTransform},set:function(e){this.assertMainViewProxy().putState({disableCameraTransform:e})&&this.onlyCallbackRemoteStateModify&&this.callbacks.dispatch("onHandToolActive",(function(t){return t(e)}))}},{key:"bindHtmlElement",value:function(e){this.assertMainViewProxy().putState({divElement:e})}},{key:"setCameraBound",value:function(e){this.assertMainViewProxy().putState({cameraBound:e})}},{key:"moveCamera",value:function(e){this.assertMainViewProxy().putState({cameraMoving:{camera:e}})}},{key:"moveCameraToContain",value:function(e){this.assertMainViewProxy().putState({cameraMoving:{toContaint:e}})}}]),e}();!function(e){e.Connecting="connecting",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnecting="disconnecting",e.Disconnected="disconnected"}(vx||(vx={})),function(e){e.ThrowError="throwError",e.Warn="warn",e.Ignore="ignore"}(mx||(mx={}));var yx=X(n("lOZ2")),bx=function(){function e(t,n,r){I(this,e),this.enableDrawPoint=t,this.disableNewPencil=n,this.undoStack=r}return M(e,[{key:"becomeWritable",value:function(e){if(this.disableNewPencil){var t=e.getMemberState();if(t){var n=t.pencilOptions;n=n?_(H({},n),{disableBezier:!0}):{disableBezier:!0,enableDrawPoint:!1,sparseHump:3,sparseWidth:4};var r=e.setMemberStateWithCommitter({pencilOptions:n}).committer;r&&this.undoStack.commit(r)}}}},{key:"shouldUseNewPencil",value:function(e){return!this.disableNewPencil&&e===SS.pencil}}]),e}(),kx=Object.freeze({x:0,y:0});function wx(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}function Sx(e){return Math.pow(e.x,2)+Math.pow(e.y,2)}function xx(e,t){return{x:e.x+t.x,y:e.y+t.y}}function Cx(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{x:t.reduce((function(e,t){return e+t.x}),0),y:t.reduce((function(e,t){return e+t.y}),0)}}function Ix(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Px(e,t){return{x:e.x*t,y:e.y*t}}function Mx(e){var t=wx(e);return 0===t?e:function(e,t){return{x:e.x/t,y:e.y/t}}(e,t)}function Tx(e,t){return e.x*t.x+e.y*t.y}function Ax(e,t){if(e.length<2)return[];var n=e.length;return function e(t,n,r,i){if(2===t.length){var a=function(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}(t[0],t[1])/3;return[{curve:[t[0],xx(t[0],Px(n,a)),xx(t[1],Px(r,a)),t[1]],beginIndex:0,count:t.length}]}var o=function(e){var t,n,r,i=[];return e.forEach((function(e,a){t=a>0?n+wx(Ix(e,r)):0,i.push(t),n=t,r=e})),i=i.map((function(e){return 0===n?0:e/n}))}(t),s=h(Ex(t,o,o,n,r),3),c=s[0],u=s[1],l=s[2];if(0===u||u<i)return[{curve:c,beginIndex:0,count:t.length}];if(u<i*i)for(var d=o,f=u,v=l,m=0;m<20;m++){var g,y;if(d=Ox(c,t,d),g=Ex(t,o,d,n,r),y=h(g,3),c=y[0],u=y[1],l=y[2],u<i)return[{curve:c,beginIndex:0,count:t.length}];if(l===v){var b=u/f;if(b>.9999&&b<1.0001)break}f=u,v=l}var k=Ix(t[l-1],t[l+1]);if(0===k.x&&0===k.y){var w=Ix(t[l-1],t[l]),S=w.x,x=w.y;k={x:-x,y:S}}var C,I=Mx(k),P=Px(I,-1),M=e(t.slice(0,l+1),n,I,i),T=e(t.slice(l),P,r,i),E=A(T);try{for(E.s();!(C=E.n()).done;){C.value.beginIndex+=l}}catch(e){E.e(e)}finally{E.f()}return[].concat(p(M),p(T))}(e,Nx(e[1],e[0]),Nx(e[n-2],e[n-1]),t)}function Ex(e,t,n,r,i){var a=function(e,t,n,r){for(var i=e[0],a=e[e.length-1],o=[i,kx,kx,a],s=t.map((function(e){var t=1-e;return[Px(n,3*e*(t*t)),Px(r,3*t*(e*e))]})),c=[[0,0],[0,0]],u=[0,0],l=0,d=Array.from(t.entries());l<d.length;l++){var f=h(d[l],2),p=f[0],v=f[1],m=h(s[p],2),g=m[0],y=m[1];c[0][0]+=Tx(g,g),c[0][1]+=Tx(g,y),c[1][0]+=Tx(g,y),c[1][1]+=Tx(y,y);var b=Ix(e[p],Lx([i,i,a,a],v));u[0]+=Tx(g,b),u[1]+=Tx(y,b)}var k=c[0][0]*c[1][1]-c[1][0]*c[0][1],w=c[0][0]*u[1]-c[1][0]*u[0],S=u[0]*c[1][1]-u[1]*c[0][1],x=0===k?0:S/k,C=0===k?0:w/k,I=wx(Ix(i,a)),P=1e-6*I;return x<P||C<P?(o[1]=xx(i,Px(n,I/3)),o[2]=xx(a,Px(r,I/3))):(o[1]=xx(i,Px(n,x)),o[2]=xx(a,Px(r,C))),o}(e,n,r,i),o=h(function(e,t,n){for(var r=0,i=Math.floor(e.length/2),a=function(e,t){for(var n=[0],r=e[0],i=0,a=1;a<=t;a++){var o=Lx(e,a/t);i+=wx(Ix(o,r)),n.push(i),r=o}return n=n.map((function(e){return e/i}))}(t,10),o=1;o<e.length-1;o++){var s=e[o],c=Rx(t,n[o],a,10),u=Sx(Ix(Lx(t,c),s));u>r&&(r=u,i=o)}return[r,i]}(e,a,t),2);return[a,o[0],o[1]]}function Ox(e,t,n){return n.map((function(n,r){return function(e,t,n){var r=Ix(Lx(e,n),t),i=function(e,t){var n=1-t,r=Px(Ix(e[1],e[0]),3*Math.pow(n,2)),i=Px(Ix(e[2],e[1]),6*n*t),a=Px(Ix(e[3],e[2]),3*Math.pow(t,2));return Cx(r,i,a)}(e,n),a=Tx(r,i),o=Sx(i)+2*Tx(r,function(e,t){return xx(Px(xx(Ix(e[2],Px(e[1],2)),e[0]),6*(1-t)),Px(xx(Ix(e[3],Px(e[2],2)),e[1]),6*t))}(e,n));return 0===o?n:n-a/o}(e,t[r],n)}))}function Rx(e,t,n,r){if(t<0)return 0;if(t>1)return 1;for(var i=1;i<=r;i++)if(t<=n[i]){var a=(i-1)/r,o=i/r,s=n[i-1];return(t-s)/(n[i]-s)*(o-a)+a}return Number.NaN}function Nx(e,t){return Mx(Ix(e,t))}function Lx(e,t){var n=1-t;return Cx(Px(e[0],Math.pow(n,3)),Px(e[1],3*Math.pow(n,2)*t),Px(e[2],3*n*Math.pow(t,2)),Px(e[3],Math.pow(t,3)))}var jx=function(){function e(t){var n=this;I(this,e),this.onLimiterInvoke=function(){if(n.nextInvoker)try{n.nextInvoker()}finally{n.nextInvoker=void 0}},this.limiter=new Be(t,this.onLimiterInvoke)}return M(e,[{key:"limitDuration",get:function(){return this.limiter.limitDuration},set:function(e){this.limiter.limitDuration=e}},{key:"invoke",value:function(e){this.nextInvoker=e,this.limiter.invoke()}},{key:"flush",value:function(){this.nextInvoker&&this.onLimiterInvoke(),this.cancel()}},{key:"cancel",value:function(){this.nextInvoker=void 0,this.limiter.cancel()}}]),e}(),Dx=function(){function e(t,n,r,i,a){var o=this;I(this,e),this.paintingShape=null,this.extraSteups=0,this.lastCurveBeginIndex=0,this.points=[],this.commiter=null,this.onAddExtraSteups=function(){var e;null==(e=o.invoker)||e.flush(),o.applianceManager.addBezierCurveExtraSteups(),o.extraSteups+=1,o.extraSteups>=o.bezierCurvePainter.maxExtraSteups&&o.fountain.stop()},this.applianceManager=t,this.cameraObserver=n,this.pencilOptions=r,this.bezierCurvePainter=i,this.fountain=new zx(this.onAddExtraSteups),!a&&i.isWrapped?this.invoker=new jx(41):this.invoker=null}return M(e,[{key:"pushBoundlessMouseEvent",value:function(e,t){switch(this.commiter=null,e){case Kc.MouseDown:case Kc.SortedTouchStart:this.onMouseDown(t);break;case Kc.MouseMove:case Kc.SortedTouchMove:this.onMouseMove(t);break;case Kc.MouseUp:case Kc.SortedTouchEnd:case Kc.SortedTouchCancel:this.onMouseUp(t);break;case Kc.MouseLeave:this.onMouseLeave(t)}return this.commiter}},{key:"onMouseDown",value:function(e){var t=e.x,n=e.y;this.paintingShape||(this.paintingShape=this.createCurveShape(t,n),this.points.push(this.createStrokePoint(t,n)),this.fountain.touch())}},{key:"onMouseMove",value:function(e){if(this.paintingShape){var t=e.x,n=e.y;this.points.push(this.createStrokePoint(t,n)),this.fitCurvesIfNeed(),this.fountain.touch()}else this.applianceManager.onMouseMove(e)}},{key:"onMouseUp",value:function(e){var t,n=e.x,r=e.y;this.paintingShape&&(null==(t=this.invoker)||t.flush(),this.fountain.stop(),this.shouldCancelPaintingPencil()?this.applianceManager.cancelPencilPainting(n,r):this.commiter=this.applianceManager.completePencilPainting(n,r),this.bezierCurvePainter.completePainting(this.paintingShape),this.points=[],this.paintingShape=null)}},{key:"onMouseLeave",value:function(e){this.paintingShape||(this.commiter=this.applianceManager.onMouseLeave(e))}},{key:"createStrokePoint",value:function(t,n){var r=this.points[this.points.length-1],i=0;if(r){var a=t-r.x,o=n-r.y;i=r.distance+Math.sqrt(a*a+o*o)}return this.points.length<e.maxSegmentsPointsCount?this.bezierCurvePainter.pushPoint(t,n):this.bezierCurvePainter.touchPoint(t,n),{x:t,y:n,distance:i}}},{key:"createCurveShape",value:function(e,t){var n=this.applianceManager.createBezierCurve({x:e,y:t}),r=Co(n);return this.bezierCurvePainter.startPainting(r),this.paintingShape=n,this.extraSteups=0,this.lastCurveBeginIndex=0,n}},{key:"fitCurvesIfNeed",value:function(){var t=this;if(this.points.length>1){var n=0;this.extraSteups>0&&(this.extraSteups-=1,n=1),this.invoker&&this.points.length<e.maxSegmentsPointsCount?this.invoker.invoke((function(){return t.syncCurve(n)})):this.syncCurve(n)}}},{key:"syncCurve",value:function(t){var n=e.fitCurveMaxError/this.cameraObserver.cameraState.scale,r=Ax(this.points.slice(this.lastCurveBeginIndex),Math.pow(n,2));if(1===r.length){var i=r[0].curve,a=this.points.length-this.lastCurveBeginIndex,o=this.createBezierCurve(i,0,a);this.applianceManager.updateBezierCurveTail(o,t)}else if(r.length>1){var s,c=0,u=[],l=A(r);try{for(l.s();!(s=l.n()).done;){var h=s.value,d=h.curve,f=h.beginIndex,p=h.count;u.push(this.createBezierCurve(d,f,p)),c=Math.max(c,f)}}catch(e){l.e(e)}finally{l.f()}this.lastCurveBeginIndex+=c,this.applianceManager.splitBezierCurveTail(u,t)}}},{key:"shouldCancelPaintingPencil",value:function(){if(!this.paintingShape||this.pencilOptions.enableDrawPoint)return!1;if(this.bezierCurvePainter.getRectangle){var e=Co(this.paintingShape),t=this.bezierCurvePainter.getRectangle(e);if(t){var n=this.paintingShape.hitTestingBoxMargin/5,r=t.width,i=t.height;if(r>n||i>n)return!1}return!0}return this.paintingShape.isLikePoint()}},{key:"createBezierCurve",value:function(e,t,n){var r=n-2,i=this.points[t],a=this.points[t+n-1];return{point1:e[1],point2:e[2],point3:e[3],hiddenPoints:r,cubic:this.fitCubic(t,n),distance:a.distance-i.distance}}},{key:"fitCubic",value:function(t,n){var r=null,i=this.points[t].distance,a=this.points[t+n-1].distance-i;if(n>=3&&a>0){for(var o=[],s=[],c=0;c<n;++c){var u=this.points[t+c].distance;o[c]=(u-i)/a,s[c]=c/(n-1)}r=e.getLinearRegression(o,s)}return r||(r=p(e.defaultCubic)),r}}],[{key:"getLinearRegression",value:function(e,t){for(var n=null,r=0,i=0,a=0,o=0,s=0,c=1;c<e.length;++c){var u=e[c],l=t[c];if(0!==u){var h=u*u,d=l/h;r+=d,i+=u,a+=h,o+=d*u,s+=1}}if(s>2){var f=i/s,p=r/s,v=(o-p*f)/(a-i*i/s),m=p-v*f,g=m+v;n=[m/g,v/g,0,0]}return n}}]),e}(),Fx=Dx;Fx.fitCurveMaxError=1,Fx.maxSegmentsPointsCount=350,Fx.defaultCubic=Object.freeze(Dx.getLinearRegression([0,.2,.4,.6,.8,1],[0,.2,.4,.6,.8,1]));var zx=function(){function e(t){var n=this;I(this,e),this.onGush=t,this.sleepTimer=null,this.gushInterval=null,this.onTick=function(){n.sleepTimer=null,n.gushInterval=setTimeout(n.onTick,e.GushInterval),n.onGush()}}return M(e,[{key:"touch",value:function(){this.gushInterval&&(clearTimeout(this.gushInterval),this.gushInterval=null),this.sleepTimer&&clearTimeout(this.sleepTimer),this.sleepTimer=setTimeout(this.onTick,e.SleepDuration)}},{key:"stop",value:function(){this.gushInterval&&(clearTimeout(this.gushInterval),this.gushInterval=null),this.sleepTimer&&(clearTimeout(this.sleepTimer),this.sleepTimer=null)}}]),e}();zx.SleepDuration=68,zx.GushInterval=17;var Bx,Ux=function(){function e(t){I(this,e),this.inputs={},this.outputs={},this.previousId=0,this.pressedInputId="",this.isPressed=!1,this.output=void 0,this.outputSwitch=t}return M(e,[{key:"createInput",value:function(){var e=this,t="".concat(this.previousId+=1),n=Object.freeze({id:t,pushEvent:function(n){return e.pushEventByInput(t,n)}});return this.inputs[t]={input:n,isPressed:!1},n}},{key:"removeInput",value:function(e){var t=this.inputs[e.id];(null==t?void 0:t.input)===e&&(delete this.inputs[e.id],this.pressedInputId=e.id,this.pressedInputId&&(this.pressedInputId=""))}},{key:"putOutput",value:function(e,t){this.outputs[e]=t}},{key:"pushEventByInput",value:function(e,t){var n=this.inputs[e];switch(t.kind){case Kc.MouseDown:case Kc.SortedTouchStart:n.isPressed=!0,this.isPressed=!0,""===this.pressedInputId&&(this.pressedInputId=e,this.pushEvent(n.input,t));break;case Kc.MouseMove:case Kc.MouseLeave:case Kc.SortedTouchMove:(""===this.pressedInputId&&!n.isPressed||this.pressedInputId===e)&&this.pushEvent(n.input,t);break;case Kc.MouseUp:case Kc.SortedTouchEnd:case Kc.SortedTouchCancel:this.pressedInputId===e&&(this.pressedInputId="",this.pushEvent(n.input,t)),n.isPressed=!1,this.isPressed=!1}}},{key:"pushEvent",value:function(e,t){var n,r=this.outputSwitch(e),i=this.outputs[r];if(void 0===this.output||this.output!==r){var a=void 0!==this.output?this.outputs[this.output]:void 0;this.output=r,this.isPressed&&(null==(n=null==a?void 0:a.onCancel)||n.call(a,t,e),null==i||i.onEvent(t,e))}else null==i||i.onEvent(t,e)}}]),e}(),Vx=X(n("0yMQ")),Wx=function(){function e(t,n){var r=this;I(this,e),this.isReadonlyMode=!1,this.isOverrideWithFreedom=!1,this.overrideDisposer=null,this.previousRectangle=null,this.onCreatedView=function(e){r.previousRectangle&&r.refreshScreenRectangle(e,r.previousRectangle)},this.viewsHub=t,this.applianceManager=n,this.followerCheckingDisposer=(0,Vx.reaction)((function(){return r.getCurrentMode()===HS.Follower}),(function(e){e?r.refreshCameraRectangle():r.previousRectangle=null})),t.callbacks.on("onCreatedView",this.onCreatedView),(0,Vx.makeObservable)(this,{isReadonlyMode:Vx.observable,isOverrideWithFreedom:Vx.observable,setReadonlyMode:Vx.action,overrideWithFreedom:Vx.action})}return M(e,[{key:"release",value:function(){this.overrideDisposer&&(this.overrideDisposer(),this.overrideDisposer=null),this.viewsHub.callbacks.off("onCreatedView",this.onCreatedView),this.followerCheckingDisposer()}},{key:"setReadonlyMode",value:function(e){this.isReadonlyMode!==e&&(this.isReadonlyMode=e,this.overrideDisposer&&!e&&(this.overrideDisposer(),this.overrideDisposer=null))}},{key:"overrideWithFreedom",value:function(e){var t=this;this.isReadonlyMode&&this.isOverrideWithFreedom!==e&&(this.isOverrideWithFreedom=e,e?this.overrideDisposer=(0,Vx.when)((function(){return t.applianceManager.getViewState().mode===HS.Freedom}),(function(){t.isReadonlyMode&&t.isOverrideWithFreedom&&(t.isOverrideWithFreedom=!1),t.overrideDisposer=null})):this.overrideDisposer&&(this.overrideDisposer(),this.overrideDisposer=null))}},{key:"getBroadcastState",value:function(){var e=this.applianceManager.getBroadcasterId();return{mode:this.getCurrentMode(),broadcasterId:e}}},{key:"getCurrentMode",value:function(){return this.isReadonlyMode&&this.isOverrideWithFreedom?HS.Freedom:this.applianceManager.getViewState().mode}},{key:"refreshCameraRectangle",value:function(){var e=this,t=this.applianceManager.getViewState(),n=t.originX,r=t.originY,i=t.width,a=t.height,o={originX:n,originY:r,width:i,height:a};(!this.previousRectangle||this.previousRectangle.originX!==n||this.previousRectangle.originY!==r||this.previousRectangle.width!==i||this.previousRectangle.height!==a)&&(this.viewsHub.forEach((function(t){return e.refreshScreenRectangle(t,o)})),this.previousRectangle=o)}},{key:"refreshScreenRectangle",value:function(e,t){var n=e.mode;(n===ix.Writable||n===ix.FollowSceneAndCamera)&&e.screen.adaptRectangle(_(H({},t),{animationMode:bd.Continuous,adapterMode:pd.Centering}))}}]),e}(),Hx=function(){function e(t,n){I(this,e),this.deviceType=t,this.screenType=n,this.previousPoint={x:0,y:0},this.previousTimestamp=0,this.currentSpeed=0,this.isPressed=!1}return M(e,[{key:"radius",value:function(e,t,n){switch(this.updatePressed(t,n),this.deviceType){case ld.Touch:return 36/mw(this.screenType);default:return e===SS.eraser?this.getSpeedRaidus():0}}},{key:"updatePressed",value:function(e,t){if(this.isPressed!==t&&(this.isPressed=t,t?(this.previousPoint.x=0,this.previousPoint.y=0,this.previousTimestamp=Date.now(),this.currentSpeed=0):this.currentSpeed=0),t){var n=Date.now(),r=e.x-this.previousPoint.x,i=e.y-this.previousPoint.y,a=n-this.previousTimestamp,o=0===a?0:Math.sqrt(r*r+i*i)/a;this.previousPoint.x=e.x,this.previousPoint.y=e.y,this.previousTimestamp=n,this.currentSpeed=(o+this.currentSpeed)/2}}},{key:"getSpeedRaidus",value:function(){var e=this.currentSpeed;e>4.35?e=4.35:e<.45&&(e=.45);return 90*(e-.45)/(4.35-.45)/mw(this.screenType)}}]),e}();!function(e){e[e.Down=0]="Down",e[e.Move=1]="Move",e[e.Up=2]="Up",e[e.Leave=3]="Leave"}(Bx||(Bx={}));var _x,Gx=function(){function e(t,n){var r=this;I(this,e),this.invoker=new jx(100),this.latestHitTestIdentifies=[],this.isPressed=!1,this.onStart=function(e){var t=r.getProxyEventKind(e),n=r.createProxyEvent(e,0);if(n&&(r.pushProxyEvent(n),2===t)){var i=r.createProxyEvent(e,2);i&&r.pushProxyEvent(i)}},this.onEvent=function(e){var t=r.createProxyEvent(e);t&&r.pushProxyEvent(t)},this.onCancel=function(e){var t=r.createProxyEvent(e,2);t&&r.pushProxyEvent(t)},this.radiusSelector=t,this.delegate=n}return M(e,[{key:"release",value:function(){this.invoker.cancel()}},{key:"pushProxyEvent",value:function(e){var t=this;switch(e.boundlessEvent.kind){case Kc.MouseDown:this.invoker.limitDuration=17,this.isPressed=!0;break;case Kc.MouseUp:this.invoker.limitDuration=100,this.isPressed=!1}switch(e.kind){case 0:this.invoker.limitDuration=17;break;case 2:this.invoker.limitDuration=100}var n=e.mouseEvent.hitTestIdentifies;e.boundlessEvent.kind!==Kc.MouseMove||this.isHitTestIdentifiesDifferent(n)?(this.invoker.cancel(),this.callbackReceiveMouseEvent(e)):this.invoker.invoke((function(){return t.callbackReceiveMouseEvent(e)})),this.latestHitTestIdentifies=n}},{key:"callbackReceiveMouseEvent",value:function(e){var t=e.kind,n=e.eraserRadius,r=e.mouseEvent;this.onReceviedMouseEvent&&this.onReceviedMouseEvent(t,n,r)}},{key:"createProxyEvent",value:function(e,t){var n=null,r=this.delegate.getWritableScreen();if(r){var i,a=0,o=this.delegate.getCurrentApplianceName(),s=e.pointOnScreen,c=null!=t?t:this.getProxyEventKind(e);if(o===SS.selector||o===SS.eraser){var u=this.radiusSelector.radius(o,s,this.isPressed);this.isPressed&&o===SS.eraser&&(a=u),i=r.hitTest(s.x,s.y,u)}else i=[];n={kind:c,eraserRadius:a,applianceName:o,mouseEvent:this.createMouseEvent(r,e,i),boundlessEvent:e}}return n}},{key:"createMouseEvent",value:function(e,t,n){var r,i=t.nativeEvent;if(i&&i.target){var a=e.findComponentWithTarget(i.target);a&&(r=this.delegate.getTargetsMap(a,i))}return r||(r={}),{x:t.pointOnScene.x,y:t.pointOnScene.y,targetsMap:r,hitTestIdentifies:n}}},{key:"getProxyEventKind",value:function(e){switch(e.kind){case Kc.MouseDown:case Kc.SortedTouchStart:return 0;case Kc.MouseMove:case Kc.SortedTouchMove:return 1;case Kc.MouseUp:case Kc.SortedTouchEnd:case Kc.SortedTouchCancel:return 2;case Kc.MouseLeave:return 3;default:throw new Error("invalid kind ".concat(e.kind))}}},{key:"isHitTestIdentifiesDifferent",value:function(e){var t=this.latestHitTestIdentifies.length!==e.length;if(!t)for(var n=0;n<e.length;++n){if(t=e[n]!==this.latestHitTestIdentifies[n])break}return t}}]),e}(),Yx=function(){function e(t,n){I(this,e),this.eventsInput=t,this.convertPointToScene=n}return M(e,[{key:"inputDown",value:function(e,t){this.pushEvent(Kc.MouseDown,e,t)}},{key:"inputMove",value:function(e,t){this.pushEvent(Kc.MouseMove,e,t)}},{key:"inputUp",value:function(e,t){this.pushEvent(Kc.MouseUp,e,t)}},{key:"pushEvent",value:function(e,t,n){var r={kind:e,isOnScreen:!0,pointOnScreen:{x:t,y:n},pointOnScene:this.convertPointToScene(t,n)};this.eventsInput.pushEvent(r)}}]),e}();!function(e){e[e.Hand=0]="Hand",e[e.NewPencil=1]="NewPencil",e[e.Others=2]="Others",e[e.Ignore=3]="Ignore"}(_x||(_x={}));var Xx,qx,Qx=function(){function e(t){var n=this;I(this,e),this.views2Inputs={},this.inputs2Views={},this.onCreatedView=function(e){var t=n.eventChannel.createInput();n.views2Inputs[e.id]=t,n.inputs2Views[t.id]=e},this.onReleasedView=function(e){var t=n.views2Inputs[e.id];t&&(delete n.views2Inputs[e.id],delete n.inputs2Views[t.id],n.eventChannel.removeInput(t))},this.onBoundlessEvent=function(e,t){var r;switch(t.kind){case Kc.MouseDown:case Kc.MouseMove:case Kc.MouseUp:case Kc.MouseLeave:case Kc.SortedTouchStart:case Kc.SortedTouchMove:case Kc.SortedTouchEnd:case Kc.SortedTouchCancel:null==(r=n.views2Inputs[e.id])||r.pushEvent(t);break;case Kc.KeyDown:case Kc.KeyUp:e===n.viewsHub.writableView&&n.onKeyPressed(t)}},this.onReceviedPencilMouseEvent=function(e,t,r){var i;switch(e){case Bx.Down:i=Kc.MouseDown;break;case Bx.Move:i=Kc.MouseMove;break;case Bx.Up:i=Kc.MouseUp;break;case Bx.Leave:i=Kc.MouseLeave}var a=n._bezierPencilAppliance.pushBoundlessMouseEvent(i,r);a&&n.onCommit(a)},this.onReceviedOthersMouseEvent=function(e,t,r){var i=null;switch(e){case Bx.Down:i=n.magix.trigger.onMouseDown(r);break;case Bx.Move:i=n.magix.trigger.onMouseMove(r);break;case Bx.Up:i=n.magix.trigger.onMouseUp(r);break;case Bx.Leave:i=n.magix.trigger.onMouseLeave(r)}n.viewsHub.putState({cursorStyle:n.getCursorStyleWithRadius(t)}),i&&n.onCommit(i)},this.magix=t.magix,this.viewsHub=t.viewsHub,this.pencilOptions=t.pencilOptions,this.getCursorStyleWithRadius=t.getCursorStyleWithRadius,this.onKeyPressed=t.onKeyPressed,this.onCommit=t.onCommit,this.onReceivedHandMouseEvent=t.onReceivedHandMouseEvent,this.onHandMouseEventCompleted=t.onHandMouseEventCompleted;var r=new Hx(t.deviceType,t.screenType),i={isWorking:function(){return n.magix.phase===pc.Connected},getWritableScreen:function(){return n.viewsHub.writableView&&n.viewsHub.writableView.screen},getCurrentApplianceName:function(){return n.magix.trigger.getMemberState().currentApplianceName},getTargetsMap:function(e,t){var r;return null==(r=n.viewsHub.writableView)?void 0:r.getTargetsMap(e,t)}};this._viewStateObserver=new Wx(this.viewsHub,this.magix.trigger),this._bezierPencilAppliance=new Fx(this.magix.trigger,t.cameraObserver,this.pencilOptions,t.bezierCurvePainter,t.disablePencilWrittingLimitFrequency),this.pencilChannel=new Gx(r,i),this.othersChannel=new Gx(r,i),this.eventChannel=this.createEventsChannel(),this.viewsHub.callbacks.on("onBoundlessEvent",this.onBoundlessEvent),this.viewsHub.callbacks.on("onCreatedView",this.onCreatedView),this.viewsHub.callbacks.on("onReleasedView",this.onReleasedView),this.viewsHub.forEach((function(e){return n.onCreatedView(e)})),this.pencilChannel.onReceviedMouseEvent=this.onReceviedPencilMouseEvent,this.othersChannel.onReceviedMouseEvent=this.onReceviedOthersMouseEvent,this.customEventInput=this.eventChannel.createInput(),this.customInput=new Yx(this.customEventInput,t.convertPointToScene)}return M(e,[{key:"viewStateObserver",get:function(){return this._viewStateObserver}},{key:"bezierPencilAppliance",get:function(){return this._bezierPencilAppliance}},{key:"release",value:function(){this._viewStateObserver.release(),this.pencilChannel.release(),this.othersChannel.release(),this.viewsHub.callbacks.off("onBoundlessEvent",this.onBoundlessEvent),this.viewsHub.callbacks.off("onCreatedView",this.onCreatedView),this.viewsHub.callbacks.off("onReleasedView",this.onReleasedView)}},{key:"createEventsChannel",value:function(){var e=this,t=new Ux((function(t){if(t.id===e.customEventInput.id||e.inputs2Views[t.id]===e.viewsHub.writableView){var n=e.magix.trigger.getMemberState().currentApplianceName;return n===SS.hand?0:e.pencilOptions.shouldUseNewPencil(n)?1:2}return 3}));return t.putOutput(1,this.pencilChannel),t.putOutput(2,this.othersChannel),t.putOutput(0,{onEvent:this.onReceivedHandMouseEvent,onCancel:this.onHandMouseEventCompleted}),t}}]),e}(),Kx=function(){function e(t){I(this,e),this.lastCommitValues={},this.sumNodes={},this.maxValues={},this.minValues={},this.lastCommitTimestamp=Date.now(),this.backgroundValues=Object.freeze(H({},t))}return M(e,[{key:"report",value:function(){var e={},t={},n={};for(var r in this.backgroundValues){var i=this.backgroundValues[r],a=this.sumNodes[r],o=this.maxValues[r],s=this.minValues[r];if(void 0===a)e[r]=i;else if(void 0===a.otherValueSum)e[r]=a.firstValue;else{var c=this.lastCommitTimestamp-a.beginAt,u=c/a.count,l=a.firstValue*u+a.otherValueSum,h=u+c;e[r]=h>0?l/h:i}t[r]=void 0===o?i:o,n[r]=void 0===s?i:s}return this.lastCommitTimestamp=Date.now(),this.sumNodes={},this.maxValues={},this.minValues={},{averageValues:e,maxValues:t,minValues:n}}},{key:"clean",value:function(){for(var e in this.lastCommitTimestamp=Date.now(),this.sumNodes={},this.maxValues={},this.minValues={},this.lastCommitValues)delete this.lastCommitValues[e]}},{key:"commit",value:function(e){var t=Date.now();this.commitSumValues(t,e),this.commitMaxAndMinValues(e),this.lastCommitTimestamp=t}},{key:"commitSumValues",value:function(e,t){for(var n in t)void 0!==t[n]&&(this.lastCommitValues[n]=t[n]);for(var r in this.lastCommitValues){var i=this.lastCommitValues[r],a=this.sumNodes[r];void 0===a?this.sumNodes[r]={beginAt:e,firstValue:i,count:1,otherValueSum:i}:(a.count+=1,void 0===a.otherValueSum?a.otherValueSum=i*(e-a.beginAt):a.otherValueSum+=i*(e-this.lastCommitTimestamp))}}},{key:"commitMaxAndMinValues",value:function(e){for(var t in e){var n=e[t],r=this.maxValues[t],i=this.minValues[t];this.maxValues[t]=void 0===r?n:Math.max(r,n),this.minValues[t]=void 0===i?n:Math.min(i,n)}}}]),e}(),Zx=function(){function e(t){var n=this,r=t.connection,i=t.disconnection,a=t.sample;I(this,e),this.statisticsTimer=null,this.onReportStatistics=function(){n.statisticsTimer=null,n.latestReportAt=Date.now();var e=n.statistics.report(),t=e.maxValues,r=e.minValues,i=e.averageValues;n.sampleCommitter.commit({maxRTT:t.rtt,minRTT:r.rtt,averageRTT:i.rtt,maxQueue:t.illusionQueueLength,minQueue:r.illusionQueueLength,averageQueue:i.illusionQueueLength,maxInterval:t.frameReceivedInterval,minInterval:r.frameReceivedInterval,averageInterval:i.frameReceivedInterval})},this.connectionCommitter=r,this.disconnectionCommitter=i,this.sampleCommitter=a,this.statistics=new Kx({rtt:0,frameReceivedInterval:0,illusionQueueLength:0})}return M(e,[{key:"commitConnection",value:function(e){this.connectionCommitter.commit(e)}},{key:"commitDisconnection",value:function(e){this.disconnectionCommitter.commit(e)}},{key:"commitStatistics",value:function(t){if(void 0===this.latestReportAt&&(this.latestReportAt=Date.now()),null===this.statisticsTimer){var n=this.latestReportAt+e.reportStatisticsInterval-Date.now();n<0&&(n=e.reportStatisticsInterval,this.statistics.clean()),this.statisticsTimer=setTimeout(this.onReportStatistics,n)}this.statistics.commit(t)}},{key:"stop",value:function(){null!==this.statisticsTimer&&(clearTimeout(this.statisticsTimer),this.statisticsTimer=null)}}]),e}();Zx.reportStatisticsInterval=6e4,(qx=Xx||(Xx={})).Hand="cursor-hand",qx.HandGrasp="cursor-hand-grasp",qx.LaserPointer="cursor-laserPointer",qx.Selector="cursor-selector",qx.Pencil="cursor-pencil",qx.Eraser="cursor-eraser",qx.Rectangle="cursor-rectangle",qx.Ellipse="cursor-ellipse",qx.Shape="cursor-shape",qx.Straight="cursor-straight",qx.Arrow="cursor-arrow",qx.Text="cursor-text",qx.Nwse="cursor-nwse",qx.Nesw="cursor-nesw",qx.Ns="cursor-ns",qx.Ew="cursor-ew",qx.Ban="ban";var Jx=Object.freeze((o(a={},Xx.Hand,Object.freeze(["url(".concat(Hw["hand-loosen"],") 7 7, auto;"),"-webkit-image-set(url(".concat(Hw["hand-loosen"],") 7 7, auto);")])),o(a,Xx.HandGrasp,Object.freeze(["url(".concat(Hw["hand-grasp"],") 6 6, auto;"),"-webkit-image-set(url(".concat(Hw["hand-grasp"],") 6 6, auto);")])),o(a,Xx.LaserPointer,Object.freeze(["url(".concat(Hw["laser-pointer-cursor"],") 14 14, auto;"),"-webkit-image-set(url(".concat(Hw["laser-pointer-cursor"],") 14 14, auto);")])),o(a,Xx.Selector,Object.freeze(["url(".concat(Hw["selector-cursor"],") 5 4, auto;"),"-webkit-image-set(\n            url(".concat(Hw["selector-cursor"],") 1x,\n            url(").concat(Hw["selector-cursor@2x"],") 2x) 5 4, auto;")])),o(a,Xx.Pencil,Object.freeze(["url(".concat(Hw["pencil-cursor"],") 2 22, auto;"),"-webkit-image-set(\n            url(".concat(Hw["pencil-cursor"],") 1x,\n            url(").concat(Hw["pencil-cursor@2x"],") 2x) 2 22, auto;")])),o(a,Xx.Eraser,Object.freeze(["url(".concat(Hw["easer-cursor"],") 8 18, auto;"),"-webkit-image-set(\n            url(".concat(Hw["easer-cursor"],") 1x,\n            url(").concat(Hw["easer-cursor@2x"],") 2x) 8 18, auto;")])),o(a,Xx.Rectangle,Object.freeze(["crosshair;"])),o(a,Xx.Ellipse,Object.freeze(["crosshair;"])),o(a,Xx.Shape,Object.freeze(["crosshair;"])),o(a,Xx.Straight,Object.freeze(["crosshair;"])),o(a,Xx.Arrow,Object.freeze(["crosshair;"])),o(a,Xx.Text,Object.freeze(["text;"])),o(a,Xx.Nwse,Object.freeze(["nwse-resize;"])),o(a,Xx.Nesw,Object.freeze(["nesw-resize;"])),o(a,Xx.Ns,Object.freeze(["ns-resize;"])),o(a,Xx.Ew,Object.freeze(["ew-resize;"])),o(a,Xx.Ban,Object.freeze(["not-allowed"])),a)),$x=new(function(){function e(){I(this,e),this.isInjected=!1}return M(e,[{key:"injectDefaultStyleIfNotInjectBefore",value:function(){this.isInjected||(this.injectToDom(Jx),this.isInjected=!0)}},{key:"injectCustomStyle",value:function(e){if(this.isInjected)throw new Error("cannot be called repeatedly, or after new WhiteWebSdk().");var t=H(H({},Jx),e);this.injectToDom(t),this.isInjected=!0}},{key:"injectToDom",value:function(e){if(Object.keys(e).length>0){var t=document.createElement("style"),n=[];for(var r in e){var i=e[r];if(i){var a=".netless-whiteboard.".concat(r," {\n                        ").concat(i.map((function(e){return"cursor: ".concat(e)})).join(""),"\n                    }");n.push(a)}}t.appendChild(document.createTextNode(n.join("")));var o=document.head;o&&o.appendChild(t)}}}]),e}());function eC(e){$x.injectCustomStyle(e)}var tC=X(n("0yMQ")),nC=function(){function e(t){I(this,e),this.useMobX=t}return M(e,[{key:"filter",value:function(e){return this.useMobX?this.copyValue(e):e}},{key:"copyValue",value:function(e){return"object"!=T(e)||null===e?e:(0,tC.isObservableObject)(e)?this.copyObservableObject(e):(0,tC.isObservableArray)(e)||e instanceof Array?this.copyArray(e):this.copyObject(e)}},{key:"copyObservableObject",value:function(e){var t,n={},r=A((0,tC.keys)(e));try{for(r.s();!(t=r.n()).done;){var i=t.value;n[i]=this.copyValue(e[i])}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"copyArray",value:function(e){for(var t=[],n=e.length,r=0;r<n;++r)t[r]=this.copyValue(e[r]);return t}},{key:"copyObject",value:function(e){var t={};for(var n in e)t[n]=this.copyValue(e[n]);return t}}]),e}(),rC=function(){function e(t,n,r){var i=this;I(this,e),this.queue=[],this.limiter=new Be(n,(function(){var e=i.queue.shift();if(e){try{r(e.event,e.payload)}catch(e){t.error(e)}i.queue.length>0&&i.limiter.invoke()}}))}return M(e,[{key:"dispatch",value:function(e,t){this.queue.push({event:e,payload:t}),this.limiter.invoke()}}]),e}();function iC(e){if("object"==T(e)){if(null===e)return null;if(e instanceof Array)return e.map((function(e){return iC(e)}));var t={};for(var n in e){var r=iC(e[n]);void 0!==r&&(t[n]=r)}return t}return"function"==typeof e?void 0:e}var aC="modules",oC=function(){function e(t){var n=this;I(this,e),this.writingBuffer=null,this.invoker=function(){var e=n.writingBuffer;e&&l(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.limiter.freeze(),t.prev=1,r={uid:n.uid,timestamp:Date.now(),memberState:e},t.next=5,n.write(n.uuid,JSON.stringify(r));case 5:return t.prev=5,n.limiter.unfreeze(),t.finish(5);case 8:case"end":return t.stop()}}),t,null,[[1,,5,8]])})))().catch((function(e){return console.error(e)}))},this.uid=t,this.limiter=new Be(500,this.invoker)}var t,n,r;return M(e,[{key:"getMemberState",value:(r=l(regeneratorRuntime.mark((function e(t,n){var r,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.read(t);case 2:if(!(r=e.sent)){e.next=7;break}if((i=JSON.parse(r)).uid!==n){e.next=7;break}return e.abrupt("return",this.writingBuffer=i.memberState);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"setMemberState",value:function(e){var t={currentApplianceName:e.currentApplianceName,strokeColor:e.strokeColor,strokeWidth:e.strokeWidth,textSize:e.textSize,bold:e.bold,italic:e.italic,underline:e.underline,lineThrough:e.lineThrough};for(var n in t)void 0===t[n]&&delete t[n];this.limiter.invoke(),this.writingBuffer=H(H({},this.writingBuffer),iC(t))}},{key:"dispose",value:function(){this.limiter.cancel(),this.writingBuffer=null}},{key:"read",value:(n=l(regeneratorRuntime.mark((function t(n){var r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dbp;case 2:return r=t.sent.transaction([aC],"readonly").objectStore(aC).get(n),t.next=5,sC(r);case 5:return i=t.sent,t.abrupt("return",("string"!=typeof i&&(i=void 0),i));case 7:case"end":return t.stop()}}),t)}))),function(e){return n.apply(this,arguments)})},{key:"write",value:(t=l(regeneratorRuntime.mark((function t(n,r){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.dbp;case 2:return i=t.sent.transaction([aC],"readwrite").objectStore(aC).put(r,n),t.next=5,sC(i);case 5:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})}],[{key:"dbp",get:function(){if(!this._dbp){var e=indexedDB.open("__netlessMemberState",1);e.onupgradeneeded=function(e){e.target.result.createObjectStore(aC)},this._dbp=sC(e)}return this._dbp}}]),e}();function sC(e){return new Promise((function(t,n){e.onsuccess=function(){return t(e.result)},e.onerror=function(){if(e.error){var t=new Error(e.error.message);t.name=e.error.name,n(t)}else n(new Error("failed with null Error"))}}))}var cC,uC,lC,hC,dC=function(e){y(u,e);var t,n,r,i,a,o,s=k(u);function u(e){var t;return I(this,u),(t=s.call(this,{logger:e.whiteLogger,region:e.region,useMobXState:e.useMobXState,screenType:e.screenType,renderEngine:e.renderEngine,boundless:e.boundless,cameraBound:e.cameraBound,autoResize:e.autoResize,plugins:e.plugins,invisiblePlugins:e.invisiblePlugins,wrappedComponents:e.wrappedComponents,preloadDynamicPPT:e.preloadDynamicPPT,disableCameraTransform:e.disableCameraTransform,useMultiViews:e.useMultiViews,userFonts:e.userFonts,handToolKey:e.handToolKey,fontFamily:e.fontFamily,memberStateStorage:e.disableKeepMemberState?void 0:new oC(e.userPayload.uid),onlyCallbackRemoteStateModify:e.onlyCallbackRemoteStateModify,pptHandler:{onPageJumpTo:function(e,n){return t.pptJumpTo(e,n)},onPageToNext:function(){return t.nextPpt()},onPageToPrev:function(){return t.previousPpt()}},textareaHub:e.floatBarOptions&&new Aw,floatBarClass:e.floatBarOptions&&mC,globalStateUpdater:function(e){return t.setGlobalState(e)},disableOperations:!1,disableOthersSelectingBox:e.disableOthersSelectingBox,willHideSelfCursor:!0,cursorAdapter:e.cursorAdapter,eraserRadiusCursor:e.eraserRadiusCursor,eventInterrupter:function(e){return t.willInterruptEvent(e)},urlInterrupter:e.urlInterrupter,onTextareaUpdate:function(e,n,r){t.magix.isWritable&&(t.applianceManager.updateTextarea(e,n),t.undoStack.onTextareaUpdate(!!r))},callbacks:e.callbacks,pptParams:e.pptParams,userPayload:e.userPayload})).apiFetch=aw.fetch("api"),t._phase=vx.Connecting,t._isWritable=!1,t._enableWriteNow=!1,t.isEraser=!1,t.writableView=null,t.copyBuffer=null,t.beginReconnectAt=0,t.isHandGrasp=!1,t.onWritableScreenChanged=function(e){t.writableView!==e&&(t.writableView&&(t.writableView.cameraman.removeCameraTransformationListener(t.onCameraTransform),t.writableView.screen.removeCameraUpdatedListener(t.onCameraUpdated)),t.writableView=e,e&&(e.cameraman.addCameraTransformationListener(t.onCameraTransform),e.screen.addCameraUpdatedListener(t.onCameraUpdated)))},t.onRoomStateChanged=function(e){e.globalState&&t.dynamicPpt.setGlobalState(iC(e.globalState)),e.memberState&&(t.isEraser=e.memberState.currentApplianceName===SS.eraser,t.refreshShouldDisableImageHit(),t.refreshCursorClass()),e.sceneState&&t.fetchNextPptSlideIfNeeded(e.sceneState),t.callbacks.dispatch("onRoomStateChanged",(function(t){return t(e)}))},t.convertPointToScene=function(e,n){var r=t.viewsHub.writableView;return r?r.screen.convertPointToScene(e,n):{x:e,y:n}},t.onBoundlessKeyEvent=function(e){var n,r=t.hotKeys.checkHotKey(e);switch(r&&(t.handleHotKey(r,e),null==(n=e.nativeEvent)||n.preventDefault()),e.kind){case Kc.KeyDown:t.callbacks.dispatch("onKeyDown",(function(t){return t(e.nativeEvent)}));break;case Kc.KeyUp:t.callbacks.dispatch("onKeyUp",(function(t){return t(e.nativeEvent)}))}},t.onReceivedHandMouseEvent=function(e,n){var r,i;if(t.magix.phase===pc.Connected)switch(e.kind){case Kc.MouseDown:case Kc.SortedTouchStart:t.isHandGrasp=!0,null==(r=t.writableView)||r.putState({handToolActive:!0}),t.refreshCursorClass();break;case Kc.MouseUp:case Kc.SortedTouchEnd:case Kc.SortedTouchCancel:t.isHandGrasp=!1,null==(i=t.writableView)||i.putState({handToolActive:!1}),t.refreshCursorClass()}},t.onHandMouseEventCompleted=function(){var e;t.isHandGrasp=!1,null==(e=t.writableView)||e.putState({handToolActive:!1}),t.refreshCursorClass()},t.onModified=function(){if(t._phase===vx.Connected){var e=t.roomInput.viewStateObserver;HS.Follower===e.getCurrentMode()&&e.refreshCameraRectangle(),t.refreshRender()}},t.onReconnected=function(e){var n,r;null==(n=t.statistics)||n.commitConnection(_(H({},e),{isReconnection:!0})),t.viewsHub.fireReloadLibrary(),t.members.refresh(),t.syncCameraToRemote(),t.magix.isWritable&&(null==(r=t.memberStateStorage)||r.getMemberState(t._uuid,t.uid).then((function(e){e&&t.stateTrigger.activeUpdate("memberState",(function(){return t.applianceManager.setMemberState(e)}))})))},t.onDisconnectWithError=function(e){var n;0!==t.beginReconnectAt&&(null==(n=t.statistics)||n.commitDisconnection({isReconnection:!0,duration:Date.now()-t.beginReconnectAt})),t.callbacks.dispatch("onDisconnectWithError",(function(t){return t(e)}))<=0&&t.logger.error(e)},t.updateSelfUserId=function(e){void 0===e?(t.setObserverId(hn),t._isWritable=!1):(t.setObserverId(e),t._isWritable=!0),t.refreshCursorClass(),t.refreshSyncOperations()},t.onCameraTransform=function(e){vx.Connected===t._phase&&yd.Begin===e&&HS.Follower===t.stateTrigger.state.broadcastState.mode&&(t._isWritable?t.applianceManager.setViewState({mode:HS.Freedom}):t.roomInput.viewStateObserver.overrideWithFreedom(!0))},t.onCameraUpdated=function(){if(t._isWritable)switch(t.stateTrigger.state.broadcastState.mode){case HS.Broadcaster:case HS.Freedom:t.syncCameraToRemoteLimiter.invoke()}},t.syncCameraToRemote=function(){var e=t.viewsHub.writableView;if(t._isWritable&&e&&t.phase===vx.Connected){var n=e.screen,r=n.visionRectangle,i=n.camera.scale*mw(t.screenType);t.applianceManager.setViewState({originX:r.originX,originY:r.originY,width:r.width,height:r.height,pixelWidth:i})}},t.updateSession=function(e){t.logger.context=_(H({},t.logger.context),{session:e})},t.onPhaseChanged=function(e){t.logger.info("change room phase to "+e),e===pc.Disconnected&&t.dispose();var n=vx.Connecting;switch(e){case pc.Ready:case pc.Connecting:n=vx.Connecting;break;case pc.Connected:n=vx.Connected;break;case pc.Reconnecting:n=vx.Reconnecting;break;case pc.Disconnecting:n=vx.Disconnecting;break;case pc.Disconnected:n=vx.Disconnected}switch(n){case vx.Reconnecting:t.beginReconnectAt=Date.now();break;case vx.Connected:t.beginReconnectAt=0}var r=t._phase!==n;t._phase=n,t.refreshSyncOperations(),t.refreshCursorClass(),r&&t.callbacks.dispatch("onPhaseChanged",(function(e){return e(n)}))},t.dispatchEvent=function(e,n){var r=n;r instanceof ArrayBuffer&&(r=be(r)),t.magix.dispatch(e,r)},t.uid=e.userPayload.uid,t.floatBarDelegate=t.createFloatBarDelegate(),t.statistics=e.qualityComitters&&new Zx(e.qualityComitters),t.rejectWhenReadonlyErrorLevel=e.rejectWhenReadonlyErrorLevel||mx.ThrowError,t.disablePencilWrittingLimitFrequency=e.disablePencilWrittingLimitFrequency,t.magix=e.akkoApp.createMagix({logger:t.logger,userPayload:e.userPayload,libraryNodeFetcher:t.libraryNodeFetcher,callbacks:{onPhaseChanged:t.onPhaseChanged,onDisconnectWithError:t.onDisconnectWithError,onModified:t.onModified,onSelfUserIdUpdate:t.updateSelfUserId,onSessionChanged:t.updateSession,onEventFire:function(e){return t.dispatchMagixEventWithObject(e,!1,e.authorId===t.observerId)},onEventFireACK:function(e){return t.dispatchMagixEventWithObject(e,!0,e.authorId===t.observerId)},onReconnected:t.onReconnected,onKickedWithReason:function(e){return t.callbacks.dispatch("onKickedWithReason",(function(t){return t(e)}))},onCatchErrorWhenAppendFrame:function(e,n){t.callbacks.dispatch("onCatchErrorWhenAppendFrame",(function(t){return t(e,n)}))},onSliceChanged:function(e){return t.callbacks.dispatch("onSliceChanged",(function(t){return t(e)}))},onReceivedRttReport:t.statistics&&function(e){return t.statistics.commitStatistics({rtt:e})},onIllusionQueueLengthChanged:t.statistics&&function(e){t.statistics.commitStatistics({illusionQueueLength:e})},onFrameReceivedInterval:t.statistics&&function(e){t.statistics.commitStatistics({frameReceivedInterval:e})}}}),t.eventsQueue=e.disableMagixEventDispatchLimit?null:new rC(t.logger,75,t.dispatchEvent),t._disableDeviceInputs=e.disableDeviceInputs,t._disableEraseImage=e.disableEraseImage,t.syncCameraToRemoteLimiter=new Be(100,t.syncCameraToRemote),t.undoStack=new Tw({execute:function(e){return t.applianceManager.execute(e)},onCanUndoStepsUpdate:function(e){return t.callbacks.dispatch("onCanUndoStepsUpdate",(function(t){return t(e)}))},onCanRedoStepsUpdate:function(e){return t.callbacks.dispatch("onCanRedoStepsUpdate",(function(t){return t(e)}))}}),t.hotKeys=new uw(e.hotKeys),t.parametersFilter=new nC(e.useMobXState),t.floatBarOptions=e.floatBarOptions,t}return M(u,[{key:"customInput",get:function(){return this.roomInput.customInput}},{key:"applianceManager",get:function(){return this.magix.trigger}},{key:"isWritable",get:function(){return this.magix.isWritable}},{key:"enableWriteNow",get:function(){return this._enableWriteNow}},{key:"setWritable",value:(o=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.logger.info("set writable "+t),r=this.roomInput.viewStateObserver,!t){e.next=14;break}return e.next=5,this.magix.setWritable(t,this.deviceType);case 5:return this.pencilOptions.becomeWritable(this.applianceManager),(i=this.applianceManager.getViewState().mode)!==HS.Broadcaster&&(a=r.getCurrentMode())!==i&&this.stateTrigger.activeUpdate("broadcastState",(function(){return s.applianceManager.setViewState({mode:a}),r.getBroadcastState()})),e.next=10,null==(n=this.memberStateStorage)?void 0:n.getMemberState(this._uuid,this.uid);case 10:(o=e.sent)&&this.applianceManager.setMemberState(o),r.setReadonlyMode(!1),e.next=17;break;case 14:return r.setReadonlyMode(!0),e.next=17,this.magix.setWritable(t);case 17:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"disableDeviceInputs",get:function(){return this._disableDeviceInputs},set:function(e){this._disableDeviceInputs=e,this.refreshSyncOperations(),this.refreshCursorClass()}},{key:"disableEraseImage",get:function(){return this._disableEraseImage},set:function(e){this._disableEraseImage=e,this.refreshShouldDisableImageHit()}},{key:"disableSerialization",get:function(){return this._phase!==vx.Connected||!this.applianceManager.enableExecute},set:function(e){this.isRoomEnableModify()&&(e&&(this.copyBuffer=null),this.applianceManager.setEnableExecute(!e))}},{key:"uuid",get:function(){return this._uuid}},{key:"session",get:function(){return this.magix.session}},{key:"slice",get:function(){return this.magix.slice}},{key:"roomToken",get:function(){return this._roomToken}},{key:"phase",get:function(){return this._phase}},{key:"calibrationTimestamp",get:function(){return this.magix.calibrationTimestamp}},{key:"state",get:function(){return this.stateTrigger.state}},{key:"timeDelay",get:function(){return this.magix.timeDelay},set:function(e){this.magix.timeDelay=e}},{key:"setupLibraryNode",value:function(e,t){var n,r=this;this.updateLibraryNode(t),this.roomInput=new Qx({deviceType:e,screenType:this.screenType,magix:this.magix,viewsHub:this.viewsHub,cameraObserver:this.cameraObserver,pencilOptions:this.pencilOptions,bezierCurvePainter:this.bezierCurvePainter,disablePencilWrittingLimitFrequency:this.disablePencilWrittingLimitFrequency,convertPointToScene:this.convertPointToScene,getCursorStyleWithRadius:function(e){return r.getCursorStyleWithRadius(e)},onKeyPressed:this.onBoundlessKeyEvent,onReceivedHandMouseEvent:this.onReceivedHandMouseEvent,onHandMouseEventCompleted:this.onHandMouseEventCompleted,onCommit:function(e){return r.undoStack.commit(e)}}),this.viewsHub.callbacks.on("onWritableScreenChanged",this.onWritableScreenChanged),this.onWritableScreenChanged(this.viewsHub.writableView);var i=this.roomInput.viewStateObserver,a=this.cameraObserver,o=this.applianceManager;this.stateTrigger=new vw({useMobXMode:this.useMobXState,disableMaskKey:this.onlyCallbackRemoteStateModify,onStateChanged:this.onRoomStateChanged,propertyGetters:{globalState:function(){return is(o.getGlobalState())},memberState:function(){return is(o.getMemberState())||r.getDefaultMemberState()},roomMembers:function(){return r.getRoomMembers()},sceneState:function(){return r.getCurrentSceneState()},broadcastState:function(){return i.getBroadcastState()},cameraState:function(){return a.cameraState}}}),this.invisiblePluginNode.isWatching=!0,this.isEraser=(null==(n=this.stateTrigger.state.memberState)?void 0:n.currentApplianceName)===SS.eraser,this.dynamicPpt.setGlobalState(is(o.getGlobalState())),this.undoStack.setCurrentScenePath(this.stateTrigger.state.sceneState.scenePath),this.refreshCursorClass(),this.refreshShouldDisableImageHit(),this.refreshSyncOperations()}},{key:"dispose",value:function(){c(C(u.prototype),"dispose",this).call(this),this.roomInput&&this.roomInput.release(),this.stateTrigger&&this.stateTrigger.release()}},{key:"handleHotKey",value:function(e,t){switch(e){case"duplicate":this.duplicate();break;case"copy":this.copy();break;case"paste":this.paste();break;case"undo":this.undo();break;case"redo":this.redo();break;case"delete":this.delete();break;case"lock":var n=this.sendToApplianceManager(e,t);n&&this.undoStack.commit(n);break;case"changeToSelector":this.setMemberState({currentApplianceName:SS.selector});break;case"changeToClick":this.setMemberState({currentApplianceName:SS.clicker});break;case"changeToLaserPointer":this.setMemberState({currentApplianceName:SS.laserPointer});break;case"changeToPencil":this.setMemberState({currentApplianceName:SS.pencil});break;case"changeToRectangle":this.setMemberState({currentApplianceName:SS.rectangle});break;case"changeToEllipse":this.setMemberState({currentApplianceName:SS.ellipse});break;case"changeToEraser":this.setMemberState({currentApplianceName:SS.eraser});break;case"changeToText":this.setMemberState({currentApplianceName:SS.text});break;case"changeToStraight":this.setMemberState({currentApplianceName:SS.straight});break;case"changeToArrow":this.setMemberState({currentApplianceName:SS.arrow});break;case"changeToHand":this.setMemberState({currentApplianceName:SS.hand})}}},{key:"sendToApplianceManager",value:function(e,t){var n=null,r={kind:e};switch(t.kind){case Kc.KeyDown:n=this.applianceManager.onKeyDown(r);break;case Kc.KeyUp:n=this.applianceManager.onKeyUp(r)}return n}},{key:"willInterruptEvent",value:function(e){if(e instanceof KeyboardEvent){var t=!1;return this.callbacks.dispatch("willInterceptKeyboardEvent",(function(n){n(e)&&(t=!0)})),this.releaseAllTextareaByEsc(e),t}return!1}},{key:"refreshSyncOperations",value:function(){var e=!this._isWritable||this._phase===vx.Reconnecting||this._phase===vx.Disconnecting||this._phase===vx.Disconnected,t=e||this._disableDeviceInputs;this.hasLibraryNode&&(this.viewsHub.putState({disableBoundlessEvent:t}),this.dynamicPpt.setDisableInteractive(t)),this._enableWriteNow!==e&&(this._enableWriteNow=e,this.callbacks.dispatch("onEnableWriteNowChanged",(function(t){return t(e)})))}},{key:"connect",value:(a=l(regeneratorRuntime.mark((function e(t){var n,r,i,a,o,s,c,u,l=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Date.now(),e.prev=1,this._uuid=t.uuid,this._roomToken=t.roomToken,this.pencilOptions=new bx(t.enableDrawPoint,t.disableNewPencil,this.undoStack),this.memberStateStorage&&(this.memberStateStorage.uuid=t.uuid),e.next=5,this.magix.connect({uuid:t.uuid,region:t.region||Bk.defaultRegion,roomToken:t.roomToken,connectedPayload:t.deviceType,isWritable:t.isWritable});case 5:if(o=e.sent,s=o.libraryNode,c=o.statistics,this.logger.context=_(H({},this.logger.context),{session:this.magix.session}),this.setupLibraryNode(t.deviceType,s),this.magix.isWritable&&this.updateSelfUserId(this.magix.selfUserId),this._isWritable||this.roomInput.viewStateObserver.setReadonlyMode(!0),!this._isWritable){e.next=14;break}return this.pencilOptions.becomeWritable(this.applianceManager),e.next=12,null==(n=this.memberStateStorage)?void 0:n.getMemberState(this._uuid,this.uid);case 12:(u=e.sent)&&this.stateTrigger.activeUpdate("memberState",(function(){return l.applianceManager.setMemberState(u)}));case 14:null==(r=this.statistics)||r.commitConnection(_(H({},c),{isReconnection:!1})),this.logger.info("join room success"),this.fetchNextPptSlideIfNeeded(this.state.sceneState),e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(1),null==(i=this.statistics)||i.commitDisconnection({isReconnection:!1,duration:Date.now()-a}),this.logger.error("join room fail"),this.logger.error(e.t0),e.t0;case 20:case"end":return e.stop()}}),e,this,[[1,17]])}))),function(e){return a.apply(this,arguments)})},{key:"onScreenSizeUpdated",value:function(){this.stateTrigger.state.broadcastState.mode!==HS.Follower&&this.syncCameraToRemoteLimiter.invoke()}},{key:"syncBlockTimestamp",value:function(e){this.magix.syncBlockTimestamp(e)}},{key:"stopBlockTimestamp",value:function(){this.magix.stopBlockTimestamp()}},{key:"dispatchMagixEvent",value:function(e,t){if(this.isRoomEnableModify())if(this.eventsQueue)this.eventsQueue.dispatch(e,t);else try{this.dispatchEvent(e,t)}catch(e){this.logger.error(e)}}},{key:"disconnect",value:(i=l(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._phase!==vx.Disconnected){e.next=2;break}throw new Error("room did disconnect");case 2:return e.next=4,this.magix.disconnect();case 4:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setGlobalState",value:function(e){var t=this;return this.isRoomEnableModify()?this.stateTrigger.activeUpdate("globalState",(function(){var n=t.parametersFilter.filter(e),r=is(t.applianceManager.setGlobalState(n));return t.dynamicPpt.setGlobalState(iC(r)),r})):this.stateTrigger.state.globalState}},{key:"setMemberState",value:function(e){var t,n,r=this;if(this.isRoomEnableModify()){var i=this.parametersFilter.filter(e);i.currentApplianceName&&(null==(t=this.viewsHub.writableView)||t.cancelCurrentContinuityEvent(),this.beforeSceneChangeStoreCommit());var a=this.stateTrigger.activeUpdate("memberState",(function(){var e=r.applianceManager.setMemberStateWithCommitter(i),t=e.memberState,n=e.committer;return n&&r.undoStack.commit(n),is(t)}));return this.refreshCursorClass(),null==(n=this.memberStateStorage)||n.setMemberState(i),a}return this.stateTrigger.state.memberState}},{key:"setViewMode",value:function(e){var t=this;this.assertRoomIsConnected();var n=this.roomInput.viewStateObserver;if(this._isWritable)this.stateTrigger.activeUpdate("broadcastState",(function(){return t.applianceManager.setViewState({mode:e}),n.getBroadcastState()})),e===HS.Follower&&n.refreshCameraRectangle();else switch(e){case HS.Follower:n.overrideWithFreedom(!1),n.refreshCameraRectangle();break;case HS.Freedom:n.overrideWithFreedom(!0);break;case HS.Broadcaster:throw new Error("cannot be broadcaster when room.isWritable is false")}}},{key:"nextPpt",value:function(){var e=this.stateTrigger.state.sceneState,t=e.scenes,n=e.index;n<t.length-1&&this.setSceneIndex(n+1)}},{key:"previousPpt",value:function(){var e=this.stateTrigger.state.sceneState.index;e>=1&&this.setSceneIndex(e-1)}},{key:"pptJumpTo",value:function(e,t){var n="".concat(e,"/").concat(t,".slide"),r=this.state.sceneState.scenes.findIndex((function(e){return!!e.ppt&&e.ppt.src.endsWith(n)}));r>0&&this.setSceneIndex(r)}},{key:"updatePptPageInfo",value:function(){var e=this.stateTrigger.state.sceneState,t=e.scenes[e.index],n=t.ppt&&t.ppt.src,r=n&&this.dynamicPpt.getSlideUrl&&this.dynamicPpt.getSlideUrl(n);r&&this.setGlobalState(iC(this.dynamicPpt.globalStateWith({uuid:r.uuid,pageIndex:r.index,disableAutoPlay:!1})))}},{key:"setScenePath",value:function(e){var t=this;if(this.isRoomEnableModify()){this.logger.info("change scene path ".concat(e));var n=this.applianceManager,r=this.scenePathType(e),i=e;if(r===CS.Dir){var a=is(n.getSceneNames(MS.parse(e))).shift();i=void 0===a?i:[i,a].join("/")}this.beforeSceneChangeStoreCommit(),this.stateTrigger.activeUpdate("sceneState",(function(){return n.changeScene(MS.parse(i)),t.undoStack.setCurrentScenePath(i),t.getCurrentSceneState()})),this.updatePptPageInfo()}}},{key:"setSceneIndex",value:function(e){var t=this;if(this.isRoomEnableModify()){var n=this.stateTrigger.state.sceneState.scenes[e];if(!n)throw new Error("index ".concat(e," is out of range"));var r=this.applianceManager,i=p(r.getCurrentScenePath());i.pop(),i.push(n.name),this.logger.info("change scene index ".concat(e," /").concat(i.join("/"))),this.beforeSceneChangeStoreCommit(),this.stateTrigger.activeUpdate("sceneState",(function(){r.changeScene(i);var e=t.getCurrentSceneState();return t.undoStack.setCurrentScenePath(e.scenePath),e})),this.updatePptPageInfo()}}},{key:"moveCamera",value:function(e){this.assertRoomIsConnected(),c(C(u.prototype),"moveCamera",this).call(this,e)}},{key:"moveCameraToContain",value:function(e){this.assertRoomIsConnected(),c(C(u.prototype),"moveCameraToContain",this).call(this,e)}},{key:"putScenes",value:function(e,t,n){var r=this;if(this.isRoomEnableModify()){var i,a=[],o=A(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;void 0!==s.name?a.push(this.parametersFilter.filter(s)):a.push({name:(0,yx.v1)().replace(/-/g,""),ppt:s.ppt})}}catch(e){o.e(e)}finally{o.f()}this.stateTrigger.activeUpdate("sceneState",(function(){return r.applianceManager.putScenes(MS.parse(e),a,n),r.getCurrentSceneState()}))}}},{key:"cleanCurrentScene",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this.isRoomEnableModify()){var t=this.applianceManager.cleanCurrentScene(e);t&&this.undoStack.commit(t)}}},{key:"removeScenes",value:function(e){var t=this;this.isRoomEnableModify()&&this.stateTrigger.activeUpdate("sceneState",(function(){return t.applianceManager.removeScenes(MS.parse(e)),t.getCurrentSceneState()}))}},{key:"moveScene",value:function(e,t){var n=this;this.isRoomEnableModify()&&this.stateTrigger.activeUpdate("sceneState",(function(){return n.applianceManager.moveScene(MS.parse(e),MS.parse(t)),n.getCurrentSceneState()}))}},{key:"createWrappedComponents",value:function(){return[].concat(p(c(C(u.prototype),"createWrappedComponents",this).call(this)),[RS(ES,this)])}},{key:"createPluginOperator",value:function(){var e=this;return Object.freeze(_(H({},c(C(u.prototype),"createPluginOperator",this).call(this)),{remove:function(t){return e.removePlugin(t)},update:function(t,n){return e.updatePlugin(t,n)},getPlugin:function(t){return e.applianceManager.getPlugin(t)}}))}},{key:"insertImage",value:function(e){this.isRoomEnableModify()&&this.applianceManager.insertImage(e)}},{key:"completeImageUpload",value:function(e,t){if(this.isRoomEnableModify()){var n=this.applianceManager.completeImageUpload(e,t);n&&this.undoStack.commit(n)}}},{key:"lockImage",value:function(e,t){this.isRoomEnableModify()&&this.applianceManager.lockImage(e,t)}},{key:"createInvisiblePlugin",value:function(e,t){return this.invisiblePluginNode.create(e,t)}},{key:"insertPlugin",value:function(e,t){if(this.isRoomEnableModify()){var n=t,r=n&&n.attributes,i=this.assignAttributes(e,r);return i!==r&&(n=_(H({},n),{attributes:i})),this.applianceManager.insertPlugin(e,n).identifier}return""}},{key:"removePlugin",value:function(e){var t=!1;return this.isRoomEnableModify()&&(t=!!this.applianceManager.removePlugin(e)),t}},{key:"updatePlugin",value:function(e,t){var n=!1;return this.isRoomEnableModify()&&(n=!!this.applianceManager.updatePlugin(e,t)),n}},{key:"getPluginAttributes",value:function(e){this.assertRoomIsConnected();var t=this.applianceManager.getPlugin(e);return t&&t.attributes}},{key:"getPluginRectangle",value:function(e){this.assertRoomIsConnected();var t=this.applianceManager.getPlugin(e);return t&&{originX:t.originX,originY:t.originY,width:t.width,height:t.height}}},{key:"duplicate",value:function(){if(this.isRoomEnableModify()){var e=12*(2*Math.random()-1),t=12*(2*Math.random()-1),n=this.applianceManager.duplicate(e,t);n&&this.undoStack.commit(n)}}},{key:"updateTextFontSize",value:function(e){var t;null==(t=this.memberStateStorage)||t.setMemberState({textSize:e}),this.applianceManager.setMemberState({textSize:e});var n=this.applianceManager.updateTextareaFontSize(e);n&&this.undoStack.commit(n)}},{key:"updateTextFormat",value:function(e){var t;if(this.textareaHub){var n={};"bold"in e&&(n.bold=e.bold),"italic"in e&&(n.italic=e.italic),"underline"in e&&(n.underline=e.underline),"lineThrough"in e&&(n.lineThrough=e.lineThrough),"color"in e&&(n.strokeColor=e.color),null==(t=this.memberStateStorage)||t.setMemberState(n),this.applianceManager.setMemberState(n);var r=this.textareaHub.getTextareaSizeMap(e),i=this.applianceManager.updateTextareaFormat(e,r);i&&this.undoStack.commit(i)}}},{key:"copy",value:function(){this.isRoomEnableModify()&&(this.copyBuffer=this.applianceManager.copy())}},{key:"paste",value:function(){if(this.isRoomEnableModify()&&this.copyBuffer){var e=12*(2*Math.random()-1),t=12*(2*Math.random()-1),n=this.applianceManager.paste(this.copyBuffer,e,t);n&&this.undoStack.commit(n)}}},{key:"canUndoSteps",get:function(){return this.undoStack.canUndoSteps}},{key:"canRedoSteps",get:function(){return this.undoStack.canRedoSteps}},{key:"undo",value:function(){return this.isRoomEnableModify()&&(this.applianceManager.hasEditingTextarea()&&this.beforeSceneChangeStoreCommit(),this.undoStack.undo()),this.undoStack.canUndoSteps}},{key:"redo",value:function(){return this.isRoomEnableModify()&&this.undoStack.redo(),this.undoStack.canRedoSteps}},{key:"delete",value:function(){if(this.isRoomEnableModify()){var e=this.applianceManager.delete();e&&this.undoStack.commit(e)}}},{key:"lockImages",value:function(e){this.applianceManager.lockImages(e)}},{key:"moveSelectedComponentsToTop",value:function(){this.applianceManager.moveSelectedComponentsToTop()}},{key:"moveSelectedComponentsToBottom",value:function(){this.applianceManager.moveSelectedComponentsToBottom()}},{key:"pptNextStep",value:function(){this.isRoomEnableModify()&&this.pptMoveStep(1)}},{key:"pptPreviousStep",value:function(){this.isRoomEnableModify()&&this.pptMoveStep(-1)}},{key:"pptMoveStep",value:function(e){var t=this.stateTrigger.state.sceneState,n=t.scenes,r=t.index,i=n[r],a=i.ppt&&i.ppt.src;if(a&&this.dynamicPpt.getSlideUrl(a))this.dynamicPpt.moveStep(e);else{var o=r+e;o>=0&&o<n.length&&this.setSceneIndex(o)}}},{key:"refreshCursorClass",value:function(){var e;switch(this.phase){case vx.Reconnecting:case vx.Disconnecting:case vx.Disconnected:e=Xx.Ban;break;case vx.Connected:if(this._isWritable&&this.stateTrigger){var t=this.stateTrigger.state.memberState;if(t&&this.magix.isWritable&&!this._disableDeviceInputs)switch(t.currentApplianceName){case SS.hand:e=this.isHandGrasp?Xx.HandGrasp:Xx.Hand;break;default:e="cursor-"+t.currentApplianceName}else e=null}}void 0!==e&&this.viewsHub.putState({cursorClass:e})}},{key:"refreshShouldDisableImageHit",value:function(){this.viewsHub.putState({disalbeImageHit:this._disableEraseImage&&this.isEraser})}},{key:"exportScene",value:(r=l(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.scenePathType(t)===CS.Page){e.next=2;break}throw new Error("can export a page, because of ".concat(t,"'s scene path type is not a scene page"));case 2:return e.next=4,this.apiFetch("http://api/v5/rooms/".concat(this.uuid,"/scenes-export/"),{method:"POST",headers:{token:this.roomToken,"content-type":"application/json"},body:JSON.stringify({path:t})});case 4:if(201!==(n=e.sent).status){e.next=9;break}return e.next=8,n.blob();case 8:return e.abrupt("return",e.sent);case 9:return e.t0=Error,e.t1="export scene fail: ",e.next=13,n.text();case 13:throw e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),new e.t0(e.t3);case 16:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"importScene",value:(n=l(regeneratorRuntime.mark((function e(t,n){var r,i,a,o,s,c,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=this.scenePathType(t))!==CS.Page&&r!==CS.Conflict){e.next=4;break}throw i=r===CS.Page?"".concat(t," is a scene page"):"".concat(t," path contains a page"),new Error("can't import a scene in ".concat(t,", because of ").concat(i));case 4:return e.next=6,this.getSceneFromBlob(n);case 6:if(a=e.sent,o=a.name,s=[t,o].join("/"),this.scenePathType(s)!==CS.Dir){e.next=11;break}throw new Error("can't import a scene in ".concat(s," because of ").concat(s," contains scene page"));case 11:return(c=new FormData).append("dir",t),c.append("payload",n),e.next=15,this.apiFetch("http://api/v5/rooms/".concat(this.uuid,"/scenes-import/"),{method:"POST",headers:{token:this.roomToken},body:c});case 15:if(!((u=e.sent).status>=300)){e.next=24;break}return e.t0=Error,e.t1="import scene fail: ",e.next=21,u.text();case 21:throw e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),new e.t0(e.t3);case 24:return e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"getSceneFromBlob",value:(t=l(regeneratorRuntime.mark((function e(t){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var i=new FileReader;i.readAsArrayBuffer(t),i.onloadend=function(){if(i.result instanceof ArrayBuffer)try{var t=be(i.result),r=n.applianceManager.getSceneFromFile(t);e(r)}catch(t){e(t)}else e(new Error("wrong content"))},i.onerror=function(e){r(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"isRoomEnableModify",value:function(){if(this.assertRoomIsConnected(),this._isWritable)return!0;switch(this.rejectWhenReadonlyErrorLevel){case mx.ThrowError:throw new Error("you can only call it when room is writable");case mx.Warn:this.logger.warn("you can only call it when room is writable")}return!1}},{key:"createFloatBarDelegate",value:function(){var e=this;return Object.freeze({delete:function(){return e.delete()},lockImages:function(t){return e.lockImages(t)},moveSelectedComponentsToTop:function(){return e.moveSelectedComponentsToTop()},moveSelectedComponentsToBottom:function(){return e.moveSelectedComponentsToBottom()},duplicate:function(){return e.duplicate()},updateTextareaFontSize:function(t){return e.updateTextFontSize(t)},updateTextareaFormat:function(t){return e.updateTextFormat(t)}})}},{key:"assertRoomIsConnected",value:function(){if(this._phase!==vx.Connected)throw new Error("you can only call it when room is connected. the phase of room is "+this._phase)}},{key:"beforeSceneChangeStoreCommit",value:function(){var e=this.applianceManager.releaseAllTextarea();e&&this.undoStack.commit(e)}},{key:"releaseAllTextareaByEsc",value:function(e){if("Escape"===e.code){var t=this.applianceManager.releaseAllTextarea();t&&this.undoStack.commit(t)}}}]),u}(gx);(uC=cC||(cC={})).WaitingFirstFrame="waitingFirstFrame",uC.Playing="playing",uC.Pause="pause",uC.Stopped="stop",uC.Ended="ended",uC.Buffering="buffering",function(e){e.Directory="directory",e.Freedom="freedom"}(lC||(lC={})),function(e){e.Success="success",e.SuccessButUnnecessary="successButUnnecessary",e.Override="override",e.Stopped="stopped"}(hC||(hC={}));var fC=X(n("0yMQ")),pC=new Date("2019-06-23Z00:00:00").getTime(),vC=function(e){y(i,e);var t,n,r=k(i);function i(e){var t;return I(this,i),(t=r.call(this,{logger:e.logger,region:e.region,useMobXState:e.useMobXState,screenType:e.screenType,renderEngine:e.renderEngine,boundless:e.boundless,cameraBound:e.cameraBound,autoResize:e.autoResize,plugins:e.plugins,invisiblePlugins:e.invisiblePlugins,wrappedComponents:e.wrappedComponents,preloadDynamicPPT:e.preloadDynamicPPT,userFonts:e.userFonts,handToolKey:e.handToolKey,fontFamily:e.fontFamily,onlyCallbackRemoteStateModify:e.onlyCallbackRemoteStateModify,disableOthersSelectingBox:e.disableOthersSelectingBox,disableCameraTransform:e.disableCameraTransform,useMultiViews:e.useMultiViews,disableOperations:!0,willHideSelfCursor:!1,cursorAdapter:e.cursorAdapter,eraserRadiusCursor:e.eraserRadiusCursor,urlInterrupter:e.urlInterrupter,pptParams:e.pptParams,callbacks:e.callbacks})).didLoadFirstFrame=!1,t.observerMode=lC.Directory,t.onTriggerBuilt=function(){t.hasLibraryNode&&(t.viewsHub.fireReloadLibrary(),t.members.refresh())},t.onLibraryNodeChanged=function(e,n){var r,i=t.hasLibraryNode;if(t.updateLibraryNode(n),!i){var a=S(t),o=a.applianceManager,s=a.cameraObserver;t.viewStateObserver=new Wx(t.viewsHub,o),t.stateTrigger=new vw({useMobXMode:t.useMobXState,disableMaskKey:t.onlyCallbackRemoteStateModify,onStateChanged:t.onPlayerStateChanged,propertyGetters:{observerMode:function(){return t.observerMode},globalState:function(){return is(o.getGlobalState())},roomMembers:function(){return t.getRoomMembers()},sceneState:function(){return t.getCurrentSceneState()},cameraState:function(){return s.cameraState}}}),t.useMultiViews||null==(r=t.mainView)||r.callbacks.on("onCameraTransform",t.onCameraTransform)}},t.onPhaseChanged=function(e){var n=!1;!t.didLoadFirstFrame&&t.hasFrameToDisplay(e)&&(t.didLoadFirstFrame=!0,n=!0,t.fetchNextPptSlideIfNeeded(t.state.sceneState),t.setupAfterLoadFirstFrame()),t.updatePhaseByReconstructorPhase(t.reconstructor.phase)&&(t.logger.info("change player phase to "+t._phase),t.callbacks.dispatch("onPhaseChanged",(function(e){return e(t._phase)})),t.dynamicPpt&&t.dynamicPpt.replayPasue&&t.dynamicPpt.replayPasue(t._phase!==cC.Playing)),n&&t.callbacks.dispatch("onLoadFirstFrame",(function(e){return e()})),t.invisiblePluginNode.isWatching=t._phase===cC.Playing||t._phase===cC.Pause},t.onPlayerStateChanged=function(e){e.globalState&&t.dynamicPpt.setGlobalState(iC(e.globalState)),e.sceneState&&t.fetchNextPptSlideIfNeeded(e.sceneState),t.callbacks.dispatch("onPlayerStateChanged",(function(t){return t(e)}))},t.onSliceChanged=function(e){t.logger.context=_(H({},t.logger.context),{slice:e&&e.uuid}),t.refreshForcePPTLandscapeWithSlice(e),t.callbacks.dispatch("onSliceChanged",(function(t){return t(e.uuid)}))},t.onCameraTransform=function(e){e===yd.Begin&&t.observerMode===lC.Directory&&(t.observerMode=lC.Freedom)},t.onModified=function(){t.viewStateObserver&&t.observerMode===lC.Directory&&t.viewStateObserver.refreshCameraRectangle(),t.refreshRender()},t.callbacks.on("onProgressTimeChanged",(function(e){return t.putPlayerState({timestamp:e})})),(0,fC.makeObservable)(S(t),{observerMode:fC.observable}),t}return M(i,[{key:"applianceManager",get:function(){return this.reconstructor.trigger}},{key:"parametersFilter",get:function(){}},{key:"playbackSpeed",get:function(){return this.reconstructor.playbackSpeed},set:function(e){this.reconstructor.playbackSpeed=e,this.putPlayerState({playbackSpeed:e})}},{key:"disablePencilWrittingLimitFrequency",get:function(){return!1}},{key:"setupReconstructor",value:(n=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.akkoApp.createReconstructor({logger:this.logger,roomToken:t.roomToken,clientVersion:Bk.sdkVersion,libraryNodeFetcher:this.libraryNodeFetcher,callbacks:this.createReconstructorCallbacks(),rangeQuery:{region:t.region,room:t.room,roomToken:t.roomToken,slice:t.slice,beginTimestamp:t.beginTimestamp,duration:t.duration}});case 3:this.reconstructor=e.sent,this.updatePhaseByReconstructorPhase(this.reconstructor.phase),this.logger.info("setup player success"),this.logger.context=_(H({},this.logger.context),{uuid:this.reconstructor.roomUUID,slice:this.reconstructor.slice&&this.reconstructor.slice.uuid}),e.next=12;break;case 9:throw e.prev=9,e.t0=e.catch(0),this.logger.error("setup player fail"),this.logger.error(e.t0),e.t0;case 12:case"end":return e.stop()}}),e,this,[[0,9]])}))),function(e){return n.apply(this,arguments)})},{key:"createReconstructorCallbacks",value:function(){var e=this;return{onEventFire:function(t){return e.dispatchMagixEventWithObject(t,!1,!1)},onSliceChanged:this.onSliceChanged,onTriggerBuilt:this.onTriggerBuilt,onLibraryNodeChanged:this.onLibraryNodeChanged,onPhaseChanged:this.onPhaseChanged,onModified:this.onModified,onIsPlayableChanged:function(t){return e.callbacks.dispatch("onIsPlayableChanged",(function(e){return e(t)}))},onProgressTimeChanged:function(t){return e.callbacks.dispatch("onProgressTimeChanged",(function(e){return e(t)}))},onStoppedWithError:function(t){return e.callbacks.dispatch("onStoppedWithError",(function(e){return e(t)}))},onCatchErrorWhenAppendFrame:function(t,n){e.callbacks.dispatch("onCatchErrorWhenAppendFrame",(function(e){return e(t,n)}))}}}},{key:"hasFrameToDisplay",value:function(e){switch(e){case Cc.Playing:case Cc.Pause:case Cc.Buffering:case Cc.Ended:return!0;default:return!1}}},{key:"setupAfterLoadFirstFrame",value:function(){this.reconstructor.slice&&this.refreshForcePPTLandscapeWithSlice(this.reconstructor.slice),this.dynamicPpt.setGlobalState(is(this.applianceManager.getGlobalState()))}},{key:"dispose",value:function(){var e;c(C(i.prototype),"dispose",this).call(this),this.viewStateObserver&&this.viewStateObserver.release(),this.stateTrigger&&this.stateTrigger.release(),this.useMultiViews||null==(e=this.mainView)||e.callbacks.on("onCameraTransform",this.onCameraTransform)}},{key:"createWrappedComponents",value:function(){return[].concat(p(c(C(i.prototype),"createWrappedComponents",this).call(this)),[RS(OS,this)])}},{key:"refreshForcePPTLandscapeWithSlice",value:function(e){e.beginTimestamp<=pC?this.viewsHub.putState({forcePPTLandscape:!0}):this.viewsHub.putState({forcePPTLandscape:!1})}},{key:"setObserverMode",value:function(e){var t=this;this.stateTrigger.activeUpdate("observerMode",(function(){return t.observerMode=e})),this.viewStateObserver&&e===lC.Directory&&this.viewStateObserver.refreshCameraRectangle()}},{key:"state",get:function(){if(!this.hasLibraryNode)throw new Error("can't read state before load first frame");return this.stateTrigger.state}},{key:"roomUUID",get:function(){return this.reconstructor.roomUUID}},{key:"slice",get:function(){return this.reconstructor.slice&&this.reconstructor.slice.uuid}},{key:"isPlayable",get:function(){return this.reconstructor.isPlayable}},{key:"phase",get:function(){return this._phase}},{key:"progressTime",get:function(){return this.reconstructor.progressTime}},{key:"timeDuration",get:function(){return this.reconstructor.duration}},{key:"framesCount",get:function(){return this.reconstructor.framesCount}},{key:"beginTimestamp",get:function(){return this.reconstructor.beginTimestamp}},{key:"play",value:function(){this.assertRoomIsConnected(),this.reconstructor.play()}},{key:"pause",value:function(){this.assertRoomIsConnected(),this.reconstructor.pause()}},{key:"stop",value:function(){if(this._phase===cC.Stopped)throw new Error("player did stop");this.reconstructor.stop(),this.dispose()}},{key:"seekToProgressTime",value:(t=l(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.assertRoomIsConnected(),e.next=3,this.reconstructor.seekToProgressTime(t);case 3:e.t0=e.sent,e.next=e.t0===Ic.Success?6:e.t0===Ic.SuccessButUnnecessary?7:e.t0===Ic.Override?8:e.t0===Ic.Stopped?9:10;break;case 6:return e.abrupt("return",hC.Success);case 7:return e.abrupt("return",hC.SuccessButUnnecessary);case 8:return e.abrupt("return",hC.Override);case 9:return e.abrupt("return",hC.Stopped);case 10:throw new Error("invalid result");case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updatePhaseByReconstructorPhase",value:function(e){var t=i.covertPhase(e),n=this._phase!==t;return n&&(this._phase=t,this.putPlayerState({isPlaying:t===cC.Playing})),n}},{key:"assertRoomIsConnected",value:function(){if(this._phase===cC.Stopped)throw new Error("you cannot call it when phase of player is stopped")}}],[{key:"covertPhase",value:function(e){switch(e){case Cc.WaitingFirstFrame:return cC.WaitingFirstFrame;case Cc.Playing:return cC.Playing;case Cc.Pause:return cC.Pause;case Cc.Stopped:return cC.Stopped;case Cc.Ended:return cC.Ended;case Cc.Buffering:case Cc.Seeking:return cC.Buffering;default:throw new Error("invalid phase ".concat(e))}}}]),i}(gx),mC=function(e){y(n,e);var t=k(n);function n(){return I(this,n),t.apply(this,arguments)}return M(n,[{key:"render",value:function(){var e=this;return Dw.createElement(LS,null,(function(t){return Dw.createElement(fS,_(H({},e.props),{room:t}))}))}}],[{key:"willInterruptEvent",value:function(){return fS.willInterruptEvent()}}]),n}(Dw.Component);function gC(e){var t;return"boolean"==typeof e?t=e?Object.freeze({colors:yC()}):void 0:e&&(t=Object.freeze({colors:yC(e.colors)})),t}function yC(e){return e?Object.freeze(e.map((function(e){return Object.freeze(p(e))}))):bC}var bC=Object.freeze([Object.freeze([224,32,32]),Object.freeze([250,100,0]),Object.freeze([247,181,0]),Object.freeze([109,212,0]),Object.freeze([68,215,182]),Object.freeze([50,197,255]),Object.freeze([0,145,255]),Object.freeze([98,54,255]),Object.freeze([182,32,224]),Object.freeze([109,114,120]),Object.freeze([0,0,0]),Object.freeze([255,255,255])]),kC=Object.defineProperty,wC=Object.defineProperties,SC=Object.getOwnPropertyDescriptors,xC=Object.getOwnPropertySymbols,CC=Object.prototype.hasOwnProperty,IC=Object.prototype.propertyIsEnumerable,PC=function(e,t,n){return t in e?kC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},MC=function(e,t){for(var n in t||(t={}))CC.call(t,n)&&PC(e,n,t[n]);if(xC){var r,i=A(xC(t));try{for(i.s();!(r=i.n()).done;){n=r.value;IC.call(t,n)&&PC(e,n,t[n])}}catch(e){i.e(e)}finally{i.f()}}return e},TC=function(e,t){return wC(e,SC(t))},AC=function(){var e=l(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.fetch(n,{method:"post",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}});case 2:if((r=e.sent).ok){e.next=5;break}throw new Error("report log failed, request status code: ".concat(r.status,", statusText: ").concat(r.statusText));case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),EC=function(){function e(t,n,r){I(this,e),this.argusEncoder=t,this.timestampKey=r,this.reportQueueManage=new tu(e.logQueue,n,AC,console.warn)}return M(e,[{key:"report",value:function(e,t){var n=this.convertToBody(e),r=this.argusEncoder.encode(t,n);this.reportQueueManage.report(r).catch((function(){}))}},{key:"convertToBody",value:function(e){var t=e.timestamp,n=e.logObject,r={};for(var i in void 0!==this.timestampKey&&(r[this.timestampKey]="".concat(t)),n)r[i]="".concat(n[i]);return r}}]),e}();EC.logQueue=new $c;var OC,RC=function(){function e(t){I(this,e),this.events=t.events,this.argusEncoder=new Jc(t.events,t.vid),this.reporter=new EC(this.argusEncoder,t.reportResourceURL,t.timestampKey),this.logger=new Hc({prefix:t.prefix,levelMask:t.printLevelMask}),this.reportLevelMaskIndex=Wc[t.reportLevelMask||"info"]}return M(e,[{key:"commit",value:function(e,t){this.reportLogNode(e,{timestamp:Date.now(),logObject:MC({},t)})}},{key:"log",value:function(e,t,n,r){if(this.logger.log(e,t,n),Wc[t]>=this.reportLevelMaskIndex){var i={timestamp:Date.now(),logObject:TC(MC({},r),{level:t,message:n})};this.reportLogNode(e,i)}}},{key:"isSupportedEvents",value:function(e){return e in this.events}},{key:"reportLogNode",value:function(e,t){try{this.reporter.report(t,e)}catch(e){console.warn(e)}}}]),e}(),NC=X(n("VDtp")),LC=NC.Reader,jC=NC.Writer,DC=NC.util,FC=NC.roots.default||(NC.roots.default={}),zC=FC.WhiteBoardPlayer=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=DC.Long?DC.Long.fromBits(0,0,!1):0,e.prototype.uuid="",e.prototype.region="",e.prototype.slice="",e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.createdAt="",e.prototype.level="",e.prototype.message="",e.prototype.vid=0,e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=jC.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(18).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(26).string(e.region),null!=e.slice&&Object.hasOwnProperty.call(e,"slice")&&t.uint32(34).string(e.slice),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(42).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(50).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(58).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(66).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(74).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(82).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(90).string(e.os),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(98).string(e.createdAt),null!=e.level&&Object.hasOwnProperty.call(e,"level")&&t.uint32(106).string(e.level),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(114).string(e.message),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(120).int32(e.vid),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(130).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof LC||(e=LC.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new FC.WhiteBoardPlayer;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.uuid=e.string();break;case 3:r.region=e.string();break;case 4:r.slice=e.string();break;case 5:r.team=e.string();break;case 6:r.app=e.string();break;case 7:r.akkoVersion=e.string();break;case 8:r.sdkVersion=e.string();break;case 9:r.nativeVersion=e.string();break;case 10:r.platform=e.string();break;case 11:r.os=e.string();break;case 12:r.createdAt=e.string();break;case 13:r.level=e.string();break;case 14:r.message=e.string();break;case 15:r.vid=e.int32();break;case 16:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof LC||(e=new LC(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=T(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||DC.isInteger(e.lts)||e.lts&&DC.isInteger(e.lts.low)&&DC.isInteger(e.lts.high)?null!=e.uuid&&e.hasOwnProperty("uuid")&&!DC.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!DC.isString(e.region)?"region: string expected":null!=e.slice&&e.hasOwnProperty("slice")&&!DC.isString(e.slice)?"slice: string expected":null!=e.team&&e.hasOwnProperty("team")&&!DC.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!DC.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!DC.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!DC.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!DC.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!DC.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!DC.isString(e.os)?"os: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!DC.isString(e.createdAt)?"createdAt: string expected":null!=e.level&&e.hasOwnProperty("level")&&!DC.isString(e.level)?"level: string expected":null!=e.message&&e.hasOwnProperty("message")&&!DC.isString(e.message)?"message: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!DC.isInteger(e.vid)?"vid: integer expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!DC.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof FC.WhiteBoardPlayer)return e;var t=new FC.WhiteBoardPlayer;return null!=e.lts&&(DC.Long?(t.lts=DC.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==T(e.lts)&&(t.lts=new DC.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.slice&&(t.slice=String(e.slice)),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.level&&(t.level=String(e.level)),null!=e.message&&(t.message=String(e.message)),null!=e.vid&&(t.vid=0|e.vid),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(DC.Long){var r=new DC.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.uuid="",n.region="",n.slice="",n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.createdAt="",n.level="",n.message="",n.vid=0,n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?DC.Long.prototype.toString.call(e.lts):t.longs===Number?new DC.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.slice&&e.hasOwnProperty("slice")&&(n.slice=e.slice),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.level&&e.hasOwnProperty("level")&&(n.level=e.level),null!=e.message&&e.hasOwnProperty("message")&&(n.message=e.message),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,NC.util.toJSONOptions)},e}(),BC=FC.WhiteBoardQualityConnection=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=DC.Long?DC.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.isReconnection="",e.prototype.retryCount="",e.prototype.buildWebSocketDuration="",e.prototype.buildMagixDuration="",e.prototype.createdAt="",e.prototype.vid=0,e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=jC.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(18).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(34).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(42).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(50).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(58).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(66).string(e.os),null!=e.kind&&Object.hasOwnProperty.call(e,"kind")&&t.uint32(74).string(e.kind),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(82).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(90).string(e.region),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(98).string(e.userId),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(106).string(e.session),null!=e.isReconnection&&Object.hasOwnProperty.call(e,"isReconnection")&&t.uint32(114).string(e.isReconnection),null!=e.retryCount&&Object.hasOwnProperty.call(e,"retryCount")&&t.uint32(122).string(e.retryCount),null!=e.buildWebSocketDuration&&Object.hasOwnProperty.call(e,"buildWebSocketDuration")&&t.uint32(130).string(e.buildWebSocketDuration),null!=e.buildMagixDuration&&Object.hasOwnProperty.call(e,"buildMagixDuration")&&t.uint32(138).string(e.buildMagixDuration),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(146).string(e.createdAt),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(152).int32(e.vid),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(162).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof LC||(e=LC.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new FC.WhiteBoardQualityConnection;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.team=e.string();break;case 3:r.app=e.string();break;case 4:r.akkoVersion=e.string();break;case 5:r.sdkVersion=e.string();break;case 6:r.nativeVersion=e.string();break;case 7:r.platform=e.string();break;case 8:r.os=e.string();break;case 9:r.kind=e.string();break;case 10:r.uuid=e.string();break;case 11:r.region=e.string();break;case 12:r.userId=e.string();break;case 13:r.session=e.string();break;case 14:r.isReconnection=e.string();break;case 15:r.retryCount=e.string();break;case 16:r.buildWebSocketDuration=e.string();break;case 17:r.buildMagixDuration=e.string();break;case 18:r.createdAt=e.string();break;case 19:r.vid=e.int32();break;case 20:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof LC||(e=new LC(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=T(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||DC.isInteger(e.lts)||e.lts&&DC.isInteger(e.lts.low)&&DC.isInteger(e.lts.high)?null!=e.team&&e.hasOwnProperty("team")&&!DC.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!DC.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!DC.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!DC.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!DC.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!DC.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!DC.isString(e.os)?"os: string expected":null!=e.kind&&e.hasOwnProperty("kind")&&!DC.isString(e.kind)?"kind: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!DC.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!DC.isString(e.region)?"region: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!DC.isString(e.userId)?"userId: string expected":null!=e.session&&e.hasOwnProperty("session")&&!DC.isString(e.session)?"session: string expected":null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&!DC.isString(e.isReconnection)?"isReconnection: string expected":null!=e.retryCount&&e.hasOwnProperty("retryCount")&&!DC.isString(e.retryCount)?"retryCount: string expected":null!=e.buildWebSocketDuration&&e.hasOwnProperty("buildWebSocketDuration")&&!DC.isString(e.buildWebSocketDuration)?"buildWebSocketDuration: string expected":null!=e.buildMagixDuration&&e.hasOwnProperty("buildMagixDuration")&&!DC.isString(e.buildMagixDuration)?"buildMagixDuration: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!DC.isString(e.createdAt)?"createdAt: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!DC.isInteger(e.vid)?"vid: integer expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!DC.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof FC.WhiteBoardQualityConnection)return e;var t=new FC.WhiteBoardQualityConnection;return null!=e.lts&&(DC.Long?(t.lts=DC.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==T(e.lts)&&(t.lts=new DC.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.kind&&(t.kind=String(e.kind)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.session&&(t.session=String(e.session)),null!=e.isReconnection&&(t.isReconnection=String(e.isReconnection)),null!=e.retryCount&&(t.retryCount=String(e.retryCount)),null!=e.buildWebSocketDuration&&(t.buildWebSocketDuration=String(e.buildWebSocketDuration)),null!=e.buildMagixDuration&&(t.buildMagixDuration=String(e.buildMagixDuration)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.vid&&(t.vid=0|e.vid),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(DC.Long){var r=new DC.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.isReconnection="",n.retryCount="",n.buildWebSocketDuration="",n.buildMagixDuration="",n.createdAt="",n.vid=0,n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?DC.Long.prototype.toString.call(e.lts):t.longs===Number?new DC.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.kind&&e.hasOwnProperty("kind")&&(n.kind=e.kind),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&(n.isReconnection=e.isReconnection),null!=e.retryCount&&e.hasOwnProperty("retryCount")&&(n.retryCount=e.retryCount),null!=e.buildWebSocketDuration&&e.hasOwnProperty("buildWebSocketDuration")&&(n.buildWebSocketDuration=e.buildWebSocketDuration),null!=e.buildMagixDuration&&e.hasOwnProperty("buildMagixDuration")&&(n.buildMagixDuration=e.buildMagixDuration),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,NC.util.toJSONOptions)},e}(),UC=FC.WhiteBoardQualityDisconnection=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=DC.Long?DC.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.duration="",e.prototype.createdAt="",e.prototype.vid=0,e.prototype.isReconnection="",e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=jC.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(18).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(34).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(42).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(50).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(58).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(66).string(e.os),null!=e.kind&&Object.hasOwnProperty.call(e,"kind")&&t.uint32(74).string(e.kind),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(82).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(90).string(e.region),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(98).string(e.userId),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(106).string(e.session),null!=e.duration&&Object.hasOwnProperty.call(e,"duration")&&t.uint32(122).string(e.duration),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(130).string(e.createdAt),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(136).int32(e.vid),null!=e.isReconnection&&Object.hasOwnProperty.call(e,"isReconnection")&&t.uint32(146).string(e.isReconnection),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(154).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof LC||(e=LC.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new FC.WhiteBoardQualityDisconnection;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.team=e.string();break;case 3:r.app=e.string();break;case 4:r.akkoVersion=e.string();break;case 5:r.sdkVersion=e.string();break;case 6:r.nativeVersion=e.string();break;case 7:r.platform=e.string();break;case 8:r.os=e.string();break;case 9:r.kind=e.string();break;case 10:r.uuid=e.string();break;case 11:r.region=e.string();break;case 12:r.userId=e.string();break;case 13:r.session=e.string();break;case 15:r.duration=e.string();break;case 16:r.createdAt=e.string();break;case 17:r.vid=e.int32();break;case 18:r.isReconnection=e.string();break;case 19:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof LC||(e=new LC(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=T(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||DC.isInteger(e.lts)||e.lts&&DC.isInteger(e.lts.low)&&DC.isInteger(e.lts.high)?null!=e.team&&e.hasOwnProperty("team")&&!DC.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!DC.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!DC.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!DC.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!DC.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!DC.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!DC.isString(e.os)?"os: string expected":null!=e.kind&&e.hasOwnProperty("kind")&&!DC.isString(e.kind)?"kind: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!DC.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!DC.isString(e.region)?"region: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!DC.isString(e.userId)?"userId: string expected":null!=e.session&&e.hasOwnProperty("session")&&!DC.isString(e.session)?"session: string expected":null!=e.duration&&e.hasOwnProperty("duration")&&!DC.isString(e.duration)?"duration: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!DC.isString(e.createdAt)?"createdAt: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!DC.isInteger(e.vid)?"vid: integer expected":null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&!DC.isString(e.isReconnection)?"isReconnection: string expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!DC.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof FC.WhiteBoardQualityDisconnection)return e;var t=new FC.WhiteBoardQualityDisconnection;return null!=e.lts&&(DC.Long?(t.lts=DC.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==T(e.lts)&&(t.lts=new DC.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.kind&&(t.kind=String(e.kind)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.session&&(t.session=String(e.session)),null!=e.duration&&(t.duration=String(e.duration)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.vid&&(t.vid=0|e.vid),null!=e.isReconnection&&(t.isReconnection=String(e.isReconnection)),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(DC.Long){var r=new DC.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.duration="",n.createdAt="",n.vid=0,n.isReconnection="",n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?DC.Long.prototype.toString.call(e.lts):t.longs===Number?new DC.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.kind&&e.hasOwnProperty("kind")&&(n.kind=e.kind),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.duration&&e.hasOwnProperty("duration")&&(n.duration=e.duration),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.isReconnection&&e.hasOwnProperty("isReconnection")&&(n.isReconnection=e.isReconnection),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,NC.util.toJSONOptions)},e}(),VC=FC.WhiteBoardQualitySample=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=DC.Long?DC.Long.fromBits(0,0,!1):0,e.prototype.team="",e.prototype.app="",e.prototype.akkoVersion="",e.prototype.sdkVersion="",e.prototype.nativeVersion="",e.prototype.platform="",e.prototype.os="",e.prototype.kind="",e.prototype.uuid="",e.prototype.region="",e.prototype.userId="",e.prototype.session="",e.prototype.maxRTT="",e.prototype.minRTT="",e.prototype.averageRTT="",e.prototype.maxQueue="",e.prototype.minQueue="",e.prototype.averageQueue="",e.prototype.maxInterval="",e.prototype.minInterval="",e.prototype.averageInterval="",e.prototype.vid=0,e.prototype.createdAt="",e.prototype.clientIP="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=jC.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(18).string(e.team),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(34).string(e.akkoVersion),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(42).string(e.sdkVersion),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(50).string(e.nativeVersion),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(58).string(e.platform),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(66).string(e.os),null!=e.kind&&Object.hasOwnProperty.call(e,"kind")&&t.uint32(74).string(e.kind),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(82).string(e.uuid),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(90).string(e.region),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(98).string(e.userId),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(106).string(e.session),null!=e.maxRTT&&Object.hasOwnProperty.call(e,"maxRTT")&&t.uint32(114).string(e.maxRTT),null!=e.minRTT&&Object.hasOwnProperty.call(e,"minRTT")&&t.uint32(122).string(e.minRTT),null!=e.averageRTT&&Object.hasOwnProperty.call(e,"averageRTT")&&t.uint32(130).string(e.averageRTT),null!=e.maxQueue&&Object.hasOwnProperty.call(e,"maxQueue")&&t.uint32(138).string(e.maxQueue),null!=e.minQueue&&Object.hasOwnProperty.call(e,"minQueue")&&t.uint32(146).string(e.minQueue),null!=e.averageQueue&&Object.hasOwnProperty.call(e,"averageQueue")&&t.uint32(154).string(e.averageQueue),null!=e.maxInterval&&Object.hasOwnProperty.call(e,"maxInterval")&&t.uint32(162).string(e.maxInterval),null!=e.minInterval&&Object.hasOwnProperty.call(e,"minInterval")&&t.uint32(170).string(e.minInterval),null!=e.averageInterval&&Object.hasOwnProperty.call(e,"averageInterval")&&t.uint32(178).string(e.averageInterval),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(184).int32(e.vid),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(194).string(e.createdAt),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(202).string(e.clientIP),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof LC||(e=LC.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new FC.WhiteBoardQualitySample;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.team=e.string();break;case 3:r.app=e.string();break;case 4:r.akkoVersion=e.string();break;case 5:r.sdkVersion=e.string();break;case 6:r.nativeVersion=e.string();break;case 7:r.platform=e.string();break;case 8:r.os=e.string();break;case 9:r.kind=e.string();break;case 10:r.uuid=e.string();break;case 11:r.region=e.string();break;case 12:r.userId=e.string();break;case 13:r.session=e.string();break;case 14:r.maxRTT=e.string();break;case 15:r.minRTT=e.string();break;case 16:r.averageRTT=e.string();break;case 17:r.maxQueue=e.string();break;case 18:r.minQueue=e.string();break;case 19:r.averageQueue=e.string();break;case 20:r.maxInterval=e.string();break;case 21:r.minInterval=e.string();break;case 22:r.averageInterval=e.string();break;case 23:r.vid=e.int32();break;case 24:r.createdAt=e.string();break;case 25:r.clientIP=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof LC||(e=new LC(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=T(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||DC.isInteger(e.lts)||e.lts&&DC.isInteger(e.lts.low)&&DC.isInteger(e.lts.high)?null!=e.team&&e.hasOwnProperty("team")&&!DC.isString(e.team)?"team: string expected":null!=e.app&&e.hasOwnProperty("app")&&!DC.isString(e.app)?"app: string expected":null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!DC.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!DC.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!DC.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!DC.isString(e.platform)?"platform: string expected":null!=e.os&&e.hasOwnProperty("os")&&!DC.isString(e.os)?"os: string expected":null!=e.kind&&e.hasOwnProperty("kind")&&!DC.isString(e.kind)?"kind: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!DC.isString(e.uuid)?"uuid: string expected":null!=e.region&&e.hasOwnProperty("region")&&!DC.isString(e.region)?"region: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!DC.isString(e.userId)?"userId: string expected":null!=e.session&&e.hasOwnProperty("session")&&!DC.isString(e.session)?"session: string expected":null!=e.maxRTT&&e.hasOwnProperty("maxRTT")&&!DC.isString(e.maxRTT)?"maxRTT: string expected":null!=e.minRTT&&e.hasOwnProperty("minRTT")&&!DC.isString(e.minRTT)?"minRTT: string expected":null!=e.averageRTT&&e.hasOwnProperty("averageRTT")&&!DC.isString(e.averageRTT)?"averageRTT: string expected":null!=e.maxQueue&&e.hasOwnProperty("maxQueue")&&!DC.isString(e.maxQueue)?"maxQueue: string expected":null!=e.minQueue&&e.hasOwnProperty("minQueue")&&!DC.isString(e.minQueue)?"minQueue: string expected":null!=e.averageQueue&&e.hasOwnProperty("averageQueue")&&!DC.isString(e.averageQueue)?"averageQueue: string expected":null!=e.maxInterval&&e.hasOwnProperty("maxInterval")&&!DC.isString(e.maxInterval)?"maxInterval: string expected":null!=e.minInterval&&e.hasOwnProperty("minInterval")&&!DC.isString(e.minInterval)?"minInterval: string expected":null!=e.averageInterval&&e.hasOwnProperty("averageInterval")&&!DC.isString(e.averageInterval)?"averageInterval: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!DC.isInteger(e.vid)?"vid: integer expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!DC.isString(e.createdAt)?"createdAt: string expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!DC.isString(e.clientIP)?"clientIP: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof FC.WhiteBoardQualitySample)return e;var t=new FC.WhiteBoardQualitySample;return null!=e.lts&&(DC.Long?(t.lts=DC.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==T(e.lts)&&(t.lts=new DC.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.team&&(t.team=String(e.team)),null!=e.app&&(t.app=String(e.app)),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.os&&(t.os=String(e.os)),null!=e.kind&&(t.kind=String(e.kind)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.region&&(t.region=String(e.region)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.session&&(t.session=String(e.session)),null!=e.maxRTT&&(t.maxRTT=String(e.maxRTT)),null!=e.minRTT&&(t.minRTT=String(e.minRTT)),null!=e.averageRTT&&(t.averageRTT=String(e.averageRTT)),null!=e.maxQueue&&(t.maxQueue=String(e.maxQueue)),null!=e.minQueue&&(t.minQueue=String(e.minQueue)),null!=e.averageQueue&&(t.averageQueue=String(e.averageQueue)),null!=e.maxInterval&&(t.maxInterval=String(e.maxInterval)),null!=e.minInterval&&(t.minInterval=String(e.minInterval)),null!=e.averageInterval&&(t.averageInterval=String(e.averageInterval)),null!=e.vid&&(t.vid=0|e.vid),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(DC.Long){var r=new DC.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.team="",n.app="",n.akkoVersion="",n.sdkVersion="",n.nativeVersion="",n.platform="",n.os="",n.kind="",n.uuid="",n.region="",n.userId="",n.session="",n.maxRTT="",n.minRTT="",n.averageRTT="",n.maxQueue="",n.minQueue="",n.averageQueue="",n.maxInterval="",n.minInterval="",n.averageInterval="",n.vid=0,n.createdAt="",n.clientIP=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?DC.Long.prototype.toString.call(e.lts):t.longs===Number?new DC.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.kind&&e.hasOwnProperty("kind")&&(n.kind=e.kind),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.maxRTT&&e.hasOwnProperty("maxRTT")&&(n.maxRTT=e.maxRTT),null!=e.minRTT&&e.hasOwnProperty("minRTT")&&(n.minRTT=e.minRTT),null!=e.averageRTT&&e.hasOwnProperty("averageRTT")&&(n.averageRTT=e.averageRTT),null!=e.maxQueue&&e.hasOwnProperty("maxQueue")&&(n.maxQueue=e.maxQueue),null!=e.minQueue&&e.hasOwnProperty("minQueue")&&(n.minQueue=e.minQueue),null!=e.averageQueue&&e.hasOwnProperty("averageQueue")&&(n.averageQueue=e.averageQueue),null!=e.maxInterval&&e.hasOwnProperty("maxInterval")&&(n.maxInterval=e.maxInterval),null!=e.minInterval&&e.hasOwnProperty("minInterval")&&(n.minInterval=e.minInterval),null!=e.averageInterval&&e.hasOwnProperty("averageInterval")&&(n.averageInterval=e.averageInterval),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,NC.util.toJSONOptions)},e}(),WC=FC.WhiteBoardRealtime=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.lts=DC.Long?DC.Long.fromBits(0,0,!1):0,e.prototype.akkoVersion="",e.prototype.app="",e.prototype.createdAt="",e.prototype.level="",e.prototype.message="",e.prototype.os="",e.prototype.platform="",e.prototype.region="",e.prototype.sdkVersion="",e.prototype.session="",e.prototype.team="",e.prototype.userId="",e.prototype.uuid="",e.prototype.vid=0,e.prototype.nativeVersion="",e.prototype.clientIP="",e.prototype.suid="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=jC.create()),null!=e.lts&&Object.hasOwnProperty.call(e,"lts")&&t.uint32(8).int64(e.lts),null!=e.akkoVersion&&Object.hasOwnProperty.call(e,"akkoVersion")&&t.uint32(18).string(e.akkoVersion),null!=e.app&&Object.hasOwnProperty.call(e,"app")&&t.uint32(26).string(e.app),null!=e.createdAt&&Object.hasOwnProperty.call(e,"createdAt")&&t.uint32(34).string(e.createdAt),null!=e.level&&Object.hasOwnProperty.call(e,"level")&&t.uint32(42).string(e.level),null!=e.message&&Object.hasOwnProperty.call(e,"message")&&t.uint32(50).string(e.message),null!=e.os&&Object.hasOwnProperty.call(e,"os")&&t.uint32(58).string(e.os),null!=e.platform&&Object.hasOwnProperty.call(e,"platform")&&t.uint32(66).string(e.platform),null!=e.region&&Object.hasOwnProperty.call(e,"region")&&t.uint32(74).string(e.region),null!=e.sdkVersion&&Object.hasOwnProperty.call(e,"sdkVersion")&&t.uint32(82).string(e.sdkVersion),null!=e.session&&Object.hasOwnProperty.call(e,"session")&&t.uint32(90).string(e.session),null!=e.team&&Object.hasOwnProperty.call(e,"team")&&t.uint32(98).string(e.team),null!=e.userId&&Object.hasOwnProperty.call(e,"userId")&&t.uint32(106).string(e.userId),null!=e.uuid&&Object.hasOwnProperty.call(e,"uuid")&&t.uint32(114).string(e.uuid),null!=e.vid&&Object.hasOwnProperty.call(e,"vid")&&t.uint32(120).int32(e.vid),null!=e.nativeVersion&&Object.hasOwnProperty.call(e,"nativeVersion")&&t.uint32(130).string(e.nativeVersion),null!=e.clientIP&&Object.hasOwnProperty.call(e,"clientIP")&&t.uint32(138).string(e.clientIP),null!=e.suid&&Object.hasOwnProperty.call(e,"suid")&&t.uint32(146).string(e.suid),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof LC||(e=LC.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new FC.WhiteBoardRealtime;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.lts=e.int64();break;case 2:r.akkoVersion=e.string();break;case 3:r.app=e.string();break;case 4:r.createdAt=e.string();break;case 5:r.level=e.string();break;case 6:r.message=e.string();break;case 7:r.os=e.string();break;case 8:r.platform=e.string();break;case 9:r.region=e.string();break;case 10:r.sdkVersion=e.string();break;case 11:r.session=e.string();break;case 12:r.team=e.string();break;case 13:r.userId=e.string();break;case 14:r.uuid=e.string();break;case 15:r.vid=e.int32();break;case 16:r.nativeVersion=e.string();break;case 17:r.clientIP=e.string();break;case 18:r.suid=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof LC||(e=new LC(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!=T(e)||null===e?"object expected":null==e.lts||!e.hasOwnProperty("lts")||DC.isInteger(e.lts)||e.lts&&DC.isInteger(e.lts.low)&&DC.isInteger(e.lts.high)?null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&!DC.isString(e.akkoVersion)?"akkoVersion: string expected":null!=e.app&&e.hasOwnProperty("app")&&!DC.isString(e.app)?"app: string expected":null!=e.createdAt&&e.hasOwnProperty("createdAt")&&!DC.isString(e.createdAt)?"createdAt: string expected":null!=e.level&&e.hasOwnProperty("level")&&!DC.isString(e.level)?"level: string expected":null!=e.message&&e.hasOwnProperty("message")&&!DC.isString(e.message)?"message: string expected":null!=e.os&&e.hasOwnProperty("os")&&!DC.isString(e.os)?"os: string expected":null!=e.platform&&e.hasOwnProperty("platform")&&!DC.isString(e.platform)?"platform: string expected":null!=e.region&&e.hasOwnProperty("region")&&!DC.isString(e.region)?"region: string expected":null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&!DC.isString(e.sdkVersion)?"sdkVersion: string expected":null!=e.session&&e.hasOwnProperty("session")&&!DC.isString(e.session)?"session: string expected":null!=e.team&&e.hasOwnProperty("team")&&!DC.isString(e.team)?"team: string expected":null!=e.userId&&e.hasOwnProperty("userId")&&!DC.isString(e.userId)?"userId: string expected":null!=e.uuid&&e.hasOwnProperty("uuid")&&!DC.isString(e.uuid)?"uuid: string expected":null!=e.vid&&e.hasOwnProperty("vid")&&!DC.isInteger(e.vid)?"vid: integer expected":null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&!DC.isString(e.nativeVersion)?"nativeVersion: string expected":null!=e.clientIP&&e.hasOwnProperty("clientIP")&&!DC.isString(e.clientIP)?"clientIP: string expected":null!=e.suid&&e.hasOwnProperty("suid")&&!DC.isString(e.suid)?"suid: string expected":null:"lts: integer|Long expected"},e.fromObject=function(e){if(e instanceof FC.WhiteBoardRealtime)return e;var t=new FC.WhiteBoardRealtime;return null!=e.lts&&(DC.Long?(t.lts=DC.Long.fromValue(e.lts)).unsigned=!1:"string"==typeof e.lts?t.lts=parseInt(e.lts,10):"number"==typeof e.lts?t.lts=e.lts:"object"==T(e.lts)&&(t.lts=new DC.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber())),null!=e.akkoVersion&&(t.akkoVersion=String(e.akkoVersion)),null!=e.app&&(t.app=String(e.app)),null!=e.createdAt&&(t.createdAt=String(e.createdAt)),null!=e.level&&(t.level=String(e.level)),null!=e.message&&(t.message=String(e.message)),null!=e.os&&(t.os=String(e.os)),null!=e.platform&&(t.platform=String(e.platform)),null!=e.region&&(t.region=String(e.region)),null!=e.sdkVersion&&(t.sdkVersion=String(e.sdkVersion)),null!=e.session&&(t.session=String(e.session)),null!=e.team&&(t.team=String(e.team)),null!=e.userId&&(t.userId=String(e.userId)),null!=e.uuid&&(t.uuid=String(e.uuid)),null!=e.vid&&(t.vid=0|e.vid),null!=e.nativeVersion&&(t.nativeVersion=String(e.nativeVersion)),null!=e.clientIP&&(t.clientIP=String(e.clientIP)),null!=e.suid&&(t.suid=String(e.suid)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(DC.Long){var r=new DC.Long(0,0,!1);n.lts=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.lts=t.longs===String?"0":0;n.akkoVersion="",n.app="",n.createdAt="",n.level="",n.message="",n.os="",n.platform="",n.region="",n.sdkVersion="",n.session="",n.team="",n.userId="",n.uuid="",n.vid=0,n.nativeVersion="",n.clientIP="",n.suid=""}return null!=e.lts&&e.hasOwnProperty("lts")&&("number"==typeof e.lts?n.lts=t.longs===String?String(e.lts):e.lts:n.lts=t.longs===String?DC.Long.prototype.toString.call(e.lts):t.longs===Number?new DC.LongBits(e.lts.low>>>0,e.lts.high>>>0).toNumber():e.lts),null!=e.akkoVersion&&e.hasOwnProperty("akkoVersion")&&(n.akkoVersion=e.akkoVersion),null!=e.app&&e.hasOwnProperty("app")&&(n.app=e.app),null!=e.createdAt&&e.hasOwnProperty("createdAt")&&(n.createdAt=e.createdAt),null!=e.level&&e.hasOwnProperty("level")&&(n.level=e.level),null!=e.message&&e.hasOwnProperty("message")&&(n.message=e.message),null!=e.os&&e.hasOwnProperty("os")&&(n.os=e.os),null!=e.platform&&e.hasOwnProperty("platform")&&(n.platform=e.platform),null!=e.region&&e.hasOwnProperty("region")&&(n.region=e.region),null!=e.sdkVersion&&e.hasOwnProperty("sdkVersion")&&(n.sdkVersion=e.sdkVersion),null!=e.session&&e.hasOwnProperty("session")&&(n.session=e.session),null!=e.team&&e.hasOwnProperty("team")&&(n.team=e.team),null!=e.userId&&e.hasOwnProperty("userId")&&(n.userId=e.userId),null!=e.uuid&&e.hasOwnProperty("uuid")&&(n.uuid=e.uuid),null!=e.vid&&e.hasOwnProperty("vid")&&(n.vid=e.vid),null!=e.nativeVersion&&e.hasOwnProperty("nativeVersion")&&(n.nativeVersion=e.nativeVersion),null!=e.clientIP&&e.hasOwnProperty("clientIP")&&(n.clientIP=e.clientIP),null!=e.suid&&e.hasOwnProperty("suid")&&(n.suid=e.suid),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,NC.util.toJSONOptions)},e}();!function(e){e.Connected="connected",e.ConnectFailed="connectFailed",e.Sample="sample"}(OC||(OC={}));var HC,_C=Object.freeze({Realtime:Object.freeze({eventID:9115,proto:WC}),Player:Object.freeze({eventID:9118,proto:zC})}),GC=Object.freeze({QualityConnection:Object.freeze({eventID:9120,proto:BC}),QualityDisconnection:Object.freeze({eventID:9121,proto:UC}),QualitySample:Object.freeze({eventID:9123,proto:VC})});function YC(e,t){var n,r=function(){var e=window.__nativeTags;if("object"==T(e)&&null!==e){var t=e.nativeVersion,n=e.platform;if("string"==typeof t&&"string"==typeof n)return{nativeVersion:t,platform:n}}return null}(),i={team:e,app:t,platform:(null==r?void 0:r.platform)||"browser",akkoVersion:We,sdkVersion:Bk.sdkVersion,nativeVersion:null==r?void 0:r.nativeVersion,os:null==(n=window.navigator)?void 0:n.platform};for(var a in i)void 0===i[a]&&delete i[a];return i}!function(e){e.AlwaysReport="alwaysReport",e.BanReport="banReport",e.DependsOnRemote="dependsOnRemote"}(HC||(HC={}));var XC=function(){function e(t,n,r){I(this,e),this.teamUUID=t,this.appUUID=n,this.loggerHub=this.createLoggerHub(r)}return M(e,[{key:"createLoggerHub",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n="[White]",r=t.reportDebugLogMode||HC.AlwaysReport;switch(r){case HC.BanReport:e=new Hc({prefix:n,levelMask:t.printLevelMask});break;case HC.AlwaysReport:case HC.DependsOnRemote:var i=Bk.log.argusOptions,a=i.reportResourceURL,o=i.vid;e=new RC({vid:o,reportResourceURL:a,prefix:n,reportLevelMask:t.reportLevelMask,printLevelMask:t.printLevelMask,timestampKey:"createdAt",events:_C});break;default:throw new Error("unrecognized LoggerReportMode ".concat(JSON.stringify(r)))}return e}},{key:"createRealtimeLogger",value:function(e,t,n){var r=Object.freeze(_(H({},YC(this.teamUUID,this.appUUID)),{uuid:e,uid:t,suid:t,region:n}));return Gc(this.loggerHub,"Realtime",r)}},{key:"createPlayerLogger",value:function(e){var t=Object.freeze(_(H({},YC(this.teamUUID,this.appUUID)),{region:e}));return Gc(this.loggerHub,"Player",t)}}]),e}(),qC=function(){function e(t,n){I(this,e);var r=Bk.log.argusOptions,i=r.reportResourceURL,a=r.vid;this.loggerHub=new RC({vid:a,reportResourceURL:i,timestampKey:"createdAt",events:GC}),this.teamUUID=t,this.appUUID=n}return M(e,[{key:"createQualityConnectionCommitter",value:function(e,t){var n=Object.freeze(_(H({},YC(this.teamUUID,this.appUUID)),{kind:OC.Connected,uuid:e,region:t}));return Qc(this.loggerHub,"QualityConnection",n)}},{key:"createQualityDisconnectionCommitter",value:function(e,t){var n=Object.freeze(_(H({},YC(this.teamUUID,this.appUUID)),{kind:OC.ConnectFailed,uuid:e,region:t}));return Qc(this.loggerHub,"QualityDisconnection",n)}},{key:"createQualitySampleCommitter",value:function(e,t){var n=Object.freeze(_(H({},YC(this.teamUUID,this.appUUID)),{kind:OC.Sample,uuid:e,region:t}));return Qc(this.loggerHub,"QualitySample",n)}}]),e}();function QC(e){return e}var KC;!function(e){e.Desktop="desktop",e.Phone="phone",e.Pad="pad",e.TV="tv"}(KC||(KC={}));var ZC=function(){function e(t){var n;I(this,e),this.version=Bk.sdkVersion;var r=this.parseAppIdentifier(t.appIdentifier),i=r.teamUUID,a=r.appUUID;if(t.deviceType&&t.screenType)this.deviceType=t.deviceType,this.screenType=t.screenType;else if(t.deviceType&&!t.screenType)this.deviceType=t.deviceType,this.screenType=t.deviceType===ld.Desktop?KC.Desktop:KC.Phone;else if(!t.deviceType&&t.screenType)this.deviceType=t.screenType===KC.Desktop?ld.Desktop:ld.Touch,this.screenType=t.screenType;else switch(Xk.default.deviceType){case"mouseOnly":this.deviceType=ld.Desktop,this.screenType=KC.Desktop;break;case"touchOnly":this.deviceType=ld.Touch,this.screenType=KC.Phone;break;case"hybrid":this.deviceType=ld.Surface,this.screenType=KC.Desktop}if(t.renderEngine===WS.SVG||this.isCanvasRenderEngineAvailable()?t.renderEngine?this.renderEngine=t.renderEngine:this.renderEngine=WS.Canvas:this.renderEngine=WS.SVG,this.region=t.region||Bk.defaultRegion,this.pptParams=t.pptParams,void 0!==(null==(n=t.loggerOptions)?void 0:n.disableReportLog))throw new Error("loggserOptions.disableReportLog is deprecated. please replace it with reportDebugLogMode or reportQualityMode");this.enableReportQuality(t.loggerOptions)&&(this.qualityLoggerFactory=new qC(i,a)),this.whiteLoggerFactory=new XC(i,a,t.loggerOptions),this.akkoApp=new Oc({appIdentifier:t.appIdentifier,observerAdapter:new nw,clientVersion:Bk.sdkVersion,enableAnimationFrame:!0,jsxFactory:qk.createElement,escapeObjectFilter:qk.isValidElement,reconnectionOptions:t.reconnectionOptions,netStateAdapter:e.netState,convertIdToUrl:t.urlInterrupter||function(e){return e},configsInterrupter:QC,shuntApiHosts:Bk.shuntApiHosts,onAkkoSetupFailed:t.onWhiteSetupFailed}),this.preloadDynamicPPT=!!t.preloadDynamicPPT,this.fonts=Object.freeze(H({},t.fonts)),this.handToolKey=t.handToolKey,this.fontFamily=t.fontFamily,this.urlInterrupter=t.urlInterrupter||function(e){return e},this.boundless=new Sd(this.deviceType),this.plugins=this.assertPlugins(t.plugins),this.invisiblePlugins=this.assertInvisiblePlugins(t.invisiblePlugins),this.wrappedComponents=Object.freeze(t.wrappedComponents?p(t.wrappedComponents):[]),this.useMobXState=!!t.useMobXState,this.onlyCallbackRemoteStateModify=!!t.onlyCallbackRemoteStateModify,$x.injectDefaultStyleIfNotInjectBefore()}var t,n,r;return M(e,[{key:"joinRoom",value:(r=l(regeneratorRuntime.mark((function t(n,r){var i,a,o,s,c,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=n.uuid,a=n.region||this.region,o=this.standardizeUserPayload(n.uid,n.userPayload),s=this.whiteLoggerFactory.createRealtimeLogger(i,o.uid,a),c=this.qualityLoggerFactory&&{connection:this.qualityLoggerFactory.createQualityConnectionCommitter(i,a),disconnection:this.qualityLoggerFactory.createQualityDisconnectionCommitter(i,a),sample:this.qualityLoggerFactory.createQualitySampleCommitter(i,a)},u=new dC({whiteLogger:s,qualityComitters:c,region:a,boundless:this.boundless,screenType:this.screenType,renderEngine:this.renderEngine,autoResize:!n.disableAutoResize,plugins:this.plugins,invisiblePlugins:this.mergeArray(this.invisiblePlugins,this.assertInvisiblePlugins(n.invisiblePlugins)),wrappedComponents:this.mergeArray(this.wrappedComponents,n.wrappedComponents),akkoApp:this.akkoApp,preloadDynamicPPT:this.preloadDynamicPPT,userFonts:this.fonts,handToolKey:this.handToolKey,fontFamily:this.fontFamily,cameraBound:this.standardizeCameraBound(n.cameraBound),userPayload:o,disableDeviceInputs:!!n.disableDeviceInputs,disableCameraTransform:n.disableCameraTransform,disableMagixEventDispatchLimit:!!n.disableMagixEventDispatchLimit,disableEraseImage:!!n.disableEraseImage,disableOthersSelectingBox:!!n.disableOthersSelectingBox,disablePencilWrittingLimitFrequency:!!n.disablePencilWrittingLimitFrequency,useMultiViews:n.useMultiViews,onlyCallbackRemoteStateModify:this.onlyCallbackRemoteStateModify,cursorAdapter:n.cursorAdapter,hotKeys:n.hotKeys,rejectWhenReadonlyErrorLevel:n.rejectWhenReadonlyErrorLevel,eraserRadiusCursor:new Mw(s),urlInterrupter:this.urlInterrupter,pptParams:this.pptParams,useMobXState:this.useMobXState,floatBarOptions:gC(n.floatBar),callbacks:r}),t.next=3,u.connect({uuid:i,region:a,roomToken:n.roomToken,userPayload:o,deviceType:this.deviceType,isWritable:e.defaultValue(n.isWritable,!0),enableDrawPoint:e.defaultValue(n.enableDrawPoint,!1),disableNewPencil:e.defaultValue(n.disableNewPencil,!0)});case 3:return t.abrupt("return",u);case 4:case"end":return t.stop()}}),t,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"isPlayable",value:(n=l(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={region:t.region||this.region,room:t.room,roomToken:t.roomToken,slice:t.slice,beginTimestamp:t.beginTimestamp,duration:t.duration},e.next=3,this.akkoApp.searchSlices(n);case 3:return e.t0=e.sent.length,e.abrupt("return",e.t0>0);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"replayRoom",value:(t=l(regeneratorRuntime.mark((function e(t,n){var r,i,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.mediaURL){e.next=2;break}throw new Error("mediaURL was deprecated. please to see https://github.com/netless-io/netless-combine-player");case 2:return r=t.region||this.region,i=this.whiteLoggerFactory.createPlayerLogger(r),a=new vC({logger:i,region:r,boundless:this.boundless,screenType:this.screenType,renderEngine:this.renderEngine,autoResize:!t.disableAutoResize,plugins:this.plugins,invisiblePlugins:this.mergeArray(this.invisiblePlugins,this.assertInvisiblePlugins(t.invisiblePlugins)),wrappedComponents:this.mergeArray(this.wrappedComponents,t.wrappedComponents),preloadDynamicPPT:this.preloadDynamicPPT,userFonts:this.fonts,handToolKey:this.handToolKey,fontFamily:this.fontFamily,cameraBound:this.standardizeCameraBound(t.cameraBound),onlyCallbackRemoteStateModify:this.onlyCallbackRemoteStateModify,disableCameraTransform:t.disableCameraTransform,disableOthersSelectingBox:!!t.disableOthersSelectingBox,useMultiViews:t.useMultiViews,cursorAdapter:t.cursorAdapter,eraserRadiusCursor:new Mw(i),urlInterrupter:this.urlInterrupter,pptParams:this.pptParams,useMobXState:this.useMobXState,callbacks:n}),e.next=5,a.setupReconstructor({akkoApp:this.akkoApp,region:r,slice:t.slice,room:t.room,roomToken:t.roomToken,beginTimestamp:t.beginTimestamp,duration:t.duration});case 5:return e.abrupt("return",a);case 6:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"standardizeUserPayload",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t;if(void 0===e)throw new Error("expect uid on parameters");if("string"!=typeof e)throw new Error("invalid uid. ".concat(e," should be string"));if(e.length>1024)throw new Error("invalid uid. length cannot over ".concat(1024));if("object"!=T(n)||null===n)throw new Error("invalid payload. ".concat(n," should be object"));if("uid"in(n=H({},n))&&n.uid!==e)throw new Error("payload did have uid ".concat(n.uid," that is not equals to ").concat(e));return n.uid=e,n}},{key:"pptConverter",value:function(e){return new jw(e)}},{key:"standardizeCameraBound",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return H({maxContentMode:pS(10),minContentMode:pS(.1),width:1/0,height:1/0},e)}},{key:"enableReportQuality",value:function(e){return(null==e?void 0:e.reportQualityMode)!==HC.BanReport}},{key:"isCanvasRenderEngineAvailable",value:function(){var e=document.createElement("canvas");if(void 0===e)return!1;var t=e.getContext("2d");if(null===t)return!1;for(var n=0,r=["setTransform","translate","scale","drawImage","getTransform","resetTransform","clearRect","fillStyle","lineWidth","strokeStyle","lineJoin","lineCap","beginPath","moveTo","quadraticCurveTo","bezierCurveTo","stroke","lineTo","arc","fill","ellipse","setLineDash","strokeRect","closePath"];n<r.length;n++){if(!(r[n]in t))return!1}return!0}},{key:"parseAppIdentifier",value:function(e){if(!/^[0-9a-zA-Z\-_]+\/[0-9a-zA-Z\-_]+$/.test(e))throw new Error("find invalid appIdentifier: ".concat(JSON.stringify(e)));var t=h(e.split("/"),2);return{teamUUID:t[0],appUUID:t[1]}}},{key:"assertPlugins",value:function(e){var t;return e&&(e instanceof FS?t=e:console.warn("plugins is not instance of Plugins. plugins will not be working. you should call createPlugins() to create it")),t||(t=new FS({})),t}},{key:"assertInvisiblePlugins",value:function(e){var t=[];if(e){var n,r=A(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;this.isValidInvisiblePluginClass(i)&&t.push(i)}}catch(e){r.e(e)}finally{r.f()}}return Object.freeze(t)}},{key:"isValidInvisiblePluginClass",value:function(e){if("string"!=typeof e.kind)return console.warn("invisible plugin class is invalid. expect `public static readonly kind: string = 'xxx';`"),!1;for(var t=e.prototype;null!==t;){if(t===BS.prototype)return!0;t=Object.getPrototypeOf(t)}return console.warn("invisible plugin class is not extends InvisiblePlugin"),!1}},{key:"mergeArray",value:function(e,t){var n=p(e);if(t){var r,i=A(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;-1===e.indexOf(a)&&n.push(a)}}catch(e){i.e(e)}finally{i.f()}}return n}}],[{key:"defaultValue",value:function(e,t){return void 0===e?t:e}}]),e}();function JC(e){return e instanceof dC}function $C(e){return e instanceof vC}ZC.netState=new rw;var eI=Bk.sdkVersion;
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
/**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */}).call(this,n("tjlA").Buffer,n("yLpj"),n("8oxB"))},zLF4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("aHma")),i=a(n("pMVe"));function a(e){return e&&e.__esModule?e:{default:e}}var o=(0,r.default)("v3",48,i.default);t.default=o,e.exports=t.default}}]);